import{d as W,u as Z,l as $,q as ee,i as g,j as te,N as ne,O as ae,s as oe,k as S,M as k,_ as ie,r as q,a as Q,o as _,b as n,c as l,w as v,f as w,t as c,F as A,B as G,C as se,D as re}from"./index-Dd8-myui.js";import{A as D}from"./ApiQuestionSet-wCWw8J7f.js";import{Q as x}from"./questionTypes-CS3lcRlq.js";import{T as le}from"./TransferQuestionData-Bl0XXg5D.js";import{V as de}from"./Validator-CWeiTIFe.js";import{I as ue}from"./Input-BtmZP41X.js";import{T as ce}from"./TextArea-DyOic0o8.js";import{S as me,O as pe,M as ge,a as fe}from"./ShortText-B2lmwy7J.js";import{G as _e,I as ve}from"./GenerateQSModal-BLpofKFx.js";import"./vue-draggable-plus-CKvOH8GT.js";import"./ApiTestTemplate-x2TAPrW4.js";const he=W({__name:"update",setup(u,{expose:o}){o();const{t:V}=Z(),e=$(),M=ee(),T=g(!1),p=g(M.params.id),h=g({id:"",name:"",description:"",tags:[]}),I=g([]),m=g(!0),U=async()=>{if(T.value=!0,!de.isValidGuid(p.value)){m.value=!1,e.push({name:"404"});return}let a=await D.GetDetailById(p.value),s=await D.GetQuestionById(p.value);if(!a.data.success||!s.data.success){m.value=!1,e.push({name:"404"});return}h.value=a.data.data,I.value=s.data.data,t.name=h.value.name,t.createUpdateQuestions=I.value.map(f=>le.transformResponseToRequest(f)),t.createUpdateTags=h.value.tags,T.value=!1,window.addEventListener("beforeunload",C)},d=g(),t=te({name:"",description:"",createUpdateQuestions:[],deleteQuestionIds:[],createUpdateTags:[],deleteTagIds:[]}),y={title:[{required:"true",message:"This field is required",trigger:"change"},{length:100,message:"Limit 100",trigger:"change"}],description:[{length:200,message:"Limit 200",trigger:"change"}],tags:[{validator:(a,s)=>s&&s.length>5?Promise.reject("You can only add up to 5 tags."):Promise.resolve(),trigger:"change"}],questions:[{validator:(a,s)=>s&&s.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},P={MultipleChoice:fe,Matching:ge,Ordering:pe,ShortText:me},R=()=>({id:"",type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),B=()=>{if(t.createUpdateQuestions.length>=100){S.warning("Each question set could have at most 100 questions");return}t.createUpdateQuestions.push(R())},N=a=>{if(t.createUpdateQuestions.length<=1){S.warning("Each question set must have at least 1 questions");return}const s=t.createUpdateQuestions[a].id;s&&t.deleteQuestionIds.push(s),t.createUpdateQuestions.splice(a,1)},F=()=>{let a=!1,s="Invalid question.",f=new Set;if(t.name.trim().length>100||t.name.trim().length===0){a=!0,s="Invalid title.",S.error(s);return}if(t.description.trim().length>250){a=!0,s="Invalid description.",S.error(s);return}[t.createUpdateQuestions.filter(i=>{const r=i.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return r.length===0||r.length>=500}),t.createUpdateQuestions.filter(i=>(i.explainText?i.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),t.createUpdateQuestions.filter(i=>i.type===x.MULTIPLE_CHOICE&&(i.multipleChoices.some(r=>r.text.trim().length===0||r.text.trim().length>500)||i.multipleChoices.filter(r=>r.isAnswer).length===0)),t.createUpdateQuestions.filter(i=>i.type===x.MATCHING&&(i.matchingPairs.some(r=>r.leftItem.trim().length===0||r.leftItem.trim().length>500)||i.matchingPairs.some(r=>r.rightItem.trim().length===0||r.rightItem.trim().length>500))),t.createUpdateQuestions.filter(i=>i.type===x.ORDERING&&i.orderingItems.some(r=>r.text.trim().length===0||r.text.trim().length>500)),t.createUpdateQuestions.filter(i=>i.type===x.SHORT_TEXT&&(i.shortAnswer.trim().length===0||i.shortAnswer.trim().length>500))].forEach(i=>{i.length>0&&(a=!0,i.forEach(r=>f.add(r)))});let K=Array.from(f).map(i=>t.createUpdateQuestions.indexOf(i)+1);a?k.error({title:"Cannot create new question set!",content:"There are errors at questions: "+K.sort().join(", ")}):z()},z=()=>{k.confirm({title:"Create new quiz!",content:"Make sure to review your contents before proceeding.",centered:!0,onOk:async()=>{let a=await D.Update(p.value,t);a.data.success&&S.success(a.data.data)}})},b=g(""),j=()=>{if(t.createUpdateTags.length>=5){S.warning("Limit : 5 tags");return}b.value&&b.value.trim().length<=50?(t.createUpdateTags.push({id:"",text:b.value}),b.value=""):S.warning("Invalid tag content")},H=a=>{t.createUpdateTags.splice(a,1);const s=t.createUpdateTags[a].id;t.deleteTagIds.push(s)},O=g(null),Y=()=>{var a;(a=O.value)==null||a.openImportModal()},L=g(null),X=()=>{var a;(a=L.value)==null||a.openGenerateAIModal()},J=a=>{t.createUpdateQuestions.push(...a)};function C(a){a.preventDefault(),a.returnValue=""}ne((a,s,f)=>{if(!m.value){f();return}k.confirm({title:"Leave already?",content:"You have unsaved changes.",onOk:()=>{f()},onCancel:()=>f(!1)})}),ae(()=>{window.removeEventListener("beforeunload",C)}),oe(async()=>{await U()});const E={t:V,router:e,route:M,loading:T,questionSetId:p,questionSetDetail:h,questionSetQuestions:I,isDataValid:m,getTestTemplate:U,formRef:d,formState:t,rules:y,componentMap:P,createQuestionTemplate:R,onAddQuestion:B,onRemoveQuestion:N,onFinish:F,showModalConfirmation:z,tagContent:b,addTag:j,removeTag:H,importModalRef:O,onOpenImportModal:Y,generateModalRef:L,openGenerateAIModal:X,onModalImport:J,handleBeforeUnload:C,Input:ue,TextArea:ce,ImportQSModal:ve,GenerateQSModal:_e};return Object.defineProperty(E,"__isScriptSetup",{enumerable:!1,value:!0}),E}}),Se={class:"page-container"},Qe={class:"title-container"},Ie={class:"content"},be={class:"content-item"},qe={class:"content-item-title"},we={class:"d-flex"},Te={class:"form-item"},Ue={class:"tag-container"},xe=["onClick"],Me={class:"tag-inputter"},ye={class:"content-item"},Ce={class:"content-item-title"},ke={class:"content-item-buttons"},Ae={class:"import-button"},De={key:0},Ve={key:1,class:"list-question-container"};function Re(u,o,V,e,M,T){const p=q("RouterLink"),h=q("a-col"),I=q("a-row"),m=q("a-skeleton"),U=q("a-form");return _(),Q(A,null,[n("div",Se,[n("div",Qe,[l(I,{class:"w-100 d-flex align-items-center"},{default:v(()=>[l(h,{span:1},{default:v(()=>[l(p,{to:{name:"User_Library"}},{default:v(()=>o[4]||(o[4]=[n("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[4]})]),_:1}),l(h,{class:"main-title",span:23},{default:v(()=>[n("span",null,c(u.$t("create_QS.title")),1),o[5]||(o[5]=w()),o[6]||(o[6]=n("br",null,null,-1)),n("span",null,c(u.$t("create_QS.sub_title")),1)]),_:1,__:[5,6]})]),_:1})]),n("div",Ie,[l(U,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":o[3]||(o[3]=d=>e.formState=d),rules:e.rules,ref:"formRef"},{default:v(()=>[n("div",be,[n("div",qe,[n("div",null,[n("span",null,c(u.$t("create_QS.quiz.question_detail_title")),1),n("span",null,c(u.$t("create_QS.quiz.question_detail_sub_title")),1)])]),l(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":o[0]||(o[0]=d=>e.formState.name=d),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),n("div",we,[l(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":o[1]||(o[1]=d=>e.formState.description=d),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"]),n("div",Te,[n("label",null,c(u.$t("create_QS.quiz.tag")),1),n("div",Ue,[(_(!0),Q(A,null,G(e.formState.createUpdateTags,(d,t)=>(_(),Q("div",{class:"tag-item",key:t},[w(c(d)+" ",1),n("i",{class:"bx bx-x",onClick:y=>e.removeTag(t)},null,8,xe)]))),128))]),n("div",Me,[l(e.Input,{modelValue:e.tagContent,"onUpdate:modelValue":o[2]||(o[2]=d=>e.tagContent=d),placeholder:e.t("question_sets_index.search_placeholder"),"max-length":50},{icon:v(()=>o[7]||(o[7]=[n("i",{class:"bx bx-purchase-tag-alt"},null,-1)])),_:1},8,["modelValue","placeholder"]),n("i",{class:"bx bx-plus tag-inputter-button",onClick:e.addTag})])])])]),n("div",ye,[n("div",Ce,[n("div",null,[n("span",null,c(u.$t("create_QS.quiz.question_question_title")),1),n("span",null,c(u.$t("create_QS.quiz.question_question_sub_title")),1)]),n("div",ke,[l(p,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:v(()=>[w(c(u.$t("create_QS.buttons.import"))+" ",1),o[8]||(o[8]=n("i",{class:"bx bx-download"},null,-1))]),_:1,__:[8]}),l(p,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:v(()=>[w(c(u.$t("create_QS.buttons.generated_by_ai"))+" ",1),o[9]||(o[9]=n("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[9]}),n("div",{class:"import-button",onClick:e.onFinish},c(u.$t("create_QS.buttons.create")),1),n("div",Ae,c(u.$t("create_QS.quiz.total",{number:e.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1)])]),e.loading?(_(),Q("div",De,[l(m,{loading:e.loading,active:""},null,8,["loading"]),l(m,{loading:e.loading,active:""},null,8,["loading"]),l(m,{loading:e.loading,active:""},null,8,["loading"]),l(m,{loading:e.loading,active:""},null,8,["loading"]),l(m,{loading:e.loading,active:""},null,8,["loading"])])):(_(),Q("div",Ve,[(_(!0),Q(A,null,G(e.formState.createUpdateQuestions,(d,t)=>(_(),Q("div",{key:d.id},[(_(),se(re(e.componentMap[d.type]),{question:d,index:t+1,displayScore:!0,onDeleteQuestion:y=>e.onRemoveQuestion(t)},null,40,["question","index","onDeleteQuestion"]))]))),128)),n("div",{class:"add-question-btn",onClick:e.onAddQuestion},[o[10]||(o[10]=n("i",{class:"bx bx-plus"},null,-1)),w(" "+c(u.$t("create_QS.buttons.add_question")),1)])]))])]),_:1},8,["modelValue"])])]),l(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,onImport:e.onModalImport},null,8,["title"]),l(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport},null,8,["title"])],64)}const Xe=ie(he,[["render",Re],["__scopeId","data-v-ef9cef6a"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/question_sets/update.vue"]]);export{Xe as default};

import{d as ie,u as ce,q as de,l as me,i as m,j as ue,V as fe,W as pe,s as Te,k as S,X as h,M as L,_ as ge,r as w,a as he,o as z,b as r,c,w as u,t as P,f as N,G as K,N as ve,F as _e}from"./index-C2jtDg6B.js";import{A as Me}from"./ApiClass-UU0KI_4U.js";import{A as Se}from"./ApiTest-RSE37fQt.js";import{Q as D}from"./questionTypes-CS3lcRlq.js";import{T as we,a as qe,C as Ie,b as Ce,c as Re,d as Ae,S as ye}from"./ChooseQuestionModal-DLcSos8M.js";import{S as De,O as Fe,M as xe,a as ke,s as be,b as Oe}from"./vue-virtual-scroller.esm-D8MvBVCq.js";import{T as Ee}from"./TransferQuestionData-Bl0XXg5D.js";import{V as Qe}from"./Validator-CWeiTIFe.js";import"./Input-0Otcuoto.js";import"./utc-BGTnualw.js";import"./ApiFolder-DE_T1vB3.js";import"./folderShareMode-BudLQ2R2.js";import"./ApiTestTemplate-Ds5LzdWO.js";import"./TextArea-SkV_8IH8.js";/* empty css                                                                 */import"./vue-draggable-plus-DALPiNCD.js";const Be=ie({__name:"create",setup(F,{expose:l}){l();const U={MultipleChoice:ke,Matching:xe,Ordering:Fe,ShortText:De},{t}=ce(),x=de(),v=me(),f=m(!0),_=m(),q=async()=>{if(!Qe.isValidGuid(o.classId)){f.value=!1,v.push({name:"404"});return}const e=await Me.GetById(o.classId);if(!e.data.success){f.value=!1,v.push({name:"404"});return}_.value=e.data.data},I=m(),o=ue({name:"",classId:x.params.id.toString()||"",timeLimit:60,startTime:"",endTime:"",gradeAttemptMethod:qe.HIGHEST_SCORE,gradeQuestionMethod:we.PARTIAL,isShowCorrectAnswerInReview:!0,isAllowReviewAfterSubmit:!0,shuffle:2,maxAttempt:2,passingScore:50,questions:[]}),C={title:[{required:"true",message:"This field is required",trigger:"change"},{length:100,message:"Limit 100",trigger:"change"}],description:[{length:200,message:"Limit 200",trigger:"change"}],tags:[{validator:(e,s)=>s&&s.length>5?Promise.reject("You can only add up to 5 tags."):Promise.resolve(),trigger:"change"}],questions:[{validator:(e,s)=>s&&s.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},d=()=>({id:Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),R=()=>{if(o.questions.length>=10){S.warning("Each question set could have at most 100 questions");return}o.questions=[...o.questions,d()],h(()=>{var e,s;(s=(e=T.value)==null?void 0:e.forceUpdate)==null||s.call(e),h(()=>{const i=o.questions.length;requestAnimationFrame(()=>{var g;(g=T.value)==null||g.scrollToItem(i)})})})},V=e=>{if(o.questions.length<=1){S.warning("Each question set must have at least 1 questions");return}o.questions=[...o.questions.slice(0,e),...o.questions.slice(e+1)]},Z=async()=>{var M;await((M=I.value)==null?void 0:M.validate());let e=!1,s="Invalid question.",i=new Set;if(o.name.trim().length>100||o.name.trim().length===0){e=!0,s="Invalid title.",S.error(s),k();return}[o.questions.filter(n=>{const a=n.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return a.length===0||a.length>=500}),o.questions.filter(n=>(n.explainText?n.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),o.questions.filter(n=>n.type===D.MULTIPLE_CHOICE&&(n.multipleChoices.some(a=>a.text.trim().length===0||a.text.trim().length>500)||n.multipleChoices.filter(a=>a.isAnswer).length===0)),o.questions.filter(n=>n.type===D.MATCHING&&(n.matchingPairs.some(a=>a.leftItem.trim().length===0||a.leftItem.trim().length>500)||n.matchingPairs.some(a=>a.rightItem.trim().length===0||a.rightItem.trim().length>500))),o.questions.filter(n=>n.type===D.ORDERING&&n.orderingItems.some(a=>a.text.trim().length===0||a.text.trim().length>500)),o.questions.filter(n=>n.type===D.SHORT_TEXT&&(n.shortAnswer.trim().length===0||n.shortAnswer.trim().length>500))].forEach(n=>{n.length>0&&(e=!0,n.forEach(a=>i.add(a)))});let B=Array.from(i).map(n=>o.questions.indexOf(n)+1);e?L.error({title:"Cannot create new question set!",content:"There are errors at questions: "+B.sort().join(", ")}):G()},G=()=>{L.confirm({title:"Create new quiz!",content:"Make sure to review your contents before proceeding.",centered:!0,onOk:async()=>{(await Se.Create(o)).data.success&&(f.value=!1,S.success("Created successfully!"),v.push({name:"User_Class_Exam",params:{id:o.classId}}))}})},H=m(null),k=()=>{var e;(e=H.value)==null||e.openTestSettingModal()},A=m(null),b=()=>{var e;(e=A.value)==null||e.openModal()},$=()=>{var e;p.value=null,(e=A.value)==null||e.closeModal(),E()},ee=e=>{var s;p.value=e,(s=A.value)==null||s.closeModal(),O()},p=m(null),j=m(""),Y=m(null),O=()=>{var e;(e=Y.value)==null||e.openModal()},te=()=>{p.value=null,b()},y=m(null),E=()=>{var e;(e=y.value)==null||e.openModal()},oe=()=>{var e;p.value=null,(e=y.value)==null||e.closeModal(),b()},ne=async e=>{var s;j.value=e,(s=y.value)==null||s.closeModal(),await h(),W()},X=m(null),W=()=>{var e;(e=X.value)==null||e.openModal()},se=e=>{p.value=e,O()},ae=()=>{E()},le=e=>{S.success(`Imported ${e.length} questions`);const s=e.map(i=>Ee.transformResponseToRequest(i));o.questions=[...o.questions,...s],h(()=>{var i,g;(g=(i=T.value)==null?void 0:i.forceUpdate)==null||g.call(i),h(()=>{const B=o.questions.length;requestAnimationFrame(()=>{var M;(M=T.value)==null||M.scrollToItem(B)})})})};fe((e,s,i)=>{if(!f.value){i();return}L.confirm({title:"Leave already?",content:"You have unsaved changes.",onOk:()=>{i()},onCancel:()=>i(!1)})});function Q(e){e.preventDefault(),e.returnValue=""}pe(()=>{window.removeEventListener("beforeunload",Q)});const T=m(null),re=()=>{h(()=>{var e,s;(s=(e=T.value)==null?void 0:e.forceUpdate)==null||s.call(e)})};Te(()=>{q(),o.questions.push(d()),window.addEventListener("beforeunload",Q),k()});const J={componentMap:U,t,route:x,router:v,isDataValid:f,classData:_,getClassData:q,formRef:I,formState:o,rules:C,createQuestionTemplate:d,onAddQuestion:R,onRemoveQuestion:V,onFinish:Z,showModalConfirmation:G,settingModalRef:H,openSettingModal:k,folderModalRef:A,openFolderModal:b,onSwitchToTestTemplate:$,onOpenFolder:ee,chosenFolder:p,chosenTestTemplateId:j,folderTestTemplateModalRef:Y,openFolderTestTemplateModal:O,onBackToFolderModal:te,testTemplateModalRef:y,openTestTemplateModal:E,onSwitchToFolder:oe,onOpenTestTemplate:ne,questionModalRef:X,openQuestionModal:W,onBackToFolderTestTemplate:se,onBackToTestTemplate:ae,onModalImport:le,handleBeforeUnload:Q,scrollerRef:T,handleScroll:re,SettingTestModal:ye,ChooseFolderModal:Ae,ChooseFolderTestTemplateModal:Re,ChooseTestTemplateModal:Ce,ChooseQuestionModal:Ie,get DynamicScroller(){return Oe},get DynamicScrollerItem(){return be}};return Object.defineProperty(J,"__isScriptSetup",{enumerable:!1,value:!0}),J}}),Le={class:"page-container"},ze={class:"title-container"},Pe={class:"content"},Ne={class:"content-item"},Ue={class:"content-item-title"},Ve={class:"content-item-buttons"},Ge={class:"import-button"};function He(F,l,U,t,x,v){var C;const f=w("RouterLink"),_=w("a-col"),q=w("a-row"),I=w("a-button"),o=w("a-form");return z(),he(_e,null,[r("div",Le,[r("div",ze,[c(q,{class:"w-100 d-flex align-items-center"},{default:u(()=>[c(_,{span:1},{default:u(()=>[c(f,{to:{name:""},onClick:t.openSettingModal},{default:u(()=>l[0]||(l[0]=[r("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[0]})]),_:1}),c(_,{class:"main-title",span:23},{default:u(()=>{var d;return[r("span",null,"Assign new test for class "+P((d=t.classData)==null?void 0:d.name),1),l[1]||(l[1]=r("br",null,null,-1)),l[2]||(l[2]=r("span",null,"Add questions, set answers and configure test settings",-1))]}),_:1,__:[1,2]})]),_:1})]),r("div",Pe,[c(o,{layout:"vertical",model:t.formState,rules:t.rules,ref:"formRef"},{default:u(()=>[r("div",Ne,[r("div",Ue,[l[5]||(l[5]=r("div",null,[r("span",null,"Test questions"),r("span",null,"Create and manage your test questions")],-1)),r("div",Ve,[c(f,{class:"import-button",to:{name:""},onClick:t.openFolderModal},{default:u(()=>l[3]||(l[3]=[N(" Choose from folder test ")])),_:1,__:[3]}),r("div",Ge,P(F.$t("create_QS.quiz.total",{number:t.formState.questions.length.toString().padStart(3,"0")})),1),c(I,{type:"primary",class:"main-color-btn",size:"large",onClick:t.onFinish},{default:u(()=>l[4]||(l[4]=[N(" Next ")])),_:1,__:[4]})])]),c(t.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:t.formState.questions,"min-item-size":650,buffer:800,prerender:10,onScroll:t.handleScroll},{default:u(({item:d,index:R})=>[(z(),K(t.DynamicScrollerItem,{item:d,key:d.id},{default:u(()=>[(z(),K(ve(t.componentMap[d.type]),{question:d,index:R+1,displayScore:!1,onDeleteQuestion:V=>t.onRemoveQuestion(R)},null,40,["question","index","onDeleteQuestion"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),r("div",{class:"add-question-btn",onClick:t.onAddQuestion},[l[6]||(l[6]=r("i",{class:"bx bx-plus"},null,-1)),N(" "+P(F.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["model"])])]),c(t.SettingTestModal,{ref:"settingModalRef","form-ref":t.formRef,"class-name":(C=t.classData)==null?void 0:C.name,"form-state":t.formState},null,8,["form-ref","class-name","form-state"]),c(t.ChooseFolderModal,{ref:"folderModalRef",onSwitchToTestTemplate:t.onSwitchToTestTemplate,onOpenFolder:t.onOpenFolder},null,512),c(t.ChooseFolderTestTemplateModal,{ref:"folderTestTemplateModalRef",folder:t.chosenFolder,onBackToFolderModal:t.onBackToFolderModal,onOpenTestTemplate:t.onOpenTestTemplate},null,8,["folder"]),c(t.ChooseTestTemplateModal,{ref:"testTemplateModalRef",onSwitchToFolder:t.onSwitchToFolder,onOpenTestTemplate:t.onOpenTestTemplate},null,512),c(t.ChooseQuestionModal,{ref:"questionModalRef","test-template-id":t.chosenTestTemplateId,folder:t.chosenFolder,onBackToFolderTestTemplateModal:t.onBackToFolderTestTemplate,onBackToTestTemplateModal:t.onBackToTestTemplate,onImport:t.onModalImport},null,8,["test-template-id","folder"])],64)}const it=ge(Be,[["render",He],["__scopeId","data-v-501cc219"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test/create.vue"]]);export{it as default};

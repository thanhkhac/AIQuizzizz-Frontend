import{d as pe,u as ge,l as fe,q as _e,i as p,j as ee,E as he,a2 as ve,a3 as Qe,s as Se,k as v,D as R,M as G,_ as be,r as x,c as q,o as _,b as o,a as d,w as f,f as k,t as c,F as B,B as te,e as ae,p as Ie,C as F,Q as Te}from"./index-DCdJMN3v.js";import{A as N}from"./ApiQuestionSet-gCPOC3iB.js";import{A as qe}from"./ApiTag-CxDE558Q.js";import{Q as z}from"./questionTypes-CS3lcRlq.js";import{T as ye}from"./TransferQuestionData-BxcXdBjq.js";import{V as Ce}from"./Validator-CWeiTIFe.js";import{I as Ue}from"./Input-vH3kTsPW.js";import{T as xe}from"./vue-draggable-plus-CYf-tL_S.js";import{C as D,S as ke,O as we,M as Me,a as Re,s as Ae,b as Ve}from"./vue-virtual-scroller.esm-BsRBFc0T.js";import{G as ze,I as De}from"./GenerateQSModal-CYzE-PbO.js";/* empty css                                                                 */import"./ApiTestTemplate-DRg4uRTN.js";import"./languages-DtYW231W.js";const Oe=pe({__name:"update",setup(m,{expose:s}){s();const{t:i}=ge(),e=fe(),O=_e(),A=p(!1),h=p(O.params.id),Q=p({id:"",name:"",description:"",tags:[]}),w=p([]),I=p(!0),S=async()=>{if(A.value=!0,!Ce.isValidGuid(h.value)){I.value=!1,e.push({name:"404"});return}let a=await N.GetDetailById(h.value),n=await N.GetQuestionById(h.value);if(!a.data.success||!n.data.success){I.value=!1,e.push({name:"404"});return}Q.value=a.data.data,w.value=n.data.data,t.name=Q.value.name,t.description=Q.value.description,t.createUpdateQuestions=w.value.map(u=>ye.transformResponseToRequest(u)),t.tags=Q.value.tags.map(u=>u.name),A.value=!1,window.addEventListener("beforeunload",P)},L=p(),t=ee({name:"",description:"",createUpdateQuestions:[],deleteQuestionIds:[],tags:[]}),T={title:[{required:"true",message:"This field is required",trigger:"change"},{length:100,message:"Limit 100",trigger:"change"}],description:[{length:200,message:"Limit 200",trigger:"change"}],tags:[{validator:(a,n)=>n&&n.length>5?Promise.reject("You can only add up to 5 tags."):Promise.resolve(),trigger:"change"}],questions:[{validator:(a,n)=>n&&n.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},y={MultipleChoice:Re,Matching:Me,Ordering:we,ShortText:ke},H=()=>({id:"new_"+Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:D.defaultMultipleChoices(),matchingPairs:D.defaultMatchingPairs(),orderingItems:D.defaultOrderingItems(),shortAnswer:""}),ne=a=>{D.onChangeQuestionType(a)},oe=()=>{if(t.createUpdateQuestions.length>=500){v.warning(i("maximum_tag.limit_question",{number:500}));return}t.createUpdateQuestions=[...t.createUpdateQuestions,H()],R(()=>{var a,n;(n=(a=C.value)==null?void 0:a.forceUpdate)==null||n.call(a),R(()=>{const u=t.createUpdateQuestions.length;requestAnimationFrame(()=>{var b;(b=C.value)==null||b.scrollToItem(u)})})})},se=a=>{if(t.createUpdateQuestions.length<=1){v.warning(i("maximum_tag.minimum_question",{number:1}));return}const n=t.createUpdateQuestions[a].id;!n.startsWith("new_")&&n&&t.deleteQuestionIds.push(n),t.createUpdateQuestions=[...t.createUpdateQuestions.slice(0,a),...t.createUpdateQuestions.slice(a+1)]},le=()=>{let a=!1,n=i("message.invalid_question"),u=new Set;if(t.name.trim().length>100||t.name.trim().length===0){a=!0,n=i("message.invalid_title"),v.error(n);return}if(t.description.trim().length>250){a=!0,n=i("message.invalid_description"),v.error(n);return}[t.createUpdateQuestions.filter(l=>{const r=l.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return r.length===0||r.length>=5e3}),t.createUpdateQuestions.filter(l=>(l.explainText?l.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=5e3),t.createUpdateQuestions.filter(l=>l.type===z.MULTIPLE_CHOICE&&(l.multipleChoices.some(r=>r.text.trim().length===0||r.text.trim().length>1e3)||l.multipleChoices.filter(r=>r.isAnswer).length===0)),t.createUpdateQuestions.filter(l=>l.type===z.MATCHING&&(l.matchingPairs.some(r=>r.leftItem.trim().length===0||r.leftItem.trim().length>1e3)||l.matchingPairs.some(r=>r.rightItem.trim().length===0||r.rightItem.trim().length>1e3))),t.createUpdateQuestions.filter(l=>l.type===z.ORDERING&&l.orderingItems.some(r=>r.text.trim().length===0||r.text.trim().length>1e3)),t.createUpdateQuestions.filter(l=>l.type===z.SHORT_TEXT&&(l.shortAnswer.trim().length===0||l.shortAnswer.trim().length>1e3))].forEach(l=>{l.length>0&&(a=!0,l.forEach(r=>u.add(r)))});let U=Array.from(u).map(l=>t.createUpdateQuestions.indexOf(l)+1);a?G.error({title:i("create_QS.modal.invalid.title"),content:i("create_QS.modal.invalid.content")+U.sort().join(", "),okText:i("sidebar.buttons.ok"),cancelText:i("sidebar.buttons.cancel")}):j()},j=()=>{G.confirm({title:i("update_QS.modal.valid.title"),content:i("create_QS.modal.valid.content"),okText:i("sidebar.buttons.ok"),cancelText:i("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{let a=await N.Update(h.value,{...t,createUpdateQuestions:t.createUpdateQuestions.map(n=>({questionId:n.id.startsWith("new_")?null:n.id,...n}))});a.data.success&&(v.success(i("message.updated_successfully")),I.value=!1,e.push({name:"User_QuestionSet_Detail",params:{id:a.data.data}}))}})},g=p(""),Y=()=>{if(t.tags.length>=5){v.warning(i("message.maximum_tag",{tag:5}));return}if(t.tags.includes(g.value.trim())){v.warning(i("message.duplicate_tag"));return}g.value&&g.value.trim().length<=50?(t.tags.push(g.value),g.value=""):v.warning(i("message.invalid_tag_content"))},ie=a=>{t.tags.splice(a,1)},re=a=>{g.value=a,Y()},M=p([]),W=p(null),E=p([]);function X(a){var n;!V.name||!((n=W.value)!=null&&n.contains(a.target))?M.value=[]:M.value=[...E.value]}const V=ee({name:g.value,pageSize:10});he(()=>g.value,()=>{V.name=g.value,J()});const J=async()=>{if(g.value.trim().length>=50)return;const a=await qe.GetAllByLimit(V);a.data.success&&(M.value=a.data.data,E.value=a.data.data,g.value.trim().length===0&&(M.value=[]))},K=p(null),de=()=>{var a;(a=K.value)==null||a.openImportModal()},Z=p(null),ue=()=>{var a;(a=Z.value)==null||a.openGenerateAIModal()},ce=a=>{t.createUpdateQuestions.unshift(...a.map((n,u)=>{var b;return{...n,id:`new_${t.createUpdateQuestions.length+u}`,orderingItems:(b=n.orderingItems)==null?void 0:b.map((U,l)=>({...U,correctOrder:l}))}})),R(()=>{var n,u;(u=(n=C.value)==null?void 0:n.forceUpdate)==null||u.call(n),R(()=>{const b=t.createUpdateQuestions.length;requestAnimationFrame(()=>{var U;(U=C.value)==null||U.scrollToItem(b)})})}),v.success(`Imported ${a.length} questions`)};function P(a){a.preventDefault(),a.returnValue=""}ve((a,n,u)=>{if(!I.value){u();return}G.confirm({title:i("create_QS.modal.leave.title"),content:i("create_QS.modal.leave.content"),okText:i("sidebar.buttons.ok"),cancelText:i("sidebar.buttons.cancel"),onOk:()=>{u()},onCancel:()=>u(!1)})}),Qe(()=>{window.removeEventListener("beforeunload",P)});const C=p(null),me=()=>{R(()=>{var a,n;(n=(a=C.value)==null?void 0:a.forceUpdate)==null||n.call(a)})};Se(async()=>{document.addEventListener("click",X),await S()});const $={t:i,router:e,route:O,loading:A,questionSetId:h,questionSetDetail:Q,questionSetQuestions:w,isDataValid:I,getTestTemplate:S,formRef:L,formState:t,rules:T,componentMap:y,createQuestionTemplate:H,onHandleChangeQuestionType:ne,onAddQuestion:oe,onRemoveQuestion:se,onFinish:le,showModalConfirmation:j,tagContent:g,addTag:Y,removeTag:ie,appendTagContent:re,tag_search_data:M,searchResultRef:W,lastSearchResult:E,handleMouseClickOutside:X,searchTagPageParams:V,getSearchTagData:J,importModalRef:K,onOpenImportModal:de,generateModalRef:Z,openGenerateAIModal:ue,onModalImport:ce,handleBeforeUnload:P,scrollerRef:C,handleScroll:me,Input:Ue,TextArea:xe,ImportQSModal:De,GenerateQSModal:ze,get DynamicScroller(){return Ve},get DynamicScrollerItem(){return Ae}};return Object.defineProperty($,"__isScriptSetup",{enumerable:!1,value:!0}),$}}),Le={class:"page-container"},Ee={class:"title-container"},Pe={class:"content"},Ge={style:{height:"500px"},class:"content-item"},Be={class:"content-item-title"},Fe={class:"d-flex"},Ne={class:"form-item"},He={class:"tag-container"},je=["onClick"],Ye={class:"tag-inputter"},We={class:"search-bar",ref:"searchResultRef"},Xe={key:0,class:Ie(["search-result-container"])},Je={class:"search-result"},Ke={class:"search-result-tag"},Ze={class:"result-tag"},$e={class:"result-tag-qs-count"},et={class:"result-item-action"},tt={class:"content-item"},at={class:"content-item-title"},nt={class:"content-item-buttons"},ot={class:"import-button"},st={key:0};function lt(m,s,i,e,O,A){const h=x("RouterLink"),Q=x("a-col"),w=x("a-row"),I=x("a-button"),S=x("a-skeleton"),L=x("a-form");return _(),q(B,null,[o("div",Le,[o("div",Ee,[d(w,{class:"w-100 d-flex align-items-center"},{default:f(()=>[d(Q,{span:1},{default:f(()=>[d(h,{to:{name:"User_Library"}},{default:f(()=>s[4]||(s[4]=[o("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[4]})]),_:1}),d(Q,{class:"main-title",span:23},{default:f(()=>[o("span",null,c(m.$t("update_QS.title",{name:e.formState.name})),1),s[5]||(s[5]=k()),s[6]||(s[6]=o("br",null,null,-1)),o("span",null,c(m.$t("create_QS.sub_title")),1)]),_:1,__:[5,6]})]),_:1})]),o("div",Pe,[d(L,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":s[3]||(s[3]=t=>e.formState=t),rules:e.rules,ref:"formRef"},{default:f(()=>[o("div",Ge,[o("div",Be,[o("div",null,[o("span",null,c(m.$t("create_QS.quiz.question_detail_title")),1),o("span",null,c(m.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":s[0]||(s[0]=t=>e.formState.name=t),isRequired:!0,placeholder:e.t("create_QS.other.title_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),o("div",Fe,[d(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":s[1]||(s[1]=t=>e.formState.description=t),placeholder:e.t("create_QS.other.description_placeholder"),"max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","placeholder","label"]),o("div",Ne,[o("label",null,c(m.$t("create_QS.quiz.tag")),1),o("div",He,[(_(!0),q(B,null,te(e.formState.tags,(t,T)=>(_(),q("div",{class:"tag-item",key:T},[k(c(t)+" ",1),o("i",{class:"bx bx-x",onClick:y=>e.removeTag(T)},null,8,je)]))),128))]),o("div",Ye,[ae(` <Input
                                    v-model="tagContent"
                                    :placeholder="t('create_QS.other.tag_content_placeholder')"
                                    :max-length="50"
                                >
                                    <template #icon>
                                        <i class="bx bx-purchase-tag-alt"></i>
                                    </template>
                                </Input> `),o("div",We,[d(e.Input,{onInput:e.getSearchTagData,modelValue:e.tagContent,"onUpdate:modelValue":s[2]||(s[2]=t=>e.tagContent=t),placeholder:e.t("create_QS.other.tag_content_placeholder"),"max-length":50},{icon:f(()=>s[7]||(s[7]=[o("i",{class:"bx bx-purchase-tag-alt"},null,-1)])),_:1},8,["modelValue","placeholder"]),e.tag_search_data.length>0?(_(),q("div",Xe,[o("div",Je,[(_(!0),q(B,null,te(e.tag_search_data,t=>(_(),q("div",Ke,[o("div",Ze,[k(c(t.name)+" ",1),o("div",$e,c(t.questionSetCount),1)]),o("div",et,[d(I,{type:"primary",class:"main-color-btn",size:"small",onClick:T=>e.appendTagContent(t.name)},{default:f(()=>[...s[8]||(s[8]=[o("i",{class:"bx bx-plus"},null,-1)])]),_:2,__:[8]},1032,["onClick"])])]))),256))])])):ae("v-if",!0)],512),o("i",{class:"bx bx-plus tag-inputter-button",onClick:e.addTag})])])])]),o("div",tt,[o("div",at,[o("div",null,[o("span",null,c(m.$t("create_QS.quiz.question_question_title")),1),o("span",null,c(m.$t("create_QS.quiz.question_question_sub_title")),1)]),o("div",nt,[d(h,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:f(()=>[k(c(m.$t("create_QS.buttons.import"))+" ",1),s[9]||(s[9]=o("i",{class:"bx bx-download"},null,-1))]),_:1,__:[9]}),d(h,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:f(()=>[k(c(m.$t("create_QS.buttons.generated_by_ai"))+" ",1),s[10]||(s[10]=o("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[10]}),o("div",{class:"import-button",onClick:e.onFinish},c(m.$t("update_QS.buttons.update")),1),o("div",ot,c(m.$t("create_QS.quiz.total",{number:e.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1)])]),e.loading?(_(),q("div",st,[d(S,{loading:e.loading,active:""},null,8,["loading"]),d(S,{loading:e.loading,active:""},null,8,["loading"]),d(S,{loading:e.loading,active:""},null,8,["loading"]),d(S,{loading:e.loading,active:""},null,8,["loading"]),d(S,{loading:e.loading,active:""},null,8,["loading"])])):(_(),F(e.DynamicScroller,{key:1,ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.createUpdateQuestions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:f(({item:t,index:T})=>[(_(),F(e.DynamicScrollerItem,{item:t,key:t.id},{default:f(()=>[(_(),F(Te(e.componentMap[t.type]),{question:t,index:e.formState.createUpdateQuestions.findIndex(y=>y.id===t.id)+1,displayScore:!1,onDeleteQuestion:y=>e.onRemoveQuestion(T),onChangeQuestionType:y=>e.onHandleChangeQuestionType(t)},null,40,["question","index","onDeleteQuestion","onChangeQuestionType"]))]),_:2},1032,["item"]))]),_:1},8,["items"])),o("div",{class:"add-question-btn",onClick:e.onAddQuestion},[s[11]||(s[11]=o("i",{class:"bx bx-plus"},null,-1)),k(" "+c(m.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),d(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,"number-of-question":e.formState.createUpdateQuestions.length,onImport:e.onModalImport},null,8,["title","number-of-question"]),d(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport,"number-of-question":e.formState.createUpdateQuestions.length},null,8,["title","number-of-question"])],64)}const St=be(Oe,[["render",lt],["__scopeId","data-v-ef9cef6a"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/question_sets/update.vue"]]);export{St as default};

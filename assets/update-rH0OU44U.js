import{d as fe,u as Te,q as ge,l as he,i as c,j as ve,V as _e,W as we,s as Me,X as h,k as q,M as G,_ as Se,r as w,a as ee,o as R,b as d,c as r,w as p,t as D,G as P,f as V,N as Ie,F as Qe}from"./index-C2jtDg6B.js";import{A as Ae}from"./ApiClass-UU0KI_4U.js";import{A as Re}from"./ApiTest-RSE37fQt.js";import{Q as b}from"./questionTypes-CS3lcRlq.js";import{T as Ce,a as ye,C as Ue,b as qe,c as De,d as be,S as ke}from"./ChooseQuestionModal-DLcSos8M.js";import{S as Fe,O as xe,M as Oe,a as Ee,s as Be,b as Le}from"./vue-virtual-scroller.esm-D8MvBVCq.js";import{T as te}from"./TransferQuestionData-Bl0XXg5D.js";import{V as oe}from"./Validator-CWeiTIFe.js";import"./Input-0Otcuoto.js";import"./utc-BGTnualw.js";import"./ApiFolder-DE_T1vB3.js";import"./folderShareMode-BudLQ2R2.js";import"./ApiTestTemplate-Ds5LzdWO.js";import"./TextArea-SkV_8IH8.js";/* empty css                                                                 */import"./vue-draggable-plus-DALPiNCD.js";const ze=fe({__name:"update",setup(k,{expose:i}){var $;i();const N={MultipleChoice:Ee,Matching:Oe,Ordering:xe,ShortText:Fe},{t:o}=Te(),F=ge(),T=he(),M=c(),S=async()=>{if(!oe.isValidGuid(t.classId)){m.value=!1,T.push({name:"404"});return}const e=await Ae.GetById(t.classId);if(!e.data.success){m.value=!1,T.push({name:"404"});return}M.value=e.data.data},C=c(),t=ve({testId:(($=F.params.id)==null?void 0:$.toString())||"",name:"",classId:"",timeLimit:60,startTime:"",endTime:"",gradeAttemptMethod:ye.HIGHEST_SCORE,gradeQuestionMethod:Ce.PARTIAL,isShowCorrectAnswerInReview:!0,isAllowReviewAfterSubmit:!0,shuffle:2,maxAttempt:2,passingScore:50,createUpdateQuestions:[],deleteQuestionIds:[]}),g={questions:[{validator:(e,a)=>a&&a.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},I=c(!1),m=c(!0),u=async()=>{try{debugger;if(I.value=!0,!oe.isValidGuid(t.testId)){m.value=!1,T.push({name:"404"});return}const e=await Re.GetById(t.testId);if(!e.data.success){m.value=!1,T.push({name:"404"});return}t.classId=e.data.data.classId,t.testId=e.data.data.testId,t.name=e.data.data.name,t.startTime=e.data.data.startTime,t.endTime=e.data.data.endTime,t.gradeAttemptMethod=e.data.data.gradeAttemptMethod,t.gradeQuestionMethod=e.data.data.gradeQuestionMethod,t.isAllowReviewAfterSubmit=e.data.data.isAllowReviewAfterSubmit,t.isShowCorrectAnswerInReview=e.data.data.isShowCorrectAnswerInReview,t.maxAttempt=e.data.data.maxAttempt,t.shuffle=e.data.data.shuffle,t.passingScore=e.data.data.passingScore,t.timeLimit=e.data.data.timeLimit,t.createUpdateQuestions=e.data.data.questions.map(a=>te.transformResponseToRequest(a))}catch(e){debugger;if(e.response.data.success===!1){m.value=!1,T.push({name:"404"});return}}finally{I.value=!1}},Q=()=>({id:`new_${Date.now().toString()}`,type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),H=()=>{if(t.createUpdateQuestions.length>=100){q.warning("Each question set could have at most 100 questions");return}t.createUpdateQuestions=[...t.createUpdateQuestions,Q()],h(()=>{var e,a;(a=(e=_.value)==null?void 0:e.forceUpdate)==null||a.call(e),h(()=>{const l=t.createUpdateQuestions.length;requestAnimationFrame(()=>{var f;(f=_.value)==null||f.scrollToItem(l)})})})},ae=e=>{if(t.createUpdateQuestions.length<=1){q.warning("Each question set must have at least 1 questions");return}const a=t.createUpdateQuestions[e].id;!a.startsWith("new_")&&a&&t.deleteQuestionIds.push(a),t.createUpdateQuestions=[...t.createUpdateQuestions.slice(0,e),...t.createUpdateQuestions.slice(e+1)]},ne=async()=>{var A;await((A=C.value)==null?void 0:A.validate());let e=!1,a="Invalid question.",l=new Set;if(t.name.trim().length>100||t.name.trim().length===0){e=!0,a="Invalid title.",q.error(a),x();return}[t.createUpdateQuestions.filter(n=>{const s=n.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return s.length===0||s.length>=500}),t.createUpdateQuestions.filter(n=>(n.explainText?n.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),t.createUpdateQuestions.filter(n=>n.type===b.MULTIPLE_CHOICE&&(n.multipleChoices.some(s=>s.text.trim().length===0||s.text.trim().length>500)||n.multipleChoices.filter(s=>s.isAnswer).length===0)),t.createUpdateQuestions.filter(n=>n.type===b.MATCHING&&(n.matchingPairs.some(s=>s.leftItem.trim().length===0||s.leftItem.trim().length>500)||n.matchingPairs.some(s=>s.rightItem.trim().length===0||s.rightItem.trim().length>500))),t.createUpdateQuestions.filter(n=>n.type===b.ORDERING&&n.orderingItems.some(s=>s.text.trim().length===0||s.text.trim().length>500)),t.createUpdateQuestions.filter(n=>n.type===b.SHORT_TEXT&&(n.shortAnswer.trim().length===0||n.shortAnswer.trim().length>500))].forEach(n=>{n.length>0&&(e=!0,n.forEach(s=>l.add(s)))});let z=Array.from(l).map(n=>t.createUpdateQuestions.indexOf(n)+1);e?G.error({title:"Cannot create new question set!",content:"There are errors at questions: "+z.sort().join(", ")}):j()},j=()=>{G.confirm({title:"Create new quiz!",content:"Make sure to review your contents before proceeding.",centered:!0,onOk:async()=>{t.createUpdateQuestions=t.createUpdateQuestions.map(e=>e.id.startsWith("new_")?{...e,id:""}:e),console.log(t)}})},W=c(null),x=()=>{var e;(e=W.value)==null||e.openTestSettingModal()},y=c(null),O=()=>{var e;(e=y.value)==null||e.openModal()},se=()=>{var e;v.value=null,(e=y.value)==null||e.closeModal(),B()},le=e=>{var a;v.value=e,(a=y.value)==null||a.closeModal(),E()},v=c(null),Y=c(""),X=c(null),E=()=>{var e;(e=X.value)==null||e.openModal()},re=()=>{v.value=null,O()},U=c(null),B=()=>{var e;(e=U.value)==null||e.openModal()},ie=()=>{var e;v.value=null,(e=U.value)==null||e.closeModal(),O()},de=async e=>{var a;Y.value=e,(a=U.value)==null||a.closeModal(),await h(),K()},J=c(null),K=()=>{var e;(e=J.value)==null||e.openModal()},ce=e=>{v.value=e,E()},me=()=>{B()},ue=e=>{q.success(`Imported ${e.length} questions`);const a=e.map(l=>te.transformResponseToRequest(l)).map((l,f)=>({...l,id:`new_${t.createUpdateQuestions.length+f}`}));t.createUpdateQuestions=[...t.createUpdateQuestions,...a],h(()=>{var l,f;(f=(l=_.value)==null?void 0:l.forceUpdate)==null||f.call(l),h(()=>{const z=t.createUpdateQuestions.length;requestAnimationFrame(()=>{var A;(A=_.value)==null||A.scrollToItem(z)})})})};_e((e,a,l)=>{if(!m.value){l();return}G.confirm({title:"Leave already?",content:"You have unsaved changes.",onOk:()=>{l()},onCancel:()=>l(!1)})});function L(e){e.preventDefault(),e.returnValue=""}we(()=>{window.removeEventListener("beforeunload",L)});const _=c(null),pe=()=>{h(()=>{var e,a;(a=(e=_.value)==null?void 0:e.forceUpdate)==null||a.call(e)})};Me(async()=>{await u(),await S(),window.addEventListener("beforeunload",L),await h(),x()});const Z={componentMap:N,t:o,route:F,router:T,classData:M,getClassData:S,formRef:C,formState:t,rules:g,loading:I,isDataValid:m,getData:u,createQuestionTemplate:Q,onAddQuestion:H,onRemoveQuestion:ae,onFinish:ne,showModalConfirmation:j,settingModalRef:W,openSettingModal:x,folderModalRef:y,openFolderModal:O,onSwitchToTestTemplate:se,onOpenFolder:le,chosenFolder:v,chosenTestTemplateId:Y,folderTestTemplateModalRef:X,openFolderTestTemplateModal:E,onBackToFolderModal:re,testTemplateModalRef:U,openTestTemplateModal:B,onSwitchToFolder:ie,onOpenTestTemplate:de,questionModalRef:J,openQuestionModal:K,onBackToFolderTestTemplate:ce,onBackToTestTemplate:me,onModalImport:ue,handleBeforeUnload:L,scrollerRef:_,handleScroll:pe,SettingTestModal:ke,ChooseFolderModal:be,ChooseFolderTestTemplateModal:De,ChooseTestTemplateModal:qe,ChooseQuestionModal:Ue,get DynamicScroller(){return Le},get DynamicScrollerItem(){return Be}};return Object.defineProperty(Z,"__isScriptSetup",{enumerable:!1,value:!0}),Z}}),Ge={class:"page-container"},Pe={class:"title-container"},Ve={class:"content"},Ne={class:"content-item"},He={class:"content-item-title"},je={class:"content-item-buttons"},We={class:"import-button"},Ye={key:0};function Xe(k,i,N,o,F,T){var m;const M=w("RouterLink"),S=w("a-col"),C=w("a-row"),t=w("a-button"),g=w("a-skeleton"),I=w("a-form");return R(),ee(Qe,null,[d("div",Ge,[d("div",Pe,[r(C,{class:"w-100 d-flex align-items-center"},{default:p(()=>[r(S,{span:1},{default:p(()=>[r(M,{to:{name:""},onClick:o.openSettingModal},{default:p(()=>i[0]||(i[0]=[d("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[0]})]),_:1}),r(S,{class:"main-title",span:23},{default:p(()=>{var u;return[d("span",null,"Update test for class "+D((u=o.classData)==null?void 0:u.name)+" | "+D(o.formState.name),1),i[1]||(i[1]=d("br",null,null,-1)),i[2]||(i[2]=d("span",null,"Add questions, set answers and configure test settings",-1))]}),_:1,__:[1,2]})]),_:1})]),d("div",Ve,[r(I,{layout:"vertical",model:o.formState,rules:o.rules,ref:"formRef"},{default:p(()=>[d("div",Ne,[d("div",He,[i[5]||(i[5]=d("div",null,[d("span",null,"Test questions"),d("span",null,"Create and manage your test questions")],-1)),d("div",je,[r(M,{class:"import-button",to:{name:""},onClick:o.openFolderModal},{default:p(()=>i[3]||(i[3]=[V(" Choose from folder test ")])),_:1,__:[3]}),d("div",We,D(k.$t("create_QS.quiz.total",{number:o.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1),r(t,{type:"primary",class:"main-color-btn",size:"large",onClick:o.onFinish},{default:p(()=>i[4]||(i[4]=[V(" Next ")])),_:1,__:[4]})])]),o.loading?(R(),ee("div",Ye,[r(g,{loading:o.loading,active:""},null,8,["loading"]),r(g,{loading:o.loading,active:""},null,8,["loading"]),r(g,{loading:o.loading,active:""},null,8,["loading"]),r(g,{loading:o.loading,active:""},null,8,["loading"]),r(g,{loading:o.loading,active:""},null,8,["loading"])])):(R(),P(o.DynamicScroller,{key:1,ref:"scrollerRef",class:"scroller","key-field":"id",items:o.formState.createUpdateQuestions,"min-item-size":650,buffer:800,prerender:10,onScroll:o.handleScroll},{default:p(({item:u,index:Q})=>[(R(),P(o.DynamicScrollerItem,{item:u,key:u.id},{default:p(()=>[(R(),P(Ie(o.componentMap[u.type]),{question:u,index:Q+1,displayScore:!1,onDeleteQuestion:H=>o.onRemoveQuestion(Q)},null,40,["question","index","onDeleteQuestion"]))]),_:2},1032,["item"]))]),_:1},8,["items"])),d("div",{class:"add-question-btn",onClick:o.onAddQuestion},[i[6]||(i[6]=d("i",{class:"bx bx-plus"},null,-1)),V(" "+D(k.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["model"])])]),r(o.SettingTestModal,{ref:"settingModalRef","form-ref":o.formRef,"class-name":(m=o.classData)==null?void 0:m.name,"form-state":o.formState},null,8,["form-ref","class-name","form-state"]),r(o.ChooseFolderModal,{ref:"folderModalRef",onSwitchToTestTemplate:o.onSwitchToTestTemplate,onOpenFolder:o.onOpenFolder},null,512),r(o.ChooseFolderTestTemplateModal,{ref:"folderTestTemplateModalRef",folder:o.chosenFolder,onBackToFolderModal:o.onBackToFolderModal,onOpenTestTemplate:o.onOpenTestTemplate},null,8,["folder"]),r(o.ChooseTestTemplateModal,{ref:"testTemplateModalRef",onSwitchToFolder:o.onSwitchToFolder,onOpenTestTemplate:o.onOpenTestTemplate},null,512),r(o.ChooseQuestionModal,{ref:"questionModalRef","test-template-id":o.chosenTestTemplateId,folder:o.chosenFolder,onBackToFolderTestTemplateModal:o.onBackToFolderTestTemplate,onBackToTestTemplateModal:o.onBackToTestTemplate,onImport:o.onModalImport},null,8,["test-template-id","folder"])],64)}const ut=Se(ze,[["render",Xe],["__scopeId","data-v-c9dbf500"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test/update.vue"]]);export{ut as default};

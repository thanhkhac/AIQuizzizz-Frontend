import{d as ve,u as he,g as fe,i as _,z as G,E as pe,s as be,J as Ie,k as S,_ as ge,r as f,C as N,o as r,w as l,b as t,p as w,a as n,t as u,e as U,c as h,F as O,B as V,f as C}from"./index-CHQ5wIb3.js";import{u as ye}from"./user-zaK1_Zi8.js";import{A as K}from"./ApiQuestionSet-CAmsUV8L.js";import{A as ae}from"./ApiClass-B3uIo_GQ.js";import{A as te}from"./ApiTestTemplate-DLg4UTUc.js";import{A as le}from"./ApiFolder-Cn-upVyy.js";import{I as Se}from"./Input-DIUsBtCl.js";import{V as J}from"./visibility-PZlBDoOn.js";const L={OWNER:"Owner",EDITABLE:"Editable",VIEW_ONLY:"ViewOnly"},Ue=ve({__name:"ShareModal",props:{id:{type:String,required:!0},name:{type:String,required:!0},mode:{type:String,required:!0},visibility:{type:String,required:!0},options:{type:null,required:!0}},setup(m,{expose:o}){const{t:i}=he(),e=fe(),Y=_(e.getUserInfo()),H=G(()=>{var v;return((v=a.value.find(b=>b.shareMode===L.OWNER))==null?void 0:v.userId)===Y.value.id}),d=m,p=_(!1),k=async()=>{if(p.value=!0,d.mode==="quiz"&&d.visibility===J.IN_CLASS){await $();return}await z()},M=()=>{p.value=!1};o({openModal:k});const E=Object.values(d.options),B=G(()=>E.map(s=>({label:i(`share_modal.visibility.${s}.mode`),value:s}))),I=_(d.visibility||B.value[0].value),x=_("");pe(()=>I.value,async s=>{x.value=i(`share_modal.visibility.${s}.explain`),s===J.PRIVATE&&await z()});const g=[L.EDITABLE,L.VIEW_ONLY],T=G(()=>g.map(s=>({label:i(`share_modal.permission.${s}.mode`),value:s}))),Q=_(T.value[0].value),j=_([{id:"1",name:"SEP490 - Summer 2025"},{id:"2",name:"MLN111 - Spring 2025"},{id:"3",name:"MLN121 - Spring 2025"}]),a=_([]),c=_(),D=_([]),z=async()=>{let s;switch(d.mode){case"quiz":{s=await K.GetSharedUser(d.id);break}case"template":{s=await te.GetSharedUser(d.id);break}case"folder":{s=await le.GetSharedUser(d.id);break}}s!=null&&s.data.success&&(a.value=s.data.data.sharingModel)},q=_(""),R=_([]),F=_([]),X=_(null);function Z(s){var v;q.value&&!((v=X.value)!=null&&v.contains(s.target))?R.value=[]:R.value=[...F.value]}const ie=async()=>{if(!q.value.trim()){R.value=[],F.value=[];return}const s=await Ie.SearchByEmail(q.value);s.data.success&&(R.value=s.data.data,F.value=[...s.data.data])},P=async({sharingModels:s=[],deleteUserIds:v=[],successMsg:b=i("message.updated_successfully"),errorMsg:A=i("message.updated_failed")})=>{c.value={id:d.id,sharingModels:s,deleteUserIds:v};let y;switch(d.mode){case"quiz":{y=await K.UpdateSharedUser({...c.value,visibilityMode:I.value});break}case"template":{y=await te.UpdateSharedUser(c.value);break}case"folder":{y=await le.UpdateSharedUser({folderId:c.value.id,...c.value});break}}y!=null&&y.data.success?(await z(),S.success(b)):S.error(A)},oe=async s=>{await P({sharingModels:[{sharingUserId:s.id,shareMode:L.VIEW_ONLY}],successMsg:i("message.added_successfully"),errorMsg:i("message.added_failed")})},ne=async(s,v)=>{await P({sharingModels:[{sharingUserId:s,shareMode:v}],successMsg:i("message.updated_successfully"),errorMsg:i("message.updated_failed")})},re=async s=>{D.value.push(s),await P({sharingModels:[],deleteUserIds:D.value,successMsg:i("message.removed_successfully"),errorMsg:i("message.removed_failed")})},de=s=>a.value.some(v=>v.userId===s),W=_([]),$=async()=>{const s=await K.GetSharedClasses(d.id);s.data.success&&(W.value=s.data.data)},ce=async s=>{if((await ae.AddQuestionSet(s,d.id)).data.success){const b=W.value.find(A=>A.classId===s);b&&(b.isAdded=!0),S.success(i("message.added_successfully"))}},ue=async s=>{if((await ae.DeleteQuestionSetFromClass(s,d.id)).data.success){const b=W.value.find(A=>A.classId===s);b&&(b.isAdded=!1),S.success(i("message.removed_successfully"))}},ee=()=>window.location.origin+`/user/question-set/${d.id}`,_e=()=>{navigator.clipboard.writeText(ee()).then(()=>{S.success(i("message.copied"))}).catch(()=>{S.error(i("message.copied_failed"))})},me=async()=>{await P({sharingModels:[],successMsg:i("message.updated_successfully"),errorMsg:i("message.updated_failed")})};be(()=>{document.addEventListener("click",Z),x.value=i(`share_modal.visibility.${I.value}.explain`)});const se={t:i,authStore:e,user:Y,isUserOwner:H,props:d,visibility:p,openModal:k,closeModal:M,visibilityKeys:E,visibility_options:B,selected_visibility_option:I,selected_visibility_explain:x,permissionKeys:g,permission_options:T,selected_permission_option:Q,user_class_sample:j,sharedUser:a,sharingFormState:c,deleteUserIds:D,getSharedUser:z,searchUserEmailValue:q,userFound:R,lastSearchResult:F,searchUserResultRef:X,handleMouseClickOutside:Z,onSearchUser:ie,updateSharedUsers:P,onShareWithResultUser:oe,onChangePeoplePermission:ne,onConfirmRemovePeopleAccess:re,isSharedUserContain:de,sharedClass:W,getSharedClasses:$,onAddToClass:ce,onRemoveFromClass:ue,getPublicShareUrl:ee,onCopyPublicShareUrl:_e,onChangeVisibility:me,get user_image(){return ye},Input:Se,get VISIBILITY(){return J},get PERMISSION(){return L}};return Object.defineProperty(se,"__isScriptSetup",{enumerable:!1,value:!0}),se}}),Ce={class:"title-container"},we={class:"visibility-explain"},ke={key:0,class:"form-item search-user",ref:"searchUserResultRef"},Me={key:0,class:w(["search-user-container"])},Ee={class:"search-user-result"},xe={class:"search-user-item"},Re={class:"user-item-email"},Pe={class:"list-item-section"},Ae={class:"list-item-title"},Ne={class:"list-item-container"},Oe={class:"list-item"},Ve=["src"],Le={class:"people-access-info"},Be={class:"people-access-permission"},Te={key:0,class:"ms-2 text-danger bx bx-trash"},ze={class:"list-item-section"},qe={class:"list-item-container"},Fe={class:"list-item"},We={class:"d-flex align-items-center"},Ye={key:0,class:"fs-4 bx bx-check result-correct"},Qe={class:"people-access-permission"},je=["onClick"];function De(m,o,i,e,Y,H){const d=f("RouterLink"),p=f("a-col"),k=f("a-row"),M=f("a-select-option"),E=f("a-select"),B=f("a-form-item"),I=f("a-qrcode"),x=f("a-input"),g=f("a-button"),T=f("a-popconfirm"),Q=f("a-form"),j=f("a-modal");return r(),N(j,{centered:"",width:"100%","wrap-class-name":"medium-modal",open:e.visibility,onCancel:e.closeModal},{footer:l(()=>o[8]||(o[8]=[])),default:l(()=>[t("div",{class:w(["page-container",e.selected_visibility_option===e.VISIBILITY.PRIVATE?"larger":""])},[t("div",Ce,[n(k,{class:"w-100 d-flex align-items-center justify-content-between"},{default:l(()=>[n(p,{span:1},{default:l(()=>[n(d,{to:{name:""},onClick:e.closeModal},{default:l(()=>o[2]||(o[2]=[t("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[2]})]),_:1}),n(p,{class:"main-title",span:22},{default:l(()=>[t("span",null,u(m.$t("share_modal.title"))+" "+u(m.$t(`share_modal.mode.${i.mode}`))+" "+u(i.name),1),o[3]||(o[3]=t("br",null,null,-1)),t("span",null,u(m.$t("share_modal.sub_title")),1)]),_:1,__:[3]})]),_:1})]),n(Q,{layout:"vertical"},{default:l(()=>[n(k,{class:"p-3 d-flex justify-content-between"},{default:l(()=>[n(p,{span:24},{default:l(()=>[n(B,{label:m.$t("share_modal.component_title.visibility")},{default:l(()=>[n(E,{disabled:!e.isUserOwner,onChange:e.onChangeVisibility,class:"me-3",value:e.selected_visibility_option,"onUpdate:value":o[0]||(o[0]=a=>e.selected_visibility_option=a),style:{width:"200px"}},{default:l(()=>[(r(!0),h(O,null,V(e.visibility_options,a=>(r(),N(M,{value:a.value},{default:l(()=>[C(u(a.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["disabled","value"]),t("div",we,u(e.selected_visibility_explain),1)]),_:1},8,["label"])]),_:1}),U(` <a-col
                        :span="24"
                        :class="[
                            'shareable-link-container',
                            selected_visibility_option === VISIBILITY.PUBLIC ? '' : 'd-none',
                        ]"
                    >
                        <a-qrcode :value="getPublicShareUrl()" />
                        <div>
                            <a-input class="share-link" :value="getPublicShareUrl()" />
                            <a-button
                                class="mt-2 main-color-btn"
                                type="primary"
                                @click="onCopyPublicShareUrl"
                            >
                                <i class="me-3 bx bx-link-alt"></i>
                                {{ $t("share_modal.buttons.copy_link") }}
                            </a-button>
                        </div>
                    </a-col> `),n(p,{span:24,class:w([e.selected_visibility_option===e.VISIBILITY.PRIVATE||e.selected_visibility_option===e.VISIBILITY.PUBLIC?"":"d-none"])},{default:l(()=>[n(p,{span:24,class:w(["shareable-link-container",e.selected_visibility_option===e.VISIBILITY.PUBLIC?"":"d-none"])},{default:l(()=>[n(I,{value:e.getPublicShareUrl()},null,8,["value"]),t("div",null,[n(x,{class:"share-link",value:e.getPublicShareUrl()},null,8,["value"]),n(g,{class:"mt-2 main-color-btn",type:"primary",onClick:e.onCopyPublicShareUrl},{default:l(()=>[o[4]||(o[4]=t("i",{class:"me-3 bx bx-link-alt"},null,-1)),C(" "+u(m.$t("share_modal.buttons.copy_link")),1)]),_:1,__:[4]})])]),_:1},8,["class"]),e.isUserOwner?(r(),h("div",ke,[t("label",null,[C(u(m.$t("share_modal.component_title.share_with_email"))+" - ",1),t("span",null,u(m.$t("share_modal.other.search_ins")),1)]),n(e.Input,{onChange:e.onSearchUser,value:e.searchUserEmailValue,"onUpdate:value":o[1]||(o[1]=a=>e.searchUserEmailValue=a),placeholder:e.t("share_modal.other.search_email_placeholder")},{icon:l(()=>o[5]||(o[5]=[t("i",{class:"bx bx-envelope"},null,-1)])),_:1},8,["value","placeholder"]),e.userFound.length>0?(r(),h("div",Me,[t("div",Ee,[(r(!0),h(O,null,V(e.userFound,a=>(r(),h("div",xe,[t("div",Re,u(a.email),1),t("div",{class:w(["user-item-access",e.isSharedUserContain(a.id)?"d-none":""])},[n(g,{type:"primary",class:"main-color-btn",onClick:c=>e.onShareWithResultUser(a)},{default:l(()=>[...o[6]||(o[6]=[t("i",{class:"bx bxs-user-plus"},null,-1)])]),_:2,__:[6]},1032,["onClick"])],2)]))),256))])])):U("v-if",!0)],512)):U("v-if",!0),t("div",Pe,[t("div",Ae,u(m.$t("share_modal.component_title.people_with_access",{number:e.sharedUser.length})),1),t("div",Ne,[(r(!0),h(O,null,V(e.sharedUser,a=>(r(),h("div",Oe,[t("img",{class:"people-access-img",src:e.user_image,alt:""},null,8,Ve),t("div",Le,[t("span",null,u(a.fullName),1),t("span",null,u(a.email),1)]),t("div",Be,[n(E,{disabled:a.shareMode===e.PERMISSION.OWNER||a.userId===e.user.id,onChange:c=>e.onChangePeoplePermission(a.userId,a.shareMode),style:{width:"130px"},value:a.shareMode,"onUpdate:value":c=>a.shareMode=c},{default:l(()=>[(r(!0),h(O,null,V(e.permission_options,c=>(r(),N(M,{value:c.value},{default:l(()=>[C(u(c.label),1)]),_:2},1032,["value"]))),256)),a.shareMode===e.PERMISSION.OWNER?(r(),N(M,{key:0,value:e.PERMISSION.OWNER},{default:l(()=>[C(u(e.t(`share_modal.permission.${e.PERMISSION.OWNER}.mode`)),1)]),_:1},8,["value"])):U("v-if",!0)]),_:2},1032,["disabled","onChange","value","onUpdate:value"]),n(T,{title:m.$t("share_modal.other.delete_warning"),"ok-text":m.$t("share_modal.buttons.yes"),"cancel-text":m.$t("share_modal.buttons.no"),onConfirm:c=>e.onConfirmRemovePeopleAccess(a.userId)},{default:l(()=>[a.userId!==e.user.id&&a.shareMode!==e.PERMISSION.OWNER?(r(),h("i",Te)):U("v-if",!0)]),_:2},1032,["title","ok-text","cancel-text","onConfirm"])])]))),256))])])]),_:1},8,["class"]),n(p,{span:24,class:w([e.selected_visibility_option===e.VISIBILITY.IN_CLASS?"":"d-none"])},{default:l(()=>[t("div",ze,[t("div",qe,[(r(!0),h(O,null,V(e.sharedClass,a=>(r(),h("div",Fe,[t("span",We,[C(u(a.className)+" ",1),a.isAdded?(r(),h("i",Ye)):U("v-if",!0)]),t("div",Qe,[a.isAdded?(r(),h("i",{key:0,class:"text-danger bx bx-trash-alt",onClick:c=>e.onRemoveFromClass(a.classId)},null,8,je)):(r(),N(g,{key:1,type:"ghost",size:"small",class:"main-color-btn",onClick:c=>e.onAddToClass(a.classId)},{default:l(()=>[...o[7]||(o[7]=[t("i",{class:"bx bx-plus"},null,-1)])]),_:2,__:[7]},1032,["onClick"]))])]))),256))])])]),_:1},8,["class"])]),_:1})]),_:1})],2)]),_:1},8,["open"])}const ss=ge(Ue,[["render",De],["__scopeId","data-v-a1cc234f"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/shared/modals/ShareModal.vue"]]);export{ss as S};

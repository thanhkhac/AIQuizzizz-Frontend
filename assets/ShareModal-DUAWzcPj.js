import{d as ve,u as he,g as fe,i as u,B as G,C as pe,s as be,K as ge,k as S,_ as ye,r as f,E as q,o as d,w as o,b as t,p as w,c as n,t as m,a as v,F as E,D as R,f as V,e as W}from"./index-odI1__hS.js";import{A as K}from"./ApiQuestionSet-DBReJRHg.js";import{A as ae}from"./ApiClass-BbWFed0P.js";import{A as te}from"./ApiTestTemplate-DcqlEdwS.js";import{A as le}from"./ApiFolder-hMFxavhR.js";import{I as Ie}from"./Input-DyxqJnjy.js";import{V as H}from"./visibility-PZlBDoOn.js";const N={OWNER:"Owner",EDITABLE:"Editable",VIEW_ONLY:"ViewOnly"},Se=ve({__name:"ShareModal",props:{id:{type:String,required:!0},name:{type:String,required:!0},mode:{type:String,required:!0},visibility:{type:String,required:!0},options:{type:null,required:!0}},setup(h,{expose:l}){const{t:i}=he(),e=fe(),Y=u(e.getUserInfo()),J=G(()=>{var _;return((_=a.value.find(b=>b.shareMode===N.OWNER))==null?void 0:_.userId)===Y.value.id}),r=h,p=u(!1),U=async()=>{if(p.value=!0,r.mode==="quiz"&&r.visibility===H.IN_CLASS){await $();return}await T()},P=()=>{p.value=!1};l({openModal:U});const C=Object.values(r.options),L=G(()=>C.map(s=>({label:i(`share_modal.visibility.${s}.mode`),value:s}))),g=u(r.visibility||L.value[0].value),M=u("");pe(()=>g.value,async s=>{M.value=i(`share_modal.visibility.${s}.explain`),s===H.PRIVATE&&await T()});const y=[N.EDITABLE,N.VIEW_ONLY],O=G(()=>y.map(s=>({label:i(`share_modal.permission.${s}.mode`),value:s}))),D=u(O.value[0].value),Q=u([{id:"1",name:"SEP490 - Summer 2025"},{id:"2",name:"MLN111 - Spring 2025"},{id:"3",name:"MLN121 - Spring 2025"}]),a=u([]),c=u(),j=u([]),T=async()=>{let s;switch(r.mode){case"quiz":{s=await K.GetSharedUser(r.id);break}case"template":{s=await te.GetSharedUser(r.id);break}case"folder":{s=await le.GetSharedUser(r.id);break}}s!=null&&s.data.success&&(a.value=s.data.data.sharingModel)},B=u(""),k=u([]),z=u([]),X=u(null);function Z(s){var _;B.value&&!((_=X.value)!=null&&_.contains(s.target))?k.value=[]:k.value=[...z.value]}const ie=async()=>{if(!B.value.trim()){k.value=[],z.value=[];return}const s=await ge.SearchByEmail(B.value);s.data.success&&(k.value=s.data.data,z.value=[...s.data.data])},x=async({sharingModels:s=[],deleteUserIds:_=[],successMsg:b=i("message.updated_successfully"),errorMsg:A=i("message.updated_failed")})=>{c.value={id:r.id,sharingModels:s,deleteUserIds:_};let I;switch(r.mode){case"quiz":{I=await K.UpdateSharedUser({...c.value,visibilityMode:g.value});break}case"template":{I=await te.UpdateSharedUser(c.value);break}case"folder":{I=await le.UpdateSharedUser({folderId:c.value.id,...c.value});break}}I!=null&&I.data.success?(await T(),S.success(b)):S.error(A)},oe=async s=>{await x({sharingModels:[{sharingUserId:s.id,shareMode:N.VIEW_ONLY}],successMsg:i("message.added_successfully"),errorMsg:i("message.added_failed")})},ne=async(s,_)=>{await x({sharingModels:[{sharingUserId:s,shareMode:_}],successMsg:i("message.updated_successfully"),errorMsg:i("message.updated_failed")})},re=async s=>{j.value.push(s),await x({sharingModels:[],deleteUserIds:j.value,successMsg:i("message.removed_successfully"),errorMsg:i("message.removed_failed")})},de=s=>a.value.some(_=>_.userId===s),F=u([]),$=async()=>{const s=await K.GetSharedClasses(r.id);s.data.success&&(F.value=s.data.data)},ce=async s=>{if((await ae.AddQuestionSet(s,r.id)).data.success){const b=F.value.find(A=>A.classId===s);b&&(b.isAdded=!0),S.success(i("message.added_successfully"))}},ue=async s=>{if((await ae.DeleteQuestionSetFromClass(s,r.id)).data.success){const b=F.value.find(A=>A.classId===s);b&&(b.isAdded=!1),S.success(i("message.removed_successfully"))}},ee=()=>window.location.origin+`/user/question-set/${r.id}`,me=()=>{navigator.clipboard.writeText(ee()).then(()=>{S.success(i("message.copied"))}).catch(()=>{S.error(i("message.copied_failed"))})},_e=async()=>{await x({sharingModels:[],successMsg:i("message.updated_successfully"),errorMsg:i("message.updated_failed")})};be(()=>{document.addEventListener("click",Z),M.value=i(`share_modal.visibility.${g.value}.explain`)});const se={t:i,authStore:e,user:Y,isUserOwner:J,props:r,visibility:p,openModal:U,closeModal:P,visibilityKeys:C,visibility_options:L,selected_visibility_option:g,selected_visibility_explain:M,permissionKeys:y,permission_options:O,selected_permission_option:D,user_class_sample:Q,sharedUser:a,sharingFormState:c,deleteUserIds:j,getSharedUser:T,searchUserEmailValue:B,userFound:k,lastSearchResult:z,searchUserResultRef:X,handleMouseClickOutside:Z,onSearchUser:ie,updateSharedUsers:x,onShareWithResultUser:oe,onChangePeoplePermission:ne,onConfirmRemovePeopleAccess:re,isSharedUserContain:de,sharedClass:F,getSharedClasses:$,onAddToClass:ce,onRemoveFromClass:ue,getPublicShareUrl:ee,onCopyPublicShareUrl:me,onChangeVisibility:_e,Input:Ie,get VISIBILITY(){return H},get PERMISSION(){return N}};return Object.defineProperty(se,"__isScriptSetup",{enumerable:!1,value:!0}),se}}),we={class:"title-container"},Ue={class:"visibility-explain"},Ce={key:0,class:"form-item search-user",ref:"searchUserResultRef"},Me={key:0,class:w(["search-user-container"])},ke={class:"search-user-result"},xe={class:"search-user-item"},Ae={class:"user-item-email"},Ee={class:"list-item-section"},Re={class:"list-item-title"},Ve={class:"list-item-container"},Ne={class:"list-item"},Pe={class:"people-access-info"},Le={class:"people-access-permission"},Oe={key:0,class:"ms-2 text-danger bx bx-trash"},Te={class:"list-item-section"},Be={class:"list-item-container"},ze={class:"list-item"},Fe={class:"d-flex align-items-center"},qe={key:0,class:"fs-4 bx bx-check result-correct"},We={class:"people-access-permission"},Ye=["onClick"];function De(h,l,i,e,Y,J){const r=f("RouterLink"),p=f("a-col"),U=f("a-row"),P=f("a-select-option"),C=f("a-select"),L=f("a-form-item"),g=f("a-qrcode"),M=f("a-input"),y=f("a-button"),O=f("a-popconfirm"),D=f("a-form"),Q=f("a-modal");return d(),q(Q,{centered:"",width:"100%","wrap-class-name":"medium-modal",open:e.visibility,onCancel:e.closeModal},{footer:o(()=>l[10]||(l[10]=[])),default:o(()=>[t("div",{class:w(["page-container",e.selected_visibility_option===e.VISIBILITY.PRIVATE?"larger":""])},[t("div",we,[n(U,{class:"w-100 d-flex align-items-center justify-content-between"},{default:o(()=>[n(p,{span:1},{default:o(()=>[n(r,{to:{name:""},onClick:e.closeModal},{default:o(()=>l[2]||(l[2]=[t("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[2]})]),_:1}),n(p,{class:"main-title",span:22},{default:o(()=>[t("span",null,m(h.$t("share_modal.title"))+" "+m(h.$t(`share_modal.mode.${i.mode}`))+" "+m(i.name),1),l[3]||(l[3]=t("br",null,null,-1)),t("span",null,m(h.$t("share_modal.sub_title")),1)]),_:1,__:[3]})]),_:1})]),n(D,{layout:"vertical"},{default:o(()=>[n(U,{class:"p-3 d-flex justify-content-between"},{default:o(()=>[n(p,{span:24},{default:o(()=>[n(L,{label:h.$t("share_modal.component_title.visibility")},{default:o(()=>[n(C,{disabled:!e.isUserOwner,onChange:e.onChangeVisibility,class:"me-3",value:e.selected_visibility_option,"onUpdate:value":l[0]||(l[0]=a=>e.selected_visibility_option=a),style:{width:"200px"}},{default:o(()=>[(d(!0),v(E,null,R(e.visibility_options,a=>(d(),q(P,{value:a.value},{default:o(()=>[V(m(a.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["disabled","value"]),t("div",Ue,m(e.selected_visibility_explain),1)]),_:1},8,["label"])]),_:1}),n(p,{span:24,class:w(["shareable-link-container",e.selected_visibility_option===e.VISIBILITY.PUBLIC?"":"d-none"])},{default:o(()=>[n(g,{value:e.getPublicShareUrl()},null,8,["value"]),t("div",null,[n(M,{class:"share-link",value:e.getPublicShareUrl()},null,8,["value"]),n(y,{class:"mt-2 main-color-btn",type:"primary",onClick:e.onCopyPublicShareUrl},{default:o(()=>[l[4]||(l[4]=t("i",{class:"me-3 bx bx-link-alt"},null,-1)),V(" "+m(h.$t("share_modal.buttons.copy_link")),1)]),_:1,__:[4]})])]),_:1},8,["class"]),n(p,{span:24,class:w([e.selected_visibility_option===e.VISIBILITY.PRIVATE?"":"d-none"])},{default:o(()=>[e.isUserOwner?(d(),v("div",Ce,[t("label",null,[V(m(h.$t("share_modal.component_title.share_with_email"))+" - ",1),l[5]||(l[5]=t("span",null,"enter full email to search user",-1))]),n(e.Input,{onChange:e.onSearchUser,value:e.searchUserEmailValue,"onUpdate:value":l[1]||(l[1]=a=>e.searchUserEmailValue=a),placeholder:e.t("share_modal.other.search_email_placeholder")},{icon:o(()=>l[6]||(l[6]=[t("i",{class:"bx bx-envelope"},null,-1)])),_:1},8,["value","placeholder"]),e.userFound.length>0?(d(),v("div",Me,[t("div",ke,[(d(!0),v(E,null,R(e.userFound,a=>(d(),v("div",xe,[t("div",Ae,m(a.email),1),t("div",{class:w(["user-item-access",e.isSharedUserContain(a.id)?"d-none":""])},[n(y,{type:"primary",class:"main-color-btn",onClick:c=>e.onShareWithResultUser(a)},{default:o(()=>[...l[7]||(l[7]=[t("i",{class:"bx bxs-user-plus"},null,-1)])]),_:2,__:[7]},1032,["onClick"])],2)]))),256))])])):W("v-if",!0)],512)):W("v-if",!0),t("div",Ee,[t("div",Re,m(h.$t("share_modal.component_title.people_with_access",{number:e.sharedUser.length})),1),t("div",Ve,[(d(!0),v(E,null,R(e.sharedUser,a=>(d(),v("div",Ne,[l[8]||(l[8]=t("img",{class:"people-access-img",src:"",alt:""},null,-1)),t("div",Pe,[t("span",null,m(a.fullName),1),t("span",null,m(a.email),1)]),t("div",Le,[n(C,{disabled:a.shareMode===e.PERMISSION.OWNER||a.userId===e.user.id,onChange:c=>e.onChangePeoplePermission(a.userId,a.shareMode),style:{width:"130px"},value:a.shareMode,"onUpdate:value":c=>a.shareMode=c},{default:o(()=>[(d(!0),v(E,null,R(e.permission_options,c=>(d(),q(P,{value:c.value},{default:o(()=>[V(m(c.label),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["disabled","onChange","value","onUpdate:value"]),n(O,{title:h.$t("share_modal.other.delete_warning"),"ok-text":h.$t("share_modal.buttons.yes"),"cancel-text":h.$t("share_modal.buttons.no"),onConfirm:c=>e.onConfirmRemovePeopleAccess(a.userId)},{default:o(()=>[a.userId!==e.user.id&&a.shareMode!==e.PERMISSION.OWNER?(d(),v("i",Oe)):W("v-if",!0)]),_:2},1032,["title","ok-text","cancel-text","onConfirm"])])]))),256))])])]),_:1},8,["class"]),n(p,{span:24,class:w([e.selected_visibility_option===e.VISIBILITY.IN_CLASS?"":"d-none"])},{default:o(()=>[t("div",Te,[t("div",Be,[(d(!0),v(E,null,R(e.sharedClass,a=>(d(),v("div",ze,[t("span",Fe,[V(m(a.className)+" ",1),a.isAdded?(d(),v("i",qe)):W("v-if",!0)]),t("div",We,[a.isAdded?(d(),v("i",{key:0,class:"text-danger bx bx-trash-alt",onClick:c=>e.onRemoveFromClass(a.classId)},null,8,Ye)):(d(),q(y,{key:1,type:"ghost",size:"small",class:"main-color-btn",onClick:c=>e.onAddToClass(a.classId)},{default:o(()=>[...l[9]||(l[9]=[t("i",{class:"bx bx-plus"},null,-1)])]),_:2,__:[9]},1032,["onClick"]))])]))),256))])])]),_:1},8,["class"])]),_:1})]),_:1})],2)]),_:1},8,["open"])}const Ze=ye(Se,[["render",De],["__scopeId","data-v-a1cc234f"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/shared/modals/ShareModal.vue"]]);export{Ze as S};

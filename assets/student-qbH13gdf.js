import{d as ce,q as me,l as ue,u as _e,z as $,i as S,j as Q,E as ge,s as pe,R as V,k as v,M,v as ee,_ as ve,r as g,c as f,o as u,b as t,a as l,e as z,w as n,f as p,t as d,C as D,F as h,B as ae}from"./index-DlVciecZ.js";import{u as be}from"./user-zaK1_Zi8.js";import{A as N}from"./ApiClass-CeJRP6bx.js";import{I as fe}from"./Input-DHZLWcQT.js";import{C as ye}from"./classStudentPosition-B7ChrNvq.js";import{V as Ce}from"./Validator-CWeiTIFe.js";const Se={FULL_NAME:"FullName",EMAIL:"Email"},ke=ce({__name:"student",emits:["updateSidebar"],setup(m,{expose:a,emit:K}){var Z;a();const e=me(),y=ue(),{t:o}=_e(),k=K,w=Object.values(Se),U=$(()=>w.map(s=>({label:o(`class_member.select_option.${s}`),value:s}))),_=S(e.params.id||""),C=S({classId:"",name:"",topic:""}),x=S(!1),j=[{title:"No",key:"no",customRender:s=>s.index+1},{title:o("class_member.column.fullName"),dataIndex:"fullName",key:"fullName",sorter:(s,c)=>s.fullName.localeCompare(c.fullName)},{title:o("class_member.column.email"),dataIndex:"email",key:"email",sorter:(s,c)=>s.email.localeCompare(c.email)},{title:o("class_member.column.position"),dataIndex:"position",key:"position"},{key:"action"}],E=[1,3,5,7,30],P=$(()=>E.map(s=>({label:s+o(s===1?"class_member.other.day_singular":"class_member.other.day_plural"),value:s}))),A=async()=>{try{if(!Ce.isValidGuid(_.value.toString())){y.push({name:"404"});return}_.value||y.push({name:"404"});let s=await N.GetById(_.value.toString());s.data.success||y.push({name:"404"}),C.value=s.data.data,L.name=C.value.name,L.topic=C.value.topic}catch(s){const c=Object.keys(s.response.data.errors);if(c.includes(V.NOT_FOUND_STUDENT_IN_CLASS)||c.includes(V.NOT_FOUND_USER_IN_CLASS)){y.push({name:"User_Class"});return}}},T=S(""),F=async()=>{try{const s=await N.GetUserPermission(C.value.classId);s.data.success&&(T.value=s.data.data)}catch(s){console.log(s)}},r=Q({pageNumber:e.query.pageNumber||1,pageSize:e.query.pageSize||10,keyword:((Z=e.query.keyword)==null?void 0:Z.toString())||"",fieldName:e.query.fieldName||U.value[0].value,totalCount:0,statusFilter:!1}),O=S([]),I=async()=>{try{x.value=!0;let s=await N.GetAllStudentByLimit(_.value.toString(),r);if(s.data.success){let c=s.data.data;O.value=c.items,r.pageNumber=c.pageNumber,r.pageSize=c.pageSize,r.totalCount=c.totalCount,r.statusFilter&&(r.pageNumber>c.totalPages&&r.totalCount>0?(r.pageNumber=1,y.push({name:"User_Class_Student",params:{id:_.value},query:{pageNumber:1,pageSize:r.pageSize,keyword:r.keyword,fieldName:r.fieldName}})):y.push({name:"User_Class_Student",params:{id:_.value},query:{pageNumber:r.pageNumber,pageSize:r.pageSize,keyword:r.keyword,fieldName:r.fieldName}}),r.statusFilter=!r.statusFilter)}}catch(s){const c=Object.keys(s.response.data.errors);(c.includes(V.NOT_FOUND_STUDENT_IN_CLASS)||c.includes(V.NOT_FOUND_USER_IN_CLASS))&&y.push({name:"User_Class"})}finally{x.value=!1}};ge(()=>Object.keys(e.query).length,()=>{var s;r.pageNumber=e.query.pageNumber||1,r.pageSize=e.query.pageSize||10,r.keyword=((s=e.query.keyword)==null?void 0:s.toString())||"",r.fieldName=e.query.fieldName||U.value[0].value,r.statusFilter=!0,I()});const B=(s,c)=>{r.pageNumber=s,r.pageSize=c,r.statusFilter=!0,I()},q=S(!1),i=Q({classId:_.value,code:"",expiredTime:P.value[0].value}),b=S(""),R=S(!1),W=async()=>{await H(),q.value=!0},H=async()=>{const s=await N.GetInivationCode(_.value.toString());s.data.data&&(i.code=s.data.data,b.value=window.location.origin+`/user/class/invitation/${i.code}`)},te=async()=>{(await N.CreateNewInvitation(i)).data.success?(v.success(o("message.created_new_invitation")),W()):v.error(o("message.created_failed"))},se=s=>{if(!i.code)return;let c=i.code;s==="link"&&(c=b.value),navigator.clipboard.writeText(c).then(()=>{v.success(o("message.copied"))}).catch(()=>{v.error(o("message.copied_failed"))})},ne=s=>{M.confirm({title:o("class_member.modal.delete_member_title"),content:o("class_member.modal.delete_member_content"),centered:!0,okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),onOk:async()=>{if(!(await N.DeleteClassMember(_.value.toString(),s.toString())).data.success){v.error(o("message.removed_failed"));return}v.success(o("message.removed_successfully")),await I()}})},le=(s,c)=>{M.confirm({title:o("class_member.modal.update_member_title"),content:o("class_member.modal.update_member_content"),centered:!0,okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),onOk:async()=>{if(!(await N.UpdateClassMemberPosition(_.value.toString(),s.toString(),c)).data.success){v.error(o("message.updated_failed"));return}v.success(o("message.updated_successfully")),await I()}})},oe=()=>{M.confirm({title:o("class_member.danger_zone.warning"),content:ee("div",{style:"color: red"},o("class_member.danger_zone.warning_explain")),centered:!0,okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),onOk:async()=>{if(!(await N.Delete(_.value.toString())).data.success){v.error(o("message.deleted_failed"));return}v.success(o("message.deleted_successfully")),y.push({name:"User_Class"})}})},ie=()=>{M.confirm({title:o("class_member.danger_zone.warning"),content:ee("div",{style:"color: red"},o("class_member.danger_zone.warning_explain")),centered:!0,okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),onOk:async()=>{if(!(await N.Delete(_.value.toString())).data.success){v.error(o("message.deleted_failed"));return}v.success(o("message.deleted_successfully")),y.push({name:"User_Class"})}})},re={name:[{required:!0,message:o("message.required"),trigger:"change"},{max:100,message:o("message.out_of_range",{max_length:100}),trigger:"change"}],topic:[{max:100,message:o("message.out_of_range",{max_length:100}),trigger:"change"}]},J=S(!1),X=S(),L=Q({name:C.value.name,topic:C.value.topic}),G=S(!1),de=async()=>{var s;G.value=!0;try{if((s=X.value)==null||s.validate(),!(await N.Update({classId:_.value,name:L.name,topic:L.topic})).data.success){v.error(o("message.updated_failed"));return}v.success(o("message.updated_successfully")),J.value=!1,window.location.reload()}catch(c){console.log(c)}finally{G.value=!1}};pe(async()=>{k("updateSidebar","class"),await A(),await F(),await I()});const Y={route:e,router:y,t:o,emit:k,optionKeys:w,class_position_options:U,classId:_,classData:C,loading:x,columns:j,optionDays:E,code_limit_time:P,getClassData:A,userRoleInClass:T,getPermission:F,pageParams:r,student_data:O,getData:I,onPaginationChange:B,modal_invitation_open:q,invitationFormState:i,inivitationLink:b,isInvitaionLoading:R,onOpenInvitationModal:W,getInvitationCode:H,onResetInvitation:te,onCopyInvitationCode:se,onConfirmDeleteMember:ne,onConfirmUpdateMemberPosition:le,onOpenConfirmDeleteClass:oe,onOpenConfirmLeaveClass:ie,rules:re,modal_update_open:J,updateClassFormRef:X,updateClassFormState:L,isUpdateLoading:G,onUpdateClass:de,get user_image(){return be},Input:fe,get CLASS_STUDENT_POSITION(){return ye}};return Object.defineProperty(Y,"__isScriptSetup",{enumerable:!1,value:!0}),Y}}),Ne={class:"page-container"},Ie={class:"title-container"},we={class:"breadcrumb-container"},xe={class:"title-breadcrumb-item"},Te={class:"title-breadcrumb-item"},he={class:"breadcrumb-item-topic"},Ue={class:"content"},Oe={class:"content-item"},ze={class:"content-item-title"},De={class:"content-item-functions"},Fe={class:"content-item-navigators"},Le={class:"navigator-container"},Ee={style:{width:"300px",padding:"0px"}},Pe={key:0,class:"student-name-container"},Ae=["src"],qe={class:"student-name"},Re={key:0,class:"student-action"},Ve=["onClick"],Me=["onClick"],je=["onClick"],Be={key:1,class:"w-100 d-flex justify-content-center"},Ge={class:"pagination-container"},Qe={key:0,class:"mt-4 content-item"},Ke={class:"content-item-title"},We={class:"text-danger"},He={class:"danger-zone mt-3 p-4"},Je={class:"text-danger fs-6 fw-bold"},Xe={class:"text-secondary"},Ye={key:1,class:"mt-4 content-item"},Ze={class:"modal-container"},$e={class:"modal-title-container"},ea={class:"modal-container"},aa={class:"modal-title-container"},ta={class:"modal-invitation-body"},sa={class:"invitation-code-container"},na={class:"invitation-code-container"};function la(m,a,K,e,y,o){const k=g("RouterLink"),w=g("a-button"),U=g("a-select-option"),_=g("a-select"),C=g("a-skeleton"),x=g("a-tooltip"),j=g("a-table"),E=g("a-config-provider"),P=g("a-empty"),A=g("a-pagination"),T=g("a-col"),F=g("a-row"),r=g("a-form-item"),O=g("a-form"),I=g("a-modal"),B=g("a-qrcode"),q=g("a-divider");return u(),f(h,null,[t("div",Ne,[t("div",Ie,[t("div",we,[t("ul",null,[t("li",xe,[l(k,{to:{name:"User_Class"}},{default:n(()=>[t("span",null,d(m.$t("class_index.title")),1),a[15]||(a[15]=p()),a[16]||(a[16]=t("br",null,null,-1))]),_:1,__:[15,16]}),a[17]||(a[17]=t("i",{class:"bx bx-chevron-right"},null,-1))]),t("li",Te,[l(k,{to:{name:""},class:"breadcrumb-item-class",onClick:a[0]||(a[0]=i=>e.modal_update_open=!0)},{default:n(()=>[t("span",null,d(e.classData.name),1),t("span",he,d(e.classData.topic),1)]),_:1}),a[18]||(a[18]=t("i",{class:"bx bx-edit"},null,-1))])])])]),t("div",Ue,[t("div",Oe,[t("div",ze,[t("div",null,[t("span",null,d(m.$t("class_member.title")),1),t("span",null,d(m.$t("class_member.sub_title")),1)]),e.userRoleInClass!==e.CLASS_STUDENT_POSITION.STUDENT?(u(),D(w,{key:0,class:"main-color-btn",type:"primary",size:"large",onClick:e.onOpenInvitationModal},{default:n(()=>[a[19]||(a[19]=t("i",{class:"me-2 bx bx-user-plus"},null,-1)),p(" "+d(m.$t("class_member.buttons.invite_member")),1)]),_:1,__:[19]})):z("v-if",!0)]),t("div",De,[t("div",Fe,[t("div",Le,[l(k,{class:"navigator-item",to:{name:"User_Class_Exam"}},{default:n(()=>[p(d(m.$t("class_index.navigators.exam")),1)]),_:1}),l(k,{class:"navigator-item",to:{name:"User_Class_Quiz"}},{default:n(()=>[p(d(m.$t("class_index.navigators.quiz")),1)]),_:1}),l(k,{class:"navigator-item navigator-active",to:{name:""}},{default:n(()=>[p(d(m.$t("class_index.navigators.member")),1)]),_:1})])]),l(_,{class:"me-3",value:e.pageParams.fieldName,"onUpdate:value":a[1]||(a[1]=i=>e.pageParams.fieldName=i),style:{width:"200px"},onChange:e.getData},{default:n(()=>[(u(!0),f(h,null,ae(e.class_position_options,i=>(u(),D(U,{value:i.value},{default:n(()=>[p(d(i.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"]),t("div",Ee,[l(e.Input,{onInput:e.getData,modelValue:e.pageParams.keyword,"onUpdate:modelValue":a[2]||(a[2]=i=>e.pageParams.keyword=i),placeholder:e.t("class_member.other.search_placeholder")},{icon:n(()=>a[20]||(a[20]=[t("i",{class:"bx bx-search"},null,-1)])),_:1},8,["modelValue","placeholder"])])]),e.loading?(u(),f(h,{key:0},[l(C,{active:"",loading:e.loading},null,8,["loading"]),l(C,{active:"",loading:e.loading},null,8,["loading"]),l(C,{active:"",loading:e.loading},null,8,["loading"])],64)):(u(),f(h,{key:1},[e.student_data.length>0?(u(),D(E,{key:0,locale:{Table:{cancelSort:"",triggerAsc:"",triggerDesc:""}}},{default:n(()=>[l(j,{columns:e.columns,"data-source":e.student_data,"row-key":"studentId",pagination:!1},{bodyCell:n(({column:i,record:b})=>[i.key==="fullName"?(u(),f("div",Pe,[t("img",{class:"user-image",src:e.user_image,alt:""},null,8,Ae),t("div",qe,d(b.fullName),1)])):z("v-if",!0),i.key==="position"?(u(),f(h,{key:1},[p(d(m.$t(`class_member.position.${b.position}`)),1)],64)):z("v-if",!0),i.key==="action"?(u(),f(h,{key:2},[e.userRoleInClass===e.CLASS_STUDENT_POSITION.OWNER?(u(),f("div",Re,[b.position===e.CLASS_STUDENT_POSITION.STUDENT?(u(),D(x,{key:0},{title:n(()=>[p(d(m.$t("class_member.buttons.assign_lecturer")),1)]),default:n(()=>[t("i",{style:{cursor:"pointer"},class:"bx bxs-id-card",onClick:R=>e.onConfirmUpdateMemberPosition(b.studentId,e.CLASS_STUDENT_POSITION.TEACHER)},null,8,Ve)]),_:2},1024)):(u(),D(x,{key:1},{title:n(()=>[p(d(m.$t("class_member.buttons.remove_lecturer")),1)]),default:n(()=>[t("i",{class:"text-danger bx bxs-id-card",onClick:R=>e.onConfirmUpdateMemberPosition(b.studentId,e.CLASS_STUDENT_POSITION.STUDENT)},null,8,Me)]),_:2},1024)),l(x,null,{title:n(()=>[p(d(m.$t("question_sets_index.buttons.delete")),1)]),default:n(()=>[t("i",{class:"text-danger bx bx-trash-alt",onClick:R=>e.onConfirmDeleteMember(b.studentId)},null,8,je)]),_:2},1024)])):z("v-if",!0)],64)):z("v-if",!0)]),_:1},8,["data-source"])]),_:1})):(u(),f("div",Be,[l(P,null,{description:n(()=>[t("span",null,d(m.$t("class_index.other.no_data_matches")),1)]),_:1})]))],64)),t("div",Ge,[l(A,{onChange:e.onPaginationChange,current:e.pageParams.pageNumber,"onUpdate:current":a[3]||(a[3]=i=>e.pageParams.pageNumber=i),total:e.pageParams.totalCount,pageSize:e.pageParams.pageSize,"show-total":(i,b)=>`${b[0]}-${b[1]} of ${i} ${e.t("class_member.other.items")}`,"show-size-changer":"","show-quick-jumper":"",class:"crud-layout-pagination",locale:{items_per_page:e.t("class_index.other.pages")}},null,8,["current","total","pageSize","show-total","locale"])])]),e.userRoleInClass===e.CLASS_STUDENT_POSITION.OWNER?(u(),f("div",Qe,[t("div",Ke,[t("div",null,[t("span",We,d(m.$t("class_member.danger_zone.title")),1),t("span",null,d(m.$t("class_member.danger_zone.sub_title")),1)])]),t("div",He,[t("div",Je,d(m.$t("class_member.danger_zone.warning")),1),t("div",Xe,d(m.$t("class_member.danger_zone.warning_explain")),1),l(w,{class:"mt-3",type:"primary",danger:"",size:"large",onClick:e.onOpenConfirmDeleteClass},{default:n(()=>[p(d(m.$t("class_member.buttons.delete_class")),1)]),_:1})])])):(u(),f("div",Ye,[l(w,{class:"mt-3",type:"primary",danger:"",size:"large",onClick:e.onOpenConfirmLeaveClass},{default:n(()=>[p(d(m.$t("class_member.buttons.move_out_class"))+" ",1),a[21]||(a[21]=t("i",{class:"bx bx-download bx-rotate-270"},null,-1))]),_:1,__:[21]})]))])]),l(I,{centered:"","wrap-class-name":"medium-modal",open:e.modal_update_open,onCancel:a[7]||(a[7]=i=>e.modal_update_open=!1)},{footer:n(()=>[l(w,{loading:e.isUpdateLoading,class:"main-color-btn",key:"submit",type:"primary",onClick:e.onUpdateClass},{default:n(()=>[p(d(m.$t("update_QS.buttons.update")),1)]),_:1},8,["loading"])]),default:n(()=>[t("div",Ze,[t("div",$e,[l(F,{class:"w-100 d-flex align-items-center"},{default:n(()=>[l(T,{span:4},{default:n(()=>[l(k,{onClick:a[4]||(a[4]=i=>e.modal_update_open=!1),to:{name:""}},{default:n(()=>a[22]||(a[22]=[t("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[22]})]),_:1}),l(T,{class:"main-title",span:20},{default:n(()=>[t("span",null,d(e.t("folder_detail.modal.create_title")),1)]),_:1})]),_:1})]),l(O,{ref:"updateClassFormRef",layout:"vertical",rules:e.rules,model:e.updateClassFormState},{default:n(()=>[l(r,null,{default:n(()=>[l(e.Input,{label:e.t("class_index.modal.create_class_name_label"),name:"name",modelValue:e.updateClassFormState.name,"onUpdate:modelValue":a[5]||(a[5]=i=>e.updateClassFormState.name=i),placeholder:e.t("class_index.modal.create_class_name_placeholder"),"is-required":!0,"max-length":100},null,8,["label","modelValue","placeholder"])]),_:1}),l(r,null,{default:n(()=>[l(e.Input,{label:e.t("class_index.modal.create_class_topic_label"),name:"topic",modelValue:e.updateClassFormState.topic,"onUpdate:modelValue":a[6]||(a[6]=i=>e.updateClassFormState.topic=i),placeholder:e.t("class_index.modal.create_class_topic_placeholder"),"max-length":100},null,8,["label","modelValue","placeholder"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open"]),z(" invitation modal "),l(I,{width:"750px",centered:"","wrap-class-name":"medium-modal",open:e.modal_invitation_open,onCancel:a[14]||(a[14]=i=>e.modal_invitation_open=!1)},{footer:n(()=>[l(O,{layout:"vertical",class:"w-100 d-flex align-items-end justify-content-between"},{default:n(()=>[l(r,{label:e.t("class_member.modal.time_limit_label")},{default:n(()=>[l(_,{value:e.invitationFormState.expiredTime,"onUpdate:value":a[13]||(a[13]=i=>e.invitationFormState.expiredTime=i),style:{width:"200px"},onChange:e.getData},{default:n(()=>[(u(!0),f(h,null,ae(e.code_limit_time,i=>(u(),D(U,{value:i.value},{default:n(()=>[p(d(i.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},8,["label"]),l(r,null,{default:n(()=>[l(w,{loading:e.isInvitaionLoading,class:"main-color-btn",key:"submit",type:"primary",onClick:e.onResetInvitation},{default:n(()=>[p(d(m.$t("class_member.buttons.reset_code")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),default:n(()=>[t("div",ea,[t("div",aa,[l(F,{class:"w-100 d-flex align-items-center"},{default:n(()=>[l(T,{span:2},{default:n(()=>[l(k,{onClick:a[8]||(a[8]=i=>e.modal_invitation_open=!1),to:{name:""}},{default:n(()=>a[23]||(a[23]=[t("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[23]})]),_:1}),l(T,{class:"main-title",span:22},{default:n(()=>[t("span",null,d(m.$t("class_member.modal.title")),1),a[24]||(a[24]=p()),a[25]||(a[25]=t("br",null,null,-1)),t("span",null,d(m.$t("class_member.modal.sub_title")),1)]),_:1,__:[24,25]})]),_:1})]),t("div",ta,[l(B,{value:e.invitationFormState.code,class:"invitation-body-qrcode"},null,8,["value"]),l(O,{layout:"vertical",class:"invitation-body-link"},{default:n(()=>[l(r,{label:e.t("class_member.modal.class_code_label")},{default:n(()=>[t("div",sa,[l(e.Input,{modelValue:e.invitationFormState.code,"onUpdate:modelValue":a[9]||(a[9]=i=>e.invitationFormState.code=i),"is-required":!0,"max-length":100,readonly:!0},null,8,["modelValue"]),t("i",{class:"bx bx-copy",onClick:a[10]||(a[10]=i=>e.onCopyInvitationCode("code"))})])]),_:1},8,["label"]),l(r,{label:e.t("class_member.modal.invitation_link")},{default:n(()=>[t("div",na,[l(e.Input,{modelValue:e.inivitationLink,"onUpdate:modelValue":a[11]||(a[11]=i=>e.inivitationLink=i),"is-required":!0,"max-length":100,readonly:!0},null,8,["modelValue"]),t("i",{class:"bx bx-copy",onClick:a[12]||(a[12]=i=>e.onCopyInvitationCode("link"))})])]),_:1},8,["label"])]),_:1})]),l(q,null,{default:n(()=>[p(d(m.$t("class_member.modal.or")),1)]),_:1})])]),_:1},8,["open"])],64)}const _a=ve(ke,[["render",la],["__scopeId","data-v-6a35c450"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/class/student.vue"]]);export{_a as default};

import{d as ae,u as oe,l as ie,q as se,i as f,j as le,X as re,Y as de,s as ue,k as Q,Q as z,M as D,_ as ce,r as T,a as M,o as b,b as a,c as u,w as _,f as U,t as p,F as N,D as me,E as L,N as pe}from"./index-Cmj4Sauw.js";import{A as O}from"./ApiQuestionSet-Bv36wec6.js";import{Q as k}from"./questionTypes-CS3lcRlq.js";import{T as ge}from"./TransferQuestionData-BxcXdBjq.js";import{V as fe}from"./Validator-CWeiTIFe.js";import{I as _e}from"./Input-7s2qH2uT.js";import{T as he}from"./TextArea-DbJ_O2S7.js";import{C as w,S as ve,O as Qe,M as be,a as Se,s as qe,b as Ie}from"./vue-virtual-scroller.esm-B8ippSNn.js";import{G as Te,I as Ue}from"./GenerateQSModal-CTpigl25.js";/* empty css                                                                 */import"./vue-draggable-plus-CBTODRnj.js";import"./ApiTestTemplate-7SUP0tzq.js";import"./languages-DtYW231W.js";const ye=ae({__name:"update",setup(m,{expose:i}){i();const{t:l}=oe(),e=ie(),R=se(),y=f(!1),h=f(R.params.id),v=f({id:"",name:"",description:"",tags:[]}),q=f([]),g=f(!0),x=async()=>{if(y.value=!0,!fe.isValidGuid(h.value)){g.value=!1,e.push({name:"404"});return}let t=await O.GetDetailById(h.value),o=await O.GetQuestionById(h.value);if(!t.data.success||!o.data.success){g.value=!1,e.push({name:"404"});return}v.value=t.data.data,q.value=o.data.data,n.name=v.value.name,n.description=v.value.description,n.createUpdateQuestions=q.value.map(c=>ge.transformResponseToRequest(c)),n.tags=v.value.tags.map(c=>c.name),y.value=!1,window.addEventListener("beforeunload",V)},d=f(),n=le({name:"",description:"",createUpdateQuestions:[],deleteQuestionIds:[],tags:[]}),S={title:[{required:"true",message:"This field is required",trigger:"change"},{length:100,message:"Limit 100",trigger:"change"}],description:[{length:200,message:"Limit 200",trigger:"change"}],tags:[{validator:(t,o)=>o&&o.length>5?Promise.reject("You can only add up to 5 tags."):Promise.resolve(),trigger:"change"}],questions:[{validator:(t,o)=>o&&o.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},H={MultipleChoice:Se,Matching:be,Ordering:Qe,ShortText:ve},E=()=>({id:Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:w.defaultMultipleChoices(),matchingPairs:w.defaultMatchingPairs(),orderingItems:w.defaultOrderingItems(),shortAnswer:""}),j=t=>{w.onChangeQuestionType(t)},Y=()=>{if(n.createUpdateQuestions.length>=500){Q.warning(l("maximum_tag.limit_question",{number:500}));return}n.createUpdateQuestions=[...n.createUpdateQuestions,E()],z(()=>{var t,o;(o=(t=C.value)==null?void 0:t.forceUpdate)==null||o.call(t),z(()=>{const c=n.createUpdateQuestions.length;requestAnimationFrame(()=>{var A;(A=C.value)==null||A.scrollToItem(c)})})})},W=t=>{if(n.createUpdateQuestions.length<=1){Q.warning(l("maximum_tag.minimum_question",{number:1}));return}const o=n.createUpdateQuestions[t].id;!o.startsWith("new_")&&o&&n.deleteQuestionIds.push(o),n.createUpdateQuestions=[...n.createUpdateQuestions.slice(0,t),...n.createUpdateQuestions.slice(t+1)]},X=()=>{let t=!1,o=l("message.invalid_question"),c=new Set;if(n.name.trim().length>100||n.name.trim().length===0){t=!0,o=l("message.invalid_title"),Q.error(o);return}if(n.description.trim().length>250){t=!0,o=l("message.invalid_description"),Q.error(o);return}[n.createUpdateQuestions.filter(s=>{const r=s.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return r.length===0||r.length>=500}),n.createUpdateQuestions.filter(s=>(s.explainText?s.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),n.createUpdateQuestions.filter(s=>s.type===k.MULTIPLE_CHOICE&&(s.multipleChoices.some(r=>r.text.trim().length===0||r.text.trim().length>500)||s.multipleChoices.filter(r=>r.isAnswer).length===0)),n.createUpdateQuestions.filter(s=>s.type===k.MATCHING&&(s.matchingPairs.some(r=>r.leftItem.trim().length===0||r.leftItem.trim().length>500)||s.matchingPairs.some(r=>r.rightItem.trim().length===0||r.rightItem.trim().length>500))),n.createUpdateQuestions.filter(s=>s.type===k.ORDERING&&s.orderingItems.some(r=>r.text.trim().length===0||r.text.trim().length>500)),n.createUpdateQuestions.filter(s=>s.type===k.SHORT_TEXT&&(s.shortAnswer.trim().length===0||s.shortAnswer.trim().length>500))].forEach(s=>{s.length>0&&(t=!0,s.forEach(r=>c.add(r)))});let ne=Array.from(c).map(s=>n.createUpdateQuestions.indexOf(s)+1);t?D.error({title:l("create_QS.modal.invalid.title"),content:l("create_QS.modal.invalid.content")+ne.sort().join(", "),okText:l("sidebar.buttons.ok"),cancelText:l("sidebar.buttons.cancel")}):G()},G=()=>{D.confirm({title:l("update_QS.modal.valid.title"),content:l("create_QS.modal.valid.content"),okText:l("sidebar.buttons.ok"),cancelText:l("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{let t=await O.Update(h.value,{...n,createUpdateQuestions:n.createUpdateQuestions.map(o=>({...o,questionId:o.id.startsWith("new_")?null:o.id}))});t.data.success&&(Q.success(l("message.updated_successfully")),g.value=!1,e.push({name:"User_QuestionSet_Detail",params:{id:t.data.data}}))}})},I=f(""),J=()=>{if(n.tags.length>=5){Q.warning("Limit : 5 tags");return}I.value&&I.value.trim().length<=50?(n.tags.push(I.value),I.value=""):Q.warning("Invalid tag content")},K=t=>{n.tags.splice(t,1)},P=f(null),Z=()=>{var t;(t=P.value)==null||t.openImportModal()},B=f(null),$=()=>{var t;(t=B.value)==null||t.openGenerateAIModal()},ee=t=>{n.createUpdateQuestions.unshift(...t.map((o,c)=>({...o,id:`new_${n.createUpdateQuestions.length+c}`}))),Q.success(`Imported ${t.length} questions`)};function V(t){t.preventDefault(),t.returnValue=""}re((t,o,c)=>{if(!g.value){c();return}D.confirm({title:l("create_QS.modal.leave.title"),content:l("create_QS.modal.leave.content"),okText:l("sidebar.buttons.ok"),cancelText:l("sidebar.buttons.cancel"),onOk:()=>{c()},onCancel:()=>c(!1)})}),de(()=>{window.removeEventListener("beforeunload",V)});const C=f(null),te=()=>{z(()=>{var t,o;(o=(t=C.value)==null?void 0:t.forceUpdate)==null||o.call(t)})};ue(async()=>{await x()});const F={t:l,router:e,route:R,loading:y,questionSetId:h,questionSetDetail:v,questionSetQuestions:q,isDataValid:g,getTestTemplate:x,formRef:d,formState:n,rules:S,componentMap:H,createQuestionTemplate:E,onHandleChangeQuestionType:j,onAddQuestion:Y,onRemoveQuestion:W,onFinish:X,showModalConfirmation:G,tagContent:I,addTag:J,removeTag:K,importModalRef:P,onOpenImportModal:Z,generateModalRef:B,openGenerateAIModal:$,onModalImport:ee,handleBeforeUnload:V,scrollerRef:C,handleScroll:te,Input:_e,TextArea:he,ImportQSModal:Ue,GenerateQSModal:Te,get DynamicScroller(){return Ie},get DynamicScrollerItem(){return qe}};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}}),xe={class:"page-container"},Ce={class:"title-container"},Me={class:"content"},ke={class:"content-item"},we={class:"content-item-title"},Re={class:"d-flex"},Ve={class:"form-item"},Ae={class:"tag-container"},ze=["onClick"],De={class:"tag-inputter"},Le={class:"content-item"},Oe={class:"content-item-title"},Ee={class:"content-item-buttons"},Ge={class:"import-button"},Pe={key:0};function Be(m,i,l,e,R,y){const h=T("RouterLink"),v=T("a-col"),q=T("a-row"),g=T("a-skeleton"),x=T("a-form");return b(),M(N,null,[a("div",xe,[a("div",Ce,[u(q,{class:"w-100 d-flex align-items-center"},{default:_(()=>[u(v,{span:1},{default:_(()=>[u(h,{to:{name:"User_Library"}},{default:_(()=>i[4]||(i[4]=[a("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[4]})]),_:1}),u(v,{class:"main-title",span:23},{default:_(()=>[a("span",null,p(m.$t("create_QS.title")),1),i[5]||(i[5]=U()),i[6]||(i[6]=a("br",null,null,-1)),a("span",null,p(m.$t("create_QS.sub_title")),1)]),_:1,__:[5,6]})]),_:1})]),a("div",Me,[u(x,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":i[3]||(i[3]=d=>e.formState=d),rules:e.rules,ref:"formRef"},{default:_(()=>[a("div",ke,[a("div",we,[a("div",null,[a("span",null,p(m.$t("create_QS.quiz.question_detail_title")),1),a("span",null,p(m.$t("create_QS.quiz.question_detail_sub_title")),1)])]),u(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":i[0]||(i[0]=d=>e.formState.name=d),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),a("div",Re,[u(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":i[1]||(i[1]=d=>e.formState.description=d),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"]),a("div",Ve,[a("label",null,p(m.$t("create_QS.quiz.tag")),1),a("div",Ae,[(b(!0),M(N,null,me(e.formState.tags,(d,n)=>(b(),M("div",{class:"tag-item",key:n},[U(p(d)+" ",1),a("i",{class:"bx bx-x",onClick:S=>e.removeTag(n)},null,8,ze)]))),128))]),a("div",De,[u(e.Input,{modelValue:e.tagContent,"onUpdate:modelValue":i[2]||(i[2]=d=>e.tagContent=d),placeholder:e.t("question_sets_index.search_placeholder"),"max-length":50},{icon:_(()=>i[7]||(i[7]=[a("i",{class:"bx bx-purchase-tag-alt"},null,-1)])),_:1},8,["modelValue","placeholder"]),a("i",{class:"bx bx-plus tag-inputter-button",onClick:e.addTag})])])])]),a("div",Le,[a("div",Oe,[a("div",null,[a("span",null,p(m.$t("create_QS.quiz.question_question_title")),1),a("span",null,p(m.$t("create_QS.quiz.question_question_sub_title")),1)]),a("div",Ee,[u(h,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:_(()=>[U(p(m.$t("create_QS.buttons.import"))+" ",1),i[8]||(i[8]=a("i",{class:"bx bx-download"},null,-1))]),_:1,__:[8]}),u(h,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:_(()=>[U(p(m.$t("create_QS.buttons.generated_by_ai"))+" ",1),i[9]||(i[9]=a("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[9]}),a("div",{class:"import-button",onClick:e.onFinish},p(m.$t("update_QS.buttons.update")),1),a("div",Ge,p(m.$t("create_QS.quiz.total",{number:e.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1)])]),e.loading?(b(),M("div",Pe,[u(g,{loading:e.loading,active:""},null,8,["loading"]),u(g,{loading:e.loading,active:""},null,8,["loading"]),u(g,{loading:e.loading,active:""},null,8,["loading"]),u(g,{loading:e.loading,active:""},null,8,["loading"]),u(g,{loading:e.loading,active:""},null,8,["loading"])])):(b(),L(e.DynamicScroller,{key:1,ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.createUpdateQuestions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:_(({item:d,index:n})=>[(b(),L(e.DynamicScrollerItem,{item:d,key:d.id},{default:_(()=>[(b(),L(pe(e.componentMap[d.type]),{question:d,index:e.formState.createUpdateQuestions.findIndex(S=>S.id===d.id)+1,displayScore:!1,onDeleteQuestion:S=>e.onRemoveQuestion(n),onChangeQuestionType:S=>e.onHandleChangeQuestionType(d)},null,40,["question","index","onDeleteQuestion","onChangeQuestionType"]))]),_:2},1032,["item"]))]),_:1},8,["items"])),a("div",{class:"add-question-btn",onClick:e.onAddQuestion},[i[10]||(i[10]=a("i",{class:"bx bx-plus"},null,-1)),U(" "+p(m.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),u(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,"number-of-question":e.formState.createUpdateQuestions.length,onImport:e.onModalImport},null,8,["title","number-of-question"]),u(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport,"number-of-question":e.formState.createUpdateQuestions.length},null,8,["title","number-of-question"])],64)}const nt=ce(ye,[["render",Be],["__scopeId","data-v-ef9cef6a"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/question_sets/update.vue"]]);export{nt as default};

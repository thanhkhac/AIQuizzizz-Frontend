import{d as $,q as ee,l as te,u as ae,C as j,i as C,j as G,P as ne,s as se,k as b,M as L,v as oe,_ as le,r as _,a as S,o as g,b as t,e as A,c as l,w as i,f as v,t as r,F as O,E as Q,G as H}from"./index-C2jtDg6B.js";import{A as k}from"./ApiClass-UU0KI_4U.js";import{I as ie}from"./Input-0Otcuoto.js";const re={FULL_NAME:"FullName",EMAIL:"Email"},de={TEACHER:"Teacher",STUDENT:"Student"},ce=$({__name:"student",emits:["updateSidebar"],setup(d,{expose:n,emit:F}){var B;n();const e=ee(),y=te(),{t:h}=ae(),p=F,w=Object.values(re),N=j(()=>w.map(a=>({label:h(`class_member.select_option.${a}`),value:a}))),u=C(e.params.id||""),z=C({classId:"",name:"",topic:""}),E=[{title:"No",key:"no",customRender:a=>a.index+1},{title:"FullName",dataIndex:"fullName",key:"fullName",sorter:(a,c)=>a.fullName.localeCompare(c.fullName)},{title:"Email",dataIndex:"email",key:"email",sorter:(a,c)=>a.email.localeCompare(c.email)},{title:"Position",dataIndex:"position",key:"position"},{key:"action"}],x=[1,3,5,7,30],D=j(()=>x.map(a=>({label:a+h(a===1?"class_member.other.day_singular":"class_member.other.day_plural"),value:a}))),U=async()=>{try{u.value||y.push({name:"404"});let a=await k.GetById(u.value.toString());a.data.success||y.push({name:"404"}),z.value=a.data.data}catch(a){console.log("ERROR: GETBYID class: "+a)}},s=G({pageNumber:e.query.pageNumber||1,pageSize:e.query.pageSize||10,keyword:((B=e.query.keyword)==null?void 0:B.toString())||"",fieldName:e.query.fieldName||N.value[0].value,totalCount:0,statusFilter:!1}),T=C([]),f=async()=>{try{let a=await k.GetAllStudentByLimit(u.value.toString(),s);if(a.data.success){let c=a.data.data;T.value=c.items,s.pageNumber=c.pageNumber,s.pageSize=c.pageSize,s.totalCount=c.totalCount,s.statusFilter&&(s.pageNumber>c.totalPages&&s.totalCount>0?(s.pageNumber=1,y.push({name:"User_Class_Student",params:{id:u.value},query:{pageNumber:1,pageSize:s.pageSize,keyword:s.keyword,fieldName:s.fieldName}})):y.push({name:"User_Class_Student",params:{id:u.value},query:{pageNumber:s.pageNumber,pageSize:s.pageSize,keyword:s.keyword,fieldName:s.fieldName}}),s.statusFilter=!s.statusFilter)}}catch(a){console.log("ERROR: GETALLEXAMBYLIMIT class exam: "+a)}};ne(()=>{var a;Object.keys(e.query).length===0&&(s.pageNumber=e.query.pageNumber||1,s.pageSize=e.query.pageSize||10,s.keyword=((a=e.query.keyword)==null?void 0:a.toString())||"",s.fieldName=e.query.fieldName||N.value[0].value,s.statusFilter=!0,f())});const P=(a,c)=>{s.pageNumber=a,s.pageSize=c,s.statusFilter=!0,f()},o=C(!1),m=G({classId:u.value,code:"",expiredTime:D.value[0].value}),I=C(window.location.origin+`/user/class/invitation/${m.code}`),q=C(!0),Y=C(!1),R=async()=>{await M(),o.value=!0},M=async()=>{debugger;const a=await k.GetInivationCode(u.value.toString());a.data.success&&(m.code=a.data.data,I.value=window.location.origin+`/user/class/invitation/${m.code}`)},K=async()=>{(await k.CreateNewInvitation(m)).data.success&&(b.success("Created new inivation code!"),R())},X=a=>{if(!q.value)return;let c=m.code;a==="link"&&(c=I.value),navigator.clipboard.writeText(c).then(()=>{b.success("Copied!")}).catch(()=>{b.error("Copy failed!")})},J=a=>{L.confirm({title:"Are you sure to remove this user from class?",content:"This action is inreversible, every related data will be erased forever. Careful!",centered:!0,okText:"Confirm",onOk:async()=>{if(!(await k.DeleteClassMember(u.value.toString(),a.toString())).data.success){b.success("Remove failed.");return}b.success("Remove successfully."),await f()}})},W=(a,c)=>{L.confirm({title:"Are you sure to update this user position from class?",content:"Please make sure to double check the important information!.",centered:!0,okText:"Confirm",onOk:async()=>{if(!(await k.UpdateClassMemberPosition(u.value.toString(),a.toString(),c)).data.success){b.success("Update failed.");return}b.success("Update successfully."),await f()}})},Z=()=>{L.confirm({title:"Are you sure to delete this class?",content:oe("div",{style:"color: red"},"This action is inreversible, every related data will be erased forever. Careful!"),centered:!0,okText:"Confirm",onOk:async()=>{if(!(await k.Delete(u.value.toString())).data.success){b.success("Delete class failed.");return}b.success("Delete class successfully."),y.push({name:"User_Class"})}})};se(async()=>{p("updateSidebar","class"),await U(),await f()});const V={route:e,router:y,t:h,emit:p,optionKeys:w,class_position_options:N,classId:u,classData:z,columns:E,optionDays:x,code_limit_time:D,getClassData:U,pageParams:s,student_data:T,getData:f,onPaginationChange:P,modal_invitation_open:o,invitationFormState:m,inivitationLink:I,allowCopy:q,isInvitaionLoading:Y,onOpenInvitationModal:R,getInvitationCode:M,onResetInvitation:K,onCopyInvitationCode:X,onConfirmDeleteMember:J,onConfirmUpdateMemberPosition:W,onOpenConfirmDeleteClass:Z,Input:ie,get CLASS_STUDENT_POSITION(){return de}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),me={class:"page-container"},ue={class:"title-container"},_e={class:"breadcrumb-container"},ve={class:"title-breadcrumb-item"},pe={class:"title-breadcrumb-item"},be={class:"breadcrumb-item-topic"},ge={class:"content"},fe={class:"content-item"},ye={class:"content-item-title"},Ce={class:"content-item-functions"},Se={class:"content-item-navigators"},ke={class:"navigator-container"},we={style:{width:"300px",padding:"0px"}},Ne={key:0,class:"student-name-container"},Ie=["src"],he={class:"student-name"},xe={key:1,class:"student-action"},Te=["onClick"],ze=["onClick"],De=["onClick"],Ue={class:"pagination-container"},Ee={class:"mt-4 content-item"},Pe={class:"content-item-title"},Le={class:"text-danger"},Ae={class:"danger-zone mt-3 p-4"},Oe={class:"text-danger fs-6 fw-bold"},Fe={class:"text-secondary"},qe={class:"modal-container"},Re={class:"modal-title-container"},Me={class:"modal-invitation-body"},Ve={class:"invitation-code-container"},Be={class:"invitation-code-container"};function je(d,n,F,e,y,h){const p=_("RouterLink"),w=_("a-button"),N=_("a-select-option"),u=_("a-select"),z=_("a-table"),E=_("a-pagination"),x=_("a-col"),D=_("a-row"),U=_("a-qrcode"),s=_("a-form-item"),T=_("a-form"),f=_("a-divider"),P=_("a-modal");return g(),S(O,null,[t("div",me,[t("div",ue,[t("div",_e,[t("ul",null,[t("li",ve,[l(p,{to:{name:"User_Class"}},{default:i(()=>[t("span",null,r(d.$t("class_index.title")),1),n[10]||(n[10]=v()),n[11]||(n[11]=t("br",null,null,-1))]),_:1,__:[10,11]}),n[12]||(n[12]=t("i",{class:"bx bx-chevron-right"},null,-1))]),t("li",pe,[l(p,{to:{name:""},class:"breadcrumb-item-class"},{default:i(()=>[t("span",null,r(e.classData.name),1),t("span",be,r(e.classData.topic),1)]),_:1})])])])]),t("div",ge,[t("div",fe,[t("div",ye,[t("div",null,[t("span",null,r(d.$t("class_member.title")),1),t("span",null,r(d.$t("class_member.sub_title")),1)]),l(w,{class:"main-color-btn",type:"primary",size:"large",onClick:e.onOpenInvitationModal},{default:i(()=>[n[13]||(n[13]=t("i",{class:"me-2 bx bx-user-plus"},null,-1)),v(" "+r(d.$t("class_member.buttons.invite_member")),1)]),_:1,__:[13]})]),t("div",Ce,[t("div",Se,[t("div",ke,[l(p,{class:"navigator-item",to:{name:"User_Class_Exam"}},{default:i(()=>[v(r(d.$t("class_index.navigators.exam")),1)]),_:1}),l(p,{class:"navigator-item",to:{name:"User_Class_Quiz"}},{default:i(()=>[v(r(d.$t("class_index.navigators.quiz")),1)]),_:1}),l(p,{class:"navigator-item navigator-active",to:{name:""}},{default:i(()=>[v(r(d.$t("class_index.navigators.member")),1)]),_:1})])]),l(u,{value:e.pageParams.fieldName,"onUpdate:value":n[0]||(n[0]=o=>e.pageParams.fieldName=o),style:{width:"200px"},onChange:e.getData},{default:i(()=>[(g(!0),S(O,null,Q(e.class_position_options,o=>(g(),H(N,{value:o.value},{default:i(()=>[v(r(o.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"]),t("div",we,[l(e.Input,{onInput:e.getData,modelValue:e.pageParams.keyword,"onUpdate:modelValue":n[1]||(n[1]=o=>e.pageParams.keyword=o),placeholder:e.t("class_member.other.search_placeholder")},{icon:i(()=>n[14]||(n[14]=[t("i",{class:"bx bx-search"},null,-1)])),_:1},8,["modelValue","placeholder"])])]),l(z,{columns:e.columns,"data-source":e.student_data,"row-key":"studentId",pagination:!1},{bodyCell:i(({column:o,record:m})=>[o.key==="fullName"?(g(),S("div",Ne,[t("img",{class:"student-image",src:m.image,alt:""},null,8,Ie),t("div",he,r(m.fullName),1)])):A("v-if",!0),o.key==="action"?(g(),S("div",xe,[m.position===e.CLASS_STUDENT_POSITION.STUDENT?(g(),S("i",{key:0,style:{cursor:"pointer"},class:"bx bxs-id-card",onClick:I=>e.onConfirmUpdateMemberPosition(m.studentId,e.CLASS_STUDENT_POSITION.TEACHER)},null,8,Te)):(g(),S("i",{key:1,class:"text-danger bx bxs-id-card",onClick:I=>e.onConfirmUpdateMemberPosition(m.studentId,e.CLASS_STUDENT_POSITION.STUDENT)},null,8,ze)),t("i",{class:"text-danger bx bx-trash-alt",onClick:I=>e.onConfirmDeleteMember(m.studentId)},null,8,De)])):A("v-if",!0)]),_:1},8,["data-source"]),t("div",Ue,[l(E,{onChange:e.onPaginationChange,current:e.pageParams.pageNumber,"onUpdate:current":n[2]||(n[2]=o=>e.pageParams.pageNumber=o),total:e.pageParams.totalCount,pageSize:e.pageParams.pageSize,"show-total":(o,m)=>`${m[0]}-${m[1]} of ${o} ${e.t("class_member.other.items")}`,"show-size-changer":"","show-quick-jumper":"",class:"crud-layout-pagination",locale:{items_per_page:e.t("class_index.other.pages")}},null,8,["current","total","pageSize","show-total","locale"])])]),t("div",Ee,[t("div",Pe,[t("div",null,[t("span",Le,r(d.$t("class_member.danger_zone.title")),1),t("span",null,r(d.$t("class_member.danger_zone.sub_title")),1)])]),t("div",Ae,[t("div",Oe,r(d.$t("class_member.danger_zone.warning")),1),t("div",Fe,r(d.$t("class_member.danger_zone.warning_explain")),1),l(w,{class:"mt-3",type:"primary",danger:"",size:"large",onClick:e.onOpenConfirmDeleteClass},{default:i(()=>[v(r(d.$t("class_member.buttons.delete_class")),1)]),_:1})])])])]),A(" invitation modal "),l(P,{width:"750px",centered:"","wrap-class-name":"medium-modal",open:e.modal_invitation_open,onCancel:n[9]||(n[9]=o=>e.modal_invitation_open=!1)},{footer:i(()=>[l(T,{layout:"vertical",class:"w-100 d-flex align-items-end justify-content-between"},{default:i(()=>[l(s,{label:e.t("class_member.modal.time_limit_label")},{default:i(()=>[l(u,{value:e.invitationFormState.expiredTime,"onUpdate:value":n[8]||(n[8]=o=>e.invitationFormState.expiredTime=o),style:{width:"200px"},onChange:e.getData},{default:i(()=>[(g(!0),S(O,null,Q(e.code_limit_time,o=>(g(),H(N,{value:o.value},{default:i(()=>[v(r(o.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},8,["label"]),l(s,null,{default:i(()=>[l(w,{loading:e.isInvitaionLoading,class:"main-color-btn",key:"submit",type:"primary",onClick:e.onResetInvitation},{default:i(()=>[v(r(d.$t("class_member.buttons.reset_code")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),default:i(()=>[t("div",qe,[t("div",Re,[l(D,{class:"w-100 d-flex align-items-center"},{default:i(()=>[l(x,{span:2},{default:i(()=>[l(p,{onClick:n[3]||(n[3]=o=>e.modal_invitation_open=!1),to:{name:""}},{default:i(()=>n[15]||(n[15]=[t("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[15]})]),_:1}),l(x,{class:"main-title",span:22},{default:i(()=>[t("span",null,r(d.$t("class_member.modal.title")),1),n[16]||(n[16]=v()),n[17]||(n[17]=t("br",null,null,-1)),t("span",null,r(d.$t("class_member.modal.sub_title")),1)]),_:1,__:[16,17]})]),_:1})]),t("div",Me,[l(U,{value:e.invitationFormState.code,class:"invitation-body-qrcode"},null,8,["value"]),l(T,{layout:"vertical",class:"invitation-body-link"},{default:i(()=>[l(s,{label:e.t("class_member.modal.class_code_label")},{default:i(()=>[t("div",Ve,[l(e.Input,{modelValue:e.invitationFormState.code,"onUpdate:modelValue":n[4]||(n[4]=o=>e.invitationFormState.code=o),"is-required":!0,"max-length":100,readonly:!0},null,8,["modelValue"]),t("i",{class:"bx bx-copy",onClick:n[5]||(n[5]=o=>e.onCopyInvitationCode("code"))})])]),_:1},8,["label"]),l(s,{label:e.t("class_member.modal.invitation_link")},{default:i(()=>[t("div",Be,[l(e.Input,{modelValue:e.inivitationLink,"onUpdate:modelValue":n[6]||(n[6]=o=>e.inivitationLink=o),"is-required":!0,"max-length":100,readonly:!0},null,8,["modelValue"]),t("i",{class:"bx bx-copy",onClick:n[7]||(n[7]=o=>e.onCopyInvitationCode("link"))})])]),_:1},8,["label"])]),_:1})]),l(f,null,{default:i(()=>[v(r(d.$t("class_member.modal.or")),1)]),_:1})])]),_:1},8,["open"])],64)}const Ke=le(ce,[["render",je],["__scopeId","data-v-6a35c450"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/class/student.vue"]]);export{Ke as default};

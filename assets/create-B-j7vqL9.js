import{d as de,u as me,q as ue,l as fe,i as d,j as pe,a2 as Te,a3 as ge,s as he,k as C,G as g,M as L,_ as _e,r as I,a as ve,o as U,b as l,c,w as f,t as h,f as G,E as Z,R as Me,F as Se}from"./index-DpsX2GFI.js";import{A as qe}from"./ApiClass-DFvxDeMB.js";import{A as be}from"./ApiTest-DjFXgMvd.js";import{Q as A}from"./questionTypes-CS3lcRlq.js";import{T as Ce,a as Ie}from"./testGradeQuestionMethod-B_BacNS6.js";import{C as O,S as we,O as ye,M as Re,a as Qe,s as ke,b as Fe}from"./vue-virtual-scroller.esm-CZcvDkXC.js";import{C as Ae,a as Oe,b as xe,c as Ee,S as De}from"./ChooseQuestionModal-B0oBhT4v.js";import{T as Be}from"./TransferQuestionData-BxcXdBjq.js";import{V as Pe}from"./Validator-CWeiTIFe.js";import"./vue-draggable-plus-VN-_ajwE.js";/* empty css                                                                 */import"./Input-izxMw_Rl.js";import"./utc-tFrh5C7_.js";import"./ApiFolder-DMq8aexG.js";import"./folderShareMode-BudLQ2R2.js";import"./ApiTestTemplate-B5r-nb3j.js";const ze=de({__name:"create",setup(u,{expose:p}){p();const V={MultipleChoice:Qe,Matching:Re,Ordering:ye,ShortText:we},{t:e}=me(),x=ue(),M=fe(),T=d(!0),S=d(),w=async()=>{if(!Pe.isValidGuid(o.classId)){T.value=!1,M.push({name:"404"});return}const t=await qe.GetById(o.classId);if(!t.data.success){T.value=!1,M.push({name:"404"});return}S.value=t.data.data},y=d(),o=pe({name:"",classId:x.params.id.toString()||"",timeLimit:60,startTime:"",endTime:"",gradeAttemptMethod:Ie.HIGHEST_SCORE,gradeQuestionMethod:Ce.PARTIAL,isShowCorrectAnswerInReview:!0,isAllowReviewAfterSubmit:!0,numberOfShuffles:2,maxAttempt:2,passingScore:50,questions:[]}),R={title:[{required:"true",message:e("message.required"),trigger:"change"},{length:100,message:e("message.limit",{limit:100}),trigger:"change"}],description:[{length:200,message:e("message.limit",{limit:200}),trigger:"change"}],tags:[{validator:(t,s)=>s&&s.length>5?Promise.reject(e("message.maximum_tag.out_of_range",{tag:5})):Promise.resolve(),trigger:"change"}],questions:[{validator:(t,s)=>s&&s.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},i=()=>({id:Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:O.defaultMultipleChoices(),matchingPairs:O.defaultMatchingPairs(),orderingItems:O.defaultOrderingItems(),shortAnswer:""}),E=t=>{O.onChangeQuestionType(t)},q=()=>{if(o.questions.length>=100){C.warning(e("message.limit_question",{number:100}));return}o.questions=[...o.questions,i()],g(()=>{var t,s;(s=(t=v.value)==null?void 0:t.forceUpdate)==null||s.call(t),g(()=>{const r=o.questions.length;requestAnimationFrame(()=>{var m;(m=v.value)==null||m.scrollToItem(r)})})})},$=t=>{if(o.questions.length<=1){C.warning(e("message.minimum_question",{number:1}));return}o.questions=[...o.questions.slice(0,t),...o.questions.slice(t+1)]},ee=async()=>{var F;await((F=y.value)==null?void 0:F.validate());let t=!1,s=e("message.invalid_question"),r=new Set;if(o.name.trim().length>100||o.name.trim().length===0){t=!0,s=e("message.invalid_title"),C.error(s),D();return}[o.questions.filter(n=>{const a=n.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return a.length===0||a.length>=500}),o.questions.filter(n=>(n.explainText?n.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),o.questions.filter(n=>n.type===A.MULTIPLE_CHOICE&&(n.multipleChoices.some(a=>a.text.trim().length===0||a.text.trim().length>500)||n.multipleChoices.filter(a=>a.isAnswer).length===0)),o.questions.filter(n=>n.type===A.MATCHING&&(n.matchingPairs.some(a=>a.leftItem.trim().length===0||a.leftItem.trim().length>500)||n.matchingPairs.some(a=>a.rightItem.trim().length===0||a.rightItem.trim().length>500))),o.questions.filter(n=>n.type===A.ORDERING&&n.orderingItems.some(a=>a.text.trim().length===0||a.text.trim().length>500)),o.questions.filter(n=>n.type===A.SHORT_TEXT&&(n.shortAnswer.trim().length===0||n.shortAnswer.trim().length>500))].forEach(n=>{n.length>0&&(t=!0,n.forEach(a=>r.add(a)))});let k=Array.from(r).map(n=>o.questions.indexOf(n)+1);t?L.error({title:e("create_QS.modal.invalid.title"),content:e("create_QS.modal.invalid.content")+k.sort().join(", "),okText:e("sidebar.buttons.ok"),cancelText:e("sidebar.buttons.cancel")}):N()},N=()=>{L.confirm({title:e("create_QS.modal.valid.title"),content:e("create_QS.modal.valid.content"),okText:e("sidebar.buttons.ok"),cancelText:e("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{(await be.Create(o)).data.success&&(T.value=!1,C.success(e("message.created_successfully")),M.push({name:"User_Class_Exam",params:{id:o.classId}}))}})},j=d(null),D=()=>{var t;(t=j.value)==null||t.openTestSettingModal()},b=d(null),B=()=>{var t;(t=b.value)==null||t.openModal()},te=async()=>{var t;_.value=null,(t=b.value)==null||t.closeModal(),z()},oe=async t=>{var s;_.value=t,await g(),(s=b.value)==null||s.closeModal(),P()},_=d(null),Y=d(""),X=d(null),P=()=>{var t;(t=X.value)==null||t.openModal()},ne=()=>{_.value=null,B()},Q=d(null),z=()=>{var t;(t=Q.value)==null||t.openModal()},se=()=>{var t;_.value=null,(t=Q.value)==null||t.closeModal(),B()},ae=async(t,s)=>{var r;Y.value=t,(r=Q.value)==null||r.closeModal(),_.value=s,await g(),K()},J=d(null),K=()=>{var t;(t=J.value)==null||t.openModal()},le=async t=>{_.value=t,await g(),P()},re=()=>{z()},ie=t=>{var r;const s=t.map(m=>Be.transformResponseToRequest(m));(r=b.value)==null||r.closeModal(),o.questions=[...o.questions,...s],g(()=>{var m,k;(k=(m=v.value)==null?void 0:m.forceUpdate)==null||k.call(m),g(()=>{const F=o.questions.length;requestAnimationFrame(()=>{var n;(n=v.value)==null||n.scrollToItem(F)})})}),C.success(`${e("message.imported_question",{number:t.length})}`)};Te((t,s,r)=>{if(!T.value){r();return}L.confirm({title:e("create_QS.modal.leave.title"),content:e("create_QS.modal.leave.content"),okText:e("sidebar.buttons.ok"),cancelText:e("sidebar.buttons.cancel"),onOk:()=>{r()},onCancel:()=>r(!1)})});function H(t){t.preventDefault(),t.returnValue=""}ge(()=>{window.removeEventListener("beforeunload",H)});const v=d(null),ce=()=>{g(()=>{var t,s;(s=(t=v.value)==null?void 0:t.forceUpdate)==null||s.call(t)})};he(()=>{w(),o.questions.push(i()),window.addEventListener("beforeunload",H),D()});const W={componentMap:V,t:e,route:x,router:M,isDataValid:T,classData:S,getClassData:w,formRef:y,formState:o,rules:R,createQuestionTemplate:i,onHandleChangeQuestionType:E,onAddQuestion:q,onRemoveQuestion:$,onFinish:ee,showModalConfirmation:N,settingModalRef:j,openSettingModal:D,folderModalRef:b,openFolderModal:B,onSwitchToTestTemplate:te,onOpenFolder:oe,chosenFolder:_,chosenTestTemplateId:Y,folderTestTemplateModalRef:X,openFolderTestTemplateModal:P,onBackToFolderModal:ne,testTemplateModalRef:Q,openTestTemplateModal:z,onSwitchToFolder:se,onOpenTestTemplate:ae,questionModalRef:J,openQuestionModal:K,onBackToFolderTestTemplate:le,onBackToTestTemplate:re,onModalImport:ie,handleBeforeUnload:H,scrollerRef:v,handleScroll:ce,SettingTestModal:De,ChooseFolderModal:Ee,ChooseFolderTestTemplateModal:xe,ChooseTestTemplateModal:Oe,ChooseQuestionModal:Ae,get DynamicScroller(){return Fe},get DynamicScrollerItem(){return ke}};return Object.defineProperty(W,"__isScriptSetup",{enumerable:!1,value:!0}),W}}),He={class:"page-container"},Le={class:"title-container"},Ue={class:"content"},Ge={class:"content-item"},Ve={class:"content-item-title"},Ne={class:"content-item-buttons"},je={class:"import-button"};function Ye(u,p,V,e,x,M){var R;const T=I("RouterLink"),S=I("a-col"),w=I("a-row"),y=I("a-button"),o=I("a-form");return U(),ve(Se,null,[l("div",He,[l("div",Le,[c(w,{class:"w-100 d-flex align-items-center"},{default:f(()=>[c(S,{span:1},{default:f(()=>[c(T,{to:{name:""},onClick:e.openSettingModal},{default:f(()=>p[0]||(p[0]=[l("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[0]})]),_:1}),c(S,{class:"main-title",span:23},{default:f(()=>{var i;return[l("span",null,h(u.$t("assign_test.title",{class_name:(i=e.classData)==null?void 0:i.name})),1),p[1]||(p[1]=l("br",null,null,-1)),l("span",null,h(u.$t("assign_test.sub_title")),1)]}),_:1,__:[1]})]),_:1})]),l("div",Ue,[c(o,{layout:"vertical",model:e.formState,rules:e.rules,ref:"formRef"},{default:f(()=>[l("div",Ge,[l("div",Ve,[l("div",null,[l("span",null,h(u.$t("assign_test.test_question.title")),1),l("span",null,h(u.$t("assign_test.test_question.sub_title")),1)]),l("div",Ne,[c(T,{class:"import-button",to:{name:""},onClick:e.openFolderModal},{default:f(()=>[G(h(u.$t("assign_test.buttons.choose_from_folder")),1)]),_:1}),l("div",je,h(u.$t("create_QS.quiz.total",{number:e.formState.questions.length.toString().padStart(3,"0")})),1),c(y,{type:"primary",class:"main-color-btn",size:"large",onClick:e.onFinish},{default:f(()=>[G(h(u.$t("assign_test.buttons.next")),1)]),_:1})])]),c(e.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.questions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:f(({item:i,index:E})=>[(U(),Z(e.DynamicScrollerItem,{item:i,key:i.id},{default:f(()=>[(U(),Z(Me(e.componentMap[i.type]),{question:i,index:e.formState.questions.findIndex(q=>q.id===i.id)+1,displayScore:!0,onDeleteQuestion:q=>e.onRemoveQuestion(E),onChangeQuestionType:q=>e.onHandleChangeQuestionType(i)},null,40,["question","index","onDeleteQuestion","onChangeQuestionType"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),l("div",{class:"add-question-btn",onClick:e.onAddQuestion},[p[2]||(p[2]=l("i",{class:"bx bx-plus"},null,-1)),G(" "+h(u.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["model"])])]),c(e.SettingTestModal,{ref:"settingModalRef","form-ref":e.formRef,"class-name":(R=e.classData)==null?void 0:R.name,"form-state":e.formState},null,8,["form-ref","class-name","form-state"]),c(e.ChooseFolderModal,{ref:"folderModalRef",onSwitchToTestTemplate:e.onSwitchToTestTemplate,onOpenFolder:e.onOpenFolder},null,512),c(e.ChooseFolderTestTemplateModal,{ref:"folderTestTemplateModalRef",folder:e.chosenFolder,onBackToFolderModal:e.onBackToFolderModal,onOpenTestTemplate:e.onOpenTestTemplate},null,8,["folder"]),c(e.ChooseTestTemplateModal,{ref:"testTemplateModalRef",onSwitchToFolder:e.onSwitchToFolder,onOpenTestTemplate:e.onOpenTestTemplate},null,512),c(e.ChooseQuestionModal,{ref:"questionModalRef","test-template-id":e.chosenTestTemplateId,folder:e.chosenFolder,onBackToFolderTestTemplateModal:e.onBackToFolderTestTemplate,onBackToTestTemplateModal:e.onBackToTestTemplate,onImport:e.onModalImport},null,8,["test-template-id","folder"])],64)}const dt=_e(ze,[["render",Ye],["__scopeId","data-v-501cc219"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test/create.vue"]]);export{dt as default};

import{d as le,u as ie,l as re,i as h,j as X,E as ue,a2 as ce,s as me,a3 as de,k as v,D as x,M as E,_ as ge,r as y,c as T,o as S,b as n,a as d,w as f,f as C,t as c,F as U,B as Y,e as J,p as _e,C as K,Q as fe}from"./index-CHQ5wIb3.js";import{A as pe}from"./ApiQuestionSet-CAmsUV8L.js";import{A as he}from"./ApiTag-cKXurwyI.js";import{I as ve}from"./Input-DIUsBtCl.js";import{T as be}from"./vue-draggable-plus-BWa1I-wc.js";import{C as A,S as Se,O as qe,M as Qe,a as Ie,s as Te,b as Ce}from"./vue-virtual-scroller.esm-zBm-Kjhm.js";import{G as xe,I as ye}from"./GenerateQSModal-DN8nG99O.js";import{Q as z}from"./questionTypes-CS3lcRlq.js";/* empty css                                                                 */import"./ApiTestTemplate-DLg4UTUc.js";import"./languages-DtYW231W.js";const ke=le({__name:"create",setup(g,{expose:i}){i();const{t:s}=ie(),e=re(),k=h(!0),L=h(),a=X({name:"",description:"",tags:[],questions:[]}),M={title:[{required:"true",message:s("message.required"),trigger:"change"},{length:100,message:s("message.out_of_range",{max_length:100}),trigger:"change"}],description:[{length:200,message:s("message.out_of_range",{max_length:200}),trigger:"change"}],tags:[{validator:(t,o)=>o&&o.length>5?Promise.reject(s("message.maximum_tag.out_of_range",{tag:5})):Promise.resolve(),trigger:"change"}],questions:[{validator:(t,o)=>o&&o.length>500?Promise.reject(s("message.maximum_tag.limit_question",{number:500})):Promise.resolve(),trigger:"change"}]},O={MultipleChoice:Ie,Matching:Qe,Ordering:qe,ShortText:Se},m=h(""),w=()=>{if(a.tags.length>=5){v.warning(s("message.maximum_tag",{tag:5}));return}if(a.tags.includes(m.value.trim())){v.warning(s("message.duplicate_tag"));return}m.value&&m.value.trim().length<=50?(a.tags.push(m.value),m.value=""):v.warning(s("message.invalid_tag_content"))},r=t=>{a.tags.splice(t,1)},q=t=>{m.value=t,w()},p=h([]),G=h(null),V=h([]);function B(t){var o;!R.name||!((o=G.value)!=null&&o.contains(t.target))?p.value=[]:p.value=[...V.value]}const R=X({name:m.value,pageSize:10});ue(()=>m.value,()=>{R.name=m.value,F()});const F=async()=>{if(m.value.trim().length>=50)return;const t=await he.GetAllByLimit(R);t.data.success&&(p.value=t.data.data,V.value=t.data.data,m.value.trim().length===0&&(p.value=[]))},D=()=>({id:"new_"+Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:A.defaultMultipleChoices(),matchingPairs:A.defaultMatchingPairs(),orderingItems:A.defaultOrderingItems(),shortAnswer:""}),Z=t=>{A.onChangeQuestionType(t)},$=async()=>{if(a.questions.length>=500){v.warning(s("message.limit_question",{number:500}));return}a.questions=[...a.questions,D()],x(()=>{var t,o;(o=(t=Q.value)==null?void 0:t.forceUpdate)==null||o.call(t),x(()=>{const _=a.questions.length;requestAnimationFrame(()=>{var b;(b=Q.value)==null||b.scrollToItem(_)})})})},ee=t=>{if(a.questions.length<=1){v.warning(s("message.minimum_question",{number:1}));return}a.questions=[...a.questions.slice(0,t),...a.questions.slice(t+1)]},te=()=>{let t=!1,o=s("message.invalid_question"),_=new Set;if(a.name.trim().length>100||a.name.trim().length===0){t=!0,o=s("message.invalid_title"),v.error(o);return}if(a.description.trim().length>250){t=!0,o=s("message.invalid_description"),v.error(o);return}[a.questions.filter(l=>{const u=l.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return u.length===0||u.length>=5e3}),a.questions.filter(l=>(l.explainText?l.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=5e3),a.questions.filter(l=>l.type===z.MULTIPLE_CHOICE&&(l.multipleChoices.some(u=>u.text.trim().length===0||u.text.trim().length>1e3)||l.multipleChoices.filter(u=>u.isAnswer).length===0||l.multipleChoices.length<2)),a.questions.filter(l=>l.type===z.MATCHING&&(l.matchingPairs.some(u=>u.leftItem.trim().length===0||u.leftItem.trim().length>1e3)||l.matchingPairs.some(u=>u.rightItem.trim().length===0||u.rightItem.trim().length>1e3)||l.matchingPairs.length<2)),a.questions.filter(l=>l.type===z.ORDERING&&(l.orderingItems.some(u=>u.text.trim().length===0||u.text.trim().length>1e3)||l.orderingItems.length<2)),a.questions.filter(l=>l.type===z.SHORT_TEXT&&(l.shortAnswer.trim().length===0||l.shortAnswer.trim().length>1e3))].forEach(l=>{l.length>0&&(t=!0,l.forEach(u=>_.add(u)))});let I=Array.from(_).map(l=>a.questions.indexOf(l)+1);t?E.error({title:s("create_QS.modal.invalid.title"),content:s("create_QS.modal.invalid.content")+I.sort().join(", "),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel")}):N()},N=()=>{E.confirm({title:s("create_QS.modal.valid.title"),content:s("create_QS.modal.valid.content"),centered:!0,okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),onOk:async()=>{a.questions=a.questions.map(o=>o.id.startsWith("new_")?{...o,questionId:null}:o);let t=await pe.Create(a);t.data.success&&(v.success(s("message.created_successfully")),k.value=!1,e.push({name:"User_QuestionSet_Detail",params:{id:t.data.data}}))}})},H=h(null),ne=()=>{var t;(t=H.value)==null||t.openImportModal()},j=h(null),ae=()=>{var t;(t=j.value)==null||t.openGenerateAIModal()},oe=t=>{t.length!==0&&(a.questions.unshift(...t.map((o,_)=>{var b;return{...o,id:`new_${a.questions.length+_}`,orderingItems:(b=o.orderingItems)==null?void 0:b.map((I,l)=>({...I,correctOrder:l}))}})),x(()=>{var o,_;(_=(o=Q.value)==null?void 0:o.forceUpdate)==null||_.call(o),x(()=>{const b=a.questions.length;requestAnimationFrame(()=>{var I;(I=Q.value)==null||I.scrollToItem(b)})})}),v.success(`${s("message.imported_question",{number:t.length})}`))};ce((t,o,_)=>{if(!k.value){_();return}E.confirm({title:s("create_QS.modal.leave.title"),content:s("create_QS.modal.leave.content"),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),onOk:()=>{_()},onCancel:()=>_(!1)})});function P(t){t.preventDefault(),t.returnValue=""}const Q=h(null),se=()=>{x(()=>{var t,o;(o=(t=Q.value)==null?void 0:t.forceUpdate)==null||o.call(t)})};me(()=>{document.addEventListener("click",B),a.questions.push(D()),window.addEventListener("beforeunload",P)}),de(()=>{window.removeEventListener("beforeunload",P)});const W={t:s,router:e,isDataValid:k,formRef:L,formState:a,rules:M,componentMap:O,tagContent:m,addTag:w,removeTag:r,appendTagContent:q,tag_search_data:p,searchResultRef:G,lastSearchResult:V,handleMouseClickOutside:B,searchTagPageParams:R,getSearchTagData:F,createQuestionTemplate:D,onHandleChangeQuestionType:Z,onAddQuestion:$,onRemoveQuestion:ee,onFinish:te,showModalConfirmation:N,importModalRef:H,onOpenImportModal:ne,generateModalRef:j,openGenerateAIModal:ae,onModalImport:oe,handleBeforeUnload:P,scrollerRef:Q,handleScroll:se,Input:ve,TextArea:be,ImportQSModal:ye,GenerateQSModal:xe,get DynamicScroller(){return Ce},get DynamicScrollerItem(){return Te}};return Object.defineProperty(W,"__isScriptSetup",{enumerable:!1,value:!0}),W}}),Me={class:"page-container"},we={class:"title-container"},Re={class:"content"},Ae={style:{height:"500px"},class:"content-item"},ze={class:"content-item-title"},Oe={class:"d-flex"},Ve={class:"form-item"},De={class:"tag-container"},Pe=["onClick"],Ee={class:"tag-inputter"},Ue={class:"search-bar",ref:"searchResultRef"},Le={key:0,class:_e(["search-result-container"])},Ge={class:"search-result"},Be={class:"search-result-tag"},Fe={class:"result-tag"},Ne={class:"result-tag-qs-count"},He={class:"result-item-action"},je={class:"content-item"},We={class:"content-item-title"},Xe={class:"content-item-buttons"},Ye={class:"import-button"};function Je(g,i,s,e,k,L){const a=y("RouterLink"),M=y("a-col"),O=y("a-row"),m=y("a-button"),w=y("a-form");return S(),T(U,null,[n("div",Me,[n("div",we,[d(O,{class:"w-100 d-flex align-items-center"},{default:f(()=>[d(M,{span:1},{default:f(()=>[d(a,{to:{name:"User_Library"}},{default:f(()=>i[4]||(i[4]=[n("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[4]})]),_:1}),d(M,{class:"main-title",span:23},{default:f(()=>[n("span",null,c(g.$t("create_QS.title")),1),i[5]||(i[5]=C()),i[6]||(i[6]=n("br",null,null,-1)),n("span",null,c(g.$t("create_QS.sub_title")),1)]),_:1,__:[5,6]})]),_:1})]),n("div",Re,[d(w,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":i[3]||(i[3]=r=>e.formState=r),rules:e.rules,ref:"formRef"},{default:f(()=>[n("div",Ae,[n("div",ze,[n("div",null,[n("span",null,c(g.$t("create_QS.quiz.question_detail_title")),1),n("span",null,c(g.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":i[0]||(i[0]=r=>e.formState.name=r),isRequired:!0,placeholder:e.t("create_QS.other.title_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),n("div",Oe,[d(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":i[1]||(i[1]=r=>e.formState.description=r),placeholder:e.t("create_QS.other.description_placeholder"),"max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","placeholder","label"]),n("div",Ve,[n("label",null,c(g.$t("create_QS.quiz.tag")),1),n("div",De,[(S(!0),T(U,null,Y(e.formState.tags,(r,q)=>(S(),T("div",{class:"tag-item",key:q},[C(c(r)+" ",1),n("i",{class:"bx bx-x",onClick:p=>e.removeTag(q)},null,8,Pe)]))),128))]),n("div",Ee,[J(` <Input
                                    v-model="tagContent"
                                    :placeholder="t('create_QS.other.tag_content_placeholder')"
                                    :max-length="50"
                                >
                                    <template #icon>
                                        <i class="bx bx-purchase-tag-alt"></i>
                                    </template>
                                </Input> `),n("div",Ue,[d(e.Input,{onInput:e.getSearchTagData,modelValue:e.tagContent,"onUpdate:modelValue":i[2]||(i[2]=r=>e.tagContent=r),placeholder:e.t("create_QS.other.tag_content_placeholder"),"max-length":50},{icon:f(()=>i[7]||(i[7]=[n("i",{class:"bx bx-purchase-tag-alt"},null,-1)])),_:1},8,["modelValue","placeholder"]),e.tag_search_data.length>0?(S(),T("div",Le,[n("div",Ge,[(S(!0),T(U,null,Y(e.tag_search_data,r=>(S(),T("div",Be,[n("div",Fe,[C(c(r.name)+" ",1),n("div",Ne,c(r.questionSetCount),1)]),n("div",He,[d(m,{type:"primary",class:"main-color-btn",size:"small",onClick:q=>e.appendTagContent(r.name)},{default:f(()=>[...i[8]||(i[8]=[n("i",{class:"bx bx-plus"},null,-1)])]),_:2,__:[8]},1032,["onClick"])])]))),256))])])):J("v-if",!0)],512),n("i",{class:"bx bx-plus tag-inputter-button",onClick:e.addTag})])])])]),n("div",je,[n("div",We,[n("div",null,[n("span",null,c(g.$t("create_QS.quiz.question_question_title")),1),n("span",null,c(g.$t("create_QS.quiz.question_question_sub_title")),1)]),n("div",Xe,[d(a,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:f(()=>[C(c(g.$t("create_QS.buttons.import"))+" ",1),i[9]||(i[9]=n("i",{class:"bx bx-download"},null,-1))]),_:1,__:[9]}),d(a,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:f(()=>[C(c(g.$t("create_QS.buttons.generated_by_ai"))+" ",1),i[10]||(i[10]=n("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[10]}),n("div",{class:"import-button",onClick:e.onFinish},c(g.$t("create_QS.buttons.create")),1),n("div",Ye,c(g.$t("create_QS.quiz.total",{number:e.formState.questions.length.toString().padStart(3,"0")})),1)])]),d(e.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.questions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:f(({item:r,index:q})=>[(S(),K(e.DynamicScrollerItem,{item:r,key:r.id},{default:f(()=>[(S(),K(fe(e.componentMap[r.type]),{question:r,index:e.formState.questions.findIndex(p=>p.id===r.id)+1,displayScore:!1,key:r.id,onDeleteQuestion:p=>e.onRemoveQuestion(q),onChangeQuestionType:p=>e.onHandleChangeQuestionType(r)},null,40,["question","index","onDeleteQuestion","onChangeQuestionType"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),n("div",{class:"add-question-btn",onClick:e.onAddQuestion},[i[11]||(i[11]=n("i",{class:"bx bx-plus"},null,-1)),C(" "+c(g.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),d(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,numberOfQuestion:e.formState.questions.length,onImport:e.onModalImport},null,8,["title","numberOfQuestion"]),d(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport,numberOfQuestion:e.formState.questions.length},null,8,["title","numberOfQuestion"])],64)}const rt=ge(ke,[["render",Je],["__scopeId","data-v-b7d6bbaa"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/question_sets/create.vue"]]);export{rt as default};

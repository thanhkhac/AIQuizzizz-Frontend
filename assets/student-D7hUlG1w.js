import{d as ae,q as ne,l as se,u as oe,B as H,i as C,j as K,C as le,s as ie,k as p,M,v as re,_ as de,r as _,a as f,o as v,b as t,e as E,c as o,w as s,f as b,t as d,F as h,D as W,E as O}from"./index-Cmj4Sauw.js";import{A as k}from"./ApiClass-D7Qkk9XC.js";import{I as ce}from"./Input-7s2qH2uT.js";import{C as me}from"./classStudentPosition-B7ChrNvq.js";const ue={FULL_NAME:"FullName",EMAIL:"Email"},_e=ae({__name:"student",emits:["updateSidebar"],setup(c,{expose:n,emit:V}){var Y;n();const e=ne(),w=se(),{t:i}=oe(),y=V,x=Object.values(ue),T=H(()=>x.map(a=>({label:i(`class_member.select_option.${a}`),value:a}))),g=C(e.params.id||""),I=C({classId:"",name:"",topic:""}),N=C(!1),F=[{title:"No",key:"no",customRender:a=>a.index+1},{title:i("class_member.column.fullName"),dataIndex:"fullName",key:"fullName",sorter:(a,u)=>a.fullName.localeCompare(u.fullName)},{title:i("class_member.column.email"),dataIndex:"email",key:"email",sorter:(a,u)=>a.email.localeCompare(u.email)},{title:i("class_member.column.position"),dataIndex:"position",key:"position"},{key:"action"}],P=[1,3,5,7,30],L=H(()=>P.map(a=>({label:a+i(a===1?"class_member.other.day_singular":"class_member.other.day_plural"),value:a}))),D=async()=>{try{g.value||w.push({name:"404"});let a=await k.GetById(g.value.toString());a.data.success||w.push({name:"404"}),I.value=a.data.data}catch(a){console.log("ERROR: GETBYID class: "+a)}},q=C(""),A=async()=>{try{const a=await k.GetUserPermission(I.value.classId);a.data.success&&(q.value=a.data.data)}catch(a){console.log(a)}},l=K({pageNumber:e.query.pageNumber||1,pageSize:e.query.pageSize||10,keyword:((Y=e.query.keyword)==null?void 0:Y.toString())||"",fieldName:e.query.fieldName||T.value[0].value,totalCount:0,statusFilter:!1}),U=C([]),S=async()=>{try{N.value=!0;let a=await k.GetAllStudentByLimit(g.value.toString(),l);if(a.data.success){let u=a.data.data;U.value=u.items,l.pageNumber=u.pageNumber,l.pageSize=u.pageSize,l.totalCount=u.totalCount,l.statusFilter&&(l.pageNumber>u.totalPages&&l.totalCount>0?(l.pageNumber=1,w.push({name:"User_Class_Student",params:{id:g.value},query:{pageNumber:1,pageSize:l.pageSize,keyword:l.keyword,fieldName:l.fieldName}})):w.push({name:"User_Class_Student",params:{id:g.value},query:{pageNumber:l.pageNumber,pageSize:l.pageSize,keyword:l.keyword,fieldName:l.fieldName}}),l.statusFilter=!l.statusFilter)}}catch(a){console.log("ERROR: GETALLEXAMBYLIMIT class exam: "+a)}finally{N.value=!1}};le(()=>Object.keys(e.query).length,()=>{var a;l.pageNumber=e.query.pageNumber||1,l.pageSize=e.query.pageSize||10,l.keyword=((a=e.query.keyword)==null?void 0:a.toString())||"",l.fieldName=e.query.fieldName||T.value[0].value,l.statusFilter=!0,S()});const R=(a,u)=>{l.pageNumber=a,l.pageSize=u,l.statusFilter=!0,S()},r=C(!1),m=K({classId:g.value,code:"",expiredTime:L.value[0].value}),z=C(window.location.origin+`/user/class/invitation/${m.code}`),B=C(!0),X=C(!1),j=async()=>{await G(),r.value=!0},G=async()=>{const a=await k.GetInivationCode(g.value.toString());a.data.success&&(m.code=a.data.data,z.value=window.location.origin+`/user/class/invitation/${m.code}`)},J=async()=>{(await k.CreateNewInvitation(m)).data.success?(p.success(i("message.created_new_invitation")),j()):p.error(i("message.created_failed"))},Z=a=>{if(!B.value)return;let u=m.code;a==="link"&&(u=z.value),navigator.clipboard.writeText(u).then(()=>{p.success(i("message.copied"))}).catch(()=>{p.error(i("message.copied_failed"))})},$=a=>{M.confirm({title:i("class_member.modal.delete_member_title"),content:i("class_member.modal.delete_member_content"),centered:!0,okText:i("sidebar.buttons.ok"),cancelText:i("sidebar.buttons.cancel"),onOk:async()=>{if(!(await k.DeleteClassMember(g.value.toString(),a.toString())).data.success){p.error(i("message.removed_failed"));return}p.success(i("message.removed_successfully")),await S()}})},ee=(a,u)=>{M.confirm({title:i("class_member.modal.update_member_title"),content:i("class_member.modal.update_member_content"),centered:!0,okText:i("sidebar.buttons.ok"),cancelText:i("sidebar.buttons.cancel"),onOk:async()=>{if(!(await k.UpdateClassMemberPosition(g.value.toString(),a.toString(),u)).data.success){p.error(i("message.updated_failed"));return}p.success(i("message.updated_successfully")),await S()}})},te=()=>{M.confirm({title:i("class_member.danger_zone.warning"),content:re("div",{style:"color: red"},i("class_member.danger_zone.warning_explain")),centered:!0,okText:i("sidebar.buttons.ok"),cancelText:i("sidebar.buttons.cancel"),onOk:async()=>{if(!(await k.Delete(g.value.toString())).data.success){p.error(i("message.deleted_failed"));return}p.success(i("message.deleted_successfully")),w.push({name:"User_Class"})}})};ie(async()=>{y("updateSidebar","class"),await D(),await A(),await S()});const Q={route:e,router:w,t:i,emit:y,optionKeys:x,class_position_options:T,classId:g,classData:I,loading:N,columns:F,optionDays:P,code_limit_time:L,getClassData:D,userRoleInClass:q,getPermission:A,pageParams:l,student_data:U,getData:S,onPaginationChange:R,modal_invitation_open:r,invitationFormState:m,inivitationLink:z,allowCopy:B,isInvitaionLoading:X,onOpenInvitationModal:j,getInvitationCode:G,onResetInvitation:J,onCopyInvitationCode:Z,onConfirmDeleteMember:$,onConfirmUpdateMemberPosition:ee,onOpenConfirmDeleteClass:te,Input:ce,get CLASS_STUDENT_POSITION(){return me}};return Object.defineProperty(Q,"__isScriptSetup",{enumerable:!1,value:!0}),Q}}),ve={class:"page-container"},be={class:"title-container"},ge={class:"breadcrumb-container"},pe={class:"title-breadcrumb-item"},fe={class:"title-breadcrumb-item"},ye={class:"breadcrumb-item-topic"},Ce={class:"content"},Se={class:"content-item"},ke={class:"content-item-title"},we={class:"content-item-functions"},Ie={class:"content-item-navigators"},Ne={class:"navigator-container"},he={style:{width:"300px",padding:"0px"}},xe={key:0,class:"student-name-container"},Te=["src"],ze={class:"student-name"},De={key:0,class:"student-action"},Ue=["onClick"],Ee=["onClick"],Oe=["onClick"],Pe={key:1,class:"w-100 d-flex justify-content-center"},Le={class:"pagination-container"},qe={class:"mt-4 content-item"},Ae={class:"content-item-title"},Fe={class:"text-danger"},Re={class:"danger-zone mt-3 p-4"},Me={class:"text-danger fs-6 fw-bold"},Ve={class:"text-secondary"},Be={class:"modal-container"},je={class:"modal-title-container"},Ge={class:"modal-invitation-body"},Qe={class:"invitation-code-container"},Ye={class:"invitation-code-container"};function He(c,n,V,e,w,i){const y=_("RouterLink"),x=_("a-button"),T=_("a-select-option"),g=_("a-select"),I=_("a-skeleton"),N=_("a-tooltip"),F=_("a-table"),P=_("a-empty"),L=_("a-pagination"),D=_("a-col"),q=_("a-row"),A=_("a-qrcode"),l=_("a-form-item"),U=_("a-form"),S=_("a-divider"),R=_("a-modal");return v(),f(h,null,[t("div",ve,[t("div",be,[t("div",ge,[t("ul",null,[t("li",pe,[o(y,{to:{name:"User_Class"}},{default:s(()=>[t("span",null,d(c.$t("class_index.title")),1),n[10]||(n[10]=b()),n[11]||(n[11]=t("br",null,null,-1))]),_:1,__:[10,11]}),n[12]||(n[12]=t("i",{class:"bx bx-chevron-right"},null,-1))]),t("li",fe,[o(y,{to:{name:""},class:"breadcrumb-item-class"},{default:s(()=>[t("span",null,d(e.classData.name),1),t("span",ye,d(e.classData.topic),1)]),_:1})])])])]),t("div",Ce,[t("div",Se,[t("div",ke,[t("div",null,[t("span",null,d(c.$t("class_member.title")),1),t("span",null,d(c.$t("class_member.sub_title")),1)]),o(x,{class:"main-color-btn",type:"primary",size:"large",onClick:e.onOpenInvitationModal},{default:s(()=>[n[13]||(n[13]=t("i",{class:"me-2 bx bx-user-plus"},null,-1)),b(" "+d(c.$t("class_member.buttons.invite_member")),1)]),_:1,__:[13]})]),t("div",we,[t("div",Ie,[t("div",Ne,[o(y,{class:"navigator-item",to:{name:"User_Class_Exam"}},{default:s(()=>[b(d(c.$t("class_index.navigators.exam")),1)]),_:1}),o(y,{class:"navigator-item",to:{name:"User_Class_Quiz"}},{default:s(()=>[b(d(c.$t("class_index.navigators.quiz")),1)]),_:1}),o(y,{class:"navigator-item navigator-active",to:{name:""}},{default:s(()=>[b(d(c.$t("class_index.navigators.member")),1)]),_:1})])]),o(g,{value:e.pageParams.fieldName,"onUpdate:value":n[0]||(n[0]=r=>e.pageParams.fieldName=r),style:{width:"200px"},onChange:e.getData},{default:s(()=>[(v(!0),f(h,null,W(e.class_position_options,r=>(v(),O(T,{value:r.value},{default:s(()=>[b(d(r.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"]),t("div",he,[o(e.Input,{onInput:e.getData,modelValue:e.pageParams.keyword,"onUpdate:modelValue":n[1]||(n[1]=r=>e.pageParams.keyword=r),placeholder:e.t("class_member.other.search_placeholder")},{icon:s(()=>n[14]||(n[14]=[t("i",{class:"bx bx-search"},null,-1)])),_:1},8,["modelValue","placeholder"])])]),e.loading?(v(),f(h,{key:0},[o(I,{loading:e.loading},null,8,["loading"]),o(I,{loading:e.loading},null,8,["loading"]),o(I,{loading:e.loading},null,8,["loading"])],64)):(v(),f(h,{key:1},[e.student_data.length>0?(v(),O(F,{key:0,columns:e.columns,"data-source":e.student_data,"row-key":"studentId",pagination:!1},{bodyCell:s(({column:r,record:m})=>[r.key==="fullName"?(v(),f("div",xe,[t("img",{class:"student-image",src:m.image,alt:""},null,8,Te),t("div",ze,d(m.fullName),1)])):E("v-if",!0),r.key==="position"?(v(),f(h,{key:1},[b(d(c.$t(`class_member.position.${m.position}`)),1)],64)):E("v-if",!0),r.key==="action"?(v(),f(h,{key:2},[e.userRoleInClass===e.CLASS_STUDENT_POSITION.OWNER?(v(),f("div",De,[m.position===e.CLASS_STUDENT_POSITION.STUDENT?(v(),O(N,{key:0},{title:s(()=>[b(d(c.$t("class_member.buttons.assign_lecturer")),1)]),default:s(()=>[t("i",{style:{cursor:"pointer"},class:"bx bxs-id-card",onClick:z=>e.onConfirmUpdateMemberPosition(m.studentId,e.CLASS_STUDENT_POSITION.TEACHER)},null,8,Ue)]),_:2},1024)):(v(),O(N,{key:1},{title:s(()=>[b(d(c.$t("class_member.buttons.remove_lecturer")),1)]),default:s(()=>[t("i",{class:"text-danger bx bxs-id-card",onClick:z=>e.onConfirmUpdateMemberPosition(m.studentId,e.CLASS_STUDENT_POSITION.STUDENT)},null,8,Ee)]),_:2},1024)),o(N,null,{title:s(()=>[b(d(c.$t("question_sets_index.buttons.delete")),1)]),default:s(()=>[t("i",{class:"text-danger bx bx-trash-alt",onClick:z=>e.onConfirmDeleteMember(m.studentId)},null,8,Oe)]),_:2},1024)])):E("v-if",!0)],64)):E("v-if",!0)]),_:1},8,["data-source"])):(v(),f("div",Pe,[o(P,null,{description:s(()=>[t("span",null,d(c.$t("class_index.other.no_data_matches")),1)]),_:1})]))],64)),t("div",Le,[o(L,{onChange:e.onPaginationChange,current:e.pageParams.pageNumber,"onUpdate:current":n[2]||(n[2]=r=>e.pageParams.pageNumber=r),total:e.pageParams.totalCount,pageSize:e.pageParams.pageSize,"show-total":(r,m)=>`${m[0]}-${m[1]} of ${r} ${e.t("class_member.other.items")}`,"show-size-changer":"","show-quick-jumper":"",class:"crud-layout-pagination",locale:{items_per_page:e.t("class_index.other.pages")}},null,8,["current","total","pageSize","show-total","locale"])])]),t("div",qe,[t("div",Ae,[t("div",null,[t("span",Fe,d(c.$t("class_member.danger_zone.title")),1),t("span",null,d(c.$t("class_member.danger_zone.sub_title")),1)])]),t("div",Re,[t("div",Me,d(c.$t("class_member.danger_zone.warning")),1),t("div",Ve,d(c.$t("class_member.danger_zone.warning_explain")),1),o(x,{class:"mt-3",type:"primary",danger:"",size:"large",onClick:e.onOpenConfirmDeleteClass},{default:s(()=>[b(d(c.$t("class_member.buttons.delete_class")),1)]),_:1})])])])]),E(" invitation modal "),o(R,{width:"750px",centered:"","wrap-class-name":"medium-modal",open:e.modal_invitation_open,onCancel:n[9]||(n[9]=r=>e.modal_invitation_open=!1)},{footer:s(()=>[o(U,{layout:"vertical",class:"w-100 d-flex align-items-end justify-content-between"},{default:s(()=>[o(l,{label:e.t("class_member.modal.time_limit_label")},{default:s(()=>[o(g,{value:e.invitationFormState.expiredTime,"onUpdate:value":n[8]||(n[8]=r=>e.invitationFormState.expiredTime=r),style:{width:"200px"},onChange:e.getData},{default:s(()=>[(v(!0),f(h,null,W(e.code_limit_time,r=>(v(),O(T,{value:r.value},{default:s(()=>[b(d(r.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},8,["label"]),o(l,null,{default:s(()=>[o(x,{loading:e.isInvitaionLoading,class:"main-color-btn",key:"submit",type:"primary",onClick:e.onResetInvitation},{default:s(()=>[b(d(c.$t("class_member.buttons.reset_code")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),default:s(()=>[t("div",Be,[t("div",je,[o(q,{class:"w-100 d-flex align-items-center"},{default:s(()=>[o(D,{span:2},{default:s(()=>[o(y,{onClick:n[3]||(n[3]=r=>e.modal_invitation_open=!1),to:{name:""}},{default:s(()=>n[15]||(n[15]=[t("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[15]})]),_:1}),o(D,{class:"main-title",span:22},{default:s(()=>[t("span",null,d(c.$t("class_member.modal.title")),1),n[16]||(n[16]=b()),n[17]||(n[17]=t("br",null,null,-1)),t("span",null,d(c.$t("class_member.modal.sub_title")),1)]),_:1,__:[16,17]})]),_:1})]),t("div",Ge,[o(A,{value:e.invitationFormState.code,class:"invitation-body-qrcode"},null,8,["value"]),o(U,{layout:"vertical",class:"invitation-body-link"},{default:s(()=>[o(l,{label:e.t("class_member.modal.class_code_label")},{default:s(()=>[t("div",Qe,[o(e.Input,{modelValue:e.invitationFormState.code,"onUpdate:modelValue":n[4]||(n[4]=r=>e.invitationFormState.code=r),"is-required":!0,"max-length":100,readonly:!0},null,8,["modelValue"]),t("i",{class:"bx bx-copy",onClick:n[5]||(n[5]=r=>e.onCopyInvitationCode("code"))})])]),_:1},8,["label"]),o(l,{label:e.t("class_member.modal.invitation_link")},{default:s(()=>[t("div",Ye,[o(e.Input,{modelValue:e.inivitationLink,"onUpdate:modelValue":n[6]||(n[6]=r=>e.inivitationLink=r),"is-required":!0,"max-length":100,readonly:!0},null,8,["modelValue"]),t("i",{class:"bx bx-copy",onClick:n[7]||(n[7]=r=>e.onCopyInvitationCode("link"))})])]),_:1},8,["label"])]),_:1})]),o(S,null,{default:s(()=>[b(d(c.$t("class_member.modal.or")),1)]),_:1})])]),_:1},8,["open"])],64)}const $e=de(_e,[["render",He],["__scopeId","data-v-6a35c450"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/class/student.vue"]]);export{$e as default};

import{d as ne,q as oe,l as le,u as ie,z as H,i as N,j as J,E as re,s as de,R,k as p,M as V,v as X,_ as ce,r as _,c as f,o as u,b as t,e as U,a as i,w as o,f as g,t as d,C as z,F as x,B as Y}from"./index--4eqDeQq.js";import{u as me}from"./user-zaK1_Zi8.js";import{A as k}from"./ApiClass-DLDi90BD.js";import{I as ue}from"./Input-OvzKKxPx.js";import{C as _e}from"./classStudentPosition-B7ChrNvq.js";import{V as be}from"./Validator-CWeiTIFe.js";const ge={FULL_NAME:"FullName",EMAIL:"Email"},ve=ne({__name:"student",emits:["updateSidebar"],setup(c,{expose:s,emit:B}){var W;s();const e=oe(),y=le(),{t:n}=ie(),S=B,I=Object.values(ge),O=H(()=>I.map(a=>({label:n(`class_member.select_option.${a}`),value:a}))),b=N(e.params.id||""),w=N({classId:"",name:"",topic:""}),T=N(!1),M=[{title:"No",key:"no",customRender:a=>a.index+1},{title:n("class_member.column.fullName"),dataIndex:"fullName",key:"fullName",sorter:(a,m)=>a.fullName.localeCompare(m.fullName)},{title:n("class_member.column.email"),dataIndex:"email",key:"email",sorter:(a,m)=>a.email.localeCompare(m.email)},{title:n("class_member.column.position"),dataIndex:"position",key:"position"},{key:"action"}],E=[1,3,5,7,30],L=H(()=>E.map(a=>({label:a+n(a===1?"class_member.other.day_singular":"class_member.other.day_plural"),value:a}))),P=async()=>{try{if(!be.isValidGuid(b.value.toString())){y.push({name:"404"});return}b.value||y.push({name:"404"});let a=await k.GetById(b.value.toString());a.data.success||y.push({name:"404"}),w.value=a.data.data}catch(a){const m=Object.keys(a.response.data.errors);if(m.includes(R.NOT_FOUND_STUDENT_IN_CLASS)||m.includes(R.NOT_FOUND_USER_IN_CLASS)){y.push({name:"User_Class"});return}}},D=N(""),A=async()=>{try{const a=await k.GetUserPermission(w.value.classId);a.data.success&&(D.value=a.data.data)}catch(a){console.log(a)}},r=J({pageNumber:e.query.pageNumber||1,pageSize:e.query.pageSize||10,keyword:((W=e.query.keyword)==null?void 0:W.toString())||"",fieldName:e.query.fieldName||O.value[0].value,totalCount:0,statusFilter:!1}),h=N([]),C=async()=>{try{T.value=!0;let a=await k.GetAllStudentByLimit(b.value.toString(),r);if(a.data.success){let m=a.data.data;h.value=m.items,r.pageNumber=m.pageNumber,r.pageSize=m.pageSize,r.totalCount=m.totalCount,r.statusFilter&&(r.pageNumber>m.totalPages&&r.totalCount>0?(r.pageNumber=1,y.push({name:"User_Class_Student",params:{id:b.value},query:{pageNumber:1,pageSize:r.pageSize,keyword:r.keyword,fieldName:r.fieldName}})):y.push({name:"User_Class_Student",params:{id:b.value},query:{pageNumber:r.pageNumber,pageSize:r.pageSize,keyword:r.keyword,fieldName:r.fieldName}}),r.statusFilter=!r.statusFilter)}}catch(a){const m=Object.keys(a.response.data.errors);(m.includes(R.NOT_FOUND_STUDENT_IN_CLASS)||m.includes(R.NOT_FOUND_USER_IN_CLASS))&&y.push({name:"User_Class"})}finally{T.value=!1}};re(()=>Object.keys(e.query).length,()=>{var a;r.pageNumber=e.query.pageNumber||1,r.pageSize=e.query.pageSize||10,r.keyword=((a=e.query.keyword)==null?void 0:a.toString())||"",r.fieldName=e.query.fieldName||O.value[0].value,r.statusFilter=!0,C()});const j=(a,m)=>{r.pageNumber=a,r.pageSize=m,r.statusFilter=!0,C()},F=N(!1),l=J({classId:b.value,code:"",expiredTime:L.value[0].value}),v=N(""),q=N(!1),G=async()=>{await K(),F.value=!0},K=async()=>{const a=await k.GetInivationCode(b.value.toString());a.data.data&&(l.code=a.data.data,v.value=window.location.origin+`/user/class/invitation/${l.code}`)},Z=async()=>{(await k.CreateNewInvitation(l)).data.success?(p.success(n("message.created_new_invitation")),G()):p.error(n("message.created_failed"))},$=a=>{if(!l.code)return;let m=l.code;a==="link"&&(m=v.value),navigator.clipboard.writeText(m).then(()=>{p.success(n("message.copied"))}).catch(()=>{p.error(n("message.copied_failed"))})},ee=a=>{V.confirm({title:n("class_member.modal.delete_member_title"),content:n("class_member.modal.delete_member_content"),centered:!0,okText:n("sidebar.buttons.ok"),cancelText:n("sidebar.buttons.cancel"),onOk:async()=>{if(!(await k.DeleteClassMember(b.value.toString(),a.toString())).data.success){p.error(n("message.removed_failed"));return}p.success(n("message.removed_successfully")),await C()}})},te=(a,m)=>{V.confirm({title:n("class_member.modal.update_member_title"),content:n("class_member.modal.update_member_content"),centered:!0,okText:n("sidebar.buttons.ok"),cancelText:n("sidebar.buttons.cancel"),onOk:async()=>{if(!(await k.UpdateClassMemberPosition(b.value.toString(),a.toString(),m)).data.success){p.error(n("message.updated_failed"));return}p.success(n("message.updated_successfully")),await C()}})},ae=()=>{V.confirm({title:n("class_member.danger_zone.warning"),content:X("div",{style:"color: red"},n("class_member.danger_zone.warning_explain")),centered:!0,okText:n("sidebar.buttons.ok"),cancelText:n("sidebar.buttons.cancel"),onOk:async()=>{if(!(await k.Delete(b.value.toString())).data.success){p.error(n("message.deleted_failed"));return}p.success(n("message.deleted_successfully")),y.push({name:"User_Class"})}})},se=()=>{V.confirm({title:n("class_member.danger_zone.warning"),content:X("div",{style:"color: red"},n("class_member.danger_zone.warning_explain")),centered:!0,okText:n("sidebar.buttons.ok"),cancelText:n("sidebar.buttons.cancel"),onOk:async()=>{if(!(await k.Delete(b.value.toString())).data.success){p.error(n("message.deleted_failed"));return}p.success(n("message.deleted_successfully")),y.push({name:"User_Class"})}})};de(async()=>{S("updateSidebar","class"),await P(),await A(),await C()});const Q={route:e,router:y,t:n,emit:S,optionKeys:I,class_position_options:O,classId:b,classData:w,loading:T,columns:M,optionDays:E,code_limit_time:L,getClassData:P,userRoleInClass:D,getPermission:A,pageParams:r,student_data:h,getData:C,onPaginationChange:j,modal_invitation_open:F,invitationFormState:l,inivitationLink:v,isInvitaionLoading:q,onOpenInvitationModal:G,getInvitationCode:K,onResetInvitation:Z,onCopyInvitationCode:$,onConfirmDeleteMember:ee,onConfirmUpdateMemberPosition:te,onOpenConfirmDeleteClass:ae,onOpenConfirmLeaveClass:se,get user_image(){return me},Input:ue,get CLASS_STUDENT_POSITION(){return _e}};return Object.defineProperty(Q,"__isScriptSetup",{enumerable:!1,value:!0}),Q}}),pe={class:"page-container"},fe={class:"title-container"},ye={class:"breadcrumb-container"},Se={class:"title-breadcrumb-item"},Ce={class:"title-breadcrumb-item"},ke={class:"breadcrumb-item-topic"},Ne={class:"content"},Ie={class:"content-item"},we={class:"content-item-title"},Te={class:"content-item-functions"},he={class:"content-item-navigators"},xe={class:"navigator-container"},Oe={style:{width:"300px",padding:"0px"}},Ue={key:0,class:"student-name-container"},ze=["src"],De={class:"student-name"},Ee={key:0,class:"student-action"},Le=["onClick"],Pe=["onClick"],Ae=["onClick"],Fe={key:1,class:"w-100 d-flex justify-content-center"},qe={class:"pagination-container"},Re={key:0,class:"mt-4 content-item"},Ve={class:"content-item-title"},Me={class:"text-danger"},je={class:"danger-zone mt-3 p-4"},Be={class:"text-danger fs-6 fw-bold"},Ge={class:"text-secondary"},Ke={key:1,class:"mt-4 content-item"},Qe={class:"modal-container"},We={class:"modal-title-container"},He={class:"modal-invitation-body"},Je={class:"invitation-code-container"},Xe={class:"invitation-code-container"};function Ye(c,s,B,e,y,n){const S=_("RouterLink"),I=_("a-button"),O=_("a-select-option"),b=_("a-select"),w=_("a-skeleton"),T=_("a-tooltip"),M=_("a-table"),E=_("a-config-provider"),L=_("a-empty"),P=_("a-pagination"),D=_("a-col"),A=_("a-row"),r=_("a-qrcode"),h=_("a-form-item"),C=_("a-form"),j=_("a-divider"),F=_("a-modal");return u(),f(x,null,[t("div",pe,[t("div",fe,[t("div",ye,[t("ul",null,[t("li",Se,[i(S,{to:{name:"User_Class"}},{default:o(()=>[t("span",null,d(c.$t("class_index.title")),1),s[10]||(s[10]=g()),s[11]||(s[11]=t("br",null,null,-1))]),_:1,__:[10,11]}),s[12]||(s[12]=t("i",{class:"bx bx-chevron-right"},null,-1))]),t("li",Ce,[i(S,{to:{name:""},class:"breadcrumb-item-class"},{default:o(()=>[t("span",null,d(e.classData.name),1),t("span",ke,d(e.classData.topic),1)]),_:1})])])])]),t("div",Ne,[t("div",Ie,[t("div",we,[t("div",null,[t("span",null,d(c.$t("class_member.title")),1),t("span",null,d(c.$t("class_member.sub_title")),1)]),e.userRoleInClass!==e.CLASS_STUDENT_POSITION.STUDENT?(u(),z(I,{key:0,class:"main-color-btn",type:"primary",size:"large",onClick:e.onOpenInvitationModal},{default:o(()=>[s[13]||(s[13]=t("i",{class:"me-2 bx bx-user-plus"},null,-1)),g(" "+d(c.$t("class_member.buttons.invite_member")),1)]),_:1,__:[13]})):U("v-if",!0)]),t("div",Te,[t("div",he,[t("div",xe,[i(S,{class:"navigator-item",to:{name:"User_Class_Exam"}},{default:o(()=>[g(d(c.$t("class_index.navigators.exam")),1)]),_:1}),i(S,{class:"navigator-item",to:{name:"User_Class_Quiz"}},{default:o(()=>[g(d(c.$t("class_index.navigators.quiz")),1)]),_:1}),i(S,{class:"navigator-item navigator-active",to:{name:""}},{default:o(()=>[g(d(c.$t("class_index.navigators.member")),1)]),_:1})])]),i(b,{class:"me-3",value:e.pageParams.fieldName,"onUpdate:value":s[0]||(s[0]=l=>e.pageParams.fieldName=l),style:{width:"200px"},onChange:e.getData},{default:o(()=>[(u(!0),f(x,null,Y(e.class_position_options,l=>(u(),z(O,{value:l.value},{default:o(()=>[g(d(l.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"]),t("div",Oe,[i(e.Input,{onInput:e.getData,modelValue:e.pageParams.keyword,"onUpdate:modelValue":s[1]||(s[1]=l=>e.pageParams.keyword=l),placeholder:e.t("class_member.other.search_placeholder")},{icon:o(()=>s[14]||(s[14]=[t("i",{class:"bx bx-search"},null,-1)])),_:1},8,["modelValue","placeholder"])])]),e.loading?(u(),f(x,{key:0},[i(w,{active:"",loading:e.loading},null,8,["loading"]),i(w,{active:"",loading:e.loading},null,8,["loading"]),i(w,{active:"",loading:e.loading},null,8,["loading"])],64)):(u(),f(x,{key:1},[e.student_data.length>0?(u(),z(E,{key:0,locale:{Table:{cancelSort:"",triggerAsc:"",triggerDesc:""}}},{default:o(()=>[i(M,{columns:e.columns,"data-source":e.student_data,"row-key":"studentId",pagination:!1},{bodyCell:o(({column:l,record:v})=>[l.key==="fullName"?(u(),f("div",Ue,[t("img",{class:"user-image",src:e.user_image,alt:""},null,8,ze),t("div",De,d(v.fullName),1)])):U("v-if",!0),l.key==="position"?(u(),f(x,{key:1},[g(d(c.$t(`class_member.position.${v.position}`)),1)],64)):U("v-if",!0),l.key==="action"?(u(),f(x,{key:2},[e.userRoleInClass===e.CLASS_STUDENT_POSITION.OWNER?(u(),f("div",Ee,[v.position===e.CLASS_STUDENT_POSITION.STUDENT?(u(),z(T,{key:0},{title:o(()=>[g(d(c.$t("class_member.buttons.assign_lecturer")),1)]),default:o(()=>[t("i",{style:{cursor:"pointer"},class:"bx bxs-id-card",onClick:q=>e.onConfirmUpdateMemberPosition(v.studentId,e.CLASS_STUDENT_POSITION.TEACHER)},null,8,Le)]),_:2},1024)):(u(),z(T,{key:1},{title:o(()=>[g(d(c.$t("class_member.buttons.remove_lecturer")),1)]),default:o(()=>[t("i",{class:"text-danger bx bxs-id-card",onClick:q=>e.onConfirmUpdateMemberPosition(v.studentId,e.CLASS_STUDENT_POSITION.STUDENT)},null,8,Pe)]),_:2},1024)),i(T,null,{title:o(()=>[g(d(c.$t("question_sets_index.buttons.delete")),1)]),default:o(()=>[t("i",{class:"text-danger bx bx-trash-alt",onClick:q=>e.onConfirmDeleteMember(v.studentId)},null,8,Ae)]),_:2},1024)])):U("v-if",!0)],64)):U("v-if",!0)]),_:1},8,["data-source"])]),_:1})):(u(),f("div",Fe,[i(L,null,{description:o(()=>[t("span",null,d(c.$t("class_index.other.no_data_matches")),1)]),_:1})]))],64)),t("div",qe,[i(P,{onChange:e.onPaginationChange,current:e.pageParams.pageNumber,"onUpdate:current":s[2]||(s[2]=l=>e.pageParams.pageNumber=l),total:e.pageParams.totalCount,pageSize:e.pageParams.pageSize,"show-total":(l,v)=>`${v[0]}-${v[1]} of ${l} ${e.t("class_member.other.items")}`,"show-size-changer":"","show-quick-jumper":"",class:"crud-layout-pagination",locale:{items_per_page:e.t("class_index.other.pages")}},null,8,["current","total","pageSize","show-total","locale"])])]),e.userRoleInClass===e.CLASS_STUDENT_POSITION.OWNER?(u(),f("div",Re,[t("div",Ve,[t("div",null,[t("span",Me,d(c.$t("class_member.danger_zone.title")),1),t("span",null,d(c.$t("class_member.danger_zone.sub_title")),1)])]),t("div",je,[t("div",Be,d(c.$t("class_member.danger_zone.warning")),1),t("div",Ge,d(c.$t("class_member.danger_zone.warning_explain")),1),i(I,{class:"mt-3",type:"primary",danger:"",size:"large",onClick:e.onOpenConfirmDeleteClass},{default:o(()=>[g(d(c.$t("class_member.buttons.delete_class")),1)]),_:1})])])):(u(),f("div",Ke,[i(I,{class:"mt-3",type:"primary",danger:"",size:"large",onClick:e.onOpenConfirmLeaveClass},{default:o(()=>[g(d(c.$t("class_member.buttons.move_out_class"))+" ",1),s[15]||(s[15]=t("i",{class:"bx bx-download bx-rotate-270"},null,-1))]),_:1,__:[15]})]))])]),U(" invitation modal "),i(F,{width:"750px",centered:"","wrap-class-name":"medium-modal",open:e.modal_invitation_open,onCancel:s[9]||(s[9]=l=>e.modal_invitation_open=!1)},{footer:o(()=>[i(C,{layout:"vertical",class:"w-100 d-flex align-items-end justify-content-between"},{default:o(()=>[i(h,{label:e.t("class_member.modal.time_limit_label")},{default:o(()=>[i(b,{value:e.invitationFormState.expiredTime,"onUpdate:value":s[8]||(s[8]=l=>e.invitationFormState.expiredTime=l),style:{width:"200px"},onChange:e.getData},{default:o(()=>[(u(!0),f(x,null,Y(e.code_limit_time,l=>(u(),z(O,{value:l.value},{default:o(()=>[g(d(l.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},8,["label"]),i(h,null,{default:o(()=>[i(I,{loading:e.isInvitaionLoading,class:"main-color-btn",key:"submit",type:"primary",onClick:e.onResetInvitation},{default:o(()=>[g(d(c.$t("class_member.buttons.reset_code")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),default:o(()=>[t("div",Qe,[t("div",We,[i(A,{class:"w-100 d-flex align-items-center"},{default:o(()=>[i(D,{span:2},{default:o(()=>[i(S,{onClick:s[3]||(s[3]=l=>e.modal_invitation_open=!1),to:{name:""}},{default:o(()=>s[16]||(s[16]=[t("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[16]})]),_:1}),i(D,{class:"main-title",span:22},{default:o(()=>[t("span",null,d(c.$t("class_member.modal.title")),1),s[17]||(s[17]=g()),s[18]||(s[18]=t("br",null,null,-1)),t("span",null,d(c.$t("class_member.modal.sub_title")),1)]),_:1,__:[17,18]})]),_:1})]),t("div",He,[i(r,{value:e.invitationFormState.code,class:"invitation-body-qrcode"},null,8,["value"]),i(C,{layout:"vertical",class:"invitation-body-link"},{default:o(()=>[i(h,{label:e.t("class_member.modal.class_code_label")},{default:o(()=>[t("div",Je,[i(e.Input,{modelValue:e.invitationFormState.code,"onUpdate:modelValue":s[4]||(s[4]=l=>e.invitationFormState.code=l),"is-required":!0,"max-length":100,readonly:!0},null,8,["modelValue"]),t("i",{class:"bx bx-copy",onClick:s[5]||(s[5]=l=>e.onCopyInvitationCode("code"))})])]),_:1},8,["label"]),i(h,{label:e.t("class_member.modal.invitation_link")},{default:o(()=>[t("div",Xe,[i(e.Input,{modelValue:e.inivitationLink,"onUpdate:modelValue":s[6]||(s[6]=l=>e.inivitationLink=l),"is-required":!0,"max-length":100,readonly:!0},null,8,["modelValue"]),t("i",{class:"bx bx-copy",onClick:s[7]||(s[7]=l=>e.onCopyInvitationCode("link"))})])]),_:1},8,["label"])]),_:1})]),i(j,null,{default:o(()=>[g(d(c.$t("class_member.modal.or")),1)]),_:1})])]),_:1},8,["open"])],64)}const ot=ce(ve,[["render",Ye],["__scopeId","data-v-6a35c450"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/class/student.vue"]]);export{ot as default};

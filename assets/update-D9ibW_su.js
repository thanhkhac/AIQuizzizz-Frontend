import{d as H,u as Y,l as X,q as J,i as f,j as K,N as W,O as Z,s as $,k as I,M as y,_ as ee,r as Q,a as S,o as v,b as o,c as l,w as g,f as q,t as u,F as z,B as te,C as ne,D as oe}from"./index-Dd8-myui.js";import{A as E}from"./ApiTestTemplate-x2TAPrW4.js";import{Q as T}from"./questionTypes-CS3lcRlq.js";import{T as ae}from"./TransferQuestionData-Bl0XXg5D.js";import{V as ie}from"./Validator-CWeiTIFe.js";import{I as re}from"./Input-BtmZP41X.js";import{T as se}from"./TextArea-DyOic0o8.js";import{S as le,O as de,M as ue,a as ce}from"./ShortText-B2lmwy7J.js";import{G as me,I as pe}from"./GenerateQSModal-BLpofKFx.js";import"./vue-draggable-plus-CKvOH8GT.js";const fe=H({__name:"update",setup(d,{expose:i}){i();const{t:x}=Y(),e=X(),b=J(),A=f(!1),p=f(b.params.id),c=f({testTemplateId:"",name:"",questions:[]}),_=f(!0),m=async()=>{if(!ie.isValidGuid(p.value)){_.value=!1,e.push({name:"404"});return}let n=await E.GetById(p.value);if(!n.data.success){_.value=!1,e.push({name:"404"});return}c.value=n.data.data,t.name=c.value.name,t.createUpdateQuestions=c.value.questions.map(s=>ae.transformResponseToRequest(s)),t.testTemplateId=c.value.testTemplateId,window.addEventListener("beforeunload",U)},M=f(),t=K({testTemplateId:"",name:"",description:"",createUpdateQuestions:[],deleteQuestionIds:[]}),w={title:[{required:"true",message:"This field is required",trigger:"change"},{length:100,message:"Limit 100",trigger:"change"}],description:[{length:200,message:"Limit 200",trigger:"change"}],tags:[{validator:(n,s)=>s&&s.length>5?Promise.reject("You can only add up to 5 tags."):Promise.resolve(),trigger:"change"}],questions:[{validator:(n,s)=>s&&s.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},C={MultipleChoice:ce,Matching:ue,Ordering:de,ShortText:le},k=()=>({id:"",type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),L=()=>{if(t.createUpdateQuestions.length>=100){I.warning("Each question set could have at most 100 questions");return}t.createUpdateQuestions.push(k())},G=n=>{if(t.createUpdateQuestions.length<=1){I.warning("Each question set must have at least 1 questions");return}const s=t.createUpdateQuestions[n].id;s&&t.deleteQuestionIds.push(s),t.createUpdateQuestions.splice(n,1)},P=()=>{let n=!1,s="Invalid question.",h=new Set;if(t.name.trim().length>100||t.name.trim().length===0){n=!0,s="Invalid title.",I.error(s);return}if(t.description.trim().length>250){n=!0,s="Invalid description.",I.error(s);return}[t.createUpdateQuestions.filter(a=>{const r=a.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return r.length===0||r.length>=500}),t.createUpdateQuestions.filter(a=>(a.explainText?a.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),t.createUpdateQuestions.filter(a=>a.type===T.MULTIPLE_CHOICE&&(a.multipleChoices.some(r=>r.text.trim().length===0||r.text.trim().length>500)||a.multipleChoices.filter(r=>r.isAnswer).length===0)),t.createUpdateQuestions.filter(a=>a.type===T.MATCHING&&(a.matchingPairs.some(r=>r.leftItem.trim().length===0||r.leftItem.trim().length>500)||a.matchingPairs.some(r=>r.rightItem.trim().length===0||r.rightItem.trim().length>500))),t.createUpdateQuestions.filter(a=>a.type===T.ORDERING&&a.orderingItems.some(r=>r.text.trim().length===0||r.text.trim().length>500)),t.createUpdateQuestions.filter(a=>a.type===T.SHORT_TEXT&&(a.shortAnswer.trim().length===0||a.shortAnswer.trim().length>500))].forEach(a=>{a.length>0&&(n=!0,a.forEach(r=>h.add(r)))});let j=Array.from(h).map(a=>t.createUpdateQuestions.indexOf(a)+1);n?y.error({title:"Cannot create new question set!",content:"There are errors at questions: "+j.sort().join(", ")}):D()},D=()=>{y.confirm({title:"Create new quiz!",content:"Make sure to review your contents before proceeding.",centered:!0,onOk:async()=>{console.log(t);let n=await E.Update(c.value.testTemplateId,t);n.data.success&&I.success(n.data.data)}})},R=f(null),B=()=>{var n;(n=R.value)==null||n.openImportModal()},O=f(null),N=()=>{var n;(n=O.value)==null||n.openGenerateAIModal()},F=n=>{t.createUpdateQuestions.push(...n)};function U(n){n.preventDefault(),n.returnValue=""}W((n,s,h)=>{if(!_.value){h();return}y.confirm({title:"Leave already?",content:"You have unsaved changes.",onOk:()=>{h()},onCancel:()=>h(!1)})}),Z(()=>{window.removeEventListener("beforeunload",U)}),$(async()=>{await m()});const V={t:x,router:e,route:b,loading:A,testTemplateId:p,testTemplate:c,isDataValid:_,getTestTemplate:m,formRef:M,formState:t,rules:w,componentMap:C,createQuestionTemplate:k,onAddQuestion:L,onRemoveQuestion:G,onFinish:P,showModalConfirmation:D,importModalRef:R,onOpenImportModal:B,generateModalRef:O,openGenerateAIModal:N,onModalImport:F,handleBeforeUnload:U,Input:re,TextArea:se,ImportQSModal:pe,GenerateQSModal:me};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),ge={class:"page-container"},_e={class:"title-container"},he={class:"content"},ve={class:"content-item"},Ie={class:"content-item-title"},Qe={class:"d-flex"},Se={class:"content-item"},we={class:"content-item-title"},qe={class:"content-item-buttons"},Te={class:"import-button"},be={key:0},Me={key:1,class:"list-question-container"};function Ue(d,i,x,e,b,A){const p=Q("RouterLink"),c=Q("a-col"),_=Q("a-row"),m=Q("a-skeleton"),M=Q("a-form");return v(),S(z,null,[o("div",ge,[o("div",_e,[l(_,{class:"w-100 d-flex align-items-center"},{default:g(()=>[l(c,{span:1},{default:g(()=>[l(p,{to:{name:"User_Library"}},{default:g(()=>i[3]||(i[3]=[o("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[3]})]),_:1}),l(c,{class:"main-title",span:23},{default:g(()=>[o("span",null,u(d.$t("create_QS.title")),1),i[4]||(i[4]=q()),i[5]||(i[5]=o("br",null,null,-1)),o("span",null,u(d.$t("create_QS.sub_title")),1)]),_:1,__:[4,5]})]),_:1})]),o("div",he,[l(M,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":i[2]||(i[2]=t=>e.formState=t),rules:e.rules,ref:"formRef"},{default:g(()=>[o("div",ve,[o("div",Ie,[o("div",null,[o("span",null,u(d.$t("create_QS.quiz.question_detail_title")),1),o("span",null,u(d.$t("create_QS.quiz.question_detail_sub_title")),1)])]),l(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":i[0]||(i[0]=t=>e.formState.name=t),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),o("div",Qe,[l(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":i[1]||(i[1]=t=>e.formState.description=t),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"])])]),o("div",Se,[o("div",we,[o("div",null,[o("span",null,u(d.$t("create_QS.quiz.question_question_title")),1),o("span",null,u(d.$t("create_QS.quiz.question_question_sub_title")),1)]),o("div",qe,[l(p,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:g(()=>[q(u(d.$t("create_QS.buttons.import"))+" ",1),i[6]||(i[6]=o("i",{class:"bx bx-download"},null,-1))]),_:1,__:[6]}),l(p,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:g(()=>[q(u(d.$t("create_QS.buttons.generated_by_ai"))+" ",1),i[7]||(i[7]=o("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[7]}),o("div",{class:"import-button",onClick:e.onFinish},u(d.$t("create_QS.buttons.create")),1),o("div",Te,u(d.$t("create_QS.quiz.total",{number:e.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1)])]),e.loading?(v(),S("div",be,[l(m,{loading:e.loading,active:""},null,8,["loading"]),l(m,{loading:e.loading,active:""},null,8,["loading"]),l(m,{loading:e.loading,active:""},null,8,["loading"]),l(m,{loading:e.loading,active:""},null,8,["loading"]),l(m,{loading:e.loading,active:""},null,8,["loading"])])):(v(),S("div",Me,[(v(!0),S(z,null,te(e.formState.createUpdateQuestions,(t,w)=>(v(),S("div",{key:t.id},[(v(),ne(oe(e.componentMap[t.type]),{question:t,index:w+1,displayScore:!0,onDeleteQuestion:C=>e.onRemoveQuestion(w)},null,40,["question","index","onDeleteQuestion"]))]))),128)),o("div",{class:"add-question-btn",onClick:e.onAddQuestion},[i[8]||(i[8]=o("i",{class:"bx bx-plus"},null,-1)),q(" "+u(d.$t("create_QS.buttons.add_question")),1)])]))])]),_:1},8,["modelValue"])])]),l(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,onImport:e.onModalImport},null,8,["title"]),l(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport},null,8,["title"])],64)}const Le=ee(fe,[["render",Ue],["__scopeId","data-v-48787c2a"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test_template/update.vue"]]);export{Le as default};

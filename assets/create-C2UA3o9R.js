import{d as J,u as K,l as Z,i as q,j as $,a2 as ee,s as te,a3 as ne,k as p,G as Q,M as z,_ as oe,r as y,c as O,o as I,b as o,a as c,w as f,f as T,t as g,F as L,D as ae,E as G,R as se}from"./index-CuKhGwID.js";import{A as ie}from"./ApiQuestionSet-BQFtHQod.js";import{I as le}from"./Input-rLMv5Unx.js";import{T as re}from"./vue-draggable-plus-34Ou4kzX.js";import{C as k,S as ue,O as me,M as de,a as ce,s as ge,b as fe}from"./vue-virtual-scroller.esm-DlJrQeYo.js";import{G as _e,I as pe}from"./GenerateQSModal-yMQ-jBDd.js";import{Q as w}from"./questionTypes-CS3lcRlq.js";/* empty css                                                              *//* empty css                                                                 */import"./ApiTestTemplate-DhEjMX_C.js";import"./languages-DtYW231W.js";const he=J({__name:"create",setup(m,{expose:l}){l();const{t:a}=K(),e=Z(),x=q(!0),V=q(),n=$({name:"",description:"",tags:[],questions:[]}),C={title:[{required:"true",message:a("message.required"),trigger:"change"},{length:100,message:a("message.out_of_range",{max_length:100}),trigger:"change"}],description:[{length:200,message:a("message.out_of_range",{max_length:200}),trigger:"change"}],tags:[{validator:(t,s)=>s&&s.length>5?Promise.reject(a("message.maximum_tag.out_of_range",{tag:5})):Promise.resolve(),trigger:"change"}],questions:[{validator:(t,s)=>s&&s.length>500?Promise.reject(a("message.maximum_tag.limit_question",{number:500})):Promise.resolve(),trigger:"change"}]},A={MultipleChoice:ce,Matching:de,Ordering:me,ShortText:ue},h=q(""),r=()=>{if(n.tags.length>=5){p.warning(a("maximum_tag.out_of_range",{tag:5}));return}h.value&&h.value.trim().length<=50?(n.tags.push(h.value),h.value=""):p.warning(a("maximum_tag.invalid_tag_content"))},b=t=>{n.tags.splice(t,1)},_=()=>({id:"new_"+Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:k.defaultMultipleChoices(),matchingPairs:k.defaultMatchingPairs(),orderingItems:k.defaultOrderingItems(),shortAnswer:""}),F=t=>{k.onChangeQuestionType(t)},B=async()=>{if(n.questions.length>=500){p.warning(a("message.limit_question",{number:500}));return}n.questions=[...n.questions,_()],Q(()=>{var t,s;(s=(t=v.value)==null?void 0:t.forceUpdate)==null||s.call(t),Q(()=>{const d=n.questions.length;requestAnimationFrame(()=>{var S;(S=v.value)==null||S.scrollToItem(d)})})})},H=t=>{if(n.questions.length<=1){p.warning(a("message.minimum_question",{number:1}));return}n.questions=[...n.questions.slice(0,t),...n.questions.slice(t+1)]},N=()=>{let t=!1,s=a("message.invalid_question"),d=new Set;if(n.name.trim().length>100||n.name.trim().length===0){t=!0,s=a("message.invalid_title"),p.error(s);return}if(n.description.trim().length>250){t=!0,s=a("message.invalid_description"),p.error(s);return}[n.questions.filter(i=>{const u=i.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return u.length===0||u.length>=5e3}),n.questions.filter(i=>(i.explainText?i.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=5e3),n.questions.filter(i=>i.type===w.MULTIPLE_CHOICE&&(i.multipleChoices.some(u=>u.text.trim().length===0||u.text.trim().length>1e3)||i.multipleChoices.filter(u=>u.isAnswer).length===0||i.multipleChoices.length<2)),n.questions.filter(i=>i.type===w.MATCHING&&(i.matchingPairs.some(u=>u.leftItem.trim().length===0||u.leftItem.trim().length>1e3)||i.matchingPairs.some(u=>u.rightItem.trim().length===0||u.rightItem.trim().length>1e3)||i.matchingPairs.length<2)),n.questions.filter(i=>i.type===w.ORDERING&&(i.orderingItems.some(u=>u.text.trim().length===0||u.text.trim().length>1e3)||i.orderingItems.length<2)),n.questions.filter(i=>i.type===w.SHORT_TEXT&&(i.shortAnswer.trim().length===0||i.shortAnswer.trim().length>1e3))].forEach(i=>{i.length>0&&(t=!0,i.forEach(u=>d.add(u)))});let M=Array.from(d).map(i=>n.questions.indexOf(i)+1);t?z.error({title:a("create_QS.modal.invalid.title"),content:a("create_QS.modal.invalid.content")+M.sort().join(", "),okText:a("sidebar.buttons.ok"),cancelText:a("sidebar.buttons.cancel")}):D()},D=()=>{z.confirm({title:a("create_QS.modal.valid.title"),content:a("create_QS.modal.valid.content"),centered:!0,okText:a("sidebar.buttons.ok"),cancelText:a("sidebar.buttons.cancel"),onOk:async()=>{n.questions=n.questions.map(s=>s.id.startsWith("new_")?{...s,questionId:null}:s);let t=await ie.Create(n);t.data.success&&(p.success(a("message.created_successfully")),x.value=!1,e.push({name:"User_QuestionSet_Detail",params:{id:t.data.data}}))}})},U=q(null),j=()=>{var t;(t=U.value)==null||t.openImportModal()},E=q(null),W=()=>{var t;(t=E.value)==null||t.openGenerateAIModal()},X=t=>{t.length!==0&&(n.questions.unshift(...t.map((s,d)=>({...s,id:`new_${n.questions.length+d}`}))),Q(()=>{var s,d;(d=(s=v.value)==null?void 0:s.forceUpdate)==null||d.call(s),Q(()=>{const S=n.questions.length;requestAnimationFrame(()=>{var M;(M=v.value)==null||M.scrollToItem(S)})})}),p.success(`${a("message.imported_question",{number:t.length})}`))};ee((t,s,d)=>{if(!x.value){d();return}z.confirm({title:a("create_QS.modal.leave.title"),content:a("create_QS.modal.leave.content"),okText:a("sidebar.buttons.ok"),cancelText:a("sidebar.buttons.cancel"),onOk:()=>{d()},onCancel:()=>d(!1)})});function R(t){t.preventDefault(),t.returnValue=""}const v=q(null),Y=()=>{Q(()=>{var t,s;(s=(t=v.value)==null?void 0:t.forceUpdate)==null||s.call(t)})};te(()=>{n.questions.push(_()),window.addEventListener("beforeunload",R)}),ne(()=>{window.removeEventListener("beforeunload",R)});const P={t:a,router:e,isDataValid:x,formRef:V,formState:n,rules:C,componentMap:A,tagContent:h,addTag:r,removeTag:b,createQuestionTemplate:_,onHandleChangeQuestionType:F,onAddQuestion:B,onRemoveQuestion:H,onFinish:N,showModalConfirmation:D,importModalRef:U,onOpenImportModal:j,generateModalRef:E,openGenerateAIModal:W,onModalImport:X,handleBeforeUnload:R,scrollerRef:v,handleScroll:Y,Input:le,TextArea:re,ImportQSModal:pe,GenerateQSModal:_e,get DynamicScroller(){return fe},get DynamicScrollerItem(){return ge}};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}}),be={class:"page-container"},ve={class:"title-container"},qe={class:"content"},Se={class:"content-item"},Qe={class:"content-item-title"},Ie={class:"d-flex"},Te={class:"form-item"},xe={class:"tag-container"},Ce=["onClick"],Me={class:"tag-inputter"},ye={class:"content-item"},ke={class:"content-item-title"},we={class:"content-item-buttons"},Ae={class:"import-button"};function Re(m,l,a,e,x,V){const n=y("RouterLink"),C=y("a-col"),A=y("a-row"),h=y("a-form");return I(),O(L,null,[o("div",be,[o("div",ve,[c(A,{class:"w-100 d-flex align-items-center"},{default:f(()=>[c(C,{span:1},{default:f(()=>[c(n,{to:{name:"User_Library"}},{default:f(()=>l[4]||(l[4]=[o("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[4]})]),_:1}),c(C,{class:"main-title",span:23},{default:f(()=>[o("span",null,g(m.$t("create_QS.title")),1),l[5]||(l[5]=T()),l[6]||(l[6]=o("br",null,null,-1)),o("span",null,g(m.$t("create_QS.sub_title")),1)]),_:1,__:[5,6]})]),_:1})]),o("div",qe,[c(h,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":l[3]||(l[3]=r=>e.formState=r),rules:e.rules,ref:"formRef"},{default:f(()=>[o("div",Se,[o("div",Qe,[o("div",null,[o("span",null,g(m.$t("create_QS.quiz.question_detail_title")),1),o("span",null,g(m.$t("create_QS.quiz.question_detail_sub_title")),1)])]),c(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":l[0]||(l[0]=r=>e.formState.name=r),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),o("div",Ie,[c(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":l[1]||(l[1]=r=>e.formState.description=r),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"]),o("div",Te,[o("label",null,g(m.$t("create_QS.quiz.tag")),1),o("div",xe,[(I(!0),O(L,null,ae(e.formState.tags,(r,b)=>(I(),O("div",{class:"tag-item",key:b},[T(g(r)+" ",1),o("i",{class:"bx bx-x",onClick:_=>e.removeTag(b)},null,8,Ce)]))),128))]),o("div",Me,[c(e.Input,{modelValue:e.tagContent,"onUpdate:modelValue":l[2]||(l[2]=r=>e.tagContent=r),placeholder:e.t("question_sets_index.search_placeholder"),"max-length":50},{icon:f(()=>l[7]||(l[7]=[o("i",{class:"bx bx-purchase-tag-alt"},null,-1)])),_:1},8,["modelValue","placeholder"]),o("i",{class:"bx bx-plus tag-inputter-button",onClick:e.addTag})])])])]),o("div",ye,[o("div",ke,[o("div",null,[o("span",null,g(m.$t("create_QS.quiz.question_question_title")),1),o("span",null,g(m.$t("create_QS.quiz.question_question_sub_title")),1)]),o("div",we,[c(n,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:f(()=>[T(g(m.$t("create_QS.buttons.import"))+" ",1),l[8]||(l[8]=o("i",{class:"bx bx-download"},null,-1))]),_:1,__:[8]}),c(n,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:f(()=>[T(g(m.$t("create_QS.buttons.generated_by_ai"))+" ",1),l[9]||(l[9]=o("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[9]}),o("div",{class:"import-button",onClick:e.onFinish},g(m.$t("create_QS.buttons.create")),1),o("div",Ae,g(m.$t("create_QS.quiz.total",{number:e.formState.questions.length.toString().padStart(3,"0")})),1)])]),c(e.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.questions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:f(({item:r,index:b})=>[(I(),G(e.DynamicScrollerItem,{item:r,key:r.id},{default:f(()=>[(I(),G(se(e.componentMap[r.type]),{question:r,index:e.formState.questions.findIndex(_=>_.id===r.id)+1,displayScore:!1,key:r.id,onDeleteQuestion:_=>e.onRemoveQuestion(b),onChangeQuestionType:_=>e.onHandleChangeQuestionType(r)},null,40,["question","index","onDeleteQuestion","onChangeQuestionType"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),o("div",{class:"add-question-btn",onClick:e.onAddQuestion},[l[10]||(l[10]=o("i",{class:"bx bx-plus"},null,-1)),T(" "+g(m.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),c(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,numberOfQuestion:e.formState.questions.length,onImport:e.onModalImport},null,8,["title","numberOfQuestion"]),c(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport,numberOfQuestion:e.formState.questions.length},null,8,["title","numberOfQuestion"])],64)}const He=oe(he,[["render",Re],["__scopeId","data-v-b7d6bbaa"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/question_sets/create.vue"]]);export{He as default};

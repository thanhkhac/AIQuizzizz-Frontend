import{d as Ie,R as j,u as be,q as Te,l as Ae,i as d,B as U,a2 as ye,s as qe,k as O,M as Ce,G as Se,_ as Qe,r as M,a as m,o as u,b as i,c as h,w as I,f as R,t as v,E as ee,F as z,D as P,p as _,e as X}from"./index-DjZzqq9v.js";import{A as ie}from"./ApiTest-34xsPgDX.js";import{Q as A}from"./questionTypes-CS3lcRlq.js";import{H as ke,Q as Oe}from"./questionTextFormat-DSvzm1e7.js";import{T as Me}from"./TextArea-Ch3F-Nss.js";import{l as De}from"./vue-draggable-plus-CztiUgzx.js";import{V as Ee}from"./Validator-CWeiTIFe.js";import{u as Ue}from"./utc-CFLmNoz-.js";/* empty css                                                                 */function Re(T=[],o=[]){const s=[];for(let e=0;e<T.length;e++)s.push({leftId:T[e].id,rightId:o[e].id});return s}class Le{transferToUserAnswerSubmit(o){return console.log(o),o.map(s=>{var e;return{questionId:s.questionId,userAnswerData:{type:s.type,multipleChoice:s.multipleChoices??[],matching:Re(s.matchingLeft??[],s.matchingRight??[]),ordering:((e=s.ordering)==null?void 0:e.map((x,g)=>({itemId:x.id,order:g})))??[],shortText:s.shortText??""}}})}transferFromUserAnswerSubmit(o){return o.filter(s=>s.userAnswerData!=null).map(s=>{var e,x,g;return{questionId:s.questionId,type:s.userAnswerData.type,multipleChoices:s.userAnswerData.multipleChoice??[],matchingLeft:(e=s.userAnswerData.matching)!=null&&e.length?s.userAnswerData.matching.map(c=>({id:c.leftId})):[],matchingRight:(x=s.userAnswerData.matching)!=null&&x.length?s.userAnswerData.matching.map(c=>({id:c.rightId})):[],ordering:(g=s.userAnswerData.ordering)!=null&&g.length?s.userAnswerData.ordering.map(c=>({id:c.itemId})):[],shortText:s.userAnswerData.shortText??""}})}}const ae=new Le,He=Ie({__name:"attempt",setup(T,{expose:o}){o(),j.extend(Ue);const{t:s}=be(),e=Te(),x=Ae(),g=d([]),c=d([]),a=d({id:"",explainText:"",questionSetId:"",questionText:"",score:0,scoreGraded:0,textFormat:"0",type:"MultipleChoice",correctMultipleChoiceCount:0,questionData:{matching:null,multipleChoice:null,ordering:null,shortText:""}}),C=d(""),S=d(!1),L=d(!1),D=d([]),H=d([]),r=d([]),f=d([]),Q=d(""),J=d(!0),K=d(e.params.id.toString()),b=d({attemptId:"",name:"",questionCount:0,timeStart:"",timeEnd:"",timeLimit:0,timeRemaining:0,questions:[]}),W=d(!1),te=async()=>{try{if(W.value=!0,!Ee.isValidGuid(K.value)){J.value=!1,x.push({name:"404"});return}const t=await ie.Attempt(K.value);if(b.value=t.data.data,b.value.timeRemaining<=0){O.error(s("message.time_up")),x.push({name:"User_Class"});return}g.value=[...t.data.data.questions.map(n=>({id:n.questionId,...n}))],c.value=ae.transferFromUserAnswerSubmit(t.data.data.questions.map(n=>({questionId:n.id,userAnswerData:n.userAnswerDataDto}))),a.value=g.value[0]}catch(t){if(console.log(t),!t.response.data.success){J.value=!1,x.push({name:"404"});return}}finally{W.value=!1}},N=(t,n)=>{t===-1?c.value.push(n):c.value[t]=n},re=()=>{const t=c.value.findIndex(n=>n.questionId===a.value.id);switch(a.value.type){case A.MULTIPLE_CHOICE:{D.value.length>0?N(t,{questionId:a.value.id,type:a.value.type,multipleChoices:[...D.value],matchingLeft:null,matchingRight:null,ordering:null,shortText:""}):t!==-1&&c.value.splice(t,1);break}case A.MATCHING:{N(t,{questionId:a.value.id,type:a.value.type,multipleChoices:null,matchingLeft:[...H.value],matchingRight:[...r.value],ordering:null,shortText:""});break}case A.ORDERING:{N(t,{questionId:a.value.id,type:a.value.type,multipleChoices:null,matchingLeft:null,matchingRight:null,ordering:[...f.value],shortText:""});break}case A.SHORT_TEXT:{Q.value.trim()?N(t,{questionId:a.value.id,type:a.value.type,multipleChoices:null,matchingLeft:null,matchingRight:null,ordering:null,shortText:Q.value.trim()}):t!==-1&&c.value.splice(t,1);break}}},G=async t=>{const n=ae.transferToUserAnswerSubmit(c.value);return(await ie.Submit({attemptId:b.value.attemptId,userAnswers:n,isSubmit:t})).data.success},le=()=>{Ce.confirm({title:s("attempt_test.submit_modal.title"),content:s("attempt_test.submit_modal.content"),centered:!0,okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),onOk:async()=>{if(!await G(!0)){O.error(s("message.submited_failed"));return}O.info(s("message.submited_successfully")),x.push({name:"User_Class"})}})},Y=t=>{var E;B(),S.value=!1,a.value=g.value[t];const n=c.value.find(l=>l.questionId===a.value.id);switch(a.value.type){case A.MULTIPLE_CHOICE:{C.value=s("learn_QS.instructions.multiple_choice",{number:a.value.correctMultipleChoiceCount}),D.value=n?n==null?void 0:n.multipleChoices:[];break}case A.ORDERING:{C.value=s("learn_QS.instructions.ordering"),f.value=n?n==null?void 0:n.ordering.map(l=>{var p,w;return{id:l.id,text:(w=(p=a.value.questionData.ordering)==null?void 0:p.find(q=>q.id===l.id))==null?void 0:w.text}}):((E=a.value.questionData.ordering)==null?void 0:E.map(l=>l))||[];break}case A.MATCHING:{C.value=s("learn_QS.instructions.matching"),H.value=n?n==null?void 0:n.matchingLeft.map(l=>{var p,w;return{id:l.id,text:(w=(p=a.value.questionData.matching)==null?void 0:p.leftItems.find(q=>q.id===l.id))==null?void 0:w.text}}):a.value.questionData.matching.leftItems.map(l=>l)||[],r.value=n?n==null?void 0:n.matchingRight.map(l=>{var p,w;return{id:l.id,text:(w=(p=a.value.questionData.matching)==null?void 0:p.rightItems.find(q=>q.id===l.id))==null?void 0:w.text}}):a.value.questionData.matching.rightItems.map(l=>l)||{};break}case A.SHORT_TEXT:{C.value=s("learn_QS.instructions.short_text"),Q.value=n?n==null?void 0:n.shortText:"";break}}},ue=()=>{const t=g.value.findIndex(n=>n.id===a.value.id);t<g.value.length-1&&Y(t+1)},ce=()=>{const t=g.value.findIndex(n=>n.id===a.value.id);t>0&&Y(t-1)},de=t=>Array.from(c.value).some(n=>n.questionId===t),me=U(()=>{const t=g.value.findIndex(n=>n.id===a.value.id);return t!==-1&&t<g.value.length-1}),ge=U(()=>{const t=g.value.findIndex(n=>n.id===a.value.id);return t!==-1&&t>0}),he=U(()=>g.value.findIndex(t=>t.id===a.value.id)),ve={scroll:!0,scrollSensitivity:100,scrollSpeed:100,scrollTarget:document.scrollingElement};function B(){Se(()=>{requestAnimationFrame(()=>{const t=document.querySelectorAll(".matching-option-container.left .answer-option-matching"),n=document.querySelectorAll(".matching-option-container.right .answer-option-matching"),E=Math.min(t.length,n.length);for(let l=0;l<E;l++){const p=t[l],w=n[l];if(!p||!w)continue;p.style.height="auto",w.style.height="auto";const q=Math.max(p.offsetHeight,w.offsetHeight);p.style.height=`${q}px`,w.style.height=`${q}px`}})})}const _e=U(()=>{var t;return(t=a.value.questionData.multipleChoice)==null?void 0:t.some(n=>n.text.length>=100)}),Z=d(j().add(b.value.timeRemaining*60,"second")),V=d(b.value.timeRemaining*60);let y=null;const fe=U(()=>{const t=Math.floor(V.value/60).toString().padStart(2,"0"),n=(V.value%60).toString().padStart(2,"0");return`${t}:${n}`}),$=async()=>{const t=Z.value.diff(j(),"second");if(V.value=t>0?t:0,t<=0&&y){if(clearInterval(y),y=null,!await G(!0)){O.error(s("message.submited_failed"));return}O.info(s("message.time_up")),x.push({name:"User_Class"})}};let F=null;const ne=async()=>{if(!await G(!1)){O.error(s("message.auto_save_failed"));return}O.info(s("message.auto_save_successfully"))},k=d(new Set),pe=()=>{const t=a.value.id;k.value.delete(t)||k.value.add(t),localStorage.setItem("flagged_question",JSON.stringify({attemptId:b.value.attemptId,questions:Array.from(k.value)}))},se=()=>{const t=localStorage.getItem("flagged_question");if(!t)return;const n=JSON.parse(t);if(n.attemptId!=b.value.attemptId){localStorage.removeItem("flagged_question");return}if(!Array.isArray(n.questions)){localStorage.removeItem("flagged_question");return}k.value=new Set(n.questions)},we=t=>Array.from(k.value).some(n=>n===t),xe=U(()=>{const t=a.value.id;return Array.from(k.value).some(n=>n===t)});ye(()=>{y&&clearInterval(y),F&&clearInterval(F)}),qe(async()=>{B(),window.addEventListener("resize",B),await te(),V.value=b.value.timeRemaining*60,Z.value=j().add(b.value.timeRemaining*60,"second"),Y(0),se(),$(),y=setInterval($,1e3),F=setInterval(ne,3e4)});const oe={t:s,route:e,router:x,quiz:g,userAnswer:c,currentQuestion:a,currentQuestionInstruction:C,currentQuestionIsSkipped:S,isSubmitted:L,userAnswerMultipleChoice:D,userAnswerMatchingLeft:H,userAnswerMatchingRight:r,userAnswerOrdering:f,userAnswerShortText:Q,isDataValid:J,testId:K,attemptData:b,loading:W,getAttemptData:te,updateUserAnswer:N,onUserAnswerChange:re,sendUserAnswer:G,onSubmit:le,onLoadCurrentQuestion:Y,onNextQuestion:ue,onPreviousQuestion:ce,userAnswerContainQuestion:de,hasNextQuestion:me,hasPreviousQuestion:ge,currentQuestionIndex:he,dragOptions:ve,syncMatchingHeights:B,isOptionExceed:_e,endTime:Z,remainingTime:V,get timer(){return y},set timer(t){y=t},formattedTime:fe,updateCountdown:$,get autoSaver(){return F},set autoSaver(t){F=t},autoSave:ne,flaggedQuestion:k,onToggleFlagQuestion:pe,onLoadFlaggedQuestion:se,flagContainQuestion:we,isCurrentQuestionFlagged:xe,get QUESTION_TYPE(){return A},get QUESTION_FORMAT(){return Oe},TextArea:Me,get VueDraggable(){return De},get HolderOutlined(){return ke}};return Object.defineProperty(oe,"__isScriptSetup",{enumerable:!1,value:!0}),oe}}),Ne={class:"page-container"},Ve={class:"title-container title-container-header"},Fe={class:"content content-test d-flex flex-column"},ze={class:"d-flex"},Pe={class:"content-item question-navigators"},Ge={class:"question-navigator-title d-flex justify-content-between align-items-center"},Ye={class:"countdown d-flex align-items-center"},Be={key:1,class:"question-navigator-container"},je=["onClick"],Xe={class:"content-item"},Je={key:0},Ke={key:1,class:"section question-section"},We={class:"question-info-index"},Ze=["innerHTML"],$e={key:1,class:_(["learn-question"])},et={class:"section answer-section"},tt={class:"d-flex align-items-center"},nt={class:"answer-section-ins"},st={class:"answer-option-content"},ot={key:1,class:"answer-option-container matching"},it={class:"matching-option-container left"},at={class:"d-flex align-items-center"},rt={class:_(["answer-option answer-option-matching"])},lt={class:"answer-option-order"},ut={class:"answer-option-content"},ct={class:"matching-option-container right"},dt={class:"d-flex align-items-center"},mt={class:_(["answer-option answer-option-matching"])},gt={class:"answer-option-content"},ht={class:"answer-option-order"},vt={key:2,class:"answer-option-container ordering"},_t={class:_(["answer-option answer-option-ordering"])},ft={class:"answer-option-order"},pt={class:"answer-option-content"},wt={key:3,class:"answer-option-container"},xt={class:_(["answer-short-text"])},It={class:"w-100 d-flex align-items-center"},bt={class:"learn-question-footer"},Tt={class:"d-flex"};function At(T,o,s,e,x,g){const c=M("RouterLink"),a=M("a-col"),C=M("a-row"),S=M("a-skeleton"),L=M("a-button"),D=M("a-checkbox"),H=M("a-checkbox-group");return u(),m("div",Ne,[i("div",Ve,[h(C,{class:"w-100 d-flex align-items-center"},{default:I(()=>[h(a,{span:1},{default:I(()=>[h(c,{to:{name:"User_Class"}},{default:I(()=>o[7]||(o[7]=[i("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[7]})]),_:1}),h(a,{class:"main-title",span:22},{default:I(()=>{var r,f;return[i("span",null,v((r=e.attemptData)==null?void 0:r.name),1),o[8]||(o[8]=R()),o[9]||(o[9]=i("br",null,null,-1)),i("span",null,v((f=e.attemptData)==null?void 0:f.questionCount),1)]}),_:1,__:[8,9]})]),_:1})]),i("div",Fe,[i("div",ze,[i("div",Pe,[i("div",Ge,[i("span",null,v(e.t("practice_test.other.question_list")),1),i("span",Ye,[o[10]||(o[10]=i("i",{class:"bx bx-timer"},null,-1)),R(" "+v(e.formattedTime),1)])]),e.loading?(u(),ee(S,{key:0,loading:e.loading},null,8,["loading"])):(u(),m("div",Be,[(u(!0),m(z,null,P(e.quiz,(r,f)=>(u(),m("div",{class:_(["question-navigation-item-outer",e.currentQuestion.id===r.id?"current-question":"",e.flagContainQuestion(r.id)?"flagged-question":""]),onClick:Q=>e.onLoadCurrentQuestion(f)},[i("div",{class:_(["question-navigator-item",e.userAnswerContainQuestion(r.id)?"completed-question":""])},[i("span",null,v(f+1),1)],2)],10,je))),256))])),h(L,{type:"primary",class:_(["main-color-btn",e.isSubmitted?"main-color-btn-disabled":""]),onClick:e.onSubmit},{default:I(()=>[R(v(T.$t("learn_QS.buttons.submit")),1)]),_:1},8,["class"])])]),i("div",Xe,[e.loading?(u(),m("div",Je,[h(S,{loading:e.loading},null,8,["loading"]),h(S,{loading:e.loading},null,8,["loading"]),h(S,{loading:e.loading},null,8,["loading"])])):(u(),m("div",Ke,[i("div",We,v(T.$t("create_QS.question.question"))+" "+v(e.currentQuestionIndex+1),1),e.currentQuestion.textFormat===e.QUESTION_FORMAT.HTML?(u(),m("div",{key:0,class:_(["learn-question"]),innerHTML:e.currentQuestion.questionText},null,8,Ze)):(u(),m("div",$e,v(e.currentQuestion.questionText),1)),i("div",et,[i("div",tt,[i("div",nt,v(e.currentQuestionInstruction),1)]),e.currentQuestion.type===e.QUESTION_TYPE.MULTIPLE_CHOICE?(u(),ee(H,{key:0,onChange:e.onUserAnswerChange,value:e.userAnswerMultipleChoice,"onUpdate:value":o[0]||(o[0]=r=>e.userAnswerMultipleChoice=r),class:_(["answer-option-container multiplechoice",e.isOptionExceed?"column":""])},{default:I(()=>[(u(!0),m(z,null,P(e.currentQuestion.questionData.multipleChoice,(r,f)=>(u(),ee(D,{value:r.id,"onUpdate:value":Q=>r.id=Q,class:_(["answer-option answer-option-multiplechoice"])},{default:I(()=>[i("div",st,v(r.text),1)]),_:2},1032,["value","onUpdate:value"]))),256))]),_:1},8,["value","class"])):X("v-if",!0),e.currentQuestion.type===e.QUESTION_TYPE.MATCHING?(u(),m("div",ot,[i("div",it,[h(e.VueDraggable,{modelValue:e.userAnswerMatchingLeft,"onUpdate:modelValue":o[1]||(o[1]=r=>e.userAnswerMatchingLeft=r),options:e.dragOptions,onMove:e.syncMatchingHeights,onEnd:o[2]||(o[2]=()=>{e.syncMatchingHeights(),e.onUserAnswerChange()})},{default:I(()=>[(u(!0),m(z,null,P(e.userAnswerMatchingLeft,(r,f)=>(u(),m("div",at,[i("div",rt,[i("div",lt,[h(e.HolderOutlined)]),i("div",ut,v(r.text),1)]),o[11]||(o[11]=i("i",{class:_(["bx bxs-label matching-icon"])},null,-1))]))),256))]),_:1},8,["modelValue"])]),i("div",ct,[h(e.VueDraggable,{modelValue:e.userAnswerMatchingRight,"onUpdate:modelValue":o[3]||(o[3]=r=>e.userAnswerMatchingRight=r),options:e.dragOptions,onMove:e.syncMatchingHeights,onEnd:o[4]||(o[4]=()=>{e.syncMatchingHeights(),e.onUserAnswerChange()})},{default:I(()=>[(u(!0),m(z,null,P(e.userAnswerMatchingRight,(r,f)=>(u(),m("div",dt,[o[12]||(o[12]=i("i",{class:_(["bx bxs-label matching-icon"])},null,-1)),i("div",mt,[i("div",gt,v(r.text),1),i("div",ht,[h(e.HolderOutlined)])])]))),256))]),_:1},8,["modelValue"])])])):X("v-if",!0),e.currentQuestion.type===e.QUESTION_TYPE.ORDERING?(u(),m("div",vt,[h(e.VueDraggable,{modelValue:e.userAnswerOrdering,"onUpdate:modelValue":o[5]||(o[5]=r=>e.userAnswerOrdering=r),options:e.dragOptions,onEnd:e.onUserAnswerChange},{default:I(()=>[(u(!0),m(z,null,P(e.userAnswerOrdering,(r,f)=>(u(),m("div",_t,[i("div",ft,[h(e.HolderOutlined),R(" "+v(f+1),1)]),i("div",pt,v(r.text),1)]))),256))]),_:1},8,["modelValue"])])):X("v-if",!0),e.currentQuestion.type===e.QUESTION_TYPE.SHORT_TEXT?(u(),m("div",wt,[i("div",xt,[i("div",It,[h(e.TextArea,{placeholder:"Enter your answer...",modelValue:e.userAnswerShortText,"onUpdate:modelValue":o[6]||(o[6]=r=>e.userAnswerShortText=r),onChange:e.onUserAnswerChange},null,8,["modelValue"])])])])):X("v-if",!0)]),i("div",bt,[h(L,{class:_(["main-color-btn",e.hasPreviousQuestion?"":"main-color-btn-disabled"]),type:"primary",size:"large",onClick:e.onPreviousQuestion},{default:I(()=>[o[13]||(o[13]=i("i",{class:"bx bx-chevron-left"},null,-1)),R(" "+v(T.$t("practice_test.buttons.previous")),1)]),_:1,__:[13]},8,["class"]),i("i",{class:_(["bx bx-flag flag-button",e.isCurrentQuestionFlagged?"bxs-flag":""]),onClick:e.onToggleFlagQuestion},null,2),i("div",Tt,[h(L,{class:_(["main-color-btn",e.hasNextQuestion?"":"main-color-btn-disabled"]),type:"primary",size:"large",onClick:e.onNextQuestion},{default:I(()=>[R(v(T.$t("learn_QS.buttons.next_question"))+" ",1),o[14]||(o[14]=i("i",{class:"bx bx-chevron-right"},null,-1))]),_:1,__:[14]},8,["class"])])])]))])])])}const Et=Qe(He,[["render",At],["__scopeId","data-v-b60278b8"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test/attempt.vue"]]);export{Et as default};

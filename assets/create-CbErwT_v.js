import{d as K,u as W,l as Z,i as q,j as $,a2 as ee,s as te,a3 as ne,k as p,G as Q,M as z,_ as oe,r as y,a as O,o as I,b as n,c,w as f,f as T,t as g,F as L,D as ae,E as G,R as se}from"./index-BZibwNZh.js";import{A as ie}from"./ApiQuestionSet-QOKMM8LS.js";import{I as le}from"./Input-CsLykV0d.js";import{T as re}from"./vue-draggable-plus-BCmoIhah.js";import{C as k,S as ue,O as me,M as de,a as ce,s as ge,b as fe}from"./vue-virtual-scroller.esm-DJaX44gq.js";import{G as _e,I as pe}from"./GenerateQSModal-DHCYSLJp.js";import{Q as w}from"./questionTypes-CS3lcRlq.js";/* empty css                                                                 */import"./ApiTestTemplate-DYdJBRMM.js";import"./languages-DtYW231W.js";const he=K({__name:"create",setup(m,{expose:s}){s();const{t:a}=W(),e=Z(),x=q(!0),V=q(),o=$({name:"",description:"",tags:[],questions:[]}),C={title:[{required:"true",message:a("message.required"),trigger:"change"},{length:100,message:a("message.out_of_range",{max_length:100}),trigger:"change"}],description:[{length:200,message:a("message.out_of_range",{max_length:200}),trigger:"change"}],tags:[{validator:(t,i)=>i&&i.length>5?Promise.reject(a("message.maximum_tag.out_of_range",{tag:5})):Promise.resolve(),trigger:"change"}],questions:[{validator:(t,i)=>i&&i.length>500?Promise.reject(a("message.maximum_tag.limit_question",{number:500})):Promise.resolve(),trigger:"change"}]},A={MultipleChoice:ce,Matching:de,Ordering:me,ShortText:ue},h=q(""),r=()=>{if(o.tags.length>=5){p.warning(a("maximum_tag.out_of_range",{tag:5}));return}h.value&&h.value.trim().length<=50?(o.tags.push(h.value),h.value=""):p.warning(a("maximum_tag.invalid_tag_content"))},b=t=>{o.tags.splice(t,1)},_=()=>({id:Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:k.defaultMultipleChoices(),matchingPairs:k.defaultMatchingPairs(),orderingItems:k.defaultOrderingItems(),shortAnswer:""}),F=t=>{k.onChangeQuestionType(t)},B=async()=>{if(o.questions.length>=500){p.warning(a("message.limit_question",{number:500}));return}o.questions=[...o.questions,_()],Q(()=>{var t,i;(i=(t=v.value)==null?void 0:t.forceUpdate)==null||i.call(t),Q(()=>{const d=o.questions.length;requestAnimationFrame(()=>{var S;(S=v.value)==null||S.scrollToItem(d)})})})},H=t=>{if(o.questions.length<=1){p.warning(a("message.minimum_question",{number:1}));return}o.questions=[...o.questions.slice(0,t),...o.questions.slice(t+1)]},N=()=>{let t=!1,i=a("message.invalid_question"),d=new Set;if(o.name.trim().length>100||o.name.trim().length===0){t=!0,i=a("message.invalid_title"),p.error(i);return}if(o.description.trim().length>250){t=!0,i=a("message.invalid_description"),p.error(i);return}[o.questions.filter(l=>{const u=l.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return u.length===0||u.length>=500}),o.questions.filter(l=>(l.explainText?l.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),o.questions.filter(l=>l.type===w.MULTIPLE_CHOICE&&(l.multipleChoices.some(u=>u.text.trim().length===0||u.text.trim().length>500)||l.multipleChoices.filter(u=>u.isAnswer).length===0)),o.questions.filter(l=>l.type===w.MATCHING&&(l.matchingPairs.some(u=>u.leftItem.trim().length===0||u.leftItem.trim().length>500)||l.matchingPairs.some(u=>u.rightItem.trim().length===0||u.rightItem.trim().length>500))),o.questions.filter(l=>l.type===w.ORDERING&&l.orderingItems.some(u=>u.text.trim().length===0||u.text.trim().length>500)),o.questions.filter(l=>l.type===w.SHORT_TEXT&&(l.shortAnswer.trim().length===0||l.shortAnswer.trim().length>500))].forEach(l=>{l.length>0&&(t=!0,l.forEach(u=>d.add(u)))});let M=Array.from(d).map(l=>o.questions.indexOf(l)+1);t?z.error({title:a("create_QS.modal.invalid.title"),content:a("create_QS.modal.invalid.content")+M.sort().join(", "),okText:a("sidebar.buttons.ok"),cancelText:a("sidebar.buttons.cancel")}):D()},D=()=>{z.confirm({title:a("create_QS.Modal.confirmvalid.title"),content:a("create_QS.modal.valid.content"),centered:!0,okText:a("sidebar.buttons.ok"),cancelText:a("sidebar.buttons.cancel"),onOk:async()=>{let t=await ie.Create(o);t.data.success&&(p.success(a("message.created_successfully")),x.value=!1,e.push({name:"User_QuestionSet_Detail",params:{id:t.data.data}}))}})},U=q(null),j=()=>{var t;(t=U.value)==null||t.openImportModal()},E=q(null),X=()=>{var t;(t=E.value)==null||t.openGenerateAIModal()},Y=t=>{t.length!==0&&(o.questions.unshift(...t.map((i,d)=>({...i,id:`new_${o.questions.length+d}`}))),Q(()=>{var i,d;(d=(i=v.value)==null?void 0:i.forceUpdate)==null||d.call(i),Q(()=>{const S=o.questions.length;requestAnimationFrame(()=>{var M;(M=v.value)==null||M.scrollToItem(S)})})}),p.success(`${a("message.imported_question",{number:t.length})}`))};ee((t,i,d)=>{if(!x.value){d();return}z.confirm({title:a("create_QS.modal.leave.title"),content:a("create_QS.modal.leave.content"),okText:a("sidebar.buttons.ok"),cancelText:a("sidebar.buttons.cancel"),onOk:()=>{d()},onCancel:()=>d(!1)})});function R(t){t.preventDefault(),t.returnValue=""}const v=q(null),J=()=>{Q(()=>{var t,i;(i=(t=v.value)==null?void 0:t.forceUpdate)==null||i.call(t)})};te(()=>{o.questions.push(_()),window.addEventListener("beforeunload",R)}),ne(()=>{window.removeEventListener("beforeunload",R)});const P={t:a,router:e,isDataValid:x,formRef:V,formState:o,rules:C,componentMap:A,tagContent:h,addTag:r,removeTag:b,createQuestionTemplate:_,onHandleChangeQuestionType:F,onAddQuestion:B,onRemoveQuestion:H,onFinish:N,showModalConfirmation:D,importModalRef:U,onOpenImportModal:j,generateModalRef:E,openGenerateAIModal:X,onModalImport:Y,handleBeforeUnload:R,scrollerRef:v,handleScroll:J,Input:le,TextArea:re,ImportQSModal:pe,GenerateQSModal:_e,get DynamicScroller(){return fe},get DynamicScrollerItem(){return ge}};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}}),be={class:"page-container"},ve={class:"title-container"},qe={class:"content"},Se={class:"content-item"},Qe={class:"content-item-title"},Ie={class:"d-flex"},Te={class:"form-item"},xe={class:"tag-container"},Ce=["onClick"],Me={class:"tag-inputter"},ye={class:"content-item"},ke={class:"content-item-title"},we={class:"content-item-buttons"},Ae={class:"import-button"};function Re(m,s,a,e,x,V){const o=y("RouterLink"),C=y("a-col"),A=y("a-row"),h=y("a-form");return I(),O(L,null,[n("div",be,[n("div",ve,[c(A,{class:"w-100 d-flex align-items-center"},{default:f(()=>[c(C,{span:1},{default:f(()=>[c(o,{to:{name:"User_Library"}},{default:f(()=>s[4]||(s[4]=[n("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[4]})]),_:1}),c(C,{class:"main-title",span:23},{default:f(()=>[n("span",null,g(m.$t("create_QS.title")),1),s[5]||(s[5]=T()),s[6]||(s[6]=n("br",null,null,-1)),n("span",null,g(m.$t("create_QS.sub_title")),1)]),_:1,__:[5,6]})]),_:1})]),n("div",qe,[c(h,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":s[3]||(s[3]=r=>e.formState=r),rules:e.rules,ref:"formRef"},{default:f(()=>[n("div",Se,[n("div",Qe,[n("div",null,[n("span",null,g(m.$t("create_QS.quiz.question_detail_title")),1),n("span",null,g(m.$t("create_QS.quiz.question_detail_sub_title")),1)])]),c(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":s[0]||(s[0]=r=>e.formState.name=r),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),n("div",Ie,[c(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":s[1]||(s[1]=r=>e.formState.description=r),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"]),n("div",Te,[n("label",null,g(m.$t("create_QS.quiz.tag")),1),n("div",xe,[(I(!0),O(L,null,ae(e.formState.tags,(r,b)=>(I(),O("div",{class:"tag-item",key:b},[T(g(r)+" ",1),n("i",{class:"bx bx-x",onClick:_=>e.removeTag(b)},null,8,Ce)]))),128))]),n("div",Me,[c(e.Input,{modelValue:e.tagContent,"onUpdate:modelValue":s[2]||(s[2]=r=>e.tagContent=r),placeholder:e.t("question_sets_index.search_placeholder"),"max-length":50},{icon:f(()=>s[7]||(s[7]=[n("i",{class:"bx bx-purchase-tag-alt"},null,-1)])),_:1},8,["modelValue","placeholder"]),n("i",{class:"bx bx-plus tag-inputter-button",onClick:e.addTag})])])])]),n("div",ye,[n("div",ke,[n("div",null,[n("span",null,g(m.$t("create_QS.quiz.question_question_title")),1),n("span",null,g(m.$t("create_QS.quiz.question_question_sub_title")),1)]),n("div",we,[c(o,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:f(()=>[T(g(m.$t("create_QS.buttons.import"))+" ",1),s[8]||(s[8]=n("i",{class:"bx bx-download"},null,-1))]),_:1,__:[8]}),c(o,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:f(()=>[T(g(m.$t("create_QS.buttons.generated_by_ai"))+" ",1),s[9]||(s[9]=n("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[9]}),n("div",{class:"import-button",onClick:e.onFinish},g(m.$t("create_QS.buttons.create")),1),n("div",Ae,g(m.$t("create_QS.quiz.total",{number:e.formState.questions.length.toString().padStart(3,"0")})),1)])]),c(e.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.questions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:f(({item:r,index:b})=>[(I(),G(e.DynamicScrollerItem,{item:r,key:r.id},{default:f(()=>[(I(),G(se(e.componentMap[r.type]),{question:r,index:e.formState.questions.findIndex(_=>_.id===r.id)+1,displayScore:!1,key:r.id,onDeleteQuestion:_=>e.onRemoveQuestion(b),onChangeQuestionType:_=>e.onHandleChangeQuestionType(r)},null,40,["question","index","onDeleteQuestion","onChangeQuestionType"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),n("div",{class:"add-question-btn",onClick:e.onAddQuestion},[s[10]||(s[10]=n("i",{class:"bx bx-plus"},null,-1)),T(" "+g(m.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),c(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,numberOfQuestion:e.formState.questions.length,onImport:e.onModalImport},null,8,["title","numberOfQuestion"]),c(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport,numberOfQuestion:e.formState.questions.length},null,8,["title","numberOfQuestion"])],64)}const Be=oe(he,[["render",Re],["__scopeId","data-v-b7d6bbaa"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/question_sets/create.vue"]]);export{Be as default};

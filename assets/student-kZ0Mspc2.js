import{d as te,q as ae,l as se,u as ne,B as Y,i as C,j as H,O as oe,s as le,k as g,M as R,v as ie,_ as re,r as _,a as S,o as v,b as t,e as D,c as r,w as n,f as b,t as d,E as U,F as E,D as K}from"./index-DhrrK0Mu.js";import{A as k}from"./ApiClass-pTCUFE45.js";import{I as de}from"./Input-BvI-y3AG.js";import{C as ce}from"./classStudentPosition-B7ChrNvq.js";const me={FULL_NAME:"FullName",EMAIL:"Email"},ue=te({__name:"student",emits:["updateSidebar"],setup(c,{expose:s,emit:M}){var Q;s();const e=ae(),w=se(),{t:l}=ne(),f=M,N=Object.values(me),h=Y(()=>N.map(a=>({label:l(`class_member.select_option.${a}`),value:a}))),p=C(e.params.id||""),I=C({classId:"",name:"",topic:""}),A=[{title:"No",key:"no",customRender:a=>a.index+1},{title:l("class_member.column.fullName"),dataIndex:"fullName",key:"fullName",sorter:(a,u)=>a.fullName.localeCompare(u.fullName)},{title:l("class_member.column.email"),dataIndex:"email",key:"email",sorter:(a,u)=>a.email.localeCompare(u.email)},{title:l("class_member.column.position"),dataIndex:"position",key:"position"},{key:"action"}],O=[1,3,5,7,30],P=Y(()=>O.map(a=>({label:a+l(a===1?"class_member.other.day_singular":"class_member.other.day_plural"),value:a}))),T=async()=>{try{p.value||w.push({name:"404"});let a=await k.GetById(p.value.toString());a.data.success||w.push({name:"404"}),I.value=a.data.data}catch(a){console.log("ERROR: GETBYID class: "+a)}},L=C(""),q=async()=>{try{const a=await k.GetUserPermission(I.value.classId);a.data.success&&(L.value=a.data.data)}catch(a){console.log(a)}},o=H({pageNumber:e.query.pageNumber||1,pageSize:e.query.pageSize||10,keyword:((Q=e.query.keyword)==null?void 0:Q.toString())||"",fieldName:e.query.fieldName||h.value[0].value,totalCount:0,statusFilter:!1}),z=C([]),y=async()=>{try{let a=await k.GetAllStudentByLimit(p.value.toString(),o);if(a.data.success){let u=a.data.data;z.value=u.items,o.pageNumber=u.pageNumber,o.pageSize=u.pageSize,o.totalCount=u.totalCount,o.statusFilter&&(o.pageNumber>u.totalPages&&o.totalCount>0?(o.pageNumber=1,w.push({name:"User_Class_Student",params:{id:p.value},query:{pageNumber:1,pageSize:o.pageSize,keyword:o.keyword,fieldName:o.fieldName}})):w.push({name:"User_Class_Student",params:{id:p.value},query:{pageNumber:o.pageNumber,pageSize:o.pageSize,keyword:o.keyword,fieldName:o.fieldName}}),o.statusFilter=!o.statusFilter)}}catch(a){console.log("ERROR: GETALLEXAMBYLIMIT class exam: "+a)}};oe(()=>{var a;Object.keys(e.query).length===0&&(o.pageNumber=e.query.pageNumber||1,o.pageSize=e.query.pageSize||10,o.keyword=((a=e.query.keyword)==null?void 0:a.toString())||"",o.fieldName=e.query.fieldName||h.value[0].value,o.statusFilter=!0,y())});const F=(a,u)=>{o.pageNumber=a,o.pageSize=u,o.statusFilter=!0,y()},i=C(!1),m=H({classId:p.value,code:"",expiredTime:P.value[0].value}),x=C(window.location.origin+`/user/class/invitation/${m.code}`),V=C(!0),W=C(!1),B=async()=>{await j(),i.value=!0},j=async()=>{debugger;const a=await k.GetInivationCode(p.value.toString());a.data.success&&(m.code=a.data.data,x.value=window.location.origin+`/user/class/invitation/${m.code}`)},X=async()=>{(await k.CreateNewInvitation(m)).data.success?(g.success(l("message.created_new_invitation")),B()):g.error(l("message.created_failed"))},J=a=>{if(!V.value)return;let u=m.code;a==="link"&&(u=x.value),navigator.clipboard.writeText(u).then(()=>{g.success(l("message.copied"))}).catch(()=>{g.error(l("message.copied_failed"))})},Z=a=>{R.confirm({title:l("class_member.modal.delete_member_title"),content:l("class_member.modal.delete_member_content"),centered:!0,okText:l("sidebar.buttons.ok"),cancelText:l("sidebar.buttons.cancel"),onOk:async()=>{if(!(await k.DeleteClassMember(p.value.toString(),a.toString())).data.success){g.error(l("message.removed_failed"));return}g.success(l("message.removed_successfully")),await y()}})},$=(a,u)=>{R.confirm({title:l("class_member.modal.update_member_title"),content:l("class_member.modal.update_member_content"),centered:!0,okText:l("sidebar.buttons.ok"),cancelText:l("sidebar.buttons.cancel"),onOk:async()=>{if(!(await k.UpdateClassMemberPosition(p.value.toString(),a.toString(),u)).data.success){g.error(l("message.updated_failed"));return}g.success(l("message.updated_successfully")),await y()}})},ee=()=>{R.confirm({title:l("class_member.danger_zone.warning"),content:ie("div",{style:"color: red"},l("class_member.danger_zone.warning_explain")),centered:!0,okText:l("sidebar.buttons.ok"),cancelText:l("sidebar.buttons.cancel"),onOk:async()=>{if(!(await k.Delete(p.value.toString())).data.success){g.error(l("message.deleted_failed"));return}g.success(l("message.deleted_successfully")),w.push({name:"User_Class"})}})};le(async()=>{f("updateSidebar","class"),await T(),await q(),await y()});const G={route:e,router:w,t:l,emit:f,optionKeys:N,class_position_options:h,classId:p,classData:I,columns:A,optionDays:O,code_limit_time:P,getClassData:T,userRoleInClass:L,getPermission:q,pageParams:o,student_data:z,getData:y,onPaginationChange:F,modal_invitation_open:i,invitationFormState:m,inivitationLink:x,allowCopy:V,isInvitaionLoading:W,onOpenInvitationModal:B,getInvitationCode:j,onResetInvitation:X,onCopyInvitationCode:J,onConfirmDeleteMember:Z,onConfirmUpdateMemberPosition:$,onOpenConfirmDeleteClass:ee,Input:de,get CLASS_STUDENT_POSITION(){return ce}};return Object.defineProperty(G,"__isScriptSetup",{enumerable:!1,value:!0}),G}}),_e={class:"page-container"},be={class:"title-container"},pe={class:"breadcrumb-container"},ve={class:"title-breadcrumb-item"},ge={class:"title-breadcrumb-item"},fe={class:"breadcrumb-item-topic"},ye={class:"content"},Ce={class:"content-item"},Se={class:"content-item-title"},ke={class:"content-item-functions"},we={class:"content-item-navigators"},Ie={class:"navigator-container"},Ne={style:{width:"300px",padding:"0px"}},he={key:0,class:"student-name-container"},xe=["src"],Te={class:"student-name"},ze={key:0,class:"student-action"},De=["onClick"],Ue=["onClick"],Ee=["onClick"],Oe={key:1,class:"w-100 d-flex justify-content-center"},Pe={class:"pagination-container"},Le={class:"mt-4 content-item"},qe={class:"content-item-title"},Ae={class:"text-danger"},Fe={class:"danger-zone mt-3 p-4"},Re={class:"text-danger fs-6 fw-bold"},Me={class:"text-secondary"},Ve={class:"modal-container"},Be={class:"modal-title-container"},je={class:"modal-invitation-body"},Ge={class:"invitation-code-container"},Qe={class:"invitation-code-container"};function Ye(c,s,M,e,w,l){const f=_("RouterLink"),N=_("a-button"),h=_("a-select-option"),p=_("a-select"),I=_("a-tooltip"),A=_("a-table"),O=_("a-empty"),P=_("a-pagination"),T=_("a-col"),L=_("a-row"),q=_("a-qrcode"),o=_("a-form-item"),z=_("a-form"),y=_("a-divider"),F=_("a-modal");return v(),S(E,null,[t("div",_e,[t("div",be,[t("div",pe,[t("ul",null,[t("li",ve,[r(f,{to:{name:"User_Class"}},{default:n(()=>[t("span",null,d(c.$t("class_index.title")),1),s[10]||(s[10]=b()),s[11]||(s[11]=t("br",null,null,-1))]),_:1,__:[10,11]}),s[12]||(s[12]=t("i",{class:"bx bx-chevron-right"},null,-1))]),t("li",ge,[r(f,{to:{name:""},class:"breadcrumb-item-class"},{default:n(()=>[t("span",null,d(e.classData.name),1),t("span",fe,d(e.classData.topic),1)]),_:1})])])])]),t("div",ye,[t("div",Ce,[t("div",Se,[t("div",null,[t("span",null,d(c.$t("class_member.title")),1),t("span",null,d(c.$t("class_member.sub_title")),1)]),r(N,{class:"main-color-btn",type:"primary",size:"large",onClick:e.onOpenInvitationModal},{default:n(()=>[s[13]||(s[13]=t("i",{class:"me-2 bx bx-user-plus"},null,-1)),b(" "+d(c.$t("class_member.buttons.invite_member")),1)]),_:1,__:[13]})]),t("div",ke,[t("div",we,[t("div",Ie,[r(f,{class:"navigator-item",to:{name:"User_Class_Exam"}},{default:n(()=>[b(d(c.$t("class_index.navigators.exam")),1)]),_:1}),r(f,{class:"navigator-item",to:{name:"User_Class_Quiz"}},{default:n(()=>[b(d(c.$t("class_index.navigators.quiz")),1)]),_:1}),r(f,{class:"navigator-item navigator-active",to:{name:""}},{default:n(()=>[b(d(c.$t("class_index.navigators.member")),1)]),_:1})])]),r(p,{value:e.pageParams.fieldName,"onUpdate:value":s[0]||(s[0]=i=>e.pageParams.fieldName=i),style:{width:"200px"},onChange:e.getData},{default:n(()=>[(v(!0),S(E,null,K(e.class_position_options,i=>(v(),U(h,{value:i.value},{default:n(()=>[b(d(i.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"]),t("div",Ne,[r(e.Input,{onInput:e.getData,modelValue:e.pageParams.keyword,"onUpdate:modelValue":s[1]||(s[1]=i=>e.pageParams.keyword=i),placeholder:e.t("class_member.other.search_placeholder")},{icon:n(()=>s[14]||(s[14]=[t("i",{class:"bx bx-search"},null,-1)])),_:1},8,["modelValue","placeholder"])])]),e.student_data.length>0?(v(),U(A,{key:0,columns:e.columns,"data-source":e.student_data,"row-key":"studentId",pagination:!1},{bodyCell:n(({column:i,record:m})=>[i.key==="fullName"?(v(),S("div",he,[t("img",{class:"student-image",src:m.image,alt:""},null,8,xe),t("div",Te,d(m.fullName),1)])):D("v-if",!0),i.key==="position"?(v(),S(E,{key:1},[b(d(c.$t(`class_member.position.${m.position}`)),1)],64)):D("v-if",!0),i.key==="action"?(v(),S(E,{key:2},[e.userRoleInClass===e.CLASS_STUDENT_POSITION.OWNER?(v(),S("div",ze,[m.position===e.CLASS_STUDENT_POSITION.STUDENT?(v(),U(I,{key:0},{title:n(()=>[b(d(c.$t("class_member.buttons.assign_lecturer")),1)]),default:n(()=>[t("i",{style:{cursor:"pointer"},class:"bx bxs-id-card",onClick:x=>e.onConfirmUpdateMemberPosition(m.studentId,e.CLASS_STUDENT_POSITION.TEACHER)},null,8,De)]),_:2},1024)):(v(),U(I,{key:1},{title:n(()=>[b(d(c.$t("class_member.buttons.remove_lecturer")),1)]),default:n(()=>[t("i",{class:"text-danger bx bxs-id-card",onClick:x=>e.onConfirmUpdateMemberPosition(m.studentId,e.CLASS_STUDENT_POSITION.STUDENT)},null,8,Ue)]),_:2},1024)),r(I,null,{title:n(()=>[b(d(c.$t("question_sets_index.buttons.delete")),1)]),default:n(()=>[t("i",{class:"text-danger bx bx-trash-alt",onClick:x=>e.onConfirmDeleteMember(m.studentId)},null,8,Ee)]),_:2},1024)])):D("v-if",!0)],64)):D("v-if",!0)]),_:1},8,["data-source"])):(v(),S("div",Oe,[r(O,null,{description:n(()=>[t("span",null,d(c.$t("class_index.other.no_data_matches")),1)]),_:1})])),t("div",Pe,[r(P,{onChange:e.onPaginationChange,current:e.pageParams.pageNumber,"onUpdate:current":s[2]||(s[2]=i=>e.pageParams.pageNumber=i),total:e.pageParams.totalCount,pageSize:e.pageParams.pageSize,"show-total":(i,m)=>`${m[0]}-${m[1]} of ${i} ${e.t("class_member.other.items")}`,"show-size-changer":"","show-quick-jumper":"",class:"crud-layout-pagination",locale:{items_per_page:e.t("class_index.other.pages")}},null,8,["current","total","pageSize","show-total","locale"])])]),t("div",Le,[t("div",qe,[t("div",null,[t("span",Ae,d(c.$t("class_member.danger_zone.title")),1),t("span",null,d(c.$t("class_member.danger_zone.sub_title")),1)])]),t("div",Fe,[t("div",Re,d(c.$t("class_member.danger_zone.warning")),1),t("div",Me,d(c.$t("class_member.danger_zone.warning_explain")),1),r(N,{class:"mt-3",type:"primary",danger:"",size:"large",onClick:e.onOpenConfirmDeleteClass},{default:n(()=>[b(d(c.$t("class_member.buttons.delete_class")),1)]),_:1})])])])]),D(" invitation modal "),r(F,{width:"750px",centered:"","wrap-class-name":"medium-modal",open:e.modal_invitation_open,onCancel:s[9]||(s[9]=i=>e.modal_invitation_open=!1)},{footer:n(()=>[r(z,{layout:"vertical",class:"w-100 d-flex align-items-end justify-content-between"},{default:n(()=>[r(o,{label:e.t("class_member.modal.time_limit_label")},{default:n(()=>[r(p,{value:e.invitationFormState.expiredTime,"onUpdate:value":s[8]||(s[8]=i=>e.invitationFormState.expiredTime=i),style:{width:"200px"},onChange:e.getData},{default:n(()=>[(v(!0),S(E,null,K(e.code_limit_time,i=>(v(),U(h,{value:i.value},{default:n(()=>[b(d(i.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},8,["label"]),r(o,null,{default:n(()=>[r(N,{loading:e.isInvitaionLoading,class:"main-color-btn",key:"submit",type:"primary",onClick:e.onResetInvitation},{default:n(()=>[b(d(c.$t("class_member.buttons.reset_code")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),default:n(()=>[t("div",Ve,[t("div",Be,[r(L,{class:"w-100 d-flex align-items-center"},{default:n(()=>[r(T,{span:2},{default:n(()=>[r(f,{onClick:s[3]||(s[3]=i=>e.modal_invitation_open=!1),to:{name:""}},{default:n(()=>s[15]||(s[15]=[t("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[15]})]),_:1}),r(T,{class:"main-title",span:22},{default:n(()=>[t("span",null,d(c.$t("class_member.modal.title")),1),s[16]||(s[16]=b()),s[17]||(s[17]=t("br",null,null,-1)),t("span",null,d(c.$t("class_member.modal.sub_title")),1)]),_:1,__:[16,17]})]),_:1})]),t("div",je,[r(q,{value:e.invitationFormState.code,class:"invitation-body-qrcode"},null,8,["value"]),r(z,{layout:"vertical",class:"invitation-body-link"},{default:n(()=>[r(o,{label:e.t("class_member.modal.class_code_label")},{default:n(()=>[t("div",Ge,[r(e.Input,{modelValue:e.invitationFormState.code,"onUpdate:modelValue":s[4]||(s[4]=i=>e.invitationFormState.code=i),"is-required":!0,"max-length":100,readonly:!0},null,8,["modelValue"]),t("i",{class:"bx bx-copy",onClick:s[5]||(s[5]=i=>e.onCopyInvitationCode("code"))})])]),_:1},8,["label"]),r(o,{label:e.t("class_member.modal.invitation_link")},{default:n(()=>[t("div",Qe,[r(e.Input,{modelValue:e.inivitationLink,"onUpdate:modelValue":s[6]||(s[6]=i=>e.inivitationLink=i),"is-required":!0,"max-length":100,readonly:!0},null,8,["modelValue"]),t("i",{class:"bx bx-copy",onClick:s[7]||(s[7]=i=>e.onCopyInvitationCode("link"))})])]),_:1},8,["label"])]),_:1})]),r(y,null,{default:n(()=>[b(d(c.$t("class_member.modal.or")),1)]),_:1})])]),_:1},8,["open"])],64)}const Ze=re(ue,[["render",Ye],["__scopeId","data-v-6a35c450"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/class/student.vue"]]);export{Ze as default};

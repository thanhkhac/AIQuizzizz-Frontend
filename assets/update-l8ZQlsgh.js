import{d as Te,u as ge,q as he,l as _e,i as c,j as ve,X as we,Y as Me,s as Se,R as T,k,M as P,_ as Qe,r as Q,a as ee,o as y,b as i,c as l,w as p,t as g,E as G,f as V,N as Ie,F as be}from"./index-BTtyw8YW.js";import{A as Ae}from"./ApiClass-BjzEsi0b.js";import{A as te}from"./ApiTest-BaqpPO5G.js";import{Q as q}from"./questionTypes-CS3lcRlq.js";import{T as Re,a as Ue,C as ke,b as ye,c as Ce,d as De,S as Fe}from"./ChooseQuestionModal-BDZ7Aiy4.js";import{S as qe,O as Oe,M as xe,a as Ee,s as Be,b as Le}from"./vue-virtual-scroller.esm-DeS4JGX7.js";import{T as ae}from"./TransferQuestionData-BxcXdBjq.js";import{V as oe}from"./Validator-CWeiTIFe.js";import"./Input-OaAZgVyh.js";import"./utc-B88jE3dg.js";import"./ApiFolder-BvCkcMgz.js";import"./folderShareMode-BudLQ2R2.js";import"./ApiTestTemplate-DKO1nVex.js";import"./TextArea-BoIpbba0.js";/* empty css                                                                 */import"./vue-draggable-plus-BpWIpMyw.js";const ze=Te({__name:"update",setup(u,{expose:f}){var $;f();const H={MultipleChoice:Ee,Matching:xe,Ordering:Oe,ShortText:qe},{t}=ge(),O=he(),h=_e(),I=c(),b=async()=>{if(!oe.isValidGuid(a.classId)){m.value=!1,h.push({name:"404"});return}const e=await Ae.GetById(a.classId);if(!e.data.success){m.value=!1,h.push({name:"404"});return}I.value=e.data.data},C=c(),a=ve({testId:(($=O.params.id)==null?void 0:$.toString())||"",name:"",classId:"",timeLimit:60,startTime:"",endTime:"",gradeAttemptMethod:Ue.HIGHEST_SCORE,gradeQuestionMethod:Re.PARTIAL,isShowCorrectAnswerInReview:!0,isAllowReviewAfterSubmit:!0,shuffle:2,maxAttempt:2,passingScore:50,createUpdateQuestions:[],deleteQuestionIds:[]}),_={questions:[{validator:(e,o)=>o&&o.length>500?Promise.reject(t("message.maximum_tag.limit_question",{number:500})):Promise.resolve(),trigger:"change"}]},A=c(!1),m=c(!0),v=async()=>{try{if(A.value=!0,!oe.isValidGuid(a.testId)){m.value=!1,h.push({name:"404"});return}const e=await te.GetById(a.testId);if(!e.data.success){m.value=!1,h.push({name:"404"});return}a.classId=e.data.data.classId,a.testId=e.data.data.testId,a.name=e.data.data.name,a.startTime=e.data.data.startTime,a.endTime=e.data.data.endTime,a.gradeAttemptMethod=e.data.data.gradeAttemptMethod,a.gradeQuestionMethod=e.data.data.gradeQuestionMethod,a.isAllowReviewAfterSubmit=e.data.data.isAllowReviewAfterSubmit,a.isShowCorrectAnswerInReview=e.data.data.isShowCorrectAnswerInReview,a.maxAttempt=e.data.data.maxAttempt,a.shuffle=e.data.data.shuffle,a.passingScore=e.data.data.passingScore,a.timeLimit=e.data.data.timeLimit,a.createUpdateQuestions=e.data.data.questions.map(o=>ae.transformResponseToRequest(o))}catch(e){if(e.response.data.success===!1){m.value=!1,h.push({name:"404"});return}}finally{A.value=!1}},R=()=>({id:`new_${Date.now().toString()}`,type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),N=()=>{if(a.createUpdateQuestions.length>=500){k.warning(t("message.limit_question",{number:500}));return}a.createUpdateQuestions=[...a.createUpdateQuestions,R()],T(()=>{var e,o;(o=(e=M.value)==null?void 0:e.forceUpdate)==null||o.call(e),T(()=>{const r=a.createUpdateQuestions.length;requestAnimationFrame(()=>{var d;(d=M.value)==null||d.scrollToItem(r)})})})},ne=e=>{if(a.createUpdateQuestions.length<=1){k.warning(t("message.minimum_question",{number:1}));return}const o=a.createUpdateQuestions[e].id;!o.startsWith("new_")&&o&&a.deleteQuestionIds.push(o),a.createUpdateQuestions=[...a.createUpdateQuestions.slice(0,e),...a.createUpdateQuestions.slice(e+1)]},se=async()=>{var F;await((F=C.value)==null?void 0:F.validate());let e=!1,o=t("message.invalid_question"),r=new Set;if(a.name.trim().length>100||a.name.trim().length===0){e=!0,o=t("message.invalid_title"),k.error(o),x();return}[a.createUpdateQuestions.filter(n=>{const s=n.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return s.length===0||s.length>=500}),a.createUpdateQuestions.filter(n=>(n.explainText?n.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),a.createUpdateQuestions.filter(n=>n.type===q.MULTIPLE_CHOICE&&(n.multipleChoices.some(s=>s.text.trim().length===0||s.text.trim().length>500)||n.multipleChoices.filter(s=>s.isAnswer).length===0)),a.createUpdateQuestions.filter(n=>n.type===q.MATCHING&&(n.matchingPairs.some(s=>s.leftItem.trim().length===0||s.leftItem.trim().length>500)||n.matchingPairs.some(s=>s.rightItem.trim().length===0||s.rightItem.trim().length>500))),a.createUpdateQuestions.filter(n=>n.type===q.ORDERING&&n.orderingItems.some(s=>s.text.trim().length===0||s.text.trim().length>500)),a.createUpdateQuestions.filter(n=>n.type===q.SHORT_TEXT&&(n.shortAnswer.trim().length===0||n.shortAnswer.trim().length>500))].forEach(n=>{n.length>0&&(e=!0,n.forEach(s=>r.add(s)))});let S=Array.from(r).map(n=>a.createUpdateQuestions.indexOf(n)+1);e?P.error({title:t("update_test.modal.invalid.title"),content:t("update_test.modal.invalid.content")+S.sort().join(", "),okText:t("sidebar.buttons.ok"),cancelText:t("sidebar.buttons.cancel")}):j()},j=()=>{P.confirm({title:t("update_test.modal.valid.title"),content:t("update_test.modal.valid.content"),okText:t("sidebar.buttons.ok"),cancelText:t("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{a.createUpdateQuestions=a.createUpdateQuestions.map(o=>o.id.startsWith("new_")?{...o,id:""}:o),(await te.Update({...a,createUpdateQuestions:a.createUpdateQuestions.map(o=>({...o,questionId:o.id.startsWith("new_")?null:o.id}))})).data.success&&(m.value=!1,k.success("Updated successfully!"))}})},W=c(null),x=()=>{var e;(e=W.value)==null||e.openTestSettingModal()},U=c(null),E=()=>{var e;(e=U.value)==null||e.openModal()},le=()=>{var e;w.value=null,(e=U.value)==null||e.closeModal(),L()},ie=e=>{var o;w.value=e,(o=U.value)==null||o.closeModal(),B()},w=c(null),X=c(""),Y=c(null),B=()=>{var e;(e=Y.value)==null||e.openModal()},re=()=>{w.value=null,E()},D=c(null),L=()=>{var e;(e=D.value)==null||e.openModal()},de=()=>{var e;w.value=null,(e=D.value)==null||e.closeModal(),E()},ce=async(e,o)=>{var r;X.value=e,(r=D.value)==null||r.closeModal(),w.value=o,await T(),K()},J=c(null),K=()=>{var e;(e=J.value)==null||e.openModal()},me=async e=>{w.value=e,await T(),B()},ue=()=>{L()},pe=e=>{var r;const o=e.map(d=>ae.transformResponseToRequest(d)).map((d,S)=>({...d,id:`new_${a.createUpdateQuestions.length+S}`}));(r=U.value)==null||r.closeModal(),a.createUpdateQuestions=[...a.createUpdateQuestions,...o],T(()=>{var d,S;(S=(d=M.value)==null?void 0:d.forceUpdate)==null||S.call(d),T(()=>{const F=a.createUpdateQuestions.length;requestAnimationFrame(()=>{var n;(n=M.value)==null||n.scrollToItem(F)})})}),k.success(`${t("message.imported_question",{number:e.length})}`)};we((e,o,r)=>{if(!m.value){r();return}P.confirm({title:t("create_QS.modal.leave.title"),content:t("create_QS.modal.leave.content"),okText:t("sidebar.buttons.ok"),cancelText:t("sidebar.buttons.cancel"),onOk:()=>{r()},onCancel:()=>r(!1)})});function z(e){e.preventDefault(),e.returnValue=""}Me(()=>{window.removeEventListener("beforeunload",z)});const M=c(null),fe=()=>{T(()=>{var e,o;(o=(e=M.value)==null?void 0:e.forceUpdate)==null||o.call(e)})};Se(async()=>{await v(),await b(),window.addEventListener("beforeunload",z),await T(),x()});const Z={componentMap:H,t,route:O,router:h,classData:I,getClassData:b,formRef:C,formState:a,rules:_,loading:A,isDataValid:m,getData:v,createQuestionTemplate:R,onAddQuestion:N,onRemoveQuestion:ne,onFinish:se,showModalConfirmation:j,settingModalRef:W,openSettingModal:x,folderModalRef:U,openFolderModal:E,onSwitchToTestTemplate:le,onOpenFolder:ie,chosenFolder:w,chosenTestTemplateId:X,folderTestTemplateModalRef:Y,openFolderTestTemplateModal:B,onBackToFolderModal:re,testTemplateModalRef:D,openTestTemplateModal:L,onSwitchToFolder:de,onOpenTestTemplate:ce,questionModalRef:J,openQuestionModal:K,onBackToFolderTestTemplate:me,onBackToTestTemplate:ue,onModalImport:pe,handleBeforeUnload:z,scrollerRef:M,handleScroll:fe,SettingTestModal:Fe,ChooseFolderModal:De,ChooseFolderTestTemplateModal:Ce,ChooseTestTemplateModal:ye,ChooseQuestionModal:ke,get DynamicScroller(){return Le},get DynamicScrollerItem(){return Be}};return Object.defineProperty(Z,"__isScriptSetup",{enumerable:!1,value:!0}),Z}}),Pe={class:"page-container"},Ge={class:"title-container"},Ve={class:"content"},He={class:"content-item"},Ne={class:"content-item-title"},je={class:"content-item-buttons"},We={class:"import-button"},Xe={key:0};function Ye(u,f,H,t,O,h){var m;const I=Q("RouterLink"),b=Q("a-col"),C=Q("a-row"),a=Q("a-button"),_=Q("a-skeleton"),A=Q("a-form");return y(),ee(be,null,[i("div",Pe,[i("div",Ge,[l(C,{class:"w-100 d-flex align-items-center"},{default:p(()=>[l(b,{span:1},{default:p(()=>[l(I,{to:{name:""},onClick:t.openSettingModal},{default:p(()=>f[0]||(f[0]=[i("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[0]})]),_:1}),l(b,{class:"main-title",span:23},{default:p(()=>[i("span",null,g(u.$t("update_test.title",{test_name:t.formState.name})),1),f[1]||(f[1]=i("br",null,null,-1)),i("span",null,g(u.$t("update_test.sub_title")),1)]),_:1,__:[1]})]),_:1})]),i("div",Ve,[l(A,{layout:"vertical",model:t.formState,rules:t.rules,ref:"formRef"},{default:p(()=>[i("div",He,[i("div",Ne,[i("div",null,[i("span",null,g(u.$t("assign_test.test_question.title")),1),i("span",null,g(u.$t("assign_test.test_question.sub_title")),1)]),i("div",je,[l(I,{class:"import-button",to:{name:""},onClick:t.openFolderModal},{default:p(()=>[V(g(u.$t("assign_test.buttons.choose_from_folder")),1)]),_:1}),i("div",We,g(u.$t("create_QS.quiz.total",{number:t.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1),l(a,{type:"primary",class:"main-color-btn",size:"large",onClick:t.onFinish},{default:p(()=>[V(g(u.$t("assign_test.buttons.next")),1)]),_:1})])]),t.loading?(y(),ee("div",Xe,[l(_,{loading:t.loading,active:""},null,8,["loading"]),l(_,{loading:t.loading,active:""},null,8,["loading"]),l(_,{loading:t.loading,active:""},null,8,["loading"]),l(_,{loading:t.loading,active:""},null,8,["loading"]),l(_,{loading:t.loading,active:""},null,8,["loading"])])):(y(),G(t.DynamicScroller,{key:1,ref:"scrollerRef",class:"scroller","key-field":"id",items:t.formState.createUpdateQuestions,"min-item-size":650,buffer:800,prerender:10,onScroll:t.handleScroll},{default:p(({item:v,index:R})=>[(y(),G(t.DynamicScrollerItem,{item:v,key:v.id},{default:p(()=>[(y(),G(Ie(t.componentMap[v.type]),{question:v,index:R+1,displayScore:!1,onDeleteQuestion:N=>t.onRemoveQuestion(R)},null,40,["question","index","onDeleteQuestion"]))]),_:2},1032,["item"]))]),_:1},8,["items"])),i("div",{class:"add-question-btn",onClick:t.onAddQuestion},[f[2]||(f[2]=i("i",{class:"bx bx-plus"},null,-1)),V(" "+g(u.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["model"])])]),l(t.SettingTestModal,{ref:"settingModalRef","form-ref":t.formRef,"class-name":(m=t.classData)==null?void 0:m.name,"form-state":t.formState},null,8,["form-ref","class-name","form-state"]),l(t.ChooseFolderModal,{ref:"folderModalRef",onSwitchToTestTemplate:t.onSwitchToTestTemplate,onOpenFolder:t.onOpenFolder},null,512),l(t.ChooseFolderTestTemplateModal,{ref:"folderTestTemplateModalRef",folder:t.chosenFolder,onBackToFolderModal:t.onBackToFolderModal,onOpenTestTemplate:t.onOpenTestTemplate},null,8,["folder"]),l(t.ChooseTestTemplateModal,{ref:"testTemplateModalRef",onSwitchToFolder:t.onSwitchToFolder,onOpenTestTemplate:t.onOpenTestTemplate},null,512),l(t.ChooseQuestionModal,{ref:"questionModalRef","test-template-id":t.chosenTestTemplateId,folder:t.chosenFolder,onBackToFolderTestTemplateModal:t.onBackToFolderTestTemplate,onBackToTestTemplateModal:t.onBackToTestTemplate,onImport:t.onModalImport},null,8,["test-template-id","folder"])],64)}const ut=Qe(ze,[["render",Ye],["__scopeId","data-v-c9dbf500"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test/update.vue"]]);export{ut as default};

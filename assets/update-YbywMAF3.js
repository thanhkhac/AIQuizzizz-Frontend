import{d as ee,u as te,l as ne,q as ae,i as f,j as oe,a2 as se,a3 as ie,s as le,k as Q,G as V,M as z,_ as re,r as S,a as B,o as q,b as i,c as d,w as g,f as U,t as m,e as de,E as N,R as ue,F as me}from"./index-Cnq_Nl0p.js";import{A as D}from"./ApiTestTemplate-BRtwqFLl.js";import{Q as y}from"./questionTypes-CS3lcRlq.js";import{T as ce}from"./TransferQuestionData-BxcXdBjq.js";import{V as pe}from"./Validator-CWeiTIFe.js";import{I as fe}from"./Input-RIkKgg1g.js";import{T as ge}from"./vue-draggable-plus-Cx2J11jB.js";import{C as M,S as _e,O as he,M as ve,a as Qe,s as be,b as Se}from"./vue-virtual-scroller.esm-D3BtcYpZ.js";import{G as Ie,I as Te}from"./GenerateQSModal-BjVwdWsz.js";import"./lodash-AsRuucYm.js";/* empty css                                                              *//* empty css                                                                 */import"./ApiQuestionSet-ycCGT-br.js";import"./languages-DtYW231W.js";const qe=ee({__name:"update",setup(u,{expose:l}){l();const{t:s}=te(),e=ne(),w=ae(),I=f(!1),_=f(w.params.id),c=f({testTemplateId:"",name:"",questions:[]}),h=f(!0),v=async()=>{try{if(I.value=!0,!pe.isValidGuid(_.value)){h.value=!1,e.push({name:"404"});return}await F();let t=await D.GetById(_.value);if(!t.data.success){h.value=!1,e.push({name:"404"});return}c.value=t.data.data,c.value.questions=t.data.data.questions.map(a=>({id:a.questionId,...a})),n.name=c.value.name,n.createUpdateQuestions=c.value.questions.map(a=>ce.transformResponseToRequest(a)),n.testTemplateId=c.value.testTemplateId,window.addEventListener("beforeunload",x)}catch(t){console.log(t)}finally{I.value=!1}},C=f(),n=oe({testTemplateId:"",name:"",description:"",createUpdateQuestions:[],deleteQuestionIds:[]}),k={title:[{required:"true",message:s("message.required"),trigger:"change"},{length:100,message:s("message.out_of_range",{max_length:100}),trigger:"change"}],description:[{length:200,message:s("message.out_of_range",{max_length:200}),trigger:"change"}],questions:[{validator:(t,a)=>a&&a.length>500?Promise.reject(s("message.maximum_tag.limit_question",{number:500})):Promise.resolve(),trigger:"change"}]},b={MultipleChoice:Qe,Matching:ve,Ordering:he,ShortText:_e},E=()=>({id:"new_"+Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:M.defaultMultipleChoices(),matchingPairs:M.defaultMatchingPairs(),orderingItems:M.defaultOrderingItems(),shortAnswer:""}),H=t=>{M.onChangeQuestionType(t)},j=()=>{if(n.createUpdateQuestions.length>=500){Q.warning(s("message.limit_question",{number:500}));return}n.createUpdateQuestions=[...n.createUpdateQuestions,E()],V(()=>{var t,a;(a=(t=T.value)==null?void 0:t.forceUpdate)==null||a.call(t),V(()=>{const p=n.createUpdateQuestions.length;requestAnimationFrame(()=>{var A;(A=T.value)==null||A.scrollToItem(p)})})})},W=t=>{if(n.createUpdateQuestions.length<=1){Q.warning(s("message.minimum_question",{number:1}));return}const a=n.createUpdateQuestions[t].id;!a.startsWith("new_")&&a&&n.deleteQuestionIds.push(a),n.createUpdateQuestions=[...n.createUpdateQuestions.slice(0,t),...n.createUpdateQuestions.slice(t+1)]},X=()=>{let t=!1,a=s("message.invalid_question"),p=new Set;if(n.name.trim().length>100||n.name.trim().length===0){t=!0,a=s("message.invalid_title"),Q.error(a);return}if(n.description.trim().length>250){t=!0,a=s("message.invalid_description"),Q.error(a);return}[n.createUpdateQuestions.filter(o=>{const r=o.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return r.length===0||r.length>=5e3}),n.createUpdateQuestions.filter(o=>(o.explainText?o.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=5e3),n.createUpdateQuestions.filter(o=>o.type===y.MULTIPLE_CHOICE&&(o.multipleChoices.some(r=>r.text.trim().length===0||r.text.trim().length>1e3)||o.multipleChoices.filter(r=>r.isAnswer).length===0||o.multipleChoices.length<2)),n.createUpdateQuestions.filter(o=>o.type===y.MATCHING&&(o.matchingPairs.some(r=>r.leftItem.trim().length===0||r.leftItem.trim().length>1e3)||o.matchingPairs.some(r=>r.rightItem.trim().length===0||r.rightItem.trim().length>1e3)||o.matchingPairs.length<2)),n.createUpdateQuestions.filter(o=>o.type===y.ORDERING&&(o.orderingItems.some(r=>r.text.trim().length===0||r.text.trim().length>1e3)||o.orderingItems.length<2)),n.createUpdateQuestions.filter(o=>o.type===y.SHORT_TEXT&&(o.shortAnswer.trim().length===0||o.shortAnswer.trim().length>1e3))].forEach(o=>{o.length>0&&(t=!0,o.forEach(r=>p.add(r)))});let $=Array.from(p).map(o=>n.createUpdateQuestions.indexOf(o)+1);t?z.error({title:s("create_QS.modal.invalid.title"),content:s("create_QS.modal.invalid.content")+$.sort().join(", "),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel")}):O()},O=()=>{z.confirm({title:s("create_template.modal.valid.title"),content:s("create_QS.modal.valid.content"),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{let t=await D.Update(c.value.testTemplateId,{...n,createUpdateQuestions:n.createUpdateQuestions.map(a=>({questionId:a.id.startsWith("new_")?null:a.id,...a}))});t.data.success&&(Q.success(s("message.updated_successfully")),h.value=!1,e.push({name:"User_TestTemplate_Detail",params:{id:t.data.data}}))}})},G=f(null),Y=()=>{var t;(t=G.value)==null||t.openImportModal()},P=f(null),J=()=>{var t;(t=P.value)==null||t.openGenerateAIModal()},K=t=>{n.createUpdateQuestions.push(...t.map((a,p)=>({...a,id:`new_${n.createUpdateQuestions.length+p}`}))),Q.success(`${s("message.imported_question",{number:t.length})}`)};function x(t){t.preventDefault(),t.returnValue=""}se((t,a,p)=>{if(!h.value){p();return}z.confirm({title:s("create_QS.modal.leave.title"),content:s("create_QS.modal.leave.content"),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),onOk:()=>{p()},onCancel:()=>p(!1)})}),ie(()=>{window.removeEventListener("beforeunload",x)});const R=f({canEdit:!1,canDelete:!1}),F=async()=>{const t=await D.GetPermissions(_.value);t.data.success&&(R.value=t.data.data,R.value.canEdit||(h.value=!1,e.push({name:"404"})))},T=f(null),Z=()=>{V(()=>{var t,a;(a=(t=T.value)==null?void 0:t.forceUpdate)==null||a.call(t)})};le(async()=>{await v()});const L={t:s,router:e,route:w,loading:I,testTemplateId:_,testTemplate:c,isDataValid:h,getTestTemplate:v,formRef:C,formState:n,rules:k,componentMap:b,createQuestionTemplate:E,onHandleChangeQuestionType:H,onAddQuestion:j,onRemoveQuestion:W,onFinish:X,showModalConfirmation:O,importModalRef:G,onOpenImportModal:Y,generateModalRef:P,openGenerateAIModal:J,onModalImport:K,handleBeforeUnload:x,permission:R,getPermission:F,scrollerRef:T,handleScroll:Z,Input:fe,TextArea:ge,ImportQSModal:Te,GenerateQSModal:Ie,get DynamicScroller(){return Se},get DynamicScrollerItem(){return be}};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}}),Ue={class:"page-container"},ye={class:"title-container"},Me={class:"content"},we={class:"content-item"},Ce={class:"content-item-title"},ke={class:"d-flex"},xe={class:"content-item"},Re={class:"content-item-title"},Ae={class:"content-item-buttons"},Ve={class:"import-button"},ze={key:0};function De(u,l,s,e,w,I){const _=S("RouterLink"),c=S("a-col"),h=S("a-row"),v=S("a-skeleton"),C=S("a-form");return q(),B(me,null,[i("div",Ue,[i("div",ye,[d(h,{class:"w-100 d-flex align-items-center"},{default:g(()=>[d(c,{span:1},{default:g(()=>[d(_,{to:{name:"User_Folder"}},{default:g(()=>l[3]||(l[3]=[i("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[3]})]),_:1}),d(c,{class:"main-title",span:23},{default:g(()=>[i("span",null,m(u.$t("update_template.title",{name:e.formState.name})),1),l[4]||(l[4]=U()),l[5]||(l[5]=i("br",null,null,-1)),i("span",null,m(u.$t("create_QS.sub_title")),1)]),_:1,__:[4,5]})]),_:1})]),i("div",Me,[d(C,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":l[2]||(l[2]=n=>e.formState=n),rules:e.rules,ref:"formRef"},{default:g(()=>[i("div",we,[i("div",Ce,[i("div",null,[i("span",null,m(u.$t("create_QS.quiz.question_detail_title")),1),i("span",null,m(u.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":l[0]||(l[0]=n=>e.formState.name=n),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),i("div",ke,[d(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":l[1]||(l[1]=n=>e.formState.description=n),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"])])]),i("div",xe,[i("div",Re,[i("div",null,[i("span",null,m(u.$t("create_QS.quiz.question_question_title")),1),i("span",null,m(u.$t("create_QS.quiz.question_question_sub_title")),1)]),i("div",Ae,[d(_,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:g(()=>[U(m(u.$t("create_QS.buttons.import"))+" ",1),l[6]||(l[6]=i("i",{class:"bx bx-download"},null,-1))]),_:1,__:[6]}),d(_,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:g(()=>[U(m(u.$t("create_QS.buttons.generated_by_ai"))+" ",1),l[7]||(l[7]=i("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[7]}),i("div",{class:"import-button",onClick:e.onFinish},m(u.$t("update_QS.buttons.update")),1),i("div",Ve,m(u.$t("create_QS.quiz.total",{number:e.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1)])]),e.loading?(q(),B("div",ze,[d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"])])):de("v-if",!0),d(e.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.createUpdateQuestions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:g(({item:n,index:k})=>[(q(),N(e.DynamicScrollerItem,{item:n,key:n.id},{default:g(()=>[(q(),N(ue(e.componentMap[n.type]),{question:n,index:e.formState.createUpdateQuestions.findIndex(b=>b.id===n.id)+1,displayScore:!1,onDeleteQuestion:b=>e.onRemoveQuestion(k),onChangeQuestionType:b=>e.onHandleChangeQuestionType(n)},null,40,["question","index","onDeleteQuestion","onChangeQuestionType"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),i("div",{class:"add-question-btn",onClick:e.onAddQuestion},[l[8]||(l[8]=i("i",{class:"bx bx-plus"},null,-1)),U(" "+m(u.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),d(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,"number-of-question":e.formState.createUpdateQuestions.length,onImport:e.onModalImport},null,8,["title","number-of-question"]),d(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport,"number-of-question":e.formState.createUpdateQuestions.length},null,8,["title","number-of-question"])],64)}const Ke=re(qe,[["render",De],["__scopeId","data-v-48787c2a"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test_template/update.vue"]]);export{Ke as default};

import{d as N,u as j,l as X,i as v,j as Y,Z,$ as J,s as K,k as g,G as S,M as R,_ as W,r as M,a as $,o as z,b as s,c as d,w as p,f as x,t as f,E as P,P as ee,F as te}from"./index-BQVBa0zY.js";import{A as ne}from"./ApiTestTemplate-BZAQRgEq.js";import{I as oe}from"./Input-DQE8nT6C.js";import{T as se}from"./TextArea-CR1GcuGc.js";import{C as y,S as ae,O as ie,M as le,a as re,s as me,b as ue}from"./vue-virtual-scroller.esm-HYgns5xH.js";import{G as ce,I as de}from"./GenerateQSModal-Tf4pSeTH.js";import{Q as C}from"./questionTypes-CS3lcRlq.js";/* empty css                                                                 */import"./vue-draggable-plus-ewuhEGvO.js";import"./languages-DtYW231W.js";import"./lodash-Dm95q8_s.js";const fe=N({__name:"create",setup(u,{expose:r}){r();const{t:o}=j(),t=X(),T=v(!0),D=v(),n=Y({name:"",description:"",questions:[]}),I={title:[{required:"true",message:o("message.required"),trigger:"change"},{length:100,message:o("message.out_of_range",{max_length:100}),trigger:"change"}],description:[{length:200,message:o("message.out_of_range",{max_length:100}),trigger:"change"}],questions:[{validator:(e,i)=>i&&i.length>500?Promise.reject(o("message.maximum_tag.limit_question",{number:500})):Promise.resolve(),trigger:"change"}]},w={MultipleChoice:re,Matching:le,Ordering:ie,ShortText:ae},h=()=>({id:Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:y.defaultMultipleChoices(),matchingPairs:y.defaultMatchingPairs(),orderingItems:y.defaultOrderingItems(),shortAnswer:""}),c=e=>{y.onChangeQuestionType(e)},k=()=>{if(n.questions.length>=500){g.warning(o("message.limit_question",{number:500}));return}n.questions=[...n.questions,h()],S(()=>{var e,i;(i=(e=_.value)==null?void 0:e.forceUpdate)==null||i.call(e),S(()=>{const m=n.questions.length;requestAnimationFrame(()=>{var b;(b=_.value)==null||b.scrollToItem(m)})})})},q=e=>{if(n.questions.length<=1){g.warning(o("message.minimum_question",{number:1}));return}n.questions=[...n.questions.slice(0,e),...n.questions.slice(e+1)]},G=()=>{let e=!1,i=o("message.invalid_question"),m=new Set;if(n.name.trim().length>100||n.name.trim().length===0){e=!0,i=o("message.invalid_title"),g.error(i);return}if(n.description.trim().length>250){e=!0,i=o("message.invalid_description"),g.error(i);return}[n.questions.filter(a=>{const l=a.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return l.length===0||l.length>=500}),n.questions.filter(a=>(a.explainText?a.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),n.questions.filter(a=>a.type===C.MULTIPLE_CHOICE&&(a.multipleChoices.some(l=>l.text.trim().length===0||l.text.trim().length>500)||a.multipleChoices.filter(l=>l.isAnswer).length===0)),n.questions.filter(a=>a.type===C.MATCHING&&(a.matchingPairs.some(l=>l.leftItem.trim().length===0||l.leftItem.trim().length>500)||a.matchingPairs.some(l=>l.rightItem.trim().length===0||l.rightItem.trim().length>500))),n.questions.filter(a=>a.type===C.ORDERING&&a.orderingItems.some(l=>l.text.trim().length===0||l.text.trim().length>500)),n.questions.filter(a=>a.type===C.SHORT_TEXT&&(a.shortAnswer.trim().length===0||a.shortAnswer.trim().length>500))].forEach(a=>{a.length>0&&(e=!0,a.forEach(l=>m.add(l)))});let Q=Array.from(m).map(a=>n.questions.indexOf(a)+1);e?R.error({title:o("create_QS.modal.invalid.title"),content:o("create_QS.modal.invalid.content")+Q.sort().join(", "),okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel")}):O()},O=()=>{R.confirm({title:o("create_template.modal.valid.title"),content:o("create_QS.modal.valid.content"),okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{let e=await ne.Create(n);e.data.success&&(g.success(o("message.created_successfully")),T.value=!1,t.push({name:"User_TestTemplate_Detail",params:{id:e.data.data}}))}})},E=v(null),F=()=>{var e;(e=E.value)==null||e.openImportModal()},U=v(null),L=()=>{var e;(e=U.value)==null||e.openGenerateAIModal()},B=e=>{n.questions.unshift(...e.map((i,m)=>({...i,id:`new_${n.questions.length+m}`}))),S(()=>{var i,m;(m=(i=_.value)==null?void 0:i.forceUpdate)==null||m.call(i),S(()=>{const b=n.questions.length;requestAnimationFrame(()=>{var Q;(Q=_.value)==null||Q.scrollToItem(b)})})}),g.success(`${o("message.imported_question",{number:e.length})}`)};Z((e,i,m)=>{if(!T.value){m();return}R.confirm({title:o("create_QS.modal.leave.title"),content:o("create_QS.modal.leave.content"),okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),onOk:()=>{m()},onCancel:()=>m(!1)})});function A(e){e.preventDefault(),e.returnValue=""}J(()=>{window.removeEventListener("beforeunload",A)});const _=v(null),H=()=>{S(()=>{var e,i;(i=(e=_.value)==null?void 0:e.forceUpdate)==null||i.call(e)})};K(()=>{n.questions.push(h()),window.addEventListener("beforeunload",A)});const V={t:o,router:t,isDataValid:T,formRef:D,formState:n,rules:I,componentMap:w,createQuestionTemplate:h,onHandleChangeQuestionType:c,onAddQuestion:k,onRemoveQuestion:q,onFinish:G,showModalConfirmation:O,importModalRef:E,onOpenImportModal:F,generateModalRef:U,openGenerateAIModal:L,onModalImport:B,handleBeforeUnload:A,scrollerRef:_,handleScroll:H,Input:oe,TextArea:se,ImportQSModal:de,GenerateQSModal:ce,get DynamicScroller(){return ue},get DynamicScrollerItem(){return me}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),pe={class:"page-container"},_e={class:"title-container"},ge={class:"content"},he={class:"content-item"},qe={class:"content-item-title"},be={class:"d-flex"},ve={class:"content-item"},Se={class:"content-item-title"},Te={class:"content-item-buttons"},Ie={class:"import-button"};function Qe(u,r,o,t,T,D){const n=M("RouterLink"),I=M("a-col"),w=M("a-row"),h=M("a-form");return z(),$(te,null,[s("div",pe,[s("div",_e,[d(w,{class:"w-100 d-flex align-items-center"},{default:p(()=>[d(I,{span:1},{default:p(()=>[d(n,{to:{name:"User_TestTemplate"}},{default:p(()=>r[2]||(r[2]=[s("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[2]})]),_:1}),d(I,{class:"main-title",span:23},{default:p(()=>[s("span",null,f(u.$t("create_template.title")),1),r[3]||(r[3]=x()),r[4]||(r[4]=s("br",null,null,-1)),s("span",null,f(u.$t("create_QS.sub_title")),1)]),_:1,__:[3,4]})]),_:1})]),s("div",ge,[d(h,{layout:"vertical",model:t.formState,rules:t.rules,ref:"formRef"},{default:p(()=>[s("div",he,[s("div",qe,[s("div",null,[s("span",null,f(u.$t("create_QS.quiz.question_detail_title")),1),s("span",null,f(u.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(t.Input,{class:"question-input-item",modelValue:t.formState.name,"onUpdate:modelValue":r[0]||(r[0]=c=>t.formState.name=c),isRequired:!0,placeholder:t.t("question_sets_index.search_placeholder"),label:t.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),s("div",be,[d(t.TextArea,{class:"question-input-item",modelValue:t.formState.description,"onUpdate:modelValue":r[1]||(r[1]=c=>t.formState.description=c),placeholder:"textarea with clear icon","max-length":250,label:t.t("create_QS.quiz.description")},null,8,["modelValue","label"])])]),s("div",ve,[s("div",Se,[s("div",null,[s("span",null,f(u.$t("create_QS.quiz.question_question_title")),1),s("span",null,f(u.$t("create_QS.quiz.question_question_sub_title")),1)]),s("div",Te,[d(n,{onClick:t.onOpenImportModal,class:"import-button",to:{name:""}},{default:p(()=>[x(f(u.$t("create_QS.buttons.import"))+" ",1),r[5]||(r[5]=s("i",{class:"bx bx-download"},null,-1))]),_:1,__:[5]}),d(n,{onClick:t.openGenerateAIModal,class:"import-button",to:{name:""}},{default:p(()=>[x(f(u.$t("create_QS.buttons.generated_by_ai"))+" ",1),r[6]||(r[6]=s("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[6]}),s("div",{class:"import-button",onClick:t.onFinish},f(u.$t("create_QS.buttons.create")),1),s("div",Ie,f(u.$t("create_QS.quiz.total",{number:t.formState.questions.length.toString().padStart(3,"0")})),1)])]),d(t.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:t.formState.questions,"min-item-size":650,buffer:800,prerender:10,onScroll:t.handleScroll},{default:p(({item:c,index:k})=>[(z(),P(t.DynamicScrollerItem,{item:c,key:c.id},{default:p(()=>[(z(),P(ee(t.componentMap[c.type]),{question:c,index:t.formState.questions.findIndex(q=>q.id===c.id)+1,displayScore:!1,onDeleteQuestion:q=>t.onRemoveQuestion(k),onChangeQuestionType:q=>t.onHandleChangeQuestionType(c)},null,40,["question","index","onDeleteQuestion","onChangeQuestionType"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),s("div",{class:"add-question-btn",onClick:t.onAddQuestion},[r[7]||(r[7]=s("i",{class:"bx bx-plus"},null,-1)),x(" "+f(u.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["model"])])]),d(t.ImportQSModal,{ref:"importModalRef",title:t.formState.name,"number-of-question":t.formState.questions.length,onImport:t.onModalImport},null,8,["title","number-of-question"]),d(t.GenerateQSModal,{ref:"generateModalRef",title:t.formState.name,onImport:t.onModalImport,"number-of-question":t.formState.questions.length},null,8,["title","number-of-question"])],64)}const Ee=W(fe,[["render",Qe],["__scopeId","data-v-6115bf3d"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test_template/create.vue"]]);export{Ee as default};

import{d as N,u as j,l as W,i as S,j as X,a2 as Y,a3 as J,s as K,k as q,D as I,M as R,_ as Z,r as M,c as $,o as z,b as i,a as d,w as f,f as C,t as p,C as P,Q as ee,F as te}from"./index-DYogllWd.js";import{A as ne}from"./ApiTestTemplate-CaG46kYt.js";import{I as oe}from"./Input-B9N-kcVq.js";import{T as se}from"./vue-draggable-plus-BTPt8NmM.js";import{C as y,S as ae,O as ie,M as le,a as re,s as me,b as ue}from"./vue-virtual-scroller.esm-D8zwNwO1.js";import{G as ce,I as de}from"./GenerateQSModal-NmyTw0y5.js";import{Q as w}from"./questionTypes-CS3lcRlq.js";/* empty css                                                                 */import"./ApiQuestionSet-CIMPze6n.js";import"./languages-DtYW231W.js";const pe=N({__name:"create",setup(u,{expose:r}){r();const{t:a}=j(),e=W(),T=S(!0),D=S(),n=X({name:"",description:"",questions:[]}),Q={title:[{required:"true",message:a("message.required"),trigger:"change"},{length:100,message:a("message.out_of_range",{max_length:100}),trigger:"change"}],description:[{length:200,message:a("message.out_of_range",{max_length:100}),trigger:"change"}],questions:[{validator:(t,s)=>s&&s.length>500?Promise.reject(a("message.maximum_tag.limit_question",{number:500})):Promise.resolve(),trigger:"change"}]},k={MultipleChoice:re,Matching:le,Ordering:ie,ShortText:ae},b=()=>({id:"new_"+Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:y.defaultMultipleChoices(),matchingPairs:y.defaultMatchingPairs(),orderingItems:y.defaultOrderingItems(),shortAnswer:""}),c=t=>{y.onChangeQuestionType(t)},x=()=>{if(n.questions.length>=500){q.warning(a("message.limit_question",{number:500}));return}n.questions=[...n.questions,b()],I(()=>{var t,s;(s=(t=g.value)==null?void 0:t.forceUpdate)==null||s.call(t),I(()=>{const m=n.questions.length;requestAnimationFrame(()=>{var _;(_=g.value)==null||_.scrollToItem(m)})})})},v=t=>{if(n.questions.length<=1){q.warning(a("message.minimum_question",{number:1}));return}n.questions=[...n.questions.slice(0,t),...n.questions.slice(t+1)]},F=()=>{let t=!1,s=a("message.invalid_question"),m=new Set;if(n.name.trim().length>100||n.name.trim().length===0){t=!0,s=a("message.invalid_title"),q.error(s);return}if(n.description.trim().length>250){t=!0,s=a("message.invalid_description"),q.error(s);return}[n.questions.filter(o=>{const l=o.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return l.length===0||l.length>=5e3}),n.questions.filter(o=>(o.explainText?o.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=5e3),n.questions.filter(o=>o.type===w.MULTIPLE_CHOICE&&(o.multipleChoices.some(l=>l.text.trim().length===0||l.text.trim().length>1e3)||o.multipleChoices.filter(l=>l.isAnswer).length===0||o.multipleChoices.length<2)),n.questions.filter(o=>o.type===w.MATCHING&&(o.matchingPairs.some(l=>l.leftItem.trim().length===0||l.leftItem.trim().length>1e3)||o.matchingPairs.some(l=>l.rightItem.trim().length===0||l.rightItem.trim().length>1e3)||o.matchingPairs.length<2)),n.questions.filter(o=>o.type===w.ORDERING&&(o.orderingItems.some(l=>l.text.trim().length===0||l.text.trim().length>1e3)||o.orderingItems.length<2)),n.questions.filter(o=>o.type===w.SHORT_TEXT&&(o.shortAnswer.trim().length===0||o.shortAnswer.trim().length>1e3))].forEach(o=>{o.length>0&&(t=!0,o.forEach(l=>m.add(l)))});let h=Array.from(m).map(o=>n.questions.indexOf(o)+1);t?R.error({title:a("create_QS.modal.invalid.title"),content:a("create_QS.modal.invalid.content")+h.sort().join(", "),okText:a("sidebar.buttons.ok"),cancelText:a("sidebar.buttons.cancel")}):O()},O=()=>{R.confirm({title:a("create_template.modal.valid.title"),content:a("create_QS.modal.valid.content"),okText:a("sidebar.buttons.ok"),cancelText:a("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{n.questions=n.questions.map(s=>s.id.startsWith("new_")?{...s,questionId:null}:s);let t=await ne.Create(n);t.data.success&&(q.success(a("message.created_successfully")),T.value=!1,e.push({name:"User_TestTemplate_Detail",params:{id:t.data.data}}))}})},E=S(null),G=()=>{var t;(t=E.value)==null||t.openImportModal()},U=S(null),L=()=>{var t;(t=U.value)==null||t.openGenerateAIModal()},B=t=>{n.questions.unshift(...t.map((s,m)=>{var _;return{...s,id:`new_${n.questions.length+m}`,orderingItems:(_=s.orderingItems)==null?void 0:_.map((h,o)=>({...h,correctOrder:o}))}})),I(()=>{var s,m;(m=(s=g.value)==null?void 0:s.forceUpdate)==null||m.call(s),I(()=>{const _=n.questions.length;requestAnimationFrame(()=>{var h;(h=g.value)==null||h.scrollToItem(_)})})}),q.success(`${a("message.imported_question",{number:t.length})}`)};Y((t,s,m)=>{if(!T.value){m();return}R.confirm({title:a("create_QS.modal.leave.title"),content:a("create_QS.modal.leave.content"),okText:a("sidebar.buttons.ok"),cancelText:a("sidebar.buttons.cancel"),onOk:()=>{m()},onCancel:()=>m(!1)})});function A(t){t.preventDefault(),t.returnValue=""}J(()=>{window.removeEventListener("beforeunload",A)});const g=S(null),H=()=>{I(()=>{var t,s;(s=(t=g.value)==null?void 0:t.forceUpdate)==null||s.call(t)})};K(()=>{n.questions.push(b()),window.addEventListener("beforeunload",A)});const V={t:a,router:e,isDataValid:T,formRef:D,formState:n,rules:Q,componentMap:k,createQuestionTemplate:b,onHandleChangeQuestionType:c,onAddQuestion:x,onRemoveQuestion:v,onFinish:F,showModalConfirmation:O,importModalRef:E,onOpenImportModal:G,generateModalRef:U,openGenerateAIModal:L,onModalImport:B,handleBeforeUnload:A,scrollerRef:g,handleScroll:H,Input:oe,TextArea:se,ImportQSModal:de,GenerateQSModal:ce,get DynamicScroller(){return ue},get DynamicScrollerItem(){return me}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),fe={class:"page-container"},_e={class:"title-container"},ge={class:"content"},he={class:"content-item"},qe={class:"content-item-title"},be={class:"d-flex"},ve={class:"content-item"},Se={class:"content-item-title"},Ie={class:"content-item-buttons"},Te={class:"import-button"};function Qe(u,r,a,e,T,D){const n=M("RouterLink"),Q=M("a-col"),k=M("a-row"),b=M("a-form");return z(),$(te,null,[i("div",fe,[i("div",_e,[d(k,{class:"w-100 d-flex align-items-center"},{default:f(()=>[d(Q,{span:1},{default:f(()=>[d(n,{to:{name:"User_TestTemplate"}},{default:f(()=>r[2]||(r[2]=[i("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[2]})]),_:1}),d(Q,{class:"main-title",span:23},{default:f(()=>[i("span",null,p(u.$t("create_template.title")),1),r[3]||(r[3]=C()),r[4]||(r[4]=i("br",null,null,-1)),i("span",null,p(u.$t("create_QS.sub_title")),1)]),_:1,__:[3,4]})]),_:1})]),i("div",ge,[d(b,{layout:"vertical",model:e.formState,rules:e.rules,ref:"formRef"},{default:f(()=>[i("div",he,[i("div",qe,[i("div",null,[i("span",null,p(u.$t("create_QS.quiz.question_detail_title")),1),i("span",null,p(u.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":r[0]||(r[0]=c=>e.formState.name=c),isRequired:!0,placeholder:e.t("create_QS.other.title_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),i("div",be,[d(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":r[1]||(r[1]=c=>e.formState.description=c),placeholder:e.t("create_QS.other.description_placeholder"),"max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","placeholder","label"])])]),i("div",ve,[i("div",Se,[i("div",null,[i("span",null,p(u.$t("create_QS.quiz.question_question_title")),1),i("span",null,p(u.$t("create_QS.quiz.question_question_sub_title")),1)]),i("div",Ie,[d(n,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:f(()=>[C(p(u.$t("create_QS.buttons.import"))+" ",1),r[5]||(r[5]=i("i",{class:"bx bx-download"},null,-1))]),_:1,__:[5]}),d(n,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:f(()=>[C(p(u.$t("create_QS.buttons.generated_by_ai"))+" ",1),r[6]||(r[6]=i("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[6]}),i("div",{class:"import-button",onClick:e.onFinish},p(u.$t("create_QS.buttons.create")),1),i("div",Te,p(u.$t("create_QS.quiz.total",{number:e.formState.questions.length.toString().padStart(3,"0")})),1)])]),d(e.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.questions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:f(({item:c,index:x})=>[(z(),P(e.DynamicScrollerItem,{item:c,key:c.id},{default:f(()=>[(z(),P(ee(e.componentMap[c.type]),{question:c,index:e.formState.questions.findIndex(v=>v.id===c.id)+1,displayScore:!1,onDeleteQuestion:v=>e.onRemoveQuestion(x),onChangeQuestionType:v=>e.onHandleChangeQuestionType(c)},null,40,["question","index","onDeleteQuestion","onChangeQuestionType"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),i("div",{class:"add-question-btn",onClick:e.onAddQuestion},[r[7]||(r[7]=i("i",{class:"bx bx-plus"},null,-1)),C(" "+p(u.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["model"])])]),d(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,"number-of-question":e.formState.questions.length,onImport:e.onModalImport},null,8,["title","number-of-question"]),d(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport,"number-of-question":e.formState.questions.length},null,8,["title","number-of-question"])],64)}const Oe=Z(pe,[["render",Qe],["__scopeId","data-v-6115bf3d"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test_template/create.vue"]]);export{Oe as default};

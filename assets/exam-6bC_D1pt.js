import{a as m,I as W,d as Z,q as ee,l as te,u as se,i as C,z as ae,j as ne,E as oe,s as ie,R as F,M as le,k as re,D as ce,S as ue,_ as me,r as h,c as b,o as _,b as s,w as u,f as p,t as i,C as k,e as D,F as N,B as q}from"./index-DlVciecZ.js";import{A as z}from"./ApiClass-CeJRP6bx.js";import{A as de}from"./ApiTest-dQMCJSL8.js";import{C as _e}from"./classStudentPosition-B7ChrNvq.js";import{I as pe}from"./Input-DHZLWcQT.js";import{V as ge}from"./Validator-CWeiTIFe.js";import{U as ve}from"./UserTestAttempts-eUpAlvcA.js";import"./lodash-EHQdPzoY.js";var be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M688 312v-48c0-4.4-3.6-8-8-8H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8zm-392 88c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm376 116c-119.3 0-216 96.7-216 216s96.7 216 216 216 216-96.7 216-216-96.7-216-216-216zm107.5 323.5C750.8 868.2 712.6 884 672 884s-78.8-15.8-107.5-44.5C535.8 810.8 520 772.6 520 732s15.8-78.8 44.5-107.5C593.2 595.8 631.4 580 672 580s78.8 15.8 107.5 44.5C808.2 653.2 824 691.4 824 732s-15.8 78.8-44.5 107.5zM761 656h-44.3c-2.6 0-5 1.2-6.5 3.3l-63.5 87.8-23.1-31.9a7.92 7.92 0 00-6.5-3.3H573c-6.5 0-10.3 7.4-6.5 12.7l73.8 102.1c3.2 4.4 9.7 4.4 12.9 0l114.2-158c3.9-5.3.1-12.7-6.4-12.7zM440 852H208V148h560v344c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h272c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"file-done",theme:"outlined"};function V(o){for(var a=1;a<arguments.length;a++){var g=arguments[a]!=null?Object(arguments[a]):{},e=Object.keys(g);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(g).filter(function(d){return Object.getOwnPropertyDescriptor(g,d).enumerable}))),e.forEach(function(d){fe(o,d,g[d])})}return o}function fe(o,a,g){return a in o?Object.defineProperty(o,a,{value:g,enumerable:!0,configurable:!0,writable:!0}):o[a]=g,o}var R=function(a,g){var e=V({},a,g.attrs);return m(W,V({},e,{icon:be}),null)};R.displayName="FileDoneOutlined";R.inheritAttrs=!1;const x={ALL:"All",UPCOMING:"Upcoming",ACTIVE:"Active",COMPLETED:"Completed"},he=Z({__name:"exam",emits:["updateSidebar"],setup(o,{expose:a,emit:g}){var L;a();const e=ee(),d=te(),{t:c}=se(),S=g,v=C(e.params.id||""),I=C({classId:"",name:"",topic:""}),E=Object.values(x),T=ae(()=>E.map(t=>({label:c(`class_exam.select_option.${t}`),value:t!==x.ALL?t:""}))),l=ne({pageNumber:e.query.pageNumber||1,pageSize:e.query.pageSize||10,testName:((L=e.query.testName)==null?void 0:L.toString())||"",status:e.query.status||T.value[0].value,totalCount:0,statusFilter:!1}),y=C([]),A=C(""),O=C(!1),n=async()=>{try{const t=await z.GetUserPermission(I.value.classId);t.data.success&&(A.value=t.data.data)}catch(t){console.log(t)}},f=async()=>{try{if(!ge.isValidGuid(v.value.toString())){d.push({name:"404"});return}v.value||d.push({name:"404"});let t=await z.GetById(v.value.toString());t.data.success||d.push({name:"404"}),I.value=t.data.data}catch(t){const r=Object.keys(t.response.data.errors);if(r.includes(F.NOT_FOUND_STUDENT_IN_CLASS)||r.includes(F.NOT_FOUND_USER_IN_CLASS)){d.push({name:"User_Class"});return}}},U=async()=>{try{O.value=!0;let t=await z.GetAllExamByLimit(v.value.toString(),l);if(t.data.success){let r=t.data.data;y.value=r.items,l.pageNumber=r.pageNumber,l.pageSize=r.pageSize,l.totalCount=r.totalCount,l.statusFilter&&(l.pageNumber>r.totalPages&&l.totalCount>0?(l.pageNumber=1,d.push({name:"User_Class_Exam",params:{id:v.value},query:{pageNumber:1,pageSize:l.pageSize,testName:l.testName,status:l.status}})):d.push({name:"User_Class_Exam",params:{id:v.value},query:{pageNumber:l.pageNumber,pageSize:l.pageSize,testName:l.testName,status:l.status}}),l.statusFilter=!l.statusFilter)}}catch(t){console.log("ERROR: GETALLEXAMBYLIMIT class exam: "+t)}finally{O.value=!1}};oe(()=>Object.keys(e.query).length,()=>{var t;l.pageNumber=e.query.pageNumber||1,l.pageSize=e.query.pageSize||10,l.testName=((t=e.query.testName)==null?void 0:t.toString())||"",l.status=e.query.status||T.value[0].value,l.statusFilter=!0,U()});const j=(t,r)=>{l.pageNumber=t,l.pageSize=r,l.statusFilter=!0,U()},H=t=>{if(t<24)return`${t} ${c(t!==1?"settings.subscription.plan.hour_plural":"settings.subscription.plan.hour_singular")} ${c("class_exam.other.ago")}`;if(t<24*7){const r=Math.floor(t/24);return`${r} ${c(r!==1?"settings.subscription.plan.day_plural":"settings.subscription.plan.day_singular")} ${c("class_exam.other.ago")}`}else if(t<24*30){const r=Math.floor(t/168);return`${r} ${c(r!==1?"settings.subscription.plan.week_plural":"settings.subscription.plan.week_singular")} ${c("class_exam.other.ago")}`}else if(t<24*365){const r=Math.floor(t/720);return`${r} ${c(r!==1?"settings.subscription.plan.month_plural":"settings.subscription.plan.month_singular")} ${c("class_exam.other.ago")}`}else{const r=Math.floor(t/8760);return`${r} ${c(r!==1?"settings.subscription.plan.year_plural":"settings.subscription.plan.year_singular")} ${c("class_exam.other.ago")}`}},B=t=>{switch(t){case x.COMPLETED:return"#3b82f6";case x.ACTIVE:return"#22C55E";case x.UPCOMING:return"#f59e0b"}},G=()=>{d.push({name:"User_Test_Create",params:{id:v.value}})},$=t=>{d.push({name:"User_Test_Update",params:{id:t}})},Q=t=>{le.confirm({title:c("class_exam.modal.delete_title"),content:c("class_exam.modal.delete_content"),okText:c("sidebar.buttons.ok"),cancelText:c("sidebar.buttons.cancel"),onOk:async()=>{(await de.Delete(t)).data.success&&(re.success(c("message.deleted_successfully")),U())}})},X=t=>{d.push({name:"User_Test_Attempt",params:{id:t}})},Y=t=>{d.push({name:"User_Class_Exam_Result",params:{classId:v.value,testId:t}})},J=C({studentId:"",studentName:"",studentEmail:"",score:0,status:""}),P=C(y.value[0]||{testId:"",name:"",timeStart:"",timeLimit:0,numberOfQuestions:0,status:x.ACTIVE,relativeTime:0}),M=C(null),K=async t=>{var r;P.value=t,await ce(),(r=M.value)==null||r.openModal()};ie(async()=>{S("updateSidebar","class"),await f(),await n(),await U()});const w={route:e,router:d,t:c,emit:S,classId:v,classData:I,optionKeys:E,exam_status_options:T,pageParams:l,exam_data:y,userRoleInClass:A,loading:O,getPermission:n,getClassData:f,getData:U,onPaginationChange:j,getFormattedRelativeTime:H,getTagColor:B,onRedirectToCreate:G,onRedirectToUpdate:$,onDeleteTest:Q,onRedirectToAttempt:X,onRedirectToResult:Y,chosenUser:J,chosenExam:P,userHistoryModalRef:M,onOpenHistoryModal:K,get CLASS_STUDENT_POSITION(){return _e},get CLASS_EXAM_STATUS(){return x},get dayjs(){return ue},Input:pe,get FileDoneOutlined(){return R},UserTestAttempts:ve};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}}),Se={class:"page-container"},ye={class:"title-container"},Ce={class:"breadcrumb-container"},Te={class:"title-breadcrumb-item"},xe={class:"title-breadcrumb-item"},Ne={class:"breadcrumb-item-topic"},Ie={class:"content"},Oe={class:"content-item"},Ue={class:"content-item-title"},ke={class:"content-item-functions"},Ee={class:"content-item-navigators"},Ae={class:"navigator-container"},De={style:{width:"300px",padding:"0px"}},ze={key:0,class:"exam-item-container"},Re={class:"exam-item"},Pe={class:"exam-item-title"},Me={class:"exam-item-info exam-item-date"},we={class:"exam-item-info exam-info-detail"},Le={class:"exam-item-questions"},Fe={class:"exam-item-time"},qe={class:"exam-item-assigned completion"},Ve={key:0,class:"exam-item-assigned"},je={key:1,class:"exam-item-assigned"},He={class:"exam-item-actions"},Be=["onClick"],Ge=["onClick"],$e=["onClick"],Qe=["onClick"],Xe={key:1,class:"w-100 d-flex justify-content-center"},Ye={class:"pagination-container"};function Je(o,a,g,e,d,c){const S=h("RouterLink"),v=h("a-button"),I=h("a-select-option"),E=h("a-select"),T=h("a-skeleton"),l=h("a-tag"),y=h("a-tooltip"),A=h("a-empty"),O=h("a-pagination");return _(),b(N,null,[s("div",Se,[s("div",ye,[s("div",Ce,[s("ul",null,[s("li",Te,[m(S,{to:{name:"User_Class"}},{default:u(()=>[s("span",null,i(o.$t("class_index.title")),1),a[3]||(a[3]=p()),a[4]||(a[4]=s("br",null,null,-1))]),_:1,__:[3,4]}),a[5]||(a[5]=s("i",{class:"bx bx-chevron-right"},null,-1))]),s("li",xe,[m(S,{to:{name:""},class:"breadcrumb-item-class"},{default:u(()=>[s("span",null,i(e.classData.name),1),s("span",Ne,i(e.classData.topic),1)]),_:1})])])])]),s("div",Ie,[s("div",Oe,[s("div",Ue,[s("div",null,[s("span",null,i(o.$t("class_index.title")),1),s("span",null,i(o.$t("class_exam.sub_title")),1)]),e.userRoleInClass!==e.CLASS_STUDENT_POSITION.STUDENT?(_(),k(v,{key:0,type:"primary",class:"main-color-btn",onClick:e.onRedirectToCreate},{default:u(()=>[a[6]||(a[6]=s("i",{class:"me-2 bx bx-list-plus"},null,-1)),p(" "+i(o.$t("class_exam.buttons.assign_test")),1)]),_:1,__:[6]})):D("v-if",!0)]),s("div",ke,[s("div",Ee,[s("div",Ae,[m(S,{class:"navigator-item navigator-active",to:{name:""}},{default:u(()=>[p(i(o.$t("class_index.navigators.exam")),1)]),_:1}),m(S,{class:"navigator-item",to:{name:"User_Class_Quiz"}},{default:u(()=>[p(i(o.$t("class_index.navigators.quiz")),1)]),_:1}),m(S,{class:"navigator-item",to:{name:"User_Class_Student"}},{default:u(()=>[p(i(o.$t("class_index.navigators.member")),1)]),_:1})])]),m(E,{class:"me-3",value:e.pageParams.status,"onUpdate:value":a[0]||(a[0]=n=>e.pageParams.status=n),style:{width:"200px"},onChange:e.getData},{default:u(()=>[(_(!0),b(N,null,q(e.exam_status_options,n=>(_(),k(I,{value:n.value},{default:u(()=>[p(i(n.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"]),s("div",De,[m(e.Input,{onInput:e.getData,modelValue:e.pageParams.testName,"onUpdate:modelValue":a[1]||(a[1]=n=>e.pageParams.testName=n),placeholder:e.t("class_exam.other.search_placeholder")},{icon:u(()=>a[7]||(a[7]=[s("i",{class:"bx bx-search"},null,-1)])),_:1},8,["modelValue","placeholder"])])]),e.loading?(_(),b(N,{key:0},[m(T,{active:"",loading:e.loading},null,8,["loading"]),m(T,{active:"",loading:e.loading},null,8,["loading"]),m(T,{active:"",loading:e.loading},null,8,["loading"])],64)):(_(),b(N,{key:1},[e.exam_data.length>0?(_(),b("div",ze,[(_(!0),b(N,null,q(e.exam_data,n=>(_(),b("div",Re,[a[11]||(a[11]=s("i",{class:"bx bx-book-open exam-item-icon"},null,-1)),s("div",null,[s("div",Pe,[p(i(n.name)+" ",1),m(l,{color:e.getTagColor(n.status)},{default:u(()=>[p(i(o.$t(`class_exam.select_option.${n.status}`)),1)]),_:2},1032,["color"])]),s("div",Me,[s("div",null,[a[8]||(a[8]=s("i",{class:"bx bx-calendar"},null,-1)),p(" "+i(e.dayjs(n.timeStart).format("DD/MM/YYYY HH:mm A")),1)])]),s("div",we,[s("div",Le,[a[9]||(a[9]=s("i",{class:"bx bx-message-square-edit bx-rotate-270"},null,-1)),p(" "+i(n.numberOfQuestions)+" "+i(o.$t("dashboards.list_items.quiz.questions")),1)]),s("div",Fe,[a[10]||(a[10]=s("i",{class:"bx bx-time-five"},null,-1)),p(" "+i(n.timeLimit)+" "+i(o.$t("class_exam.other.min")),1)]),s("span",qe,i(n.numberOfCompletion)+" "+i(o.$t("class_exam.other.completions")),1),n.relativeTime>=0?(_(),b("span",Ve,i(o.$t("class_exam.other.assigned"))+" "+i(e.getFormattedRelativeTime(n.relativeTime)),1)):(_(),b("span",je,i(o.$t("class_exam.other.start_in"))+" "+i(n.relativeTime*-1)+" "+i(n.relativeTime*-1>0?o.$t("settings.subscription.plan.hour_plural"):o.$t("settings.subscription.plan.hour_singular")),1))])]),s("div",He,[n.status===e.CLASS_EXAM_STATUS.ACTIVE?(_(),k(v,{key:0,type:"primary",class:"main-color-btn",onClick:f=>e.onRedirectToAttempt(n.testId)},{default:u(()=>[p(i(o.$t("class_exam.buttons.attempt")),1)]),_:2},1032,["onClick"])):D("v-if",!0),e.userRoleInClass!==e.CLASS_STUDENT_POSITION.STUDENT?(_(),b(N,{key:1},[n.status===e.CLASS_EXAM_STATUS.UPCOMING?(_(),k(y,{key:0},{title:u(()=>[p(i(o.$t("question_sets_index.buttons.edit")),1)]),default:u(()=>[s("i",{class:"bx bx-edit",onClick:f=>e.onRedirectToUpdate(n.testId)},null,8,Be)]),_:2},1024)):D("v-if",!0),m(y,null,{title:u(()=>[p(i(o.$t("class_member.buttons.history_test")),1)]),default:u(()=>[s("i",{onClick:f=>e.onRedirectToResult(n.testId)},[m(e.FileDoneOutlined)],8,Ge)]),_:2},1024),m(y,null,{title:u(()=>[p(i(o.$t("question_sets_index.buttons.delete")),1)]),default:u(()=>[s("i",{class:"text-danger bx bx-trash-alt",onClick:f=>e.onDeleteTest(n.testId)},null,8,$e)]),_:2},1024)],64)):(_(),k(y,{key:2},{title:u(()=>[p(i(o.$t("class_member.buttons.history_test")),1)]),default:u(()=>[s("i",{onClick:f=>e.onOpenHistoryModal(n)},[m(e.FileDoneOutlined)],8,Qe)]),_:2},1024))])]))),256))])):(_(),b("div",Xe,[m(A,null,{description:u(()=>[s("span",null,i(o.$t("class_index.other.no_data_matches")),1)]),_:1})]))],64)),s("div",Ye,[m(O,{onChange:e.onPaginationChange,current:e.pageParams.pageNumber,"onUpdate:current":a[2]||(a[2]=n=>e.pageParams.pageNumber=n),total:e.pageParams.totalCount,pageSize:e.pageParams.pageSize,"show-total":(n,f)=>`${f[0]}-${f[1]} of ${n} ${e.t("class_exam.other.items")}`,"show-size-changer":"",class:"crud-layout-pagination",locale:{items_per_page:e.t("class_index.other.pages")}},null,8,["current","total","pageSize","show-total","locale"])])])])]),m(e.UserTestAttempts,{ref:"userHistoryModalRef","test-id":e.chosenExam.testId.toString(),"user-id":null,"test-name":e.chosenExam.name,"passing-score":0,"student-name":null},null,8,["test-id","test-name"])],64)}const ot=me(he,[["render",Je],["__scopeId","data-v-1afc52c6"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/class/exam.vue"]]);export{ot as default};

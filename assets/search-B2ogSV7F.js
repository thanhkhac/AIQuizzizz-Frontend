import{d as j,q as E,l as U,u as G,z as M,i as b,j as D,E as O,s as J,_ as Y,r as v,c as m,o as u,b as e,a as d,w as g,f as S,t as l,F as q,B as w,C as K,e as F,p as X}from"./index-DQ5VBJ-w.js";import{A as H}from"./ApiQuestionSet-D7H97fGN.js";import{A as W}from"./ApiTag-9OXcOKBe.js";import{Q as Z}from"./questionSetSortCate-BudA85fH.js";/* empty css                                                                 */import{I as $}from"./Input-Cgk3a5K5.js";const ee=j({__name:"search",setup(_,{expose:n}){var A;n();const r=E(),t=U(),{t:N}=G(),T=Object.values(Z),z=M(()=>T.map(o=>({label:N(`question_sets_search.sort_category.${o}`),value:o}))),y=b(!1),C=b([]),a=D({pageNumber:r.query.pageNumber||1,pageSize:r.query.pageSize||10,name:((A=r.query.name)==null?void 0:A.toString())||"",sortBy:r.query.sortBy||z.value[0].value,tagIds:r.query.tags?r.query.tags.toString().split(","):[],totalCount:0,statusFilter:!1}),h=async()=>{try{y.value=!0;let o=await H.GetPublicByLimit(a);if(o.data.success){let i=o.data.data;C.value=i.items,a.pageNumber=i.pageNumber,a.pageSize=i.pageSize,a.totalCount=i.totalCount,a.statusFilter&&(a.pageNumber>i.totalPages&&a.totalCount>0?(a.pageNumber=1,t.push({name:"User_QuestionSet_Search",query:{pageNumber:1,pageSize:a.pageSize,name:a.name,sortBy:a.sortBy,tagIds:a.tagIds.join(",")}})):t.push({name:"User_QuestionSet_Search",query:{pageNumber:a.pageNumber,pageSize:a.pageSize,name:a.name,sortBy:a.sortBy,tagIds:a.tagIds.join(",")}}),a.statusFilter=!a.statusFilter)}}catch(o){console.log("ERROR: GETALLEXAMBYLIMIT search qs: "+o)}finally{y.value=!1}};O(()=>Object.keys(r.query).length,()=>{var o;a.pageNumber=r.query.pageNumber||1,a.pageSize=r.query.pageSize||10,a.name=((o=r.query.name)==null?void 0:o.toString())||"",a.sortBy=r.query.sortBy||z.value[0].value,a.tagIds=r.query.tags?r.query.tags.toString().split(","):c.value.map(i=>i.id),a.statusFilter=!0,h()});const k=(o,i)=>{a.pageNumber=o,a.pageSize=i,a.statusFilter=!0,h()},c=b([]),f=b([]),I=()=>{const o=sessionStorage.getItem("selected_tags");o&&c.value.push(...JSON.parse(o)),a.tagIds=c.value.map(i=>i.id)},s=D({name:"",pageSize:10}),p=async()=>{if(s.name.trim().length>=50)return;const o=await W.GetAllByLimit(s);o.data.success&&(f.value=o.data.data,P.value=o.data.data,s.name.trim().length===0&&(f.value=[]))},B=o=>{c.value.map(i=>i.id).includes(o.id)||c.value.push(o),sessionStorage.setItem("selected_tags",JSON.stringify(c.value))},L=o=>{c.value.splice(o,1),sessionStorage.setItem("selected_tags",JSON.stringify(c.value))};O(()=>c.value.length,()=>{a.tagIds=c.value.map(o=>o.id),h()});const Q=b(null),P=b([]);function x(o){var i;!s.name||!((i=Q.value)!=null&&i.contains(o.target))?f.value=[]:f.value=[...P.value]}const V=o=>{t.push({name:"User_QuestionSet_Detail",params:{id:o}})};J(async()=>{document.addEventListener("click",x),I(),await h()});const R={route:r,router:t,t:N,optionKeys:T,sort_options:z,loading:y,quiz_data:C,pageParams:a,getData:h,onPaginationChange:k,selectedTags:c,tag_search_data:f,getSessionSelectedTag:I,searchTagPageParams:s,getSearchTagData:p,addTag:B,removeTag:L,searchResultRef:Q,lastSearchResult:P,handleMouseClickOutside:x,onRedirectToDetail:V,Input:$};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),te={class:"page-container"},ae={class:"title-container"},se={class:"content"},oe={class:"content-item"},ne={class:"content-item-title"},le={class:"d-flex justify-content-between"},ie={class:"form-item"},re={class:"form-item form-item-sort"},ce={class:"d-flex justify-content-between"},ue={class:"form-item form-item-tag"},de={class:"tag-container"},_e={class:"tag-item-qs-count"},me=["onClick"],ge={class:"search-bar",ref:"searchResultRef"},pe={key:0,class:X(["search-result-container"])},ve={class:"search-result"},he={class:"search-result-tag"},fe={class:"result-tag"},ye={class:"result-tag-qs-count"},be={class:"result-item-action"},Se={class:"content-item-title"},qe={key:0,class:"quiz-item-container"},ze={class:"quiz-item"},Ce={class:"quiz-item-title"},ke={class:"quiz-item-description"},Ie={class:"quiz-item-info quiz-info-detail"},we={class:"quiz-item-questions"},Ne={class:"quiz-item-created-by"},Te={class:"exam-item-actions"},Pe={key:1,class:"w-100 d-flex align-items-center justify-content-center quiz-item-container"},Be={class:"pagination-container"};function Qe(_,n,r,t,N,T){const z=v("RouterLink"),y=v("a-col"),C=v("a-row"),a=v("a-select-option"),h=v("a-select"),k=v("a-button"),c=v("a-skeleton"),f=v("a-empty"),I=v("a-pagination");return u(),m("div",te,[e("div",ae,[d(C,{class:"w-100 d-flex align-items-center"},{default:g(()=>[d(y,{span:1},{default:g(()=>[d(z,{to:{name:"User_Library"}},{default:g(()=>n[4]||(n[4]=[e("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[4]})]),_:1}),d(y,{class:"main-title",span:23},{default:g(()=>[e("span",null,l(_.$t("detail_QS.other.library")),1),n[5]||(n[5]=S()),n[6]||(n[6]=e("br",null,null,-1))]),_:1,__:[5,6]})]),_:1})]),e("div",se,[e("div",oe,[e("div",ne,[e("div",null,[e("span",null,l(_.$t("search_QS.title")),1),e("span",null,l(_.$t("search_QS.sub_title")),1)])]),e("div",le,[e("div",ie,[e("label",null,l(_.$t("search_QS.form.key_word")),1),d(t.Input,{onInput:t.getData,modelValue:t.pageParams.name,"onUpdate:modelValue":n[0]||(n[0]=s=>t.pageParams.name=s),placeholder:t.t("search_QS.form.key_word_placeholder")},{icon:g(()=>n[7]||(n[7]=[e("i",{class:"bx bx-search"},null,-1)])),_:1},8,["modelValue","placeholder"])]),e("div",re,[e("label",null,l(_.$t("search_QS.form.sort_by")),1),d(h,{value:t.pageParams.sortBy,"onUpdate:value":n[1]||(n[1]=s=>t.pageParams.sortBy=s),style:{width:"200px"},onChange:t.getData},{default:g(()=>[(u(!0),m(q,null,w(t.sort_options,s=>(u(),K(a,{value:s.value},{default:g(()=>[S(l(s.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])]),e("div",ce,[F(` <div class="form-item form-item-sort">
                        <label>Sort by</label>
                        <a-select
                            v-model:value="pageParams.sortBy"
                            style="width: 200px"
                            @change="getData"
                        >
                            <a-select-option v-for="option in sort_options" :value="option.value">
                                {{ option.label }}
                            </a-select-option>
                        </a-select>
                    </div> `),e("div",ue,[e("label",null,l(_.$t("create_QS.quiz.tag")),1),e("div",de,[(u(!0),m(q,null,w(t.selectedTags,(s,p)=>(u(),m("div",{class:"result-tag",key:p},[S(l(s.name)+" ",1),e("span",_e,l(s.questionSetCount),1),e("i",{class:"bx bx-x",onClick:B=>t.removeTag(p)},null,8,me)]))),128))]),e("div",ge,[d(t.Input,{onInput:t.getSearchTagData,modelValue:t.searchTagPageParams.name,"onUpdate:modelValue":n[2]||(n[2]=s=>t.searchTagPageParams.name=s),placeholder:t.t("search_QS.form.tag_placeholder")},null,8,["modelValue","placeholder"]),t.tag_search_data.length>0?(u(),m("div",pe,[e("div",ve,[(u(!0),m(q,null,w(t.tag_search_data,s=>(u(),m("div",he,[e("div",fe,[S(l(s.name)+" ",1),e("div",ye,l(s.questionSetCount),1)]),e("div",be,[d(k,{type:"primary",class:"main-color-btn",size:"small",onClick:p=>t.addTag(s)},{default:g(()=>[...n[8]||(n[8]=[e("i",{class:"bx bx-plus"},null,-1)])]),_:2,__:[8]},1032,["onClick"])])]))),256))])])):F("v-if",!0)],512)])]),e("div",Se,[e("div",null,[e("span",null,l(_.$t("search_QS.other.result_title",{number:t.quiz_data.length})),1)])]),t.loading?(u(),m(q,{key:0},[d(c,{loading:t.loading},null,8,["loading"]),d(c,{loading:t.loading},null,8,["loading"]),d(c,{loading:t.loading},null,8,["loading"])],64)):(u(),m(q,{key:1},[t.quiz_data.length>0?(u(),m("div",qe,[(u(!0),m(q,null,w(t.quiz_data,s=>(u(),m("div",ze,[n[10]||(n[10]=e("i",{class:"bx bx-book-open quiz-item-icon"},null,-1)),e("div",null,[e("div",Ce,l(s.name),1),e("div",ke,l(_.$t("search_QS.other.rating",{average:s.ratingAverage,count:s.ratingCount})),1),e("div",Ie,[e("div",we,[n[9]||(n[9]=e("i",{class:"bx bx-message-square-edit bx-rotate-270"},null,-1)),S(" "+l(s.totalQuestionCount)+" "+l(_.$t("dashboards.list_items.quiz.questions")),1)]),e("div",Ne,l(_.$t("class_question_set.other.created_by"))+" "+l(s.createBy),1)])]),e("div",Te,[d(k,{type:"primary",class:"me-3 main-color-btn",onClick:p=>t.onRedirectToDetail(s.id)},{default:g(()=>[S(l(_.$t("class_question_set.buttons.view")),1)]),_:2},1032,["onClick"])])]))),256))])):(u(),m("div",Pe,[d(f,null,{description:g(()=>[e("span",null,l(_.$t("class_index.other.no_data_matches")),1)]),_:1})]))],64)),e("div",Be,[d(I,{onChange:t.onPaginationChange,current:t.pageParams.pageNumber,"onUpdate:current":n[3]||(n[3]=s=>t.pageParams.pageNumber=s),total:t.pageParams.totalCount,pageSize:t.pageParams.pageSize,"show-total":(s,p)=>`${p[0]}-${p[1]} of ${s} ${t.t("class_question_set.other.items")}`,"show-size-changer":"",class:"crud-layout-pagination",locale:{items_per_page:t.t("class_index.other.pages")}},null,8,["current","total","pageSize","show-total","locale"])])])])])}const Le=Y(ee,[["render",Qe],["__scopeId","data-v-27ebb566"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/question_sets/search.vue"]]);export{Le as default};

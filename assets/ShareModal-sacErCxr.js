import{d as me,u as _e,g as ve,i as _,B as j,C as Z,j as he,s as pe,V as fe,k as q,_ as be,r as v,E as D,o as c,w as i,b as t,p as g,c as n,t as o,a as h,F as A,D as x,f as L,e as G}from"./index-BhCEM7Qr.js";import{A as $}from"./ApiQuestionSet-DcHTXIEH.js";import{A as ee}from"./ApiTestTemplate-GdvjRZpe.js";import{A as se}from"./ApiFolder-BZCwdVbU.js";import{I as ye}from"./Input-pAeduOdR.js";import{V as ae}from"./visibility-PZlBDoOn.js";const P={OWNER:"Owner",EDITABLE:"Editable",VIEW_ONLY:"ViewOnly"},Ie=me({__name:"ShareModal",props:{id:{type:String,required:!0},name:{type:String,required:!0},mode:{type:String,required:!0},visibility:{type:String,required:!0},options:{type:null,required:!0}},setup(u,{expose:l}){const{t:f}=_e(),e=ve(),F=_(e.getUserInfo()),Q=j(()=>{var d;return((d=a.value.find(V=>V.shareMode===P.OWNER))==null?void 0:d.userId)===F.value.id}),m=u,p=_(!1),S=async()=>{await O(),b.value=m.visibility||M.value[0].value,p.value=!0},U=()=>{p.value=!1};l({openModal:S});const w=Object.values(m.options),M=j(()=>w.map(s=>({label:f(`share_modal.visibility.${s}.mode`),value:s}))),b=_(m.visibility||M.value[0].value),C=_("");Z(()=>b.value,async s=>{C.value=f(`share_modal.visibility.${s}.explain`),s===ae.PRIVATE&&await O()});const y=[P.EDITABLE,P.VIEW_ONLY],N=j(()=>y.map(s=>({label:f(`share_modal.permission.${s}.mode`),value:s}))),W=_(N.value[0].value),k=_([{id:"1",name:"SEP490 - Summer 2025"},{id:"2",name:"MLN111 - Spring 2025"},{id:"3",name:"MLN121 - Spring 2025"}]),a=_([]),r=_(),Y=_([]),O=async()=>{let s;switch(m.mode){case"quiz":{s=await $.GetSharedUser(m.id);break}case"template":{s=await ee.GetSharedUser(m.id);break}case"folder":{s=await se.GetSharedUser(m.id);break}}s!=null&&s.data.success&&(a.value=s.data.data.sharingModel)},B=_(""),E=_([]),T=_([]),K=_(null);function H(s){var d;B.value&&!((d=K.value)!=null&&d.contains(s.target))?E.value=[]:E.value=[...T.value]}const te=async()=>{if(!B.value.trim()){E.value=[],T.value=[];return}const s=await fe.SearchByEmail(B.value);s.data.success&&(E.value=s.data.data,T.value=[...s.data.data])},R=async({sharingModels:s=[],deleteUserIds:d=[],successMsg:V="Updated successfully",errorMsg:ue="Update failed!"})=>{r.value={id:m.id,sharingModels:s,deleteUserIds:d};let I;switch(m.mode){case"quiz":{I=await $.UpdateSharedUser({...r.value,visibilityMode:b.value});break}case"template":{I=await ee.UpdateSharedUser(r.value);break}case"folder":{I=await se.UpdateSharedUser({folderId:r.value.id,...r.value});break}}I!=null&&I.data.success?(await O(),q.success(V)):q.error(ue)},le=async s=>{await R({sharingModels:[{sharingUserId:s.id,shareMode:P.VIEW_ONLY}],successMsg:"Added successfully",errorMsg:"Add failed!"})},ie=async(s,d)=>{await R({sharingModels:[{sharingUserId:s,shareMode:d}],successMsg:"Updated successfully",errorMsg:"Update failed!"})},ne=async s=>{Y.value.push(s),await R({sharingModels:[],deleteUserIds:Y.value,successMsg:"Removed successfully",errorMsg:"Remove failed!"})},oe=s=>a.value.some(d=>d.userId===s),z=he({checkAll:!1,indeterminate:!1,checkedList:[]});Z(()=>z.checkedList,s=>{var d;z.indeterminate=!!s.length&&s.length<k.value.map(V=>V.id).length,z.checkAll=s.length===((d=k.value)==null?void 0:d.length)});const re=()=>{U()},J=()=>window.location.origin+`/user/question-set/${m.id}`,de=()=>{navigator.clipboard.writeText(J()).then(()=>{q.success("Copied")}).catch(()=>{q.error("Empty")})},ce=async()=>{await R({sharingModels:[],successMsg:"Updated successfully",errorMsg:"Update failed!"})};pe(()=>{document.addEventListener("click",H),C.value=f(`share_modal.visibility.${b.value}.explain`)});const X={t:f,authStore:e,user:F,isUserOwner:Q,props:m,visibility:p,openModal:S,closeModal:U,visibilityKeys:w,visibility_options:M,selected_visibility_option:b,selected_visibility_explain:C,permissionKeys:y,permission_options:N,selected_permission_option:W,user_class_sample:k,sharedUser:a,sharingFormState:r,deleteUserIds:Y,getSharedUser:O,searchUserEmailValue:B,userFound:E,lastSearchResult:T,searchUserResultRef:K,handleMouseClickOutside:H,onSearchUser:te,updateSharedUsers:R,onShareWithResultUser:le,onChangePeoplePermission:ie,onConfirmRemovePeopleAccess:ne,isSharedUserContain:oe,shareClassState:z,onShareClass:re,getPublicShareUrl:J,onCopyPublicShareUrl:de,onChangeVisibility:ce,Input:ye,get VISIBILITY(){return ae},get PERMISSION(){return P}};return Object.defineProperty(X,"__isScriptSetup",{enumerable:!1,value:!0}),X}}),ge={class:"title-container"},Se={class:"visibility-explain"},Ue={key:0,class:"form-item search-user",ref:"searchUserResultRef"},we={key:0,class:g(["search-user-container"])},Me={class:"search-user-result"},Ce={class:"search-user-item"},ke={class:"user-item-email"},Ee={class:"list-item-section"},Re={class:"list-item-title"},Ve={class:"list-item-container"},Ae={class:"list-item"},xe={class:"people-access-info"},Le={class:"people-access-permission"},Pe={key:0,class:"ms-2 text-danger bx bx-trash"},Ne={class:"list-item-section"},Oe={class:"list-item-container"},Be={class:"list-item"},Te={class:"mt-3 d-flex justify-content-end"};function ze(u,l,f,e,F,Q){const m=v("RouterLink"),p=v("a-col"),S=v("a-row"),U=v("a-select-option"),w=v("a-select"),M=v("a-form-item"),b=v("a-qrcode"),C=v("a-input"),y=v("a-button"),N=v("a-popconfirm"),W=v("a-form"),k=v("a-modal");return c(),D(k,{centered:"",width:"100%","wrap-class-name":"medium-modal",open:e.visibility,onCancel:e.closeModal},{footer:i(()=>l[9]||(l[9]=[])),default:i(()=>[t("div",{class:g(["page-container",e.selected_visibility_option===e.VISIBILITY.PRIVATE?"larger":""])},[t("div",ge,[n(S,{class:"w-100 d-flex align-items-center justify-content-between"},{default:i(()=>[n(p,{span:1},{default:i(()=>[n(m,{to:{name:""},onClick:e.closeModal},{default:i(()=>l[2]||(l[2]=[t("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[2]})]),_:1}),n(p,{class:"main-title",span:22},{default:i(()=>[t("span",null,o(u.$t("share_modal.title"))+" "+o(u.$t(`share_modal.mode.${f.mode}`))+" "+o(f.name),1),l[3]||(l[3]=t("br",null,null,-1)),t("span",null,o(u.$t("share_modal.sub_title")),1)]),_:1,__:[3]})]),_:1})]),n(W,{layout:"vertical"},{default:i(()=>[n(S,{class:"p-3 d-flex justify-content-between"},{default:i(()=>[n(p,{span:24},{default:i(()=>[n(M,{label:u.$t("share_modal.component_title.visibility")},{default:i(()=>[n(w,{onChange:e.onChangeVisibility,class:"me-3",value:e.selected_visibility_option,"onUpdate:value":l[0]||(l[0]=a=>e.selected_visibility_option=a),style:{width:"200px"}},{default:i(()=>[(c(!0),h(A,null,x(e.visibility_options,a=>(c(),D(U,{value:a.value},{default:i(()=>[L(o(a.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"]),t("div",Se,o(e.selected_visibility_explain),1)]),_:1},8,["label"])]),_:1}),n(p,{span:24,class:g(["shareable-link-container",e.selected_visibility_option===e.VISIBILITY.PUBLIC?"":"d-none"])},{default:i(()=>[n(b,{value:e.getPublicShareUrl()},null,8,["value"]),t("div",null,[n(C,{class:"share-link",value:e.getPublicShareUrl()},null,8,["value"]),n(y,{class:"mt-2 main-color-btn",type:"primary",onClick:e.onCopyPublicShareUrl},{default:i(()=>[l[4]||(l[4]=t("i",{class:"me-3 bx bx-link-alt"},null,-1)),L(" "+o(u.$t("share_modal.buttons.copy_link")),1)]),_:1,__:[4]})])]),_:1},8,["class"]),n(p,{span:24,class:g([e.selected_visibility_option===e.VISIBILITY.PRIVATE?"":"d-none"])},{default:i(()=>[e.isUserOwner?(c(),h("div",Ue,[t("label",null,[L(o(u.$t("share_modal.component_title.share_with_email"))+" - ",1),l[5]||(l[5]=t("span",null,"enter full email to search user",-1))]),n(e.Input,{onChange:e.onSearchUser,value:e.searchUserEmailValue,"onUpdate:value":l[1]||(l[1]=a=>e.searchUserEmailValue=a),placeholder:e.t("share_modal.other.search_email_placeholder")},{icon:i(()=>l[6]||(l[6]=[t("i",{class:"bx bx-envelope"},null,-1)])),_:1},8,["value","placeholder"]),e.userFound.length>0?(c(),h("div",we,[t("div",Me,[(c(!0),h(A,null,x(e.userFound,a=>(c(),h("div",Ce,[t("div",ke,o(a.email),1),t("div",{class:g(["user-item-access",e.isSharedUserContain(a.id)?"d-none":""])},[n(y,{type:"primary",class:"main-color-btn",onClick:r=>e.onShareWithResultUser(a)},{default:i(()=>[...l[7]||(l[7]=[t("i",{class:"bx bxs-user-plus"},null,-1)])]),_:2,__:[7]},1032,["onClick"])],2)]))),256))])])):G("v-if",!0)],512)):G("v-if",!0),t("div",Ee,[t("div",Re,o(u.$t("share_modal.component_title.people_with_access",{number:e.sharedUser.length})),1),t("div",Ve,[(c(!0),h(A,null,x(e.sharedUser,a=>(c(),h("div",Ae,[l[8]||(l[8]=t("img",{class:"people-access-img",src:"",alt:""},null,-1)),t("div",xe,[t("span",null,o(a.fullName),1),t("span",null,o(a.email),1)]),t("div",Le,[n(w,{disabled:a.shareMode===e.PERMISSION.OWNER||a.userId===e.user.id,onChange:r=>e.onChangePeoplePermission(a.userId,a.shareMode),style:{width:"130px"},value:a.shareMode,"onUpdate:value":r=>a.shareMode=r},{default:i(()=>[(c(!0),h(A,null,x(e.permission_options,r=>(c(),D(U,{value:r.value},{default:i(()=>[L(o(r.label),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["disabled","onChange","value","onUpdate:value"]),n(N,{title:u.$t("share_modal.other.delete_warning"),"ok-text":u.$t("share_modal.buttons.yes"),"cancel-text":u.$t("share_modal.buttons.no"),onConfirm:r=>e.onConfirmRemovePeopleAccess(a.userId)},{default:i(()=>[a.userId!==e.user.id&&a.shareMode!==e.PERMISSION.OWNER?(c(),h("i",Pe)):G("v-if",!0)]),_:2},1032,["title","ok-text","cancel-text","onConfirm"])])]))),256))])])]),_:1},8,["class"]),n(p,{span:24,class:g([e.selected_visibility_option===e.VISIBILITY.IN_CLASS?"":"d-none"])},{default:i(()=>[t("div",Ne,[t("div",Oe,[(c(!0),h(A,null,x(e.user_class_sample,a=>(c(),h("div",Be,[t("span",null,o(a.name),1)]))),256))]),t("div",Te,[n(y,{type:"primary",class:"main-color-btn",size:"large",onClick:e.onShareClass},{default:i(()=>[L(o(u.$t("share_modal.buttons.done")),1)]),_:1})])])]),_:1},8,["class"])]),_:1})]),_:1})],2)]),_:1},8,["open"])}const Ge=be(Ie,[["render",ze],["__scopeId","data-v-a1cc234f"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/shared/modals/ShareModal.vue"]]);export{Ge as S};

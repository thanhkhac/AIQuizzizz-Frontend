import{d as ce,q as me,l as ue,u as _e,z as $,i as k,j as Q,E as ge,s as pe,R as V,k as b,M,v as ee,_ as be,r as g,c as v,o as u,b as a,a as l,e as D,w as n,f as p,t as d,C as z,F as h,B as ae}from"./index-DYogllWd.js";import{u as ve}from"./user-zaK1_Zi8.js";import{A as N}from"./ApiClass-C9JH0GiT.js";import{I as fe}from"./Input-B9N-kcVq.js";import{C as ye}from"./classStudentPosition-B7ChrNvq.js";import{V as Ce}from"./Validator-CWeiTIFe.js";const Se={FULL_NAME:"FullName",EMAIL:"Email"},ke=ce({__name:"student",emits:["updateSidebar"],setup(m,{expose:t,emit:K}){var Z;t();const e=me(),y=ue(),{t:o}=_e(),C=K,w=Object.values(Se),U=$(()=>w.map(s=>({label:o(`class_member.select_option.${s}`),value:s}))),_=k(e.params.id||""),S=k({classId:"",name:"",topic:""}),x=k(!1),j=[{title:"No",key:"no",customRender:s=>s.index+1},{title:o("class_member.column.fullName"),dataIndex:"fullName",key:"fullName",sorter:(s,c)=>s.fullName.localeCompare(c.fullName)},{title:o("class_member.column.email"),dataIndex:"email",key:"email",sorter:(s,c)=>s.email.localeCompare(c.email)},{title:o("class_member.column.position"),dataIndex:"position",key:"position"},{key:"action"}],F=[1,3,5,7,30],P=$(()=>F.map(s=>({label:s+o(s===1?"class_member.other.day_singular":"class_member.other.day_plural"),value:s}))),A=async()=>{try{if(!Ce.isValidGuid(_.value.toString())){y.push({name:"404"});return}_.value||y.push({name:"404"});let s=await N.GetById(_.value.toString());s.data.success||y.push({name:"404"}),S.value=s.data.data,L.name=S.value.name,L.topic=S.value.topic}catch(s){const c=Object.keys(s.response.data.errors);if(c.includes(V.NOT_FOUND_STUDENT_IN_CLASS)||c.includes(V.NOT_FOUND_USER_IN_CLASS)){y.push({name:"User_Class"});return}}},T=k(""),E=async()=>{try{const s=await N.GetUserPermission(S.value.classId);s.data.success&&(T.value=s.data.data)}catch(s){console.log(s)}},r=Q({pageNumber:e.query.pageNumber||1,pageSize:e.query.pageSize||10,keyword:((Z=e.query.keyword)==null?void 0:Z.toString())||"",fieldName:e.query.fieldName||U.value[0].value,totalCount:0,statusFilter:!1}),O=k([]),I=async()=>{try{x.value=!0;let s=await N.GetAllStudentByLimit(_.value.toString(),r);if(s.data.success){let c=s.data.data;O.value=c.items,r.pageNumber=c.pageNumber,r.pageSize=c.pageSize,r.totalCount=c.totalCount,r.statusFilter&&(r.pageNumber>c.totalPages&&r.totalCount>0?(r.pageNumber=1,y.push({name:"User_Class_Student",params:{id:_.value},query:{pageNumber:1,pageSize:r.pageSize,keyword:r.keyword,fieldName:r.fieldName}})):y.push({name:"User_Class_Student",params:{id:_.value},query:{pageNumber:r.pageNumber,pageSize:r.pageSize,keyword:r.keyword,fieldName:r.fieldName}}),r.statusFilter=!r.statusFilter)}}catch(s){const c=Object.keys(s.response.data.errors);(c.includes(V.NOT_FOUND_STUDENT_IN_CLASS)||c.includes(V.NOT_FOUND_USER_IN_CLASS))&&y.push({name:"User_Class"})}finally{x.value=!1}};ge(()=>Object.keys(e.query).length,()=>{var s;r.pageNumber=e.query.pageNumber||1,r.pageSize=e.query.pageSize||10,r.keyword=((s=e.query.keyword)==null?void 0:s.toString())||"",r.fieldName=e.query.fieldName||U.value[0].value,r.statusFilter=!0,I()});const B=(s,c)=>{r.pageNumber=s,r.pageSize=c,r.statusFilter=!0,I()},R=k(!1),i=Q({classId:_.value,code:"",expiredTime:P.value[0].value}),f=k(""),q=k(!1),W=async()=>{await H(),R.value=!0},H=async()=>{const s=await N.GetInivationCode(_.value.toString());s.data.data&&(i.code=s.data.data,f.value=window.location.origin+`/user/class/invitation/${i.code}`)},te=async()=>{(await N.CreateNewInvitation(i)).data.success?(b.success(o("message.created_new_invitation")),W()):b.error(o("message.created_failed"))},se=s=>{if(!i.code)return;let c=i.code;s==="link"&&(c=f.value),navigator.clipboard.writeText(c).then(()=>{b.success(o("message.copied"))}).catch(()=>{b.error(o("message.copied_failed"))})},ne=s=>{M.confirm({title:o("class_member.modal.delete_member_title"),content:o("class_member.modal.delete_member_content"),centered:!0,okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),onOk:async()=>{if(!(await N.DeleteClassMember(_.value.toString(),s.toString())).data.success){b.error(o("message.removed_failed"));return}b.success(o("message.removed_successfully")),await I()}})},le=(s,c)=>{M.confirm({title:o("class_member.modal.update_member_title"),content:o("class_member.modal.update_member_content"),centered:!0,okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),onOk:async()=>{if(!(await N.UpdateClassMemberPosition(_.value.toString(),s.toString(),c)).data.success){b.error(o("message.updated_failed"));return}b.success(o("message.updated_successfully")),await I()}})},oe=()=>{M.confirm({title:o("class_member.danger_zone.warning"),content:ee("div",{style:"color: red"},o("class_member.danger_zone.warning_explain")),centered:!0,okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),onOk:async()=>{if(!(await N.Delete(_.value.toString())).data.success){b.error(o("message.deleted_failed"));return}b.success(o("message.deleted_successfully")),y.push({name:"User_Class"})}})},ie=()=>{M.confirm({title:o("class_member.danger_zone.warning"),content:ee("div",{style:"color: red"},o("class_member.danger_zone.warning_explain")),centered:!0,okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),onOk:async()=>{if(!(await N.Delete(_.value.toString())).data.success){b.error(o("message.deleted_failed"));return}b.success(o("message.deleted_successfully")),y.push({name:"User_Class"})}})},re={name:[{required:!0,message:o("message.required"),trigger:"change"},{max:100,message:o("message.out_of_range",{max_length:100}),trigger:"change"}],topic:[{max:100,message:o("message.out_of_range",{max_length:100}),trigger:"change"}]},J=k(!1),X=k(),L=Q({name:S.value.name,topic:S.value.topic}),G=k(!1),de=async()=>{var s;G.value=!0;try{if((s=X.value)==null||s.validate(),!(await N.Update({classId:_.value,name:L.name,topic:L.topic})).data.success){b.error(o("message.updated_failed"));return}b.success(o("message.updated_successfully")),J.value=!1,window.location.reload()}catch(c){console.log(c)}finally{G.value=!1}};pe(async()=>{C("updateSidebar","class"),await A(),await E(),await I()});const Y={route:e,router:y,t:o,emit:C,optionKeys:w,class_position_options:U,classId:_,classData:S,loading:x,columns:j,optionDays:F,code_limit_time:P,getClassData:A,userRoleInClass:T,getPermission:E,pageParams:r,student_data:O,getData:I,onPaginationChange:B,modal_invitation_open:R,invitationFormState:i,inivitationLink:f,isInvitaionLoading:q,onOpenInvitationModal:W,getInvitationCode:H,onResetInvitation:te,onCopyInvitationCode:se,onConfirmDeleteMember:ne,onConfirmUpdateMemberPosition:le,onOpenConfirmDeleteClass:oe,onOpenConfirmLeaveClass:ie,rules:re,modal_update_open:J,updateClassFormRef:X,updateClassFormState:L,isUpdateLoading:G,onUpdateClass:de,get user_image(){return ve},Input:fe,get CLASS_STUDENT_POSITION(){return ye}};return Object.defineProperty(Y,"__isScriptSetup",{enumerable:!1,value:!0}),Y}}),Ne={class:"page-container"},Ie={class:"title-container"},we={class:"breadcrumb-container"},xe={class:"title-breadcrumb-item"},Te={key:0,class:"title-breadcrumb-item"},he={class:"breadcrumb-item-topic"},Ue={key:1,class:"title-breadcrumb-item"},Oe={class:"breadcrumb-item-topic"},De={class:"content"},ze={class:"content-item"},Ee={class:"content-item-title"},Le={class:"content-item-functions"},Fe={class:"content-item-navigators"},Pe={class:"navigator-container"},Ae={style:{width:"300px",padding:"0px"}},Re={key:0,class:"student-name-container"},qe=["src"],Ve={class:"student-name"},Me={key:0,class:"student-action"},je=["onClick"],Be=["onClick"],Ge=["onClick"],Qe={key:1,class:"w-100 d-flex justify-content-center"},Ke={class:"pagination-container"},We={key:0,class:"mt-4 content-item"},He={class:"content-item-title"},Je={class:"text-danger"},Xe={class:"danger-zone mt-3 p-4"},Ye={class:"text-danger fs-6 fw-bold"},Ze={class:"text-secondary"},$e={key:1,class:"mt-4 content-item"},ea={class:"modal-container"},aa={class:"modal-title-container"},ta={class:"modal-container"},sa={class:"modal-title-container"},na={class:"modal-invitation-body"},la={class:"invitation-code-container"},oa={class:"invitation-code-container"};function ia(m,t,K,e,y,o){const C=g("RouterLink"),w=g("a-button"),U=g("a-select-option"),_=g("a-select"),S=g("a-skeleton"),x=g("a-tooltip"),j=g("a-table"),F=g("a-config-provider"),P=g("a-empty"),A=g("a-pagination"),T=g("a-col"),E=g("a-row"),r=g("a-form-item"),O=g("a-form"),I=g("a-modal"),B=g("a-qrcode"),R=g("a-divider");return u(),v(h,null,[a("div",Ne,[a("div",Ie,[a("div",we,[a("ul",null,[a("li",xe,[l(C,{to:{name:"User_Class"}},{default:n(()=>[a("span",null,d(m.$t("class_index.title")),1),t[15]||(t[15]=p()),t[16]||(t[16]=a("br",null,null,-1))]),_:1,__:[15,16]}),t[17]||(t[17]=a("i",{class:"bx bx-chevron-right"},null,-1))]),e.userRoleInClass===e.CLASS_STUDENT_POSITION.OWNER?(u(),v("li",Te,[l(C,{to:{name:""},class:"breadcrumb-item-class",onClick:t[0]||(t[0]=i=>e.modal_update_open=!0)},{default:n(()=>[a("span",null,d(e.classData.name),1),a("span",he,d(e.classData.topic),1)]),_:1}),t[18]||(t[18]=a("i",{class:"bx bx-edit"},null,-1))])):(u(),v("li",Ue,[l(C,{to:{name:""},class:"breadcrumb-item-class"},{default:n(()=>[a("span",null,d(e.classData.name),1),a("span",Oe,d(e.classData.topic),1)]),_:1})]))])])]),a("div",De,[a("div",ze,[a("div",Ee,[a("div",null,[a("span",null,d(m.$t("class_member.title")),1),a("span",null,d(m.$t("class_member.sub_title")),1)]),e.userRoleInClass!==e.CLASS_STUDENT_POSITION.STUDENT?(u(),z(w,{key:0,class:"main-color-btn",type:"primary",size:"large",onClick:e.onOpenInvitationModal},{default:n(()=>[t[19]||(t[19]=a("i",{class:"me-2 bx bx-user-plus"},null,-1)),p(" "+d(m.$t("class_member.buttons.invite_member")),1)]),_:1,__:[19]})):D("v-if",!0)]),a("div",Le,[a("div",Fe,[a("div",Pe,[l(C,{class:"navigator-item",to:{name:"User_Class_Exam"}},{default:n(()=>[p(d(m.$t("class_index.navigators.exam")),1)]),_:1}),l(C,{class:"navigator-item",to:{name:"User_Class_Quiz"}},{default:n(()=>[p(d(m.$t("class_index.navigators.quiz")),1)]),_:1}),l(C,{class:"navigator-item navigator-active",to:{name:""}},{default:n(()=>[p(d(m.$t("class_index.navigators.member")),1)]),_:1})])]),l(_,{class:"me-3",value:e.pageParams.fieldName,"onUpdate:value":t[1]||(t[1]=i=>e.pageParams.fieldName=i),style:{width:"200px"},onChange:e.getData},{default:n(()=>[(u(!0),v(h,null,ae(e.class_position_options,i=>(u(),z(U,{value:i.value},{default:n(()=>[p(d(i.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"]),a("div",Ae,[l(e.Input,{onInput:e.getData,modelValue:e.pageParams.keyword,"onUpdate:modelValue":t[2]||(t[2]=i=>e.pageParams.keyword=i),placeholder:e.t("class_member.other.search_placeholder")},{icon:n(()=>t[20]||(t[20]=[a("i",{class:"bx bx-search"},null,-1)])),_:1},8,["modelValue","placeholder"])])]),e.loading?(u(),v(h,{key:0},[l(S,{active:"",loading:e.loading},null,8,["loading"]),l(S,{active:"",loading:e.loading},null,8,["loading"]),l(S,{active:"",loading:e.loading},null,8,["loading"])],64)):(u(),v(h,{key:1},[e.student_data.length>0?(u(),z(F,{key:0,locale:{Table:{cancelSort:"",triggerAsc:"",triggerDesc:""}}},{default:n(()=>[l(j,{columns:e.columns,"data-source":e.student_data,"row-key":"studentId",pagination:!1},{bodyCell:n(({column:i,record:f})=>[i.key==="fullName"?(u(),v("div",Re,[a("img",{class:"user-image",src:e.user_image,alt:""},null,8,qe),a("div",Ve,d(f.fullName),1)])):D("v-if",!0),i.key==="position"?(u(),v(h,{key:1},[p(d(m.$t(`class_member.position.${f.position}`)),1)],64)):D("v-if",!0),i.key==="action"?(u(),v(h,{key:2},[e.userRoleInClass===e.CLASS_STUDENT_POSITION.OWNER?(u(),v("div",Me,[f.position===e.CLASS_STUDENT_POSITION.STUDENT?(u(),z(x,{key:0},{title:n(()=>[p(d(m.$t("class_member.buttons.assign_lecturer")),1)]),default:n(()=>[a("i",{style:{cursor:"pointer"},class:"bx bxs-id-card",onClick:q=>e.onConfirmUpdateMemberPosition(f.studentId,e.CLASS_STUDENT_POSITION.TEACHER)},null,8,je)]),_:2},1024)):(u(),z(x,{key:1},{title:n(()=>[p(d(m.$t("class_member.buttons.remove_lecturer")),1)]),default:n(()=>[a("i",{class:"text-danger bx bxs-id-card",onClick:q=>e.onConfirmUpdateMemberPosition(f.studentId,e.CLASS_STUDENT_POSITION.STUDENT)},null,8,Be)]),_:2},1024)),l(x,null,{title:n(()=>[p(d(m.$t("question_sets_index.buttons.delete")),1)]),default:n(()=>[a("i",{class:"text-danger bx bx-trash-alt",onClick:q=>e.onConfirmDeleteMember(f.studentId)},null,8,Ge)]),_:2},1024)])):D("v-if",!0)],64)):D("v-if",!0)]),_:1},8,["data-source"])]),_:1})):(u(),v("div",Qe,[l(P,null,{description:n(()=>[a("span",null,d(m.$t("class_index.other.no_data_matches")),1)]),_:1})]))],64)),a("div",Ke,[l(A,{onChange:e.onPaginationChange,current:e.pageParams.pageNumber,"onUpdate:current":t[3]||(t[3]=i=>e.pageParams.pageNumber=i),total:e.pageParams.totalCount,pageSize:e.pageParams.pageSize,"show-total":(i,f)=>`${f[0]}-${f[1]} of ${i} ${e.t("class_member.other.items")}`,"show-size-changer":"","show-quick-jumper":"",class:"crud-layout-pagination",locale:{items_per_page:e.t("class_index.other.pages")}},null,8,["current","total","pageSize","show-total","locale"])])]),e.userRoleInClass===e.CLASS_STUDENT_POSITION.OWNER?(u(),v("div",We,[a("div",He,[a("div",null,[a("span",Je,d(m.$t("class_member.danger_zone.title")),1),a("span",null,d(m.$t("class_member.danger_zone.sub_title")),1)])]),a("div",Xe,[a("div",Ye,d(m.$t("class_member.danger_zone.warning")),1),a("div",Ze,d(m.$t("class_member.danger_zone.warning_explain")),1),l(w,{class:"mt-3",type:"primary",danger:"",size:"large",onClick:e.onOpenConfirmDeleteClass},{default:n(()=>[p(d(m.$t("class_member.buttons.delete_class")),1)]),_:1})])])):(u(),v("div",$e,[l(w,{class:"mt-3",type:"primary",danger:"",size:"large",onClick:e.onOpenConfirmLeaveClass},{default:n(()=>[p(d(m.$t("class_member.buttons.move_out_class"))+" ",1),t[21]||(t[21]=a("i",{class:"bx bx-download bx-rotate-270"},null,-1))]),_:1,__:[21]})]))])]),l(I,{centered:"","wrap-class-name":"medium-modal",open:e.modal_update_open,onCancel:t[7]||(t[7]=i=>e.modal_update_open=!1)},{footer:n(()=>[l(w,{loading:e.isUpdateLoading,class:"main-color-btn",key:"submit",type:"primary",onClick:e.onUpdateClass},{default:n(()=>[p(d(m.$t("update_QS.buttons.update")),1)]),_:1},8,["loading"])]),default:n(()=>[a("div",ea,[a("div",aa,[l(E,{class:"w-100 d-flex align-items-center"},{default:n(()=>[l(T,{span:4},{default:n(()=>[l(C,{onClick:t[4]||(t[4]=i=>e.modal_update_open=!1),to:{name:""}},{default:n(()=>t[22]||(t[22]=[a("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[22]})]),_:1}),l(T,{class:"main-title",span:20},{default:n(()=>[a("span",null,d(e.t("class_index.modal.update_title")),1)]),_:1})]),_:1})]),l(O,{ref:"updateClassFormRef",layout:"vertical",rules:e.rules,model:e.updateClassFormState},{default:n(()=>[l(r,null,{default:n(()=>[l(e.Input,{label:e.t("class_index.modal.create_class_name_label"),name:"name",modelValue:e.updateClassFormState.name,"onUpdate:modelValue":t[5]||(t[5]=i=>e.updateClassFormState.name=i),placeholder:e.t("class_index.modal.create_class_name_placeholder"),"is-required":!0,"max-length":100},null,8,["label","modelValue","placeholder"])]),_:1}),l(r,null,{default:n(()=>[l(e.Input,{label:e.t("class_index.modal.create_class_topic_label"),name:"topic",modelValue:e.updateClassFormState.topic,"onUpdate:modelValue":t[6]||(t[6]=i=>e.updateClassFormState.topic=i),placeholder:e.t("class_index.modal.create_class_topic_placeholder"),"max-length":100},null,8,["label","modelValue","placeholder"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open"]),D(" invitation modal "),l(I,{width:"750px",centered:"","wrap-class-name":"medium-modal",open:e.modal_invitation_open,onCancel:t[14]||(t[14]=i=>e.modal_invitation_open=!1)},{footer:n(()=>[l(O,{layout:"vertical",class:"w-100 d-flex align-items-end justify-content-between"},{default:n(()=>[l(r,{label:e.t("class_member.modal.time_limit_label")},{default:n(()=>[l(_,{value:e.invitationFormState.expiredTime,"onUpdate:value":t[13]||(t[13]=i=>e.invitationFormState.expiredTime=i),style:{width:"200px"},onChange:e.getData},{default:n(()=>[(u(!0),v(h,null,ae(e.code_limit_time,i=>(u(),z(U,{value:i.value},{default:n(()=>[p(d(i.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},8,["label"]),l(r,null,{default:n(()=>[l(w,{loading:e.isInvitaionLoading,class:"main-color-btn",key:"submit",type:"primary",onClick:e.onResetInvitation},{default:n(()=>[p(d(m.$t("class_member.buttons.reset_code")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),default:n(()=>[a("div",ta,[a("div",sa,[l(E,{class:"w-100 d-flex align-items-center"},{default:n(()=>[l(T,{span:2},{default:n(()=>[l(C,{onClick:t[8]||(t[8]=i=>e.modal_invitation_open=!1),to:{name:""}},{default:n(()=>t[23]||(t[23]=[a("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[23]})]),_:1}),l(T,{class:"main-title",span:22},{default:n(()=>[a("span",null,d(m.$t("class_member.modal.title")),1),t[24]||(t[24]=p()),t[25]||(t[25]=a("br",null,null,-1)),a("span",null,d(m.$t("class_member.modal.sub_title")),1)]),_:1,__:[24,25]})]),_:1})]),a("div",na,[l(B,{value:e.invitationFormState.code,class:"invitation-body-qrcode"},null,8,["value"]),l(O,{layout:"vertical",class:"invitation-body-link"},{default:n(()=>[l(r,{label:e.t("class_member.modal.class_code_label")},{default:n(()=>[a("div",la,[l(e.Input,{modelValue:e.invitationFormState.code,"onUpdate:modelValue":t[9]||(t[9]=i=>e.invitationFormState.code=i),"is-required":!0,"max-length":100,readonly:!0},null,8,["modelValue"]),a("i",{class:"bx bx-copy",onClick:t[10]||(t[10]=i=>e.onCopyInvitationCode("code"))})])]),_:1},8,["label"]),l(r,{label:e.t("class_member.modal.invitation_link")},{default:n(()=>[a("div",oa,[l(e.Input,{modelValue:e.inivitationLink,"onUpdate:modelValue":t[11]||(t[11]=i=>e.inivitationLink=i),"is-required":!0,"max-length":100,readonly:!0},null,8,["modelValue"]),a("i",{class:"bx bx-copy",onClick:t[12]||(t[12]=i=>e.onCopyInvitationCode("link"))})])]),_:1},8,["label"])]),_:1})]),l(R,null,{default:n(()=>[p(d(m.$t("class_member.modal.or")),1)]),_:1})])]),_:1},8,["open"])],64)}const pa=be(ke,[["render",ia],["__scopeId","data-v-6a35c450"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/class/student.vue"]]);export{pa as default};

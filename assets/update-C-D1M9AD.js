import{d as Z,u as $,l as ee,q as te,i as p,j as ne,V as ae,W as oe,s as re,k as v,X as A,M as k,_ as se,r as S,a as F,o as q,b as o,c as l,w as f,f as T,t as u,e as ie,G as N,N as le,F as de}from"./index-C2jtDg6B.js";import{A as C}from"./ApiTestTemplate-Ds5LzdWO.js";import{Q as b}from"./questionTypes-CS3lcRlq.js";import{T as ue}from"./TransferQuestionData-Bl0XXg5D.js";import{V as ce}from"./Validator-CWeiTIFe.js";import{I as me}from"./Input-0Otcuoto.js";import{T as pe}from"./TextArea-SkV_8IH8.js";import{S as fe,O as ge,M as _e,a as he,s as ve,b as Se}from"./vue-virtual-scroller.esm-D8MvBVCq.js";import{G as Qe,I as Ie}from"./GenerateQSModal-Cbah8nW_.js";/* empty css                                                                 */import"./vue-draggable-plus-DALPiNCD.js";const we=Z({__name:"update",setup(d,{expose:s}){s();const{t:R}=$(),t=ee(),U=te(),Q=p(!1),g=p(U.params.id),m=p({testTemplateId:"",name:"",questions:[]}),h=p(!0),_=async()=>{try{if(Q.value=!0,!ce.isValidGuid(g.value)){h.value=!1,t.push({name:"404"});return}await P();let e=await C.GetById(g.value);if(!e.data.success){h.value=!1,t.push({name:"404"});return}m.value=e.data.data,n.name=m.value.name,n.createUpdateQuestions=m.value.questions.map(a=>ue.transformResponseToRequest(a)),n.testTemplateId=m.value.testTemplateId,window.addEventListener("beforeunload",M)}catch(e){console.log(e)}finally{Q.value=!1}},y=p(),n=ne({testTemplateId:"",name:"",description:"",createUpdateQuestions:[],deleteQuestionIds:[]}),I={title:[{required:"true",message:"This field is required",trigger:"change"},{length:100,message:"Limit 100",trigger:"change"}],description:[{length:200,message:"Limit 200",trigger:"change"}],tags:[{validator:(e,a)=>a&&a.length>5?Promise.reject("You can only add up to 5 tags."):Promise.resolve(),trigger:"change"}],questions:[{validator:(e,a)=>a&&a.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},V={MultipleChoice:he,Matching:_e,Ordering:ge,ShortText:fe},z=()=>({id:`new_${Date.now().toString()}`,type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),B=()=>{if(n.createUpdateQuestions.length>=100){v.warning("Each question set could have at most 100 questions");return}n.createUpdateQuestions=[...n.createUpdateQuestions,z()],A(()=>{var e,a;(a=(e=w.value)==null?void 0:e.forceUpdate)==null||a.call(e),A(()=>{const c=n.createUpdateQuestions.length;requestAnimationFrame(()=>{var x;(x=w.value)==null||x.scrollToItem(c)})})})},j=e=>{if(n.createUpdateQuestions.length<=1){v.warning("Each question set must have at least 1 questions");return}const a=n.createUpdateQuestions[e].id;!a.startsWith("new_")&&a&&n.deleteQuestionIds.push(a),n.createUpdateQuestions=[...n.createUpdateQuestions.slice(0,e),...n.createUpdateQuestions.slice(e+1)]},H=()=>{let e=!1,a="Invalid question.",c=new Set;if(n.name.trim().length>100||n.name.trim().length===0){e=!0,a="Invalid title.",v.error(a);return}if(n.description.trim().length>250){e=!0,a="Invalid description.",v.error(a);return}[n.createUpdateQuestions.filter(r=>{const i=r.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return i.length===0||i.length>=500}),n.createUpdateQuestions.filter(r=>(r.explainText?r.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),n.createUpdateQuestions.filter(r=>r.type===b.MULTIPLE_CHOICE&&(r.multipleChoices.some(i=>i.text.trim().length===0||i.text.trim().length>500)||r.multipleChoices.filter(i=>i.isAnswer).length===0)),n.createUpdateQuestions.filter(r=>r.type===b.MATCHING&&(r.matchingPairs.some(i=>i.leftItem.trim().length===0||i.leftItem.trim().length>500)||r.matchingPairs.some(i=>i.rightItem.trim().length===0||i.rightItem.trim().length>500))),n.createUpdateQuestions.filter(r=>r.type===b.ORDERING&&r.orderingItems.some(i=>i.text.trim().length===0||i.text.trim().length>500)),n.createUpdateQuestions.filter(r=>r.type===b.SHORT_TEXT&&(r.shortAnswer.trim().length===0||r.shortAnswer.trim().length>500))].forEach(r=>{r.length>0&&(e=!0,r.forEach(i=>c.add(i)))});let K=Array.from(c).map(r=>n.createUpdateQuestions.indexOf(r)+1);e?k.error({title:"Cannot create new question set!",content:"There are errors at questions: "+K.sort().join(", ")}):O()},O=()=>{k.confirm({title:"Create new quiz!",content:"Make sure to review your contents before proceeding.",centered:!0,onOk:async()=>{n.createUpdateQuestions=n.createUpdateQuestions.map(a=>a.id.startsWith("new_")?{...a,id:""}:a);let e=await C.Update(m.value.testTemplateId,n);e.data.success&&v.success(e.data.data)}})},E=p(null),Y=()=>{var e;(e=E.value)==null||e.openImportModal()},G=p(null),W=()=>{var e;(e=G.value)==null||e.openGenerateAIModal()},X=e=>{n.createUpdateQuestions.push(...e.map((a,c)=>({...a,id:`new_${n.createUpdateQuestions.length+c}`}))),v.success(`Imported ${e.length} questions`)};function M(e){e.preventDefault(),e.returnValue=""}ae((e,a,c)=>{if(!h.value){c();return}k.confirm({title:"Leave already?",content:"You have unsaved changes.",onOk:()=>{c()},onCancel:()=>c(!1)})}),oe(()=>{window.removeEventListener("beforeunload",M)});const D=p({canEdit:!1,canDelete:!1}),P=async()=>{const e=await C.GetPermissions(g.value);e.data.success&&(D.value=e.data.data,D.value.canEdit||(h.value=!1,t.push({name:"404"})))},w=p(null),J=()=>{A(()=>{var e,a;(a=(e=w.value)==null?void 0:e.forceUpdate)==null||a.call(e)})};re(async()=>{await _()});const L={t:R,router:t,route:U,loading:Q,testTemplateId:g,testTemplate:m,isDataValid:h,getTestTemplate:_,formRef:y,formState:n,rules:I,componentMap:V,createQuestionTemplate:z,onAddQuestion:B,onRemoveQuestion:j,onFinish:H,showModalConfirmation:O,importModalRef:E,onOpenImportModal:Y,generateModalRef:G,openGenerateAIModal:W,onModalImport:X,handleBeforeUnload:M,permission:D,getPermission:P,scrollerRef:w,handleScroll:J,Input:me,TextArea:pe,ImportQSModal:Ie,GenerateQSModal:Qe,get DynamicScroller(){return Se},get DynamicScrollerItem(){return ve}};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}}),qe={class:"page-container"},Te={class:"title-container"},be={class:"content"},Ue={class:"content-item"},ye={class:"content-item-title"},Me={class:"d-flex"},De={class:"content-item"},xe={class:"content-item-title"},Ae={class:"content-item-buttons"},ke={class:"import-button"},Ce={key:0};function Re(d,s,R,t,U,Q){const g=S("RouterLink"),m=S("a-col"),h=S("a-row"),_=S("a-skeleton"),y=S("a-form");return q(),F(de,null,[o("div",qe,[o("div",Te,[l(h,{class:"w-100 d-flex align-items-center"},{default:f(()=>[l(m,{span:1},{default:f(()=>[l(g,{to:{name:"User_Folder"}},{default:f(()=>s[3]||(s[3]=[o("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[3]})]),_:1}),l(m,{class:"main-title",span:23},{default:f(()=>[o("span",null,u(d.$t("create_QS.title")),1),s[4]||(s[4]=T()),s[5]||(s[5]=o("br",null,null,-1)),o("span",null,u(d.$t("create_QS.sub_title")),1)]),_:1,__:[4,5]})]),_:1})]),o("div",be,[l(y,{layout:"vertical",modelValue:t.formState,"onUpdate:modelValue":s[2]||(s[2]=n=>t.formState=n),rules:t.rules,ref:"formRef"},{default:f(()=>[o("div",Ue,[o("div",ye,[o("div",null,[o("span",null,u(d.$t("create_QS.quiz.question_detail_title")),1),o("span",null,u(d.$t("create_QS.quiz.question_detail_sub_title")),1)])]),l(t.Input,{class:"question-input-item",modelValue:t.formState.name,"onUpdate:modelValue":s[0]||(s[0]=n=>t.formState.name=n),isRequired:!0,placeholder:t.t("question_sets_index.search_placeholder"),label:t.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),o("div",Me,[l(t.TextArea,{class:"question-input-item",modelValue:t.formState.description,"onUpdate:modelValue":s[1]||(s[1]=n=>t.formState.description=n),placeholder:"textarea with clear icon","max-length":250,label:t.t("create_QS.quiz.description")},null,8,["modelValue","label"])])]),o("div",De,[o("div",xe,[o("div",null,[o("span",null,u(d.$t("create_QS.quiz.question_question_title")),1),o("span",null,u(d.$t("create_QS.quiz.question_question_sub_title")),1)]),o("div",Ae,[l(g,{onClick:t.onOpenImportModal,class:"import-button",to:{name:""}},{default:f(()=>[T(u(d.$t("create_QS.buttons.import"))+" ",1),s[6]||(s[6]=o("i",{class:"bx bx-download"},null,-1))]),_:1,__:[6]}),l(g,{onClick:t.openGenerateAIModal,class:"import-button",to:{name:""}},{default:f(()=>[T(u(d.$t("create_QS.buttons.generated_by_ai"))+" ",1),s[7]||(s[7]=o("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[7]}),o("div",{class:"import-button",onClick:t.onFinish},u(d.$t("create_QS.buttons.create")),1),o("div",ke,u(d.$t("create_QS.quiz.total",{number:t.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1)])]),t.loading?(q(),F("div",Ce,[l(_,{loading:t.loading,active:""},null,8,["loading"]),l(_,{loading:t.loading,active:""},null,8,["loading"]),l(_,{loading:t.loading,active:""},null,8,["loading"]),l(_,{loading:t.loading,active:""},null,8,["loading"]),l(_,{loading:t.loading,active:""},null,8,["loading"])])):ie("v-if",!0),l(t.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:t.formState.createUpdateQuestions,"min-item-size":650,buffer:800,prerender:10,onScroll:t.handleScroll},{default:f(({item:n,index:I})=>[(q(),N(t.DynamicScrollerItem,{item:n,key:n.id},{default:f(()=>[(q(),N(le(t.componentMap[n.type]),{question:n,index:I+1,displayScore:!1,onDeleteQuestion:V=>t.onRemoveQuestion(I)},null,40,["question","index","onDeleteQuestion"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),o("div",{class:"add-question-btn",onClick:t.onAddQuestion},[s[8]||(s[8]=o("i",{class:"bx bx-plus"},null,-1)),T(" "+u(d.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),l(t.ImportQSModal,{ref:"importModalRef",title:t.formState.name,onImport:t.onModalImport},null,8,["title"]),l(t.GenerateQSModal,{ref:"generateModalRef",title:t.formState.name,onImport:t.onModalImport},null,8,["title"])],64)}const He=se(we,[["render",Re],["__scopeId","data-v-48787c2a"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test_template/update.vue"]]);export{He as default};

import{d as ee,u as te,l as ne,q as ae,i as f,j as oe,a2 as se,a3 as ie,s as le,k as Q,D as z,M as D,_ as re,r as I,c as N,o as U,b as i,a as d,w as g,f as y,t as m,e as de,C as H,Q as ue,F as me}from"./index--4eqDeQq.js";import{A as O}from"./ApiTestTemplate-Sk4Z8YU1.js";import{Q as M}from"./questionTypes-CS3lcRlq.js";import{T as ce}from"./TransferQuestionData-BxcXdBjq.js";import{V as pe}from"./Validator-CWeiTIFe.js";import{I as fe}from"./Input-OvzKKxPx.js";import{T as ge}from"./vue-draggable-plus-C9QOeUr4.js";import{C as w,S as _e,O as he,M as ve,a as Qe,s as be,b as Se}from"./vue-virtual-scroller.esm-mOm_49WC.js";import{G as Ie,I as Te}from"./GenerateQSModal-BvxjYBTw.js";import"./lodash-DVCQFWkP.js";/* empty css                                                                 */import"./ApiQuestionSet-CHCQ695S.js";import"./languages-DtYW231W.js";const qe=ee({__name:"update",setup(u,{expose:l}){l();const{t:s}=te(),e=ne(),C=ae(),T=f(!1),_=f(C.params.id),c=f({testTemplateId:"",name:"",questions:[]}),h=f(!0),v=async()=>{try{if(T.value=!0,!pe.isValidGuid(_.value)){h.value=!1,e.push({name:"404"});return}await L();let t=await O.GetById(_.value);if(!t.data.success){h.value=!1,e.push({name:"404"});return}c.value=t.data.data,c.value.questions=t.data.data.questions.map(a=>({id:a.questionId,...a})),n.name=c.value.name,n.createUpdateQuestions=c.value.questions.map(a=>ce.transformResponseToRequest(a)),n.testTemplateId=c.value.testTemplateId,window.addEventListener("beforeunload",R)}catch(t){console.log(t)}finally{T.value=!1}},k=f(),n=oe({testTemplateId:"",name:"",description:"",createUpdateQuestions:[],deleteQuestionIds:[]}),x={title:[{required:"true",message:s("message.required"),trigger:"change"},{length:100,message:s("message.out_of_range",{max_length:100}),trigger:"change"}],description:[{length:200,message:s("message.out_of_range",{max_length:200}),trigger:"change"}],questions:[{validator:(t,a)=>a&&a.length>500?Promise.reject(s("message.maximum_tag.limit_question",{number:500})):Promise.resolve(),trigger:"change"}]},b={MultipleChoice:Qe,Matching:ve,Ordering:he,ShortText:_e},E=()=>({id:"new_"+Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:w.defaultMultipleChoices(),matchingPairs:w.defaultMatchingPairs(),orderingItems:w.defaultOrderingItems(),shortAnswer:""}),j=t=>{w.onChangeQuestionType(t)},W=()=>{if(n.createUpdateQuestions.length>=500){Q.warning(s("message.limit_question",{number:500}));return}n.createUpdateQuestions=[...n.createUpdateQuestions,E()],z(()=>{var t,a;(a=(t=q.value)==null?void 0:t.forceUpdate)==null||a.call(t),z(()=>{const p=n.createUpdateQuestions.length;requestAnimationFrame(()=>{var S;(S=q.value)==null||S.scrollToItem(p)})})})},X=t=>{if(n.createUpdateQuestions.length<=1){Q.warning(s("message.minimum_question",{number:1}));return}const a=n.createUpdateQuestions[t].id;!a.startsWith("new_")&&a&&n.deleteQuestionIds.push(a),n.createUpdateQuestions=[...n.createUpdateQuestions.slice(0,t),...n.createUpdateQuestions.slice(t+1)]},Y=()=>{let t=!1,a=s("message.invalid_question"),p=new Set;if(n.name.trim().length>100||n.name.trim().length===0){t=!0,a=s("message.invalid_title"),Q.error(a);return}if(n.description.trim().length>250){t=!0,a=s("message.invalid_description"),Q.error(a);return}[n.createUpdateQuestions.filter(o=>{const r=o.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return r.length===0||r.length>=5e3}),n.createUpdateQuestions.filter(o=>(o.explainText?o.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=5e3),n.createUpdateQuestions.filter(o=>o.type===M.MULTIPLE_CHOICE&&(o.multipleChoices.some(r=>r.text.trim().length===0||r.text.trim().length>1e3)||o.multipleChoices.filter(r=>r.isAnswer).length===0||o.multipleChoices.length<2)),n.createUpdateQuestions.filter(o=>o.type===M.MATCHING&&(o.matchingPairs.some(r=>r.leftItem.trim().length===0||r.leftItem.trim().length>1e3)||o.matchingPairs.some(r=>r.rightItem.trim().length===0||r.rightItem.trim().length>1e3)||o.matchingPairs.length<2)),n.createUpdateQuestions.filter(o=>o.type===M.ORDERING&&(o.orderingItems.some(r=>r.text.trim().length===0||r.text.trim().length>1e3)||o.orderingItems.length<2)),n.createUpdateQuestions.filter(o=>o.type===M.SHORT_TEXT&&(o.shortAnswer.trim().length===0||o.shortAnswer.trim().length>1e3))].forEach(o=>{o.length>0&&(t=!0,o.forEach(r=>p.add(r)))});let V=Array.from(p).map(o=>n.createUpdateQuestions.indexOf(o)+1);t?D.error({title:s("create_QS.modal.invalid.title"),content:s("create_QS.modal.invalid.content")+V.sort().join(", "),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel")}):P()},P=()=>{D.confirm({title:s("create_template.modal.valid.title"),content:s("create_QS.modal.valid.content"),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{let t=await O.Update(c.value.testTemplateId,{...n,createUpdateQuestions:n.createUpdateQuestions.map(a=>({questionId:a.id.startsWith("new_")?null:a.id,...a}))});t.data.success&&(Q.success(s("message.updated_successfully")),h.value=!1,e.push({name:"User_TestTemplate_Detail",params:{id:t.data.data}}))}})},G=f(null),J=()=>{var t;(t=G.value)==null||t.openImportModal()},F=f(null),K=()=>{var t;(t=F.value)==null||t.openGenerateAIModal()},Z=t=>{n.createUpdateQuestions.push(...t.map((a,p)=>({...a,id:`new_${n.createUpdateQuestions.length+p}`,orderingItems:a.orderingItems.map((S,V)=>({...S,correctOrder:V}))}))),Q.success(`${s("message.imported_question",{number:t.length})}`)};function R(t){t.preventDefault(),t.returnValue=""}se((t,a,p)=>{if(!h.value){p();return}D.confirm({title:s("create_QS.modal.leave.title"),content:s("create_QS.modal.leave.content"),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),onOk:()=>{p()},onCancel:()=>p(!1)})}),ie(()=>{window.removeEventListener("beforeunload",R)});const A=f({canEdit:!1,canDelete:!1}),L=async()=>{const t=await O.GetPermissions(_.value);t.data.success&&(A.value=t.data.data,A.value.canEdit||(h.value=!1,e.push({name:"404"})))},q=f(null),$=()=>{z(()=>{var t,a;(a=(t=q.value)==null?void 0:t.forceUpdate)==null||a.call(t)})};le(async()=>{await v()});const B={t:s,router:e,route:C,loading:T,testTemplateId:_,testTemplate:c,isDataValid:h,getTestTemplate:v,formRef:k,formState:n,rules:x,componentMap:b,createQuestionTemplate:E,onHandleChangeQuestionType:j,onAddQuestion:W,onRemoveQuestion:X,onFinish:Y,showModalConfirmation:P,importModalRef:G,onOpenImportModal:J,generateModalRef:F,openGenerateAIModal:K,onModalImport:Z,handleBeforeUnload:R,permission:A,getPermission:L,scrollerRef:q,handleScroll:$,Input:fe,TextArea:ge,ImportQSModal:Te,GenerateQSModal:Ie,get DynamicScroller(){return Se},get DynamicScrollerItem(){return be}};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),Ue={class:"page-container"},ye={class:"title-container"},Me={class:"content"},we={class:"content-item"},Ce={class:"content-item-title"},ke={class:"d-flex"},xe={class:"content-item"},Re={class:"content-item-title"},Ae={class:"content-item-buttons"},Ve={class:"import-button"},ze={key:0};function De(u,l,s,e,C,T){const _=I("RouterLink"),c=I("a-col"),h=I("a-row"),v=I("a-skeleton"),k=I("a-form");return U(),N(me,null,[i("div",Ue,[i("div",ye,[d(h,{class:"w-100 d-flex align-items-center"},{default:g(()=>[d(c,{span:1},{default:g(()=>[d(_,{to:{name:"User_Folder"}},{default:g(()=>l[3]||(l[3]=[i("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[3]})]),_:1}),d(c,{class:"main-title",span:23},{default:g(()=>[i("span",null,m(u.$t("update_template.title",{name:e.formState.name})),1),l[4]||(l[4]=y()),l[5]||(l[5]=i("br",null,null,-1)),i("span",null,m(u.$t("create_QS.sub_title")),1)]),_:1,__:[4,5]})]),_:1})]),i("div",Me,[d(k,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":l[2]||(l[2]=n=>e.formState=n),rules:e.rules,ref:"formRef"},{default:g(()=>[i("div",we,[i("div",Ce,[i("div",null,[i("span",null,m(u.$t("create_QS.quiz.question_detail_title")),1),i("span",null,m(u.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":l[0]||(l[0]=n=>e.formState.name=n),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),i("div",ke,[d(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":l[1]||(l[1]=n=>e.formState.description=n),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"])])]),i("div",xe,[i("div",Re,[i("div",null,[i("span",null,m(u.$t("create_QS.quiz.question_question_title")),1),i("span",null,m(u.$t("create_QS.quiz.question_question_sub_title")),1)]),i("div",Ae,[d(_,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:g(()=>[y(m(u.$t("create_QS.buttons.import"))+" ",1),l[6]||(l[6]=i("i",{class:"bx bx-download"},null,-1))]),_:1,__:[6]}),d(_,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:g(()=>[y(m(u.$t("create_QS.buttons.generated_by_ai"))+" ",1),l[7]||(l[7]=i("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[7]}),i("div",{class:"import-button",onClick:e.onFinish},m(u.$t("update_QS.buttons.update")),1),i("div",Ve,m(u.$t("create_QS.quiz.total",{number:e.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1)])]),e.loading?(U(),N("div",ze,[d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"])])):de("v-if",!0),d(e.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.createUpdateQuestions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:g(({item:n,index:x})=>[(U(),H(e.DynamicScrollerItem,{item:n,key:n.id},{default:g(()=>[(U(),H(ue(e.componentMap[n.type]),{question:n,index:e.formState.createUpdateQuestions.findIndex(b=>b.id===n.id)+1,displayScore:!1,onDeleteQuestion:b=>e.onRemoveQuestion(x),onChangeQuestionType:b=>e.onHandleChangeQuestionType(n)},null,40,["question","index","onDeleteQuestion","onChangeQuestionType"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),i("div",{class:"add-question-btn",onClick:e.onAddQuestion},[l[8]||(l[8]=i("i",{class:"bx bx-plus"},null,-1)),y(" "+m(u.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),d(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,"number-of-question":e.formState.createUpdateQuestions.length,onImport:e.onModalImport},null,8,["title","number-of-question"]),d(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport,"number-of-question":e.formState.createUpdateQuestions.length},null,8,["title","number-of-question"])],64)}const Je=re(qe,[["render",De],["__scopeId","data-v-48787c2a"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test_template/update.vue"]]);export{Je as default};

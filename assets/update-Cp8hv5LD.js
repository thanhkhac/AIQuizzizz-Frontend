import{d as pe,u as ge,l as _e,q as fe,i as p,j as ee,E as he,a2 as ve,a3 as Qe,s as Se,k as v,D as P,M as G,_ as be,r as y,c as T,o as f,b as n,a as d,w as _,f as C,t as u,F as B,B as te,e as ae,p as Ie,C as F,Q as Te}from"./index--4eqDeQq.js";import{A as N}from"./ApiQuestionSet-CHCQ695S.js";import{A as qe}from"./ApiTag-e5CK6svL.js";import{Q as A}from"./questionTypes-CS3lcRlq.js";import{T as ye}from"./TransferQuestionData-BxcXdBjq.js";import{V as Ce}from"./Validator-CWeiTIFe.js";import{I as Ue}from"./Input-OvzKKxPx.js";import{T as ke}from"./vue-draggable-plus-C9QOeUr4.js";import{C as V,S as xe,O as we,M as Me,a as Re,s as Ae,b as Ve}from"./vue-virtual-scroller.esm-mOm_49WC.js";import{G as ze,I as De}from"./GenerateQSModal-BvxjYBTw.js";/* empty css                                                                 */import"./ApiTestTemplate-Sk4Z8YU1.js";import"./languages-DtYW231W.js";const Oe=pe({__name:"update",setup(m,{expose:s}){s();const{t:i}=ge(),e=_e(),z=fe(),w=p(!1),h=p(z.params.id),Q=p({id:"",name:"",description:"",tags:[]}),U=p([]),b=p(!0),S=async()=>{if(w.value=!0,!Ce.isValidGuid(h.value)){b.value=!1,e.push({name:"404"});return}let a=await N.GetDetailById(h.value),o=await N.GetQuestionById(h.value);if(!a.data.success||!o.data.success){b.value=!1,e.push({name:"404"});return}Q.value=a.data.data,U.value=o.data.data,t.name=Q.value.name,t.description=Q.value.description,t.createUpdateQuestions=U.value.map(c=>ye.transformResponseToRequest(c)),t.tags=Q.value.tags.map(c=>c.name),w.value=!1,window.addEventListener("beforeunload",L)},D=p(),t=ee({name:"",description:"",createUpdateQuestions:[],deleteQuestionIds:[],tags:[]}),I={title:[{required:"true",message:"This field is required",trigger:"change"},{length:100,message:"Limit 100",trigger:"change"}],description:[{length:200,message:"Limit 200",trigger:"change"}],tags:[{validator:(a,o)=>o&&o.length>5?Promise.reject("You can only add up to 5 tags."):Promise.resolve(),trigger:"change"}],questions:[{validator:(a,o)=>o&&o.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},q={MultipleChoice:Re,Matching:Me,Ordering:we,ShortText:xe},H=()=>({id:"new_"+Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:V.defaultMultipleChoices(),matchingPairs:V.defaultMatchingPairs(),orderingItems:V.defaultOrderingItems(),shortAnswer:""}),ne=a=>{V.onChangeQuestionType(a)},oe=()=>{if(t.createUpdateQuestions.length>=500){v.warning(i("maximum_tag.limit_question",{number:500}));return}t.createUpdateQuestions=[...t.createUpdateQuestions,H()],P(()=>{var a,o;(o=(a=R.value)==null?void 0:a.forceUpdate)==null||o.call(a),P(()=>{const c=t.createUpdateQuestions.length;requestAnimationFrame(()=>{var x;(x=R.value)==null||x.scrollToItem(c)})})})},se=a=>{if(t.createUpdateQuestions.length<=1){v.warning(i("maximum_tag.minimum_question",{number:1}));return}const o=t.createUpdateQuestions[a].id;!o.startsWith("new_")&&o&&t.deleteQuestionIds.push(o),t.createUpdateQuestions=[...t.createUpdateQuestions.slice(0,a),...t.createUpdateQuestions.slice(a+1)]},le=()=>{let a=!1,o=i("message.invalid_question"),c=new Set;if(t.name.trim().length>100||t.name.trim().length===0){a=!0,o=i("message.invalid_title"),v.error(o);return}if(t.description.trim().length>250){a=!0,o=i("message.invalid_description"),v.error(o);return}[t.createUpdateQuestions.filter(l=>{const r=l.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return r.length===0||r.length>=5e3}),t.createUpdateQuestions.filter(l=>(l.explainText?l.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=5e3),t.createUpdateQuestions.filter(l=>l.type===A.MULTIPLE_CHOICE&&(l.multipleChoices.some(r=>r.text.trim().length===0||r.text.trim().length>1e3)||l.multipleChoices.filter(r=>r.isAnswer).length===0)),t.createUpdateQuestions.filter(l=>l.type===A.MATCHING&&(l.matchingPairs.some(r=>r.leftItem.trim().length===0||r.leftItem.trim().length>1e3)||l.matchingPairs.some(r=>r.rightItem.trim().length===0||r.rightItem.trim().length>1e3))),t.createUpdateQuestions.filter(l=>l.type===A.ORDERING&&l.orderingItems.some(r=>r.text.trim().length===0||r.text.trim().length>1e3)),t.createUpdateQuestions.filter(l=>l.type===A.SHORT_TEXT&&(l.shortAnswer.trim().length===0||l.shortAnswer.trim().length>1e3))].forEach(l=>{l.length>0&&(a=!0,l.forEach(r=>c.add(r)))});let E=Array.from(c).map(l=>t.createUpdateQuestions.indexOf(l)+1);a?G.error({title:i("create_QS.modal.invalid.title"),content:i("create_QS.modal.invalid.content")+E.sort().join(", "),okText:i("sidebar.buttons.ok"),cancelText:i("sidebar.buttons.cancel")}):j()},j=()=>{G.confirm({title:i("update_QS.modal.valid.title"),content:i("create_QS.modal.valid.content"),okText:i("sidebar.buttons.ok"),cancelText:i("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{let a=await N.Update(h.value,{...t,createUpdateQuestions:t.createUpdateQuestions.map(o=>({questionId:o.id.startsWith("new_")?null:o.id,...o}))});a.data.success&&(v.success(i("message.updated_successfully")),b.value=!1,e.push({name:"User_QuestionSet_Detail",params:{id:a.data.data}}))}})},g=p(""),Y=()=>{if(t.tags.length>=5){v.warning(i("message.maximum_tag",{tag:5}));return}if(t.tags.includes(g.value.trim())){v.warning(i("message.duplicate_tag"));return}g.value&&g.value.trim().length<=50?(t.tags.push(g.value),g.value=""):v.warning(i("message.invalid_tag_content"))},ie=a=>{t.tags.splice(a,1)},re=a=>{g.value=a,Y()},k=p([]),W=p(null),O=p([]);function X(a){var o;!M.name||!((o=W.value)!=null&&o.contains(a.target))?k.value=[]:k.value=[...O.value]}const M=ee({name:g.value,pageSize:10});he(()=>g.value,()=>{M.name=g.value,J()});const J=async()=>{if(g.value.trim().length>=50)return;const a=await qe.GetAllByLimit(M);a.data.success&&(k.value=a.data.data,O.value=a.data.data,g.value.trim().length===0&&(k.value=[]))},K=p(null),de=()=>{var a;(a=K.value)==null||a.openImportModal()},Z=p(null),ue=()=>{var a;(a=Z.value)==null||a.openGenerateAIModal()},ce=a=>{t.createUpdateQuestions.unshift(...a.map((o,c)=>({...o,id:`new_${t.createUpdateQuestions.length+c}`,orderingItems:o.orderingItems.map((x,E)=>({...x,correctOrder:E}))}))),v.success(`Imported ${a.length} questions`)};function L(a){a.preventDefault(),a.returnValue=""}ve((a,o,c)=>{if(!b.value){c();return}G.confirm({title:i("create_QS.modal.leave.title"),content:i("create_QS.modal.leave.content"),okText:i("sidebar.buttons.ok"),cancelText:i("sidebar.buttons.cancel"),onOk:()=>{c()},onCancel:()=>c(!1)})}),Qe(()=>{window.removeEventListener("beforeunload",L)});const R=p(null),me=()=>{P(()=>{var a,o;(o=(a=R.value)==null?void 0:a.forceUpdate)==null||o.call(a)})};Se(async()=>{document.addEventListener("click",X),await S()});const $={t:i,router:e,route:z,loading:w,questionSetId:h,questionSetDetail:Q,questionSetQuestions:U,isDataValid:b,getTestTemplate:S,formRef:D,formState:t,rules:I,componentMap:q,createQuestionTemplate:H,onHandleChangeQuestionType:ne,onAddQuestion:oe,onRemoveQuestion:se,onFinish:le,showModalConfirmation:j,tagContent:g,addTag:Y,removeTag:ie,appendTagContent:re,tag_search_data:k,searchResultRef:W,lastSearchResult:O,handleMouseClickOutside:X,searchTagPageParams:M,getSearchTagData:J,importModalRef:K,onOpenImportModal:de,generateModalRef:Z,openGenerateAIModal:ue,onModalImport:ce,handleBeforeUnload:L,scrollerRef:R,handleScroll:me,Input:Ue,TextArea:ke,ImportQSModal:De,GenerateQSModal:ze,get DynamicScroller(){return Ve},get DynamicScrollerItem(){return Ae}};return Object.defineProperty($,"__isScriptSetup",{enumerable:!1,value:!0}),$}}),Le={class:"page-container"},Ee={class:"title-container"},Pe={class:"content"},Ge={style:{height:"500px"},class:"content-item"},Be={class:"content-item-title"},Fe={class:"d-flex"},Ne={class:"form-item"},He={class:"tag-container"},je=["onClick"],Ye={class:"tag-inputter"},We={class:"search-bar",ref:"searchResultRef"},Xe={key:0,class:Ie(["search-result-container"])},Je={class:"search-result"},Ke={class:"search-result-tag"},Ze={class:"result-tag"},$e={class:"result-tag-qs-count"},et={class:"result-item-action"},tt={class:"content-item"},at={class:"content-item-title"},nt={class:"content-item-buttons"},ot={class:"import-button"},st={key:0};function lt(m,s,i,e,z,w){const h=y("RouterLink"),Q=y("a-col"),U=y("a-row"),b=y("a-button"),S=y("a-skeleton"),D=y("a-form");return f(),T(B,null,[n("div",Le,[n("div",Ee,[d(U,{class:"w-100 d-flex align-items-center"},{default:_(()=>[d(Q,{span:1},{default:_(()=>[d(h,{to:{name:"User_Library"}},{default:_(()=>s[4]||(s[4]=[n("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[4]})]),_:1}),d(Q,{class:"main-title",span:23},{default:_(()=>[n("span",null,u(m.$t("update_QS.title",{name:e.formState.name})),1),s[5]||(s[5]=C()),s[6]||(s[6]=n("br",null,null,-1)),n("span",null,u(m.$t("create_QS.sub_title")),1)]),_:1,__:[5,6]})]),_:1})]),n("div",Pe,[d(D,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":s[3]||(s[3]=t=>e.formState=t),rules:e.rules,ref:"formRef"},{default:_(()=>[n("div",Ge,[n("div",Be,[n("div",null,[n("span",null,u(m.$t("create_QS.quiz.question_detail_title")),1),n("span",null,u(m.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":s[0]||(s[0]=t=>e.formState.name=t),isRequired:!0,placeholder:e.t("create_QS.other.title_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),n("div",Fe,[d(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":s[1]||(s[1]=t=>e.formState.description=t),placeholder:e.t("create_QS.other.description_placeholder"),"max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","placeholder","label"]),n("div",Ne,[n("label",null,u(m.$t("create_QS.quiz.tag")),1),n("div",He,[(f(!0),T(B,null,te(e.formState.tags,(t,I)=>(f(),T("div",{class:"tag-item",key:I},[C(u(t)+" ",1),n("i",{class:"bx bx-x",onClick:q=>e.removeTag(I)},null,8,je)]))),128))]),n("div",Ye,[ae(` <Input
                                    v-model="tagContent"
                                    :placeholder="t('create_QS.other.tag_content_placeholder')"
                                    :max-length="50"
                                >
                                    <template #icon>
                                        <i class="bx bx-purchase-tag-alt"></i>
                                    </template>
                                </Input> `),n("div",We,[d(e.Input,{onInput:e.getSearchTagData,modelValue:e.tagContent,"onUpdate:modelValue":s[2]||(s[2]=t=>e.tagContent=t),placeholder:e.t("create_QS.other.tag_content_placeholder"),"max-length":50},{icon:_(()=>s[7]||(s[7]=[n("i",{class:"bx bx-purchase-tag-alt"},null,-1)])),_:1},8,["modelValue","placeholder"]),e.tag_search_data.length>0?(f(),T("div",Xe,[n("div",Je,[(f(!0),T(B,null,te(e.tag_search_data,t=>(f(),T("div",Ke,[n("div",Ze,[C(u(t.name)+" ",1),n("div",$e,u(t.questionSetCount),1)]),n("div",et,[d(b,{type:"primary",class:"main-color-btn",size:"small",onClick:I=>e.appendTagContent(t.name)},{default:_(()=>[...s[8]||(s[8]=[n("i",{class:"bx bx-plus"},null,-1)])]),_:2,__:[8]},1032,["onClick"])])]))),256))])])):ae("v-if",!0)],512),n("i",{class:"bx bx-plus tag-inputter-button",onClick:e.addTag})])])])]),n("div",tt,[n("div",at,[n("div",null,[n("span",null,u(m.$t("create_QS.quiz.question_question_title")),1),n("span",null,u(m.$t("create_QS.quiz.question_question_sub_title")),1)]),n("div",nt,[d(h,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:_(()=>[C(u(m.$t("create_QS.buttons.import"))+" ",1),s[9]||(s[9]=n("i",{class:"bx bx-download"},null,-1))]),_:1,__:[9]}),d(h,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:_(()=>[C(u(m.$t("create_QS.buttons.generated_by_ai"))+" ",1),s[10]||(s[10]=n("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[10]}),n("div",{class:"import-button",onClick:e.onFinish},u(m.$t("update_QS.buttons.update")),1),n("div",ot,u(m.$t("create_QS.quiz.total",{number:e.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1)])]),e.loading?(f(),T("div",st,[d(S,{loading:e.loading,active:""},null,8,["loading"]),d(S,{loading:e.loading,active:""},null,8,["loading"]),d(S,{loading:e.loading,active:""},null,8,["loading"]),d(S,{loading:e.loading,active:""},null,8,["loading"]),d(S,{loading:e.loading,active:""},null,8,["loading"])])):(f(),F(e.DynamicScroller,{key:1,ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.createUpdateQuestions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:_(({item:t,index:I})=>[(f(),F(e.DynamicScrollerItem,{item:t,key:t.id},{default:_(()=>[(f(),F(Te(e.componentMap[t.type]),{question:t,index:e.formState.createUpdateQuestions.findIndex(q=>q.id===t.id)+1,displayScore:!1,onDeleteQuestion:q=>e.onRemoveQuestion(I),onChangeQuestionType:q=>e.onHandleChangeQuestionType(t)},null,40,["question","index","onDeleteQuestion","onChangeQuestionType"]))]),_:2},1032,["item"]))]),_:1},8,["items"])),n("div",{class:"add-question-btn",onClick:e.onAddQuestion},[s[11]||(s[11]=n("i",{class:"bx bx-plus"},null,-1)),C(" "+u(m.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),d(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,"number-of-question":e.formState.createUpdateQuestions.length,onImport:e.onModalImport},null,8,["title","number-of-question"]),d(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport,"number-of-question":e.formState.createUpdateQuestions.length},null,8,["title","number-of-question"])],64)}const St=be(Oe,[["render",lt],["__scopeId","data-v-ef9cef6a"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/question_sets/update.vue"]]);export{St as default};

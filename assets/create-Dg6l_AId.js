import{d as N,u as j,l as X,i as v,j as Y,a2 as J,a3 as K,s as W,k as g,G as S,M as R,_ as Z,r as M,a as $,o as z,b as a,c as d,w as p,f as x,t as f,E as G,R as ee,F as te}from"./index-BCAnCLfr.js";import{A as ne}from"./ApiTestTemplate-FLskaAZ8.js";import{I as oe}from"./Input-BPu-Dvk0.js";import{T as ae}from"./vue-draggable-plus-kFQVmXo5.js";import{C as y,S as se,O as ie,M as le,a as re,s as ue,b as me}from"./vue-virtual-scroller.esm-DhYXSrZJ.js";import{G as ce,I as de}from"./GenerateQSModal-CboUwLlq.js";import{Q as C}from"./questionTypes-CS3lcRlq.js";/* empty css                                                                 */import"./ApiQuestionSet-CU3LbYSs.js";import"./languages-DtYW231W.js";const fe=N({__name:"create",setup(m,{expose:r}){r();const{t:o}=j(),t=X(),T=v(!0),D=v(),n=Y({name:"",description:"",questions:[]}),I={title:[{required:"true",message:o("message.required"),trigger:"change"},{length:100,message:o("message.out_of_range",{max_length:100}),trigger:"change"}],description:[{length:200,message:o("message.out_of_range",{max_length:100}),trigger:"change"}],questions:[{validator:(e,i)=>i&&i.length>500?Promise.reject(o("message.maximum_tag.limit_question",{number:500})):Promise.resolve(),trigger:"change"}]},w={MultipleChoice:re,Matching:le,Ordering:ie,ShortText:se},h=()=>({id:Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:y.defaultMultipleChoices(),matchingPairs:y.defaultMatchingPairs(),orderingItems:y.defaultOrderingItems(),shortAnswer:""}),c=e=>{y.onChangeQuestionType(e)},k=()=>{if(n.questions.length>=500){g.warning(o("message.limit_question",{number:500}));return}n.questions=[...n.questions,h()],S(()=>{var e,i;(i=(e=_.value)==null?void 0:e.forceUpdate)==null||i.call(e),S(()=>{const u=n.questions.length;requestAnimationFrame(()=>{var b;(b=_.value)==null||b.scrollToItem(u)})})})},q=e=>{if(n.questions.length<=1){g.warning(o("message.minimum_question",{number:1}));return}n.questions=[...n.questions.slice(0,e),...n.questions.slice(e+1)]},P=()=>{let e=!1,i=o("message.invalid_question"),u=new Set;if(n.name.trim().length>100||n.name.trim().length===0){e=!0,i=o("message.invalid_title"),g.error(i);return}if(n.description.trim().length>250){e=!0,i=o("message.invalid_description"),g.error(i);return}[n.questions.filter(s=>{const l=s.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return l.length===0||l.length>=500}),n.questions.filter(s=>(s.explainText?s.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),n.questions.filter(s=>s.type===C.MULTIPLE_CHOICE&&(s.multipleChoices.some(l=>l.text.trim().length===0||l.text.trim().length>500)||s.multipleChoices.filter(l=>l.isAnswer).length===0)),n.questions.filter(s=>s.type===C.MATCHING&&(s.matchingPairs.some(l=>l.leftItem.trim().length===0||l.leftItem.trim().length>500)||s.matchingPairs.some(l=>l.rightItem.trim().length===0||l.rightItem.trim().length>500))),n.questions.filter(s=>s.type===C.ORDERING&&s.orderingItems.some(l=>l.text.trim().length===0||l.text.trim().length>500)),n.questions.filter(s=>s.type===C.SHORT_TEXT&&(s.shortAnswer.trim().length===0||s.shortAnswer.trim().length>500))].forEach(s=>{s.length>0&&(e=!0,s.forEach(l=>u.add(l)))});let Q=Array.from(u).map(s=>n.questions.indexOf(s)+1);e?R.error({title:o("create_QS.modal.invalid.title"),content:o("create_QS.modal.invalid.content")+Q.sort().join(", "),okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel")}):O()},O=()=>{R.confirm({title:o("create_template.modal.valid.title"),content:o("create_QS.modal.valid.content"),okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{let e=await ne.Create(n);e.data.success&&(g.success(o("message.created_successfully")),T.value=!1,t.push({name:"User_TestTemplate_Detail",params:{id:e.data.data}}))}})},E=v(null),F=()=>{var e;(e=E.value)==null||e.openImportModal()},U=v(null),L=()=>{var e;(e=U.value)==null||e.openGenerateAIModal()},B=e=>{n.questions.unshift(...e.map((i,u)=>({...i,id:`new_${n.questions.length+u}`}))),S(()=>{var i,u;(u=(i=_.value)==null?void 0:i.forceUpdate)==null||u.call(i),S(()=>{const b=n.questions.length;requestAnimationFrame(()=>{var Q;(Q=_.value)==null||Q.scrollToItem(b)})})}),g.success(`${o("message.imported_question",{number:e.length})}`)};J((e,i,u)=>{if(!T.value){u();return}R.confirm({title:o("create_QS.modal.leave.title"),content:o("create_QS.modal.leave.content"),okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),onOk:()=>{u()},onCancel:()=>u(!1)})});function A(e){e.preventDefault(),e.returnValue=""}K(()=>{window.removeEventListener("beforeunload",A)});const _=v(null),H=()=>{S(()=>{var e,i;(i=(e=_.value)==null?void 0:e.forceUpdate)==null||i.call(e)})};W(()=>{n.questions.push(h()),window.addEventListener("beforeunload",A)});const V={t:o,router:t,isDataValid:T,formRef:D,formState:n,rules:I,componentMap:w,createQuestionTemplate:h,onHandleChangeQuestionType:c,onAddQuestion:k,onRemoveQuestion:q,onFinish:P,showModalConfirmation:O,importModalRef:E,onOpenImportModal:F,generateModalRef:U,openGenerateAIModal:L,onModalImport:B,handleBeforeUnload:A,scrollerRef:_,handleScroll:H,Input:oe,TextArea:ae,ImportQSModal:de,GenerateQSModal:ce,get DynamicScroller(){return me},get DynamicScrollerItem(){return ue}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),pe={class:"page-container"},_e={class:"title-container"},ge={class:"content"},he={class:"content-item"},qe={class:"content-item-title"},be={class:"d-flex"},ve={class:"content-item"},Se={class:"content-item-title"},Te={class:"content-item-buttons"},Ie={class:"import-button"};function Qe(m,r,o,t,T,D){const n=M("RouterLink"),I=M("a-col"),w=M("a-row"),h=M("a-form");return z(),$(te,null,[a("div",pe,[a("div",_e,[d(w,{class:"w-100 d-flex align-items-center"},{default:p(()=>[d(I,{span:1},{default:p(()=>[d(n,{to:{name:"User_TestTemplate"}},{default:p(()=>r[2]||(r[2]=[a("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[2]})]),_:1}),d(I,{class:"main-title",span:23},{default:p(()=>[a("span",null,f(m.$t("create_template.title")),1),r[3]||(r[3]=x()),r[4]||(r[4]=a("br",null,null,-1)),a("span",null,f(m.$t("create_QS.sub_title")),1)]),_:1,__:[3,4]})]),_:1})]),a("div",ge,[d(h,{layout:"vertical",model:t.formState,rules:t.rules,ref:"formRef"},{default:p(()=>[a("div",he,[a("div",qe,[a("div",null,[a("span",null,f(m.$t("create_QS.quiz.question_detail_title")),1),a("span",null,f(m.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(t.Input,{class:"question-input-item",modelValue:t.formState.name,"onUpdate:modelValue":r[0]||(r[0]=c=>t.formState.name=c),isRequired:!0,placeholder:t.t("question_sets_index.search_placeholder"),label:t.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),a("div",be,[d(t.TextArea,{class:"question-input-item",modelValue:t.formState.description,"onUpdate:modelValue":r[1]||(r[1]=c=>t.formState.description=c),placeholder:"textarea with clear icon","max-length":250,label:t.t("create_QS.quiz.description")},null,8,["modelValue","label"])])]),a("div",ve,[a("div",Se,[a("div",null,[a("span",null,f(m.$t("create_QS.quiz.question_question_title")),1),a("span",null,f(m.$t("create_QS.quiz.question_question_sub_title")),1)]),a("div",Te,[d(n,{onClick:t.onOpenImportModal,class:"import-button",to:{name:""}},{default:p(()=>[x(f(m.$t("create_QS.buttons.import"))+" ",1),r[5]||(r[5]=a("i",{class:"bx bx-download"},null,-1))]),_:1,__:[5]}),d(n,{onClick:t.openGenerateAIModal,class:"import-button",to:{name:""}},{default:p(()=>[x(f(m.$t("create_QS.buttons.generated_by_ai"))+" ",1),r[6]||(r[6]=a("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[6]}),a("div",{class:"import-button",onClick:t.onFinish},f(m.$t("create_QS.buttons.create")),1),a("div",Ie,f(m.$t("create_QS.quiz.total",{number:t.formState.questions.length.toString().padStart(3,"0")})),1)])]),d(t.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:t.formState.questions,"min-item-size":650,buffer:800,prerender:10,onScroll:t.handleScroll},{default:p(({item:c,index:k})=>[(z(),G(t.DynamicScrollerItem,{item:c,key:c.id},{default:p(()=>[(z(),G(ee(t.componentMap[c.type]),{question:c,index:t.formState.questions.findIndex(q=>q.id===c.id)+1,displayScore:!1,onDeleteQuestion:q=>t.onRemoveQuestion(k),onChangeQuestionType:q=>t.onHandleChangeQuestionType(c)},null,40,["question","index","onDeleteQuestion","onChangeQuestionType"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),a("div",{class:"add-question-btn",onClick:t.onAddQuestion},[r[7]||(r[7]=a("i",{class:"bx bx-plus"},null,-1)),x(" "+f(m.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["model"])])]),d(t.ImportQSModal,{ref:"importModalRef",title:t.formState.name,"number-of-question":t.formState.questions.length,onImport:t.onModalImport},null,8,["title","number-of-question"]),d(t.GenerateQSModal,{ref:"generateModalRef",title:t.formState.name,onImport:t.onModalImport,"number-of-question":t.formState.questions.length},null,8,["title","number-of-question"])],64)}const Oe=Z(fe,[["render",Qe],["__scopeId","data-v-6115bf3d"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test_template/create.vue"]]);export{Oe as default};

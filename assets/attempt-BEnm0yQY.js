import{d as Ie,S as X,u as be,q as Te,l as ye,i as d,z as U,a3 as Ae,s as Ce,k as D,R as qe,M as Se,D as Qe,_ as ke,r as M,c as v,o as u,b as o,a as g,w as I,f as R,t as h,C as $,F as P,B as F,p as _,e as G}from"./index--4eqDeQq.js";import{A as ie}from"./ApiTest-CLZHHVO0.js";import{Q as y}from"./questionTypes-CS3lcRlq.js";import{T as De,l as Me}from"./vue-draggable-plus-C9QOeUr4.js";import{V as Ee}from"./Validator-CWeiTIFe.js";import{u as Oe}from"./utc-DZk0pe0M.js";import{H as Ue}from"./HolderOutlined-CbIxoqSr.js";/* empty css                                                                 */function Re(T=[],i=[]){const s=[];for(let e=0;e<T.length;e++)s.push({leftId:T[e].id,rightId:i[e].id});return s}class Le{transferToUserAnswerSubmit(i){return console.log(i),i.map(s=>{var e;return{questionId:s.questionId,userAnswerData:{type:s.type,multipleChoice:s.multipleChoices??[],matching:Re(s.matchingLeft??[],s.matchingRight??[]),ordering:((e=s.ordering)==null?void 0:e.map((x,m)=>({itemId:x.id,order:m})))??[],shortText:s.shortText??""}}})}transferFromUserAnswerSubmit(i){return i.filter(s=>s.userAnswerData!=null).map(s=>{var e,x,m;return{questionId:s.questionId,type:s.userAnswerData.type,multipleChoices:s.userAnswerData.multipleChoice??[],matchingLeft:(e=s.userAnswerData.matching)!=null&&e.length?s.userAnswerData.matching.map(c=>({id:c.leftId})):[],matchingRight:(x=s.userAnswerData.matching)!=null&&x.length?s.userAnswerData.matching.map(c=>({id:c.rightId})):[],ordering:(m=s.userAnswerData.ordering)!=null&&m.length?s.userAnswerData.ordering.map(c=>({id:c.itemId})):[],shortText:s.userAnswerData.shortText??""}})}}const ae=new Le,He=Ie({__name:"attempt",setup(T,{expose:i}){i(),X.extend(Oe);const{t:s}=be(),e=Te(),x=ye(),m=d([]),c=d([]),a=d({id:"",explainText:"",questionSetId:"",questionText:"",score:0,scoreGraded:0,textFormat:"0",type:"MultipleChoice",correctMultipleChoiceCount:0,questionData:{matching:null,multipleChoice:null,ordering:null,shortText:""}}),q=d(""),S=d(!1),L=d(!1),E=d([]),H=d([]),r=d([]),f=d([]),Q=d(""),ee=d(!0),J=d(e.params.id.toString()),b=d({attemptId:"",name:"",questionCount:0,timeStart:"",timeEnd:"",timeLimit:0,timeRemaining:0,questions:[]}),K=d(!1),te=async()=>{try{if(K.value=!0,!Ee.isValidGuid(J.value)){ee.value=!1,x.push({name:"404"});return}const t=await ie.Attempt(J.value);if(b.value=t.data.data,b.value.timeRemaining<=0){D.error(s("message.time_up")),x.push({name:"User_Class"});return}m.value=[...t.data.data.questions.map(n=>({id:n.questionId,...n}))],c.value=ae.transferFromUserAnswerSubmit(t.data.data.questions.map(n=>({questionId:n.id,userAnswerData:n.userAnswerDataDto}))),a.value=m.value[0]}catch(t){Object.keys(t.response.data.errors).includes(qe.MAX_ATTEMPT_IN_THIS_TEST)&&x.back()}finally{K.value=!1}},V=(t,n)=>{t===-1?c.value.push(n):c.value[t]=n},re=()=>{const t=c.value.findIndex(n=>n.questionId===a.value.id);switch(a.value.type){case y.MULTIPLE_CHOICE:{E.value.length>0?V(t,{questionId:a.value.id,type:a.value.type,multipleChoices:[...E.value],matchingLeft:null,matchingRight:null,ordering:null,shortText:""}):t!==-1&&c.value.splice(t,1);break}case y.MATCHING:{V(t,{questionId:a.value.id,type:a.value.type,multipleChoices:null,matchingLeft:[...H.value],matchingRight:[...r.value],ordering:null,shortText:""});break}case y.ORDERING:{V(t,{questionId:a.value.id,type:a.value.type,multipleChoices:null,matchingLeft:null,matchingRight:null,ordering:[...f.value],shortText:""});break}case y.SHORT_TEXT:{Q.value.trim()?V(t,{questionId:a.value.id,type:a.value.type,multipleChoices:null,matchingLeft:null,matchingRight:null,ordering:null,shortText:Q.value.trim()}):t!==-1&&c.value.splice(t,1);break}}},Y=async t=>{const n=ae.transferToUserAnswerSubmit(c.value);return(await ie.Submit({attemptId:b.value.attemptId,userAnswers:n,isSubmit:t})).data.success},le=()=>{Se.confirm({title:s("attempt_test.submit_modal.title"),content:s("attempt_test.submit_modal.content"),centered:!0,okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),onOk:async()=>{if(!await Y(!0)){D.error(s("message.submited_failed"));return}D.info(s("message.submited_successfully")),x.push({name:"User_Class"})}})},j=t=>{var O;B(),S.value=!1,a.value=m.value[t];const n=c.value.find(l=>l.questionId===a.value.id);switch(a.value.type){case y.MULTIPLE_CHOICE:{q.value=s("learn_QS.instructions.multiple_choice",{number:a.value.correctMultipleChoiceCount}),E.value=n?n==null?void 0:n.multipleChoices:[];break}case y.ORDERING:{q.value=s("learn_QS.instructions.ordering"),f.value=n?n==null?void 0:n.ordering.map(l=>{var p,w;return{id:l.id,text:(w=(p=a.value.questionData.ordering)==null?void 0:p.find(C=>C.id===l.id))==null?void 0:w.text}}):((O=a.value.questionData.ordering)==null?void 0:O.map(l=>l))||[];break}case y.MATCHING:{q.value=s("learn_QS.instructions.matching"),H.value=n?n==null?void 0:n.matchingLeft.map(l=>{var p,w;return{id:l.id,text:(w=(p=a.value.questionData.matching)==null?void 0:p.leftItems.find(C=>C.id===l.id))==null?void 0:w.text}}):a.value.questionData.matching.leftItems.map(l=>l)||[],r.value=n?n==null?void 0:n.matchingRight.map(l=>{var p,w;return{id:l.id,text:(w=(p=a.value.questionData.matching)==null?void 0:p.rightItems.find(C=>C.id===l.id))==null?void 0:w.text}}):a.value.questionData.matching.rightItems.map(l=>l)||{};break}case y.SHORT_TEXT:{q.value=s("learn_QS.instructions.short_text"),Q.value=n?n==null?void 0:n.shortText:"";break}}},ue=()=>{const t=m.value.findIndex(n=>n.id===a.value.id);t<m.value.length-1&&j(t+1)},ce=()=>{const t=m.value.findIndex(n=>n.id===a.value.id);t>0&&j(t-1)},de=t=>Array.from(c.value).some(n=>n.questionId===t),me=U(()=>{const t=m.value.findIndex(n=>n.id===a.value.id);return t!==-1&&t<m.value.length-1}),ge=U(()=>{const t=m.value.findIndex(n=>n.id===a.value.id);return t!==-1&&t>0}),ve=U(()=>m.value.findIndex(t=>t.id===a.value.id)),he={scroll:!0,scrollSensitivity:100,scrollSpeed:100,scrollTarget:document.scrollingElement};function B(){Qe(()=>{requestAnimationFrame(()=>{const t=document.querySelectorAll(".matching-option-container.left .answer-option-matching"),n=document.querySelectorAll(".matching-option-container.right .answer-option-matching"),O=Math.min(t.length,n.length);for(let l=0;l<O;l++){const p=t[l],w=n[l];if(!p||!w)continue;p.style.height="auto",w.style.height="auto";const C=Math.max(p.offsetHeight,w.offsetHeight);p.style.height=`${C}px`,w.style.height=`${C}px`}})})}const _e=U(()=>{var t;return(t=a.value.questionData.multipleChoice)==null?void 0:t.some(n=>n.text.length>=100)}),W=d(X().add(b.value.timeRemaining*60,"second")),N=d(b.value.timeRemaining*60);let A=null;const fe=U(()=>{const t=Math.floor(N.value/60).toString().padStart(2,"0"),n=(N.value%60).toString().padStart(2,"0");return`${t}:${n}`}),Z=async()=>{const t=W.value.diff(X(),"second");if(N.value=t>0?t:0,t<=0&&A){if(clearInterval(A),A=null,!await Y(!0)){D.error(s("message.submited_failed"));return}D.info(s("message.time_up")),x.push({name:"User_Class"})}};let z=null;const ne=async()=>{if(!await Y(!1)){D.error(s("message.auto_save_failed"));return}D.info(s("message.auto_save_successfully"))},k=d(new Set),pe=()=>{const t=a.value.id;k.value.delete(t)||k.value.add(t),localStorage.setItem("flagged_question",JSON.stringify({attemptId:b.value.attemptId,questions:Array.from(k.value)}))},se=()=>{const t=localStorage.getItem("flagged_question");if(!t)return;const n=JSON.parse(t);if(n.attemptId!=b.value.attemptId){localStorage.removeItem("flagged_question");return}if(!Array.isArray(n.questions)){localStorage.removeItem("flagged_question");return}k.value=new Set(n.questions)},we=t=>Array.from(k.value).some(n=>n===t),xe=U(()=>{const t=a.value.id;return Array.from(k.value).some(n=>n===t)});Ae(()=>{A&&clearInterval(A),z&&clearInterval(z)}),Ce(async()=>{B(),window.addEventListener("resize",B),await te(),N.value=b.value.timeRemaining*60,W.value=X().add(b.value.timeRemaining*60,"second"),j(0),se(),Z(),A=setInterval(Z,1e3),z=setInterval(ne,3e4)});const oe={t:s,route:e,router:x,quiz:m,userAnswer:c,currentQuestion:a,currentQuestionInstruction:q,currentQuestionIsSkipped:S,isSubmitted:L,userAnswerMultipleChoice:E,userAnswerMatchingLeft:H,userAnswerMatchingRight:r,userAnswerOrdering:f,userAnswerShortText:Q,isDataValid:ee,testId:J,attemptData:b,loading:K,getAttemptData:te,updateUserAnswer:V,onUserAnswerChange:re,sendUserAnswer:Y,onSubmit:le,onLoadCurrentQuestion:j,onNextQuestion:ue,onPreviousQuestion:ce,userAnswerContainQuestion:de,hasNextQuestion:me,hasPreviousQuestion:ge,currentQuestionIndex:ve,dragOptions:he,syncMatchingHeights:B,isOptionExceed:_e,endTime:W,remainingTime:N,get timer(){return A},set timer(t){A=t},formattedTime:fe,updateCountdown:Z,get autoSaver(){return z},set autoSaver(t){z=t},autoSave:ne,flaggedQuestion:k,onToggleFlagQuestion:pe,onLoadFlaggedQuestion:se,flagContainQuestion:we,isCurrentQuestionFlagged:xe,get QUESTION_TYPE(){return y},TextArea:De,get VueDraggable(){return Me},get HolderOutlined(){return Ue}};return Object.defineProperty(oe,"__isScriptSetup",{enumerable:!1,value:!0}),oe}}),Ve={class:"page-container"},Ne={class:"title-container title-container-header"},ze={class:"content content-test d-flex flex-column"},Pe={class:"d-flex"},Fe={class:"content-item question-navigators"},Ge={class:"question-navigator-title d-flex justify-content-between align-items-center"},Ye={class:"countdown d-flex align-items-center"},je={key:1,class:"question-navigator-container"},Be=["onClick"],Xe={class:"content-item"},Je={key:0},Ke={key:1,class:"section question-section"},We={class:"question-info-index"},Ze=["innerHTML"],$e={class:"section answer-section"},et={class:"d-flex align-items-center"},tt={class:"answer-section-ins"},nt={class:"answer-option-content"},st={key:1,class:"answer-option-container matching"},ot={class:"matching-option-container left"},it={class:"d-flex align-items-center"},at={class:_(["answer-option answer-option-matching"])},rt={class:"answer-option-order"},lt={class:"answer-option-content"},ut={class:"matching-option-container right"},ct={class:"d-flex align-items-center"},dt={class:_(["answer-option answer-option-matching"])},mt={class:"answer-option-content"},gt={class:"answer-option-order"},vt={key:2,class:"answer-option-container ordering"},ht={class:_(["answer-option answer-option-ordering"])},_t={class:"answer-option-order"},ft={class:"answer-option-content"},pt={key:3,class:"answer-option-container"},wt={class:_(["answer-short-text"])},xt={class:"w-100 d-flex align-items-center"},It={class:"learn-question-footer"},bt={class:"d-flex"};function Tt(T,i,s,e,x,m){const c=M("RouterLink"),a=M("a-col"),q=M("a-row"),S=M("a-skeleton"),L=M("a-button"),E=M("a-checkbox"),H=M("a-checkbox-group");return u(),v("div",Ve,[o("div",Ne,[g(q,{class:"w-100 d-flex align-items-center"},{default:I(()=>[g(a,{span:1},{default:I(()=>[g(c,{to:{name:"User_Class"}},{default:I(()=>i[7]||(i[7]=[o("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[7]})]),_:1}),g(a,{class:"main-title",span:22},{default:I(()=>{var r,f;return[o("span",null,h((r=e.attemptData)==null?void 0:r.name),1),i[8]||(i[8]=R()),i[9]||(i[9]=o("br",null,null,-1)),o("span",null,h((f=e.attemptData)==null?void 0:f.questionCount),1)]}),_:1,__:[8,9]})]),_:1})]),o("div",ze,[o("div",Pe,[o("div",Fe,[o("div",Ge,[o("span",null,h(e.t("practice_test.other.question_list")),1),o("span",Ye,[i[10]||(i[10]=o("i",{class:"bx bx-timer"},null,-1)),R(" "+h(e.formattedTime),1)])]),e.loading?(u(),$(S,{key:0,loading:e.loading},null,8,["loading"])):(u(),v("div",je,[(u(!0),v(P,null,F(e.quiz,(r,f)=>(u(),v("div",{class:_(["question-navigation-item-outer",e.currentQuestion.id===r.id?"current-question":"",e.flagContainQuestion(r.id)?"flagged-question":""]),onClick:Q=>e.onLoadCurrentQuestion(f)},[o("div",{class:_(["question-navigator-item",e.userAnswerContainQuestion(r.id)?"completed-question":""])},[o("span",null,h(f+1),1)],2)],10,Be))),256))])),g(L,{type:"primary",class:_(["main-color-btn",e.isSubmitted?"main-color-btn-disabled":""]),onClick:e.onSubmit},{default:I(()=>[R(h(T.$t("learn_QS.buttons.submit")),1)]),_:1},8,["class"])])]),o("div",Xe,[e.loading?(u(),v("div",Je,[g(S,{loading:e.loading},null,8,["loading"]),g(S,{loading:e.loading},null,8,["loading"]),g(S,{loading:e.loading},null,8,["loading"])])):(u(),v("div",Ke,[o("div",We,h(T.$t("create_QS.question.question"))+" "+h(e.currentQuestionIndex+1),1),o("div",{class:_(["learn-question"]),innerHTML:e.currentQuestion.questionText},null,8,Ze),G(` <div v-else :class="['learn-question']">
                        {{ currentQuestion.questionText }}
                    </div> `),o("div",$e,[o("div",et,[o("div",tt,h(e.currentQuestionInstruction),1)]),e.currentQuestion.type===e.QUESTION_TYPE.MULTIPLE_CHOICE?(u(),$(H,{key:0,onChange:e.onUserAnswerChange,value:e.userAnswerMultipleChoice,"onUpdate:value":i[0]||(i[0]=r=>e.userAnswerMultipleChoice=r),class:_(["answer-option-container multiplechoice",e.isOptionExceed?"column":""])},{default:I(()=>[(u(!0),v(P,null,F(e.currentQuestion.questionData.multipleChoice,(r,f)=>(u(),$(E,{value:r.id,"onUpdate:value":Q=>r.id=Q,class:_(["answer-option answer-option-multiplechoice"])},{default:I(()=>[o("div",nt,h(r.text),1)]),_:2},1032,["value","onUpdate:value"]))),256))]),_:1},8,["value","class"])):G("v-if",!0),e.currentQuestion.type===e.QUESTION_TYPE.MATCHING?(u(),v("div",st,[o("div",ot,[g(e.VueDraggable,{modelValue:e.userAnswerMatchingLeft,"onUpdate:modelValue":i[1]||(i[1]=r=>e.userAnswerMatchingLeft=r),options:e.dragOptions,onMove:e.syncMatchingHeights,onEnd:i[2]||(i[2]=()=>{e.syncMatchingHeights(),e.onUserAnswerChange()})},{default:I(()=>[(u(!0),v(P,null,F(e.userAnswerMatchingLeft,(r,f)=>(u(),v("div",it,[o("div",at,[o("div",rt,[g(e.HolderOutlined)]),o("div",lt,h(r.text),1)]),i[11]||(i[11]=o("i",{class:_(["bx bxs-label matching-icon"])},null,-1))]))),256))]),_:1},8,["modelValue"])]),o("div",ut,[g(e.VueDraggable,{modelValue:e.userAnswerMatchingRight,"onUpdate:modelValue":i[3]||(i[3]=r=>e.userAnswerMatchingRight=r),options:e.dragOptions,onMove:e.syncMatchingHeights,onEnd:i[4]||(i[4]=()=>{e.syncMatchingHeights(),e.onUserAnswerChange()})},{default:I(()=>[(u(!0),v(P,null,F(e.userAnswerMatchingRight,(r,f)=>(u(),v("div",ct,[i[12]||(i[12]=o("i",{class:_(["bx bxs-label matching-icon"])},null,-1)),o("div",dt,[o("div",mt,h(r.text),1),o("div",gt,[g(e.HolderOutlined)])])]))),256))]),_:1},8,["modelValue"])])])):G("v-if",!0),e.currentQuestion.type===e.QUESTION_TYPE.ORDERING?(u(),v("div",vt,[g(e.VueDraggable,{modelValue:e.userAnswerOrdering,"onUpdate:modelValue":i[5]||(i[5]=r=>e.userAnswerOrdering=r),options:e.dragOptions,onEnd:e.onUserAnswerChange},{default:I(()=>[(u(!0),v(P,null,F(e.userAnswerOrdering,(r,f)=>(u(),v("div",ht,[o("div",_t,[g(e.HolderOutlined),R(" "+h(f+1),1)]),o("div",ft,h(r.text),1)]))),256))]),_:1},8,["modelValue"])])):G("v-if",!0),e.currentQuestion.type===e.QUESTION_TYPE.SHORT_TEXT?(u(),v("div",pt,[o("div",wt,[o("div",xt,[g(e.TextArea,{placeholder:"Enter your answer...",modelValue:e.userAnswerShortText,"onUpdate:modelValue":i[6]||(i[6]=r=>e.userAnswerShortText=r),onChange:e.onUserAnswerChange},null,8,["modelValue"])])])])):G("v-if",!0)]),o("div",It,[g(L,{class:_(["main-color-btn",e.hasPreviousQuestion?"":"main-color-btn-disabled"]),type:"primary",size:"large",onClick:e.onPreviousQuestion},{default:I(()=>[i[13]||(i[13]=o("i",{class:"bx bx-chevron-left"},null,-1)),R(" "+h(T.$t("practice_test.buttons.previous")),1)]),_:1,__:[13]},8,["class"]),o("i",{class:_(["bx bx-flag flag-button",e.isCurrentQuestionFlagged?"bxs-flag":""]),onClick:e.onToggleFlagQuestion},null,2),o("div",bt,[g(L,{class:_(["main-color-btn",e.hasNextQuestion?"":"main-color-btn-disabled"]),type:"primary",size:"large",onClick:e.onNextQuestion},{default:I(()=>[R(h(T.$t("learn_QS.buttons.next_question"))+" ",1),i[14]||(i[14]=o("i",{class:"bx bx-chevron-right"},null,-1))]),_:1,__:[14]},8,["class"])])])]))])])])}const Mt=ke(He,[["render",Tt],["__scopeId","data-v-b60278b8"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test/attempt.vue"]]);export{Mt as default};

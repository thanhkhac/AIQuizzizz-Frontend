import{d as me,u as _e,g as ve,i as v,B as j,C as Z,j as he,s as pe,X as fe,k as q,_ as be,r as h,E as D,o as u,w as i,b as t,p as I,c as o,t as r,a as p,F as x,D as L,f as P,e as G}from"./index-7pvKWGH0.js";import{A as $}from"./ApiQuestionSet-CujiQ4Kp.js";import{A as ee}from"./ApiTestTemplate-A2vpt1dk.js";import{A as se}from"./ApiFolder-CoVq6ZhZ.js";import{I as ge}from"./Input-CGTktEnb.js";import{V as ae}from"./visibility-PZlBDoOn.js";const A={OWNER:"Owner",EDITABLE:"Editable",VIEW_ONLY:"ViewOnly"},ye=me({__name:"ShareModal",props:{id:{type:String,required:!0},name:{type:String,required:!0},mode:{type:String,required:!0},visibility:{type:String,required:!0},options:{type:null,required:!0}},setup(m,{expose:l}){const{t:n}=_e(),e=ve(),F=v(e.getUserInfo()),Q=j(()=>{var c;return((c=a.value.find(R=>R.shareMode===A.OWNER))==null?void 0:c.userId)===F.value.id}),_=m,f=v(!1),S=async()=>{await O(),b.value=_.visibility||M.value[0].value,f.value=!0},U=()=>{f.value=!1};l({openModal:S});const w=Object.values(_.options),M=j(()=>w.map(s=>({label:n(`share_modal.visibility.${s}.mode`),value:s}))),b=v(_.visibility||M.value[0].value),C=v("");Z(()=>b.value,async s=>{C.value=n(`share_modal.visibility.${s}.explain`),s===ae.PRIVATE&&await O()});const g=[A.EDITABLE,A.VIEW_ONLY],N=j(()=>g.map(s=>({label:n(`share_modal.permission.${s}.mode`),value:s}))),W=v(N.value[0].value),k=v([{id:"1",name:"SEP490 - Summer 2025"},{id:"2",name:"MLN111 - Spring 2025"},{id:"3",name:"MLN121 - Spring 2025"}]),a=v([]),d=v(),Y=v([]),O=async()=>{let s;switch(_.mode){case"quiz":{s=await $.GetSharedUser(_.id);break}case"template":{s=await ee.GetSharedUser(_.id);break}case"folder":{s=await se.GetSharedUser(_.id);break}}s!=null&&s.data.success&&(a.value=s.data.data.sharingModel)},B=v(""),E=v([]),T=v([]),K=v(null);function X(s){var c;B.value&&!((c=K.value)!=null&&c.contains(s.target))?E.value=[]:E.value=[...T.value]}const te=async()=>{if(!B.value.trim()){E.value=[],T.value=[];return}const s=await fe.SearchByEmail(B.value);s.data.success&&(E.value=s.data.data,T.value=[...s.data.data])},V=async({sharingModels:s=[],deleteUserIds:c=[],successMsg:R=n("message.updated_successfully"),errorMsg:ue=n("message.updated_failed")})=>{d.value={id:_.id,sharingModels:s,deleteUserIds:c};let y;switch(_.mode){case"quiz":{y=await $.UpdateSharedUser({...d.value,visibilityMode:b.value});break}case"template":{y=await ee.UpdateSharedUser(d.value);break}case"folder":{y=await se.UpdateSharedUser({folderId:d.value.id,...d.value});break}}y!=null&&y.data.success?(await O(),q.success(R)):q.error(ue)},le=async s=>{await V({sharingModels:[{sharingUserId:s.id,shareMode:A.VIEW_ONLY}],successMsg:n("message.added_successfully"),errorMsg:n("message.added_failed")})},ie=async(s,c)=>{await V({sharingModels:[{sharingUserId:s,shareMode:c}],successMsg:n("message.updated_successfully"),errorMsg:n("message.updated_failed")})},ne=async s=>{Y.value.push(s),await V({sharingModels:[],deleteUserIds:Y.value,successMsg:n("message.removed_successfully"),errorMsg:n("message.removed_failed")})},oe=s=>a.value.some(c=>c.userId===s),z=he({checkAll:!1,indeterminate:!1,checkedList:[]});Z(()=>z.checkedList,s=>{var c;z.indeterminate=!!s.length&&s.length<k.value.map(R=>R.id).length,z.checkAll=s.length===((c=k.value)==null?void 0:c.length)});const re=()=>{U()},H=()=>window.location.origin+`/user/question-set/${_.id}`,de=()=>{navigator.clipboard.writeText(H()).then(()=>{q.success(n("message.copied"))}).catch(()=>{q.error(n("message.copied_failed"))})},ce=async()=>{await V({sharingModels:[],successMsg:n("message.updated_successfully"),errorMsg:n("message.updated_failed")})};pe(()=>{document.addEventListener("click",X),C.value=n(`share_modal.visibility.${b.value}.explain`)});const J={t:n,authStore:e,user:F,isUserOwner:Q,props:_,visibility:f,openModal:S,closeModal:U,visibilityKeys:w,visibility_options:M,selected_visibility_option:b,selected_visibility_explain:C,permissionKeys:g,permission_options:N,selected_permission_option:W,user_class_sample:k,sharedUser:a,sharingFormState:d,deleteUserIds:Y,getSharedUser:O,searchUserEmailValue:B,userFound:E,lastSearchResult:T,searchUserResultRef:K,handleMouseClickOutside:X,onSearchUser:te,updateSharedUsers:V,onShareWithResultUser:le,onChangePeoplePermission:ie,onConfirmRemovePeopleAccess:ne,isSharedUserContain:oe,shareClassState:z,onShareClass:re,getPublicShareUrl:H,onCopyPublicShareUrl:de,onChangeVisibility:ce,Input:ge,get VISIBILITY(){return ae},get PERMISSION(){return A}};return Object.defineProperty(J,"__isScriptSetup",{enumerable:!1,value:!0}),J}}),Ie={class:"title-container"},Se={class:"visibility-explain"},Ue={key:0,class:"form-item search-user",ref:"searchUserResultRef"},we={key:0,class:I(["search-user-container"])},Me={class:"search-user-result"},Ce={class:"search-user-item"},ke={class:"user-item-email"},Ee={class:"list-item-section"},Ve={class:"list-item-title"},Re={class:"list-item-container"},xe={class:"list-item"},Le={class:"people-access-info"},Pe={class:"people-access-permission"},Ae={key:0,class:"ms-2 text-danger bx bx-trash"},Ne={class:"list-item-section"},Oe={class:"list-item-container"},Be={class:"list-item"},Te={class:"mt-3 d-flex justify-content-end"};function ze(m,l,n,e,F,Q){const _=h("RouterLink"),f=h("a-col"),S=h("a-row"),U=h("a-select-option"),w=h("a-select"),M=h("a-form-item"),b=h("a-qrcode"),C=h("a-input"),g=h("a-button"),N=h("a-popconfirm"),W=h("a-form"),k=h("a-modal");return u(),D(k,{centered:"",width:"100%","wrap-class-name":"medium-modal",open:e.visibility,onCancel:e.closeModal},{footer:i(()=>l[9]||(l[9]=[])),default:i(()=>[t("div",{class:I(["page-container",e.selected_visibility_option===e.VISIBILITY.PRIVATE?"larger":""])},[t("div",Ie,[o(S,{class:"w-100 d-flex align-items-center justify-content-between"},{default:i(()=>[o(f,{span:1},{default:i(()=>[o(_,{to:{name:""},onClick:e.closeModal},{default:i(()=>l[2]||(l[2]=[t("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[2]})]),_:1}),o(f,{class:"main-title",span:22},{default:i(()=>[t("span",null,r(m.$t("share_modal.title"))+" "+r(m.$t(`share_modal.mode.${n.mode}`))+" "+r(n.name),1),l[3]||(l[3]=t("br",null,null,-1)),t("span",null,r(m.$t("share_modal.sub_title")),1)]),_:1,__:[3]})]),_:1})]),o(W,{layout:"vertical"},{default:i(()=>[o(S,{class:"p-3 d-flex justify-content-between"},{default:i(()=>[o(f,{span:24},{default:i(()=>[o(M,{label:m.$t("share_modal.component_title.visibility")},{default:i(()=>[o(w,{disabled:!e.isUserOwner,onChange:e.onChangeVisibility,class:"me-3",value:e.selected_visibility_option,"onUpdate:value":l[0]||(l[0]=a=>e.selected_visibility_option=a),style:{width:"200px"}},{default:i(()=>[(u(!0),p(x,null,L(e.visibility_options,a=>(u(),D(U,{value:a.value},{default:i(()=>[P(r(a.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["disabled","value"]),t("div",Se,r(e.selected_visibility_explain),1)]),_:1},8,["label"])]),_:1}),o(f,{span:24,class:I(["shareable-link-container",e.selected_visibility_option===e.VISIBILITY.PUBLIC?"":"d-none"])},{default:i(()=>[o(b,{value:e.getPublicShareUrl()},null,8,["value"]),t("div",null,[o(C,{class:"share-link",value:e.getPublicShareUrl()},null,8,["value"]),o(g,{class:"mt-2 main-color-btn",type:"primary",onClick:e.onCopyPublicShareUrl},{default:i(()=>[l[4]||(l[4]=t("i",{class:"me-3 bx bx-link-alt"},null,-1)),P(" "+r(m.$t("share_modal.buttons.copy_link")),1)]),_:1,__:[4]})])]),_:1},8,["class"]),o(f,{span:24,class:I([e.selected_visibility_option===e.VISIBILITY.PRIVATE?"":"d-none"])},{default:i(()=>[e.isUserOwner?(u(),p("div",Ue,[t("label",null,[P(r(m.$t("share_modal.component_title.share_with_email"))+" - ",1),l[5]||(l[5]=t("span",null,"enter full email to search user",-1))]),o(e.Input,{onChange:e.onSearchUser,value:e.searchUserEmailValue,"onUpdate:value":l[1]||(l[1]=a=>e.searchUserEmailValue=a),placeholder:e.t("share_modal.other.search_email_placeholder")},{icon:i(()=>l[6]||(l[6]=[t("i",{class:"bx bx-envelope"},null,-1)])),_:1},8,["value","placeholder"]),e.userFound.length>0?(u(),p("div",we,[t("div",Me,[(u(!0),p(x,null,L(e.userFound,a=>(u(),p("div",Ce,[t("div",ke,r(a.email),1),t("div",{class:I(["user-item-access",e.isSharedUserContain(a.id)?"d-none":""])},[o(g,{type:"primary",class:"main-color-btn",onClick:d=>e.onShareWithResultUser(a)},{default:i(()=>[...l[7]||(l[7]=[t("i",{class:"bx bxs-user-plus"},null,-1)])]),_:2,__:[7]},1032,["onClick"])],2)]))),256))])])):G("v-if",!0)],512)):G("v-if",!0),t("div",Ee,[t("div",Ve,r(m.$t("share_modal.component_title.people_with_access",{number:e.sharedUser.length})),1),t("div",Re,[(u(!0),p(x,null,L(e.sharedUser,a=>(u(),p("div",xe,[l[8]||(l[8]=t("img",{class:"people-access-img",src:"",alt:""},null,-1)),t("div",Le,[t("span",null,r(a.fullName),1),t("span",null,r(a.email),1)]),t("div",Pe,[o(w,{disabled:a.shareMode===e.PERMISSION.OWNER||a.userId===e.user.id,onChange:d=>e.onChangePeoplePermission(a.userId,a.shareMode),style:{width:"130px"},value:a.shareMode,"onUpdate:value":d=>a.shareMode=d},{default:i(()=>[(u(!0),p(x,null,L(e.permission_options,d=>(u(),D(U,{value:d.value},{default:i(()=>[P(r(d.label),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["disabled","onChange","value","onUpdate:value"]),o(N,{title:m.$t("share_modal.other.delete_warning"),"ok-text":m.$t("share_modal.buttons.yes"),"cancel-text":m.$t("share_modal.buttons.no"),onConfirm:d=>e.onConfirmRemovePeopleAccess(a.userId)},{default:i(()=>[a.userId!==e.user.id&&a.shareMode!==e.PERMISSION.OWNER?(u(),p("i",Ae)):G("v-if",!0)]),_:2},1032,["title","ok-text","cancel-text","onConfirm"])])]))),256))])])]),_:1},8,["class"]),o(f,{span:24,class:I([e.selected_visibility_option===e.VISIBILITY.IN_CLASS?"":"d-none"])},{default:i(()=>[t("div",Ne,[t("div",Oe,[(u(!0),p(x,null,L(e.user_class_sample,a=>(u(),p("div",Be,[t("span",null,r(a.name),1)]))),256))]),t("div",Te,[o(g,{type:"primary",class:"main-color-btn",size:"large",onClick:e.onShareClass},{default:i(()=>[P(r(m.$t("share_modal.buttons.done")),1)]),_:1})])])]),_:1},8,["class"])]),_:1})]),_:1})],2)]),_:1},8,["open"])}const Ge=be(ye,[["render",ze],["__scopeId","data-v-a1cc234f"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/shared/modals/ShareModal.vue"]]);export{Ge as S};

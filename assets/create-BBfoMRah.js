import{d as se,u as ae,q as re,l as le,i as d,j as ie,N as de,O as ce,s as ue,k as h,M as E,P as me,_ as pe,r as _,a as D,o as q,b as r,c as i,w as p,f as b,t as j,F as Y,B as fe,C as Te,D as ge}from"./index-Dd8-myui.js";import{A as he}from"./ApiClass-Dplhuan4.js";import{A as _e}from"./ApiTest-Dpo4bmJf.js";import{Q as C}from"./questionTypes-CS3lcRlq.js";import{T as ve,a as Me,C as we,b as Se,c as qe,d as Ce,S as Ie}from"./ChooseQuestionModal-vNGkBmBP.js";import{S as Re,O as Ae,M as Fe,a as xe}from"./ShortText-B2lmwy7J.js";import{T as Oe}from"./TransferQuestionData-Bl0XXg5D.js";import{V as ke}from"./Validator-CWeiTIFe.js";import"./Input-BtmZP41X.js";import"./ApiFolder-MKgG6ozZ.js";import"./folderShareMode-BudLQ2R2.js";import"./ApiTestTemplate-x2TAPrW4.js";import"./TextArea-DyOic0o8.js";import"./vue-draggable-plus-CKvOH8GT.js";const ye=se({__name:"create",setup(I,{expose:l}){l();const Q={MultipleChoice:xe,Matching:Fe,Ordering:Ae,ShortText:Re},{t}=ae(),R=re(),T=le(),c=d(!0),g=async()=>{if(!ke.isValidGuid(n.classId)){c.value=!1,T.push({name:"404"});return}(await he.GetById(n.classId)).data.success||(c.value=!1,T.push({name:"404"}))},v=d(),n=ie({name:"",classId:R.params.id.toString()||"",timeLimit:60,startTime:"",endTime:"",gradeAttemptMethod:Me.HIGHEST_SCORE,gradeQuestionMethod:ve.PARTIAL,isShowCorrectAnswerInReview:!0,isAllowReviewAfterSubmit:!0,shuffle:2,maxAttempt:2,passingScore:50,questions:[]}),A={title:[{required:"true",message:"This field is required",trigger:"change"},{length:100,message:"Limit 100",trigger:"change"}],description:[{length:200,message:"Limit 200",trigger:"change"}],tags:[{validator:(e,a)=>a&&a.length>5?Promise.reject("You can only add up to 5 tags."):Promise.resolve(),trigger:"change"}],questions:[{validator:(e,a)=>a&&a.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},m=()=>({id:Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),M=()=>{if(n.questions.length>=10){h.warning("Each question set could have at most 100 questions");return}n.questions.push(m())},B=e=>{if(n.questions.length<=1){h.warning("Each question set must have at least 1 questions");return}n.questions.splice(e,1)},X=async()=>{var U;await((U=v.value)==null?void 0:U.validate());let e=!1,a="Invalid question.",u=new Set;if(n.name.trim().length>100||n.name.trim().length===0){e=!0,a="Invalid title.",h.error(a),F();return}[n.questions.filter(o=>{const s=o.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return s.length===0||s.length>=500}),n.questions.filter(o=>(o.explainText?o.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),n.questions.filter(o=>o.type===C.MULTIPLE_CHOICE&&(o.multipleChoices.some(s=>s.text.trim().length===0||s.text.trim().length>500)||o.multipleChoices.filter(s=>s.isAnswer).length===0)),n.questions.filter(o=>o.type===C.MATCHING&&(o.matchingPairs.some(s=>s.leftItem.trim().length===0||s.leftItem.trim().length>500)||o.matchingPairs.some(s=>s.rightItem.trim().length===0||s.rightItem.trim().length>500))),n.questions.filter(o=>o.type===C.ORDERING&&o.orderingItems.some(s=>s.text.trim().length===0||s.text.trim().length>500)),n.questions.filter(o=>o.type===C.SHORT_TEXT&&(o.shortAnswer.trim().length===0||o.shortAnswer.trim().length>500))].forEach(o=>{o.length>0&&(e=!0,o.forEach(s=>u.add(s)))});let ne=Array.from(u).map(o=>n.questions.indexOf(o)+1);e?E.error({title:"Cannot create new question set!",content:"There are errors at questions: "+ne.sort().join(", ")}):P()},P=()=>{E.confirm({title:"Create new quiz!",content:"Make sure to review your contents before proceeding.",centered:!0,onOk:async()=>{(await _e.Create(n)).data.success&&(c.value=!1,h.success("Created successfully!"),T.push({name:"User_Class_Exam",params:{id:n.classId}}))}})},L=d(null),F=()=>{var e;(e=L.value)==null||e.openTestSettingModal()},w=d(null),x=()=>{var e;(e=w.value)==null||e.openModal()},J=()=>{var e;f.value=null,(e=w.value)==null||e.closeModal(),k()},K=e=>{var a;f.value=e,(a=w.value)==null||a.closeModal(),O()},f=d(null),z=d(""),N=d(null),O=()=>{var e;(e=N.value)==null||e.openModal()},W=()=>{f.value=null,x()},S=d(null),k=()=>{var e;(e=S.value)==null||e.openModal()},Z=()=>{var e;f.value=null,(e=S.value)==null||e.closeModal(),x()},$=async e=>{var a;z.value=e,(a=S.value)==null||a.closeModal(),await me(),V()},H=d(null),V=()=>{var e;(e=H.value)==null||e.openModal()},ee=e=>{f.value=e,O()},te=()=>{k()},oe=e=>{h.success(`Imported ${e.length} questions`);const a=e.map(u=>Oe.transformResponseToRequest(u));n.questions.push(...a)};de((e,a,u)=>{if(!c.value){u();return}E.confirm({title:"Leave already?",content:"You have unsaved changes.",onOk:()=>{u()},onCancel:()=>u(!1)})});function y(e){e.preventDefault(),e.returnValue=""}ce(()=>{window.removeEventListener("beforeunload",y)}),ue(()=>{g(),n.questions.push(m()),window.addEventListener("beforeunload",y),F()});const G={componentMap:Q,t,route:R,router:T,isDataValid:c,getClassData:g,formRef:v,formState:n,rules:A,createQuestionTemplate:m,onAddQuestion:M,onRemoveQuestion:B,onFinish:X,showModalConfirmation:P,settingModalRef:L,openSettingModal:F,folderModalRef:w,openFolderModal:x,onSwitchToTestTemplate:J,onOpenFolder:K,chosenFolder:f,chosenTestTemplateId:z,folderTestTemplateModalRef:N,openFolderTestTemplateModal:O,onBackToFolderModal:W,testTemplateModalRef:S,openTestTemplateModal:k,onSwitchToFolder:Z,onOpenTestTemplate:$,questionModalRef:H,openQuestionModal:V,onBackToFolderTestTemplate:ee,onBackToTestTemplate:te,onModalImport:oe,handleBeforeUnload:y,SettingTestModal:Ie,ChooseFolderModal:Ce,ChooseFolderTestTemplateModal:qe,ChooseTestTemplateModal:Se,ChooseQuestionModal:we};return Object.defineProperty(G,"__isScriptSetup",{enumerable:!1,value:!0}),G}}),Ee={class:"page-container"},De={class:"title-container"},be={class:"content"},Qe={class:"content-item"},Be={class:"content-item-title"},Pe={class:"content-item-buttons"},Le={class:"import-button"},ze={class:"list-question-container"};function Ne(I,l,Q,t,R,T){const c=_("RouterLink"),g=_("a-col"),v=_("a-row"),n=_("a-button"),A=_("a-form");return q(),D(Y,null,[r("div",Ee,[r("div",De,[i(v,{class:"w-100 d-flex align-items-center"},{default:p(()=>[i(g,{span:1},{default:p(()=>[i(c,{to:{name:""},onClick:t.openSettingModal},{default:p(()=>l[0]||(l[0]=[r("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[0]})]),_:1}),i(g,{class:"main-title",span:23},{default:p(()=>l[1]||(l[1]=[r("span",null,"Assign new test for class SEP490",-1),r("br",null,null,-1),r("span",null,"Add questions, set answers and configure test settings",-1)])),_:1,__:[1]})]),_:1})]),r("div",be,[i(A,{layout:"vertical",model:t.formState,rules:t.rules,ref:"formRef"},{default:p(()=>[r("div",Qe,[r("div",Be,[l[4]||(l[4]=r("div",null,[r("span",null,"Test questions"),r("span",null,"Create and manage your test questions")],-1)),r("div",Pe,[i(c,{class:"import-button",to:{name:""},onClick:t.openFolderModal},{default:p(()=>l[2]||(l[2]=[b(" Choose from folder test ")])),_:1,__:[2]}),r("div",Le,j(I.$t("create_QS.quiz.total",{number:t.formState.questions.length.toString().padStart(3,"0")})),1),i(n,{type:"primary",class:"main-color-btn",size:"large",onClick:t.onFinish},{default:p(()=>l[3]||(l[3]=[b(" Next ")])),_:1,__:[3]})])]),r("div",ze,[(q(!0),D(Y,null,fe(t.formState.questions,(m,M)=>(q(),D("div",{key:m.id},[(q(),Te(ge(t.componentMap[m.type]),{question:m,index:M+1,displayScore:!0,onDeleteQuestion:B=>t.onRemoveQuestion(M)},null,40,["question","index","onDeleteQuestion"]))]))),128)),r("div",{class:"add-question-btn",onClick:t.onAddQuestion},[l[5]||(l[5]=r("i",{class:"bx bx-plus"},null,-1)),b(" "+j(I.$t("create_QS.buttons.add_question")),1)])])])]),_:1},8,["model"])])]),i(t.SettingTestModal,{ref:"settingModalRef","form-ref":t.formRef,"class-name":"SEP490","form-state":t.formState},null,8,["form-ref","form-state"]),i(t.ChooseFolderModal,{ref:"folderModalRef",onSwitchToTestTemplate:t.onSwitchToTestTemplate,onOpenFolder:t.onOpenFolder},null,512),i(t.ChooseFolderTestTemplateModal,{ref:"folderTestTemplateModalRef",folder:t.chosenFolder,onBackToFolderModal:t.onBackToFolderModal,onOpenTestTemplate:t.onOpenTestTemplate},null,8,["folder"]),i(t.ChooseTestTemplateModal,{ref:"testTemplateModalRef",onSwitchToFolder:t.onSwitchToFolder,onOpenTestTemplate:t.onOpenTestTemplate},null,512),i(t.ChooseQuestionModal,{ref:"questionModalRef","test-template-id":t.chosenTestTemplateId,folder:t.chosenFolder,onBackToFolderTestTemplateModal:t.onBackToFolderTestTemplate,onBackToTestTemplateModal:t.onBackToTestTemplate,onImport:t.onModalImport},null,8,["test-template-id","folder"])],64)}const nt=pe(ye,[["render",Ne],["__scopeId","data-v-501cc219"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test/create.vue"]]);export{nt as default};

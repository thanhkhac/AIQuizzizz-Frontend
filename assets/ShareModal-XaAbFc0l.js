import{d as ve,u as he,g as fe,i as m,z as G,E as pe,s as be,J as ge,k as S,_ as Ie,r as f,C as N,o as r,w as l,b as t,p as U,a as n,t as u,c as v,F as O,B as P,f as w,e as V}from"./index--4eqDeQq.js";import{u as ye}from"./user-zaK1_Zi8.js";import{A as K}from"./ApiQuestionSet-CHCQ695S.js";import{A as ae}from"./ApiClass-DLDi90BD.js";import{A as te}from"./ApiTestTemplate-Sk4Z8YU1.js";import{A as le}from"./ApiFolder-BwK6KQqW.js";import{I as Se}from"./Input-OvzKKxPx.js";import{V as J}from"./visibility-PZlBDoOn.js";const L={OWNER:"Owner",EDITABLE:"Editable",VIEW_ONLY:"ViewOnly"},we=ve({__name:"ShareModal",props:{id:{type:String,required:!0},name:{type:String,required:!0},mode:{type:String,required:!0},visibility:{type:String,required:!0},options:{type:null,required:!0}},setup(h,{expose:i}){const{t:o}=he(),e=fe(),Y=m(e.getUserInfo()),H=G(()=>{var _;return((_=a.value.find(b=>b.shareMode===L.OWNER))==null?void 0:_.userId)===Y.value.id}),d=h,p=m(!1),C=async()=>{if(p.value=!0,d.mode==="quiz"&&d.visibility===J.IN_CLASS){await $();return}await z()},M=()=>{p.value=!1};i({openModal:C});const k=Object.values(d.options),T=G(()=>k.map(s=>({label:o(`share_modal.visibility.${s}.mode`),value:s}))),g=m(d.visibility||T.value[0].value),E=m("");pe(()=>g.value,async s=>{E.value=o(`share_modal.visibility.${s}.explain`),s===J.PRIVATE&&await z()});const I=[L.EDITABLE,L.VIEW_ONLY],B=G(()=>I.map(s=>({label:o(`share_modal.permission.${s}.mode`),value:s}))),Q=m(B.value[0].value),j=m([{id:"1",name:"SEP490 - Summer 2025"},{id:"2",name:"MLN111 - Spring 2025"},{id:"3",name:"MLN121 - Spring 2025"}]),a=m([]),c=m(),D=m([]),z=async()=>{let s;switch(d.mode){case"quiz":{s=await K.GetSharedUser(d.id);break}case"template":{s=await te.GetSharedUser(d.id);break}case"folder":{s=await le.GetSharedUser(d.id);break}}s!=null&&s.data.success&&(a.value=s.data.data.sharingModel)},F=m(""),R=m([]),W=m([]),X=m(null);function Z(s){var _;F.value&&!((_=X.value)!=null&&_.contains(s.target))?R.value=[]:R.value=[...W.value]}const ie=async()=>{if(!F.value.trim()){R.value=[],W.value=[];return}const s=await ge.SearchByEmail(F.value);s.data.success&&(R.value=s.data.data,W.value=[...s.data.data])},x=async({sharingModels:s=[],deleteUserIds:_=[],successMsg:b=o("message.updated_successfully"),errorMsg:A=o("message.updated_failed")})=>{c.value={id:d.id,sharingModels:s,deleteUserIds:_};let y;switch(d.mode){case"quiz":{y=await K.UpdateSharedUser({...c.value,visibilityMode:g.value});break}case"template":{y=await te.UpdateSharedUser(c.value);break}case"folder":{y=await le.UpdateSharedUser({folderId:c.value.id,...c.value});break}}y!=null&&y.data.success?(await z(),S.success(b)):S.error(A)},oe=async s=>{await x({sharingModels:[{sharingUserId:s.id,shareMode:L.VIEW_ONLY}],successMsg:o("message.added_successfully"),errorMsg:o("message.added_failed")})},ne=async(s,_)=>{await x({sharingModels:[{sharingUserId:s,shareMode:_}],successMsg:o("message.updated_successfully"),errorMsg:o("message.updated_failed")})},re=async s=>{D.value.push(s),await x({sharingModels:[],deleteUserIds:D.value,successMsg:o("message.removed_successfully"),errorMsg:o("message.removed_failed")})},de=s=>a.value.some(_=>_.userId===s),q=m([]),$=async()=>{const s=await K.GetSharedClasses(d.id);s.data.success&&(q.value=s.data.data)},ce=async s=>{if((await ae.AddQuestionSet(s,d.id)).data.success){const b=q.value.find(A=>A.classId===s);b&&(b.isAdded=!0),S.success(o("message.added_successfully"))}},ue=async s=>{if((await ae.DeleteQuestionSetFromClass(s,d.id)).data.success){const b=q.value.find(A=>A.classId===s);b&&(b.isAdded=!1),S.success(o("message.removed_successfully"))}},ee=()=>window.location.origin+`/user/question-set/${d.id}`,me=()=>{navigator.clipboard.writeText(ee()).then(()=>{S.success(o("message.copied"))}).catch(()=>{S.error(o("message.copied_failed"))})},_e=async()=>{await x({sharingModels:[],successMsg:o("message.updated_successfully"),errorMsg:o("message.updated_failed")})};be(()=>{document.addEventListener("click",Z),E.value=o(`share_modal.visibility.${g.value}.explain`)});const se={t:o,authStore:e,user:Y,isUserOwner:H,props:d,visibility:p,openModal:C,closeModal:M,visibilityKeys:k,visibility_options:T,selected_visibility_option:g,selected_visibility_explain:E,permissionKeys:I,permission_options:B,selected_permission_option:Q,user_class_sample:j,sharedUser:a,sharingFormState:c,deleteUserIds:D,getSharedUser:z,searchUserEmailValue:F,userFound:R,lastSearchResult:W,searchUserResultRef:X,handleMouseClickOutside:Z,onSearchUser:ie,updateSharedUsers:x,onShareWithResultUser:oe,onChangePeoplePermission:ne,onConfirmRemovePeopleAccess:re,isSharedUserContain:de,sharedClass:q,getSharedClasses:$,onAddToClass:ce,onRemoveFromClass:ue,getPublicShareUrl:ee,onCopyPublicShareUrl:me,onChangeVisibility:_e,get user_image(){return ye},Input:Se,get VISIBILITY(){return J},get PERMISSION(){return L}};return Object.defineProperty(se,"__isScriptSetup",{enumerable:!1,value:!0}),se}}),Ue={class:"title-container"},Ce={class:"visibility-explain"},Me={key:0,class:"form-item search-user",ref:"searchUserResultRef"},ke={key:0,class:U(["search-user-container"])},Ee={class:"search-user-result"},Re={class:"search-user-item"},xe={class:"user-item-email"},Ae={class:"list-item-section"},Ne={class:"list-item-title"},Oe={class:"list-item-container"},Pe={class:"list-item"},Ve=["src"],Le={class:"people-access-info"},Te={class:"people-access-permission"},Be={key:0,class:"ms-2 text-danger bx bx-trash"},ze={class:"list-item-section"},Fe={class:"list-item-container"},We={class:"list-item"},qe={class:"d-flex align-items-center"},Ye={key:0,class:"fs-4 bx bx-check result-correct"},Qe={class:"people-access-permission"},je=["onClick"];function De(h,i,o,e,Y,H){const d=f("RouterLink"),p=f("a-col"),C=f("a-row"),M=f("a-select-option"),k=f("a-select"),T=f("a-form-item"),g=f("a-qrcode"),E=f("a-input"),I=f("a-button"),B=f("a-popconfirm"),Q=f("a-form"),j=f("a-modal");return r(),N(j,{centered:"",width:"100%","wrap-class-name":"medium-modal",open:e.visibility,onCancel:e.closeModal},{footer:l(()=>i[9]||(i[9]=[])),default:l(()=>[t("div",{class:U(["page-container",e.selected_visibility_option===e.VISIBILITY.PRIVATE?"larger":""])},[t("div",Ue,[n(C,{class:"w-100 d-flex align-items-center justify-content-between"},{default:l(()=>[n(p,{span:1},{default:l(()=>[n(d,{to:{name:""},onClick:e.closeModal},{default:l(()=>i[2]||(i[2]=[t("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[2]})]),_:1}),n(p,{class:"main-title",span:22},{default:l(()=>[t("span",null,u(h.$t("share_modal.title"))+" "+u(h.$t(`share_modal.mode.${o.mode}`))+" "+u(o.name),1),i[3]||(i[3]=t("br",null,null,-1)),t("span",null,u(h.$t("share_modal.sub_title")),1)]),_:1,__:[3]})]),_:1})]),n(Q,{layout:"vertical"},{default:l(()=>[n(C,{class:"p-3 d-flex justify-content-between"},{default:l(()=>[n(p,{span:24},{default:l(()=>[n(T,{label:h.$t("share_modal.component_title.visibility")},{default:l(()=>[n(k,{disabled:!e.isUserOwner,onChange:e.onChangeVisibility,class:"me-3",value:e.selected_visibility_option,"onUpdate:value":i[0]||(i[0]=a=>e.selected_visibility_option=a),style:{width:"200px"}},{default:l(()=>[(r(!0),v(O,null,P(e.visibility_options,a=>(r(),N(M,{value:a.value},{default:l(()=>[w(u(a.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["disabled","value"]),t("div",Ce,u(e.selected_visibility_explain),1)]),_:1},8,["label"])]),_:1}),n(p,{span:24,class:U(["shareable-link-container",e.selected_visibility_option===e.VISIBILITY.PUBLIC?"":"d-none"])},{default:l(()=>[n(g,{value:e.getPublicShareUrl()},null,8,["value"]),t("div",null,[n(E,{class:"share-link",value:e.getPublicShareUrl()},null,8,["value"]),n(I,{class:"mt-2 main-color-btn",type:"primary",onClick:e.onCopyPublicShareUrl},{default:l(()=>[i[4]||(i[4]=t("i",{class:"me-3 bx bx-link-alt"},null,-1)),w(" "+u(h.$t("share_modal.buttons.copy_link")),1)]),_:1,__:[4]})])]),_:1},8,["class"]),n(p,{span:24,class:U([e.selected_visibility_option===e.VISIBILITY.PRIVATE?"":"d-none"])},{default:l(()=>[e.isUserOwner?(r(),v("div",Me,[t("label",null,[w(u(h.$t("share_modal.component_title.share_with_email"))+" - ",1),i[5]||(i[5]=t("span",null,"enter full email to search user",-1))]),n(e.Input,{onChange:e.onSearchUser,value:e.searchUserEmailValue,"onUpdate:value":i[1]||(i[1]=a=>e.searchUserEmailValue=a),placeholder:e.t("share_modal.other.search_email_placeholder")},{icon:l(()=>i[6]||(i[6]=[t("i",{class:"bx bx-envelope"},null,-1)])),_:1},8,["value","placeholder"]),e.userFound.length>0?(r(),v("div",ke,[t("div",Ee,[(r(!0),v(O,null,P(e.userFound,a=>(r(),v("div",Re,[t("div",xe,u(a.email),1),t("div",{class:U(["user-item-access",e.isSharedUserContain(a.id)?"d-none":""])},[n(I,{type:"primary",class:"main-color-btn",onClick:c=>e.onShareWithResultUser(a)},{default:l(()=>[...i[7]||(i[7]=[t("i",{class:"bx bxs-user-plus"},null,-1)])]),_:2,__:[7]},1032,["onClick"])],2)]))),256))])])):V("v-if",!0)],512)):V("v-if",!0),t("div",Ae,[t("div",Ne,u(h.$t("share_modal.component_title.people_with_access",{number:e.sharedUser.length})),1),t("div",Oe,[(r(!0),v(O,null,P(e.sharedUser,a=>(r(),v("div",Pe,[t("img",{class:"people-access-img",src:e.user_image,alt:""},null,8,Ve),t("div",Le,[t("span",null,u(a.fullName),1),t("span",null,u(a.email),1)]),t("div",Te,[n(k,{disabled:a.shareMode===e.PERMISSION.OWNER||a.userId===e.user.id,onChange:c=>e.onChangePeoplePermission(a.userId,a.shareMode),style:{width:"130px"},value:a.shareMode,"onUpdate:value":c=>a.shareMode=c},{default:l(()=>[(r(!0),v(O,null,P(e.permission_options,c=>(r(),N(M,{value:c.value},{default:l(()=>[w(u(c.label),1)]),_:2},1032,["value"]))),256)),a.shareMode===e.PERMISSION.OWNER?(r(),N(M,{key:0,value:e.PERMISSION.OWNER},{default:l(()=>[w(u(e.t(`share_modal.permission.${e.PERMISSION.OWNER}.mode`)),1)]),_:1},8,["value"])):V("v-if",!0)]),_:2},1032,["disabled","onChange","value","onUpdate:value"]),n(B,{title:h.$t("share_modal.other.delete_warning"),"ok-text":h.$t("share_modal.buttons.yes"),"cancel-text":h.$t("share_modal.buttons.no"),onConfirm:c=>e.onConfirmRemovePeopleAccess(a.userId)},{default:l(()=>[a.userId!==e.user.id&&a.shareMode!==e.PERMISSION.OWNER?(r(),v("i",Be)):V("v-if",!0)]),_:2},1032,["title","ok-text","cancel-text","onConfirm"])])]))),256))])])]),_:1},8,["class"]),n(p,{span:24,class:U([e.selected_visibility_option===e.VISIBILITY.IN_CLASS?"":"d-none"])},{default:l(()=>[t("div",ze,[t("div",Fe,[(r(!0),v(O,null,P(e.sharedClass,a=>(r(),v("div",We,[t("span",qe,[w(u(a.className)+" ",1),a.isAdded?(r(),v("i",Ye)):V("v-if",!0)]),t("div",Qe,[a.isAdded?(r(),v("i",{key:0,class:"text-danger bx bx-trash-alt",onClick:c=>e.onRemoveFromClass(a.classId)},null,8,je)):(r(),N(I,{key:1,type:"ghost",size:"small",class:"main-color-btn",onClick:c=>e.onAddToClass(a.classId)},{default:l(()=>[...i[8]||(i[8]=[t("i",{class:"bx bx-plus"},null,-1)])]),_:2,__:[8]},1032,["onClick"]))])]))),256))])])]),_:1},8,["class"])]),_:1})]),_:1})],2)]),_:1},8,["open"])}const ss=Ie(we,[["render",De],["__scopeId","data-v-a1cc234f"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/shared/modals/ShareModal.vue"]]);export{ss as S};

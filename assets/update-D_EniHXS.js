import{d as de,u as ce,q as ue,l as me,i as c,j as fe,N as pe,O as Te,s as ge,P as X,k as _,M as E,_ as he,r as T,a as M,o as g,b as i,c as a,w as f,f as Q,t as J,F as K,B as ve,C as _e,D as Me}from"./index-Dd8-myui.js";import{A as W}from"./ApiTest-Dpo4bmJf.js";import{Q as R}from"./questionTypes-CS3lcRlq.js";import{T as we,a as Se,C as qe,b as Ie,c as Ce,d as Re,S as ke}from"./ChooseQuestionModal-vNGkBmBP.js";import{S as ye,O as Ae,M as Fe,a as Oe}from"./ShortText-B2lmwy7J.js";import{T as Z}from"./TransferQuestionData-Bl0XXg5D.js";import{V as be}from"./Validator-CWeiTIFe.js";import"./Input-BtmZP41X.js";import"./ApiFolder-MKgG6ozZ.js";import"./folderShareMode-BudLQ2R2.js";import"./ApiTestTemplate-x2TAPrW4.js";import"./TextArea-DyOic0o8.js";import"./vue-draggable-plus-CKvOH8GT.js";const xe=de({__name:"update",setup(k,{expose:r}){var j;r();const B={MultipleChoice:Oe,Matching:Fe,Ordering:Ae,ShortText:ye},{t}=ce(),y=ue(),w=me(),h=c(),o=fe({testId:((j=y.params.id)==null?void 0:j.toString())||"",name:"",classId:"",timeLimit:60,startTime:"",endTime:"",gradeAttemptMethod:Se.HIGHEST_SCORE,gradeQuestionMethod:we.PARTIAL,isShowCorrectAnswerInReview:!0,isAllowReviewAfterSubmit:!0,shuffle:2,maxAttempt:2,passingScore:50,questions:[]}),A={questions:[{validator:(e,l)=>l&&l.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},v=c(!1),d=c(!0),S=async()=>{if(v.value=!0,!be.isValidGuid(o.testId)){d.value=!1,w.push({name:"404"});return}const e=await W.GetById(o.testId);if(!e.data.success){d.value=!1,w.push({name:"404"});return}Object.assign(o,e.data.data),o.questions=e.data.data.questions.map(l=>Z.transformResponseToRequest(l)),v.value=!1},m=()=>({id:Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),q=()=>{if(o.questions.length>=10){_.warning("Each question set could have at most 100 questions");return}o.questions.push(m())},P=e=>{if(o.questions.length<=1){_.warning("Each question set must have at least 1 questions");return}o.questions.splice(e,1)},$=async()=>{var Y;await((Y=h.value)==null?void 0:Y.validate());let e=!1,l="Invalid question.",u=new Set;if(o.name.trim().length>100||o.name.trim().length===0){e=!0,l="Invalid title.",_.error(l),F();return}[o.questions.filter(n=>{const s=n.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return s.length===0||s.length>=500}),o.questions.filter(n=>(n.explainText?n.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),o.questions.filter(n=>n.type===R.MULTIPLE_CHOICE&&(n.multipleChoices.some(s=>s.text.trim().length===0||s.text.trim().length>500)||n.multipleChoices.filter(s=>s.isAnswer).length===0)),o.questions.filter(n=>n.type===R.MATCHING&&(n.matchingPairs.some(s=>s.leftItem.trim().length===0||s.leftItem.trim().length>500)||n.matchingPairs.some(s=>s.rightItem.trim().length===0||s.rightItem.trim().length>500))),o.questions.filter(n=>n.type===R.ORDERING&&n.orderingItems.some(s=>s.text.trim().length===0||s.text.trim().length>500)),o.questions.filter(n=>n.type===R.SHORT_TEXT&&(n.shortAnswer.trim().length===0||n.shortAnswer.trim().length>500))].forEach(n=>{n.length>0&&(e=!0,n.forEach(s=>u.add(s)))});let re=Array.from(u).map(n=>o.questions.indexOf(n)+1);e?E.error({title:"Cannot create new question set!",content:"There are errors at questions: "+re.sort().join(", ")}):L()},L=()=>{E.confirm({title:"Create new quiz!",content:"Make sure to review your contents before proceeding.",centered:!0,onOk:async()=>{(await W.Create(o)).data.success&&(d.value=!1,_.success("Updated successfully!"))}})},z=c(null),F=()=>{var e;(e=z.value)==null||e.openTestSettingModal()},I=c(null),O=()=>{var e;(e=I.value)==null||e.openModal()},ee=()=>{var e;p.value=null,(e=I.value)==null||e.closeModal(),x()},te=e=>{var l;p.value=e,(l=I.value)==null||l.closeModal(),b()},p=c(null),N=c(""),H=c(null),b=()=>{var e;(e=H.value)==null||e.openModal()},oe=()=>{p.value=null,O()},C=c(null),x=()=>{var e;(e=C.value)==null||e.openModal()},ne=()=>{var e;p.value=null,(e=C.value)==null||e.closeModal(),O()},se=async e=>{var l;N.value=e,(l=C.value)==null||l.closeModal(),await X(),G()},V=c(null),G=()=>{var e;(e=V.value)==null||e.openModal()},ae=e=>{p.value=e,b()},le=()=>{x()},ie=e=>{_.success(`Imported ${e.length} questions`);const l=e.map(u=>Z.transformResponseToRequest(u));o.questions.push(...l)};pe((e,l,u)=>{if(!d.value){u();return}E.confirm({title:"Leave already?",content:"You have unsaved changes.",onOk:()=>{u()},onCancel:()=>u(!1)})});function D(e){e.preventDefault(),e.returnValue=""}Te(()=>{window.removeEventListener("beforeunload",D)}),ge(async()=>{await S(),o.questions.push(m()),window.addEventListener("beforeunload",D),await X(),F()});const U={componentMap:B,t,route:y,router:w,formRef:h,formState:o,rules:A,loading:v,isDataValid:d,getData:S,createQuestionTemplate:m,onAddQuestion:q,onRemoveQuestion:P,onFinish:$,showModalConfirmation:L,settingModalRef:z,openSettingModal:F,folderModalRef:I,openFolderModal:O,onSwitchToTestTemplate:ee,onOpenFolder:te,chosenFolder:p,chosenTestTemplateId:N,folderTestTemplateModalRef:H,openFolderTestTemplateModal:b,onBackToFolderModal:oe,testTemplateModalRef:C,openTestTemplateModal:x,onSwitchToFolder:ne,onOpenTestTemplate:se,questionModalRef:V,openQuestionModal:G,onBackToFolderTestTemplate:ae,onBackToTestTemplate:le,onModalImport:ie,handleBeforeUnload:D,SettingTestModal:ke,ChooseFolderModal:Re,ChooseFolderTestTemplateModal:Ce,ChooseTestTemplateModal:Ie,ChooseQuestionModal:qe};return Object.defineProperty(U,"__isScriptSetup",{enumerable:!1,value:!0}),U}}),De={class:"page-container"},Ee={class:"title-container"},Qe={class:"content"},Be={class:"content-item"},Pe={class:"content-item-title"},Le={class:"content-item-buttons"},ze={class:"import-button"},Ne={key:0},He={key:1,class:"list-question-container"};function Ve(k,r,B,t,y,w){const h=T("RouterLink"),o=T("a-col"),A=T("a-row"),v=T("a-button"),d=T("a-skeleton"),S=T("a-form");return g(),M(K,null,[i("div",De,[i("div",Ee,[a(A,{class:"w-100 d-flex align-items-center"},{default:f(()=>[a(o,{span:1},{default:f(()=>[a(h,{to:{name:""},onClick:t.openSettingModal},{default:f(()=>r[0]||(r[0]=[i("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[0]})]),_:1}),a(o,{class:"main-title",span:23},{default:f(()=>r[1]||(r[1]=[i("span",null,"Assign new test for class SEP490",-1),i("br",null,null,-1),i("span",null,"Add questions, set answers and configure test settings",-1)])),_:1,__:[1]})]),_:1})]),i("div",Qe,[a(S,{layout:"vertical",model:t.formState,rules:t.rules,ref:"formRef"},{default:f(()=>[i("div",Be,[i("div",Pe,[r[4]||(r[4]=i("div",null,[i("span",null,"Test questions"),i("span",null,"Create and manage your test questions")],-1)),i("div",Le,[a(h,{class:"import-button",to:{name:""},onClick:t.openFolderModal},{default:f(()=>r[2]||(r[2]=[Q(" Choose from folder test ")])),_:1,__:[2]}),i("div",ze,J(k.$t("create_QS.quiz.total",{number:t.formState.questions.length.toString().padStart(3,"0")})),1),a(v,{type:"primary",class:"main-color-btn",size:"large",onClick:t.onFinish},{default:f(()=>r[3]||(r[3]=[Q(" Next ")])),_:1,__:[3]})])]),t.loading?(g(),M("div",Ne,[a(d,{loading:t.loading,active:""},null,8,["loading"]),a(d,{loading:t.loading,active:""},null,8,["loading"]),a(d,{loading:t.loading,active:""},null,8,["loading"]),a(d,{loading:t.loading,active:""},null,8,["loading"]),a(d,{loading:t.loading,active:""},null,8,["loading"])])):(g(),M("div",He,[(g(!0),M(K,null,ve(t.formState.questions,(m,q)=>(g(),M("div",{key:m.id},[(g(),_e(Me(t.componentMap[m.type]),{question:m,index:q+1,displayScore:!0,onDeleteQuestion:P=>t.onRemoveQuestion(q)},null,40,["question","index","onDeleteQuestion"]))]))),128)),i("div",{class:"add-question-btn",onClick:t.onAddQuestion},[r[5]||(r[5]=i("i",{class:"bx bx-plus"},null,-1)),Q(" "+J(k.$t("create_QS.buttons.add_question")),1)])]))])]),_:1},8,["model"])])]),a(t.SettingTestModal,{ref:"settingModalRef","form-ref":t.formRef,"class-name":"SEP490","form-state":t.formState},null,8,["form-ref","form-state"]),a(t.ChooseFolderModal,{ref:"folderModalRef",onSwitchToTestTemplate:t.onSwitchToTestTemplate,onOpenFolder:t.onOpenFolder},null,512),a(t.ChooseFolderTestTemplateModal,{ref:"folderTestTemplateModalRef",folder:t.chosenFolder,onBackToFolderModal:t.onBackToFolderModal,onOpenTestTemplate:t.onOpenTestTemplate},null,8,["folder"]),a(t.ChooseTestTemplateModal,{ref:"testTemplateModalRef",onSwitchToFolder:t.onSwitchToFolder,onOpenTestTemplate:t.onOpenTestTemplate},null,512),a(t.ChooseQuestionModal,{ref:"questionModalRef","test-template-id":t.chosenTestTemplateId,folder:t.chosenFolder,onBackToFolderTestTemplateModal:t.onBackToFolderTestTemplate,onBackToTestTemplateModal:t.onBackToTestTemplate,onImport:t.onModalImport},null,8,["test-template-id","folder"])],64)}const st=he(xe,[["render",Ve],["__scopeId","data-v-c9dbf500"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test/update.vue"]]);export{st as default};

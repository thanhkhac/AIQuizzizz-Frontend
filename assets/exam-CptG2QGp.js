import{a as r,I as oe,d as ie,q as re,l as ce,u as de,i as C,z as me,j as Y,E as ue,s as _e,R as W,M as pe,k as M,D as ge,S as fe,_ as be,r as f,c as b,o as u,b as s,w as i,f as p,t as l,C as D,e as q,F as O,B as J}from"./index-CW61C-sU.js";import{A as z}from"./ApiClass-uzTGsytZ.js";import{A as ve}from"./ApiTest-BOKsJ6Sl.js";import{C as Ce}from"./classStudentPosition-B7ChrNvq.js";import{I as he}from"./Input-BFv57ikI.js";import{V as Se}from"./Validator-CWeiTIFe.js";import{U as ye}from"./UserTestAttempts-C9sXttgL.js";import"./lodash-BAfItYC6.js";var xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M688 312v-48c0-4.4-3.6-8-8-8H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8zm-392 88c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm376 116c-119.3 0-216 96.7-216 216s96.7 216 216 216 216-96.7 216-216-96.7-216-216-216zm107.5 323.5C750.8 868.2 712.6 884 672 884s-78.8-15.8-107.5-44.5C535.8 810.8 520 772.6 520 732s15.8-78.8 44.5-107.5C593.2 595.8 631.4 580 672 580s78.8 15.8 107.5 44.5C808.2 653.2 824 691.4 824 732s-15.8 78.8-44.5 107.5zM761 656h-44.3c-2.6 0-5 1.2-6.5 3.3l-63.5 87.8-23.1-31.9a7.92 7.92 0 00-6.5-3.3H573c-6.5 0-10.3 7.4-6.5 12.7l73.8 102.1c3.2 4.4 9.7 4.4 12.9 0l114.2-158c3.9-5.3.1-12.7-6.4-12.7zM440 852H208V148h560v344c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h272c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"file-done",theme:"outlined"};function K(o){for(var t=1;t<arguments.length;t++){var v=arguments[t]!=null?Object(arguments[t]):{},e=Object.keys(v);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(v).filter(function(_){return Object.getOwnPropertyDescriptor(v,_).enumerable}))),e.forEach(function(_){Te(o,_,v[_])})}return o}function Te(o,t,v){return t in o?Object.defineProperty(o,t,{value:v,enumerable:!0,configurable:!0,writable:!0}):o[t]=v,o}var V=function(t,v){var e=K({},t,v.attrs);return r(oe,K({},e,{icon:xe}),null)};V.displayName="FileDoneOutlined";V.inheritAttrs=!1;const I={ALL:"All",UPCOMING:"Upcoming",ACTIVE:"Active",COMPLETED:"Completed"},Ne=ie({__name:"exam",emits:["updateSidebar"],setup(o,{expose:t,emit:v}){var X;t();const e=re(),_=ce(),{t:d}=de(),h=v,g=C(e.params.id||""),S=C({classId:"",name:"",topic:""}),A=Object.values(I),N=me(()=>A.map(a=>({label:d(`class_exam.select_option.${a}`),value:a!==I.ALL?a:""}))),m=Y({pageNumber:e.query.pageNumber||1,pageSize:e.query.pageSize||10,testName:((X=e.query.testName)==null?void 0:X.toString())||"",status:e.query.status||N.value[0].value,totalCount:0,statusFilter:!1}),x=C([]),R=C(""),U=C(!1),k=async()=>{try{const a=await z.GetUserPermission(S.value.classId);a.data.success&&(R.value=a.data.data)}catch(a){console.log(a)}},w=async()=>{try{if(!Se.isValidGuid(g.value.toString())){_.push({name:"404"});return}g.value||_.push({name:"404"});let a=await z.GetById(g.value.toString());a.data.success||_.push({name:"404"}),S.value=a.data.data,E.name=S.value.name,E.topic=S.value.topic}catch(a){const c=Object.keys(a.response.data.errors);if(c.includes(W.NOT_FOUND_STUDENT_IN_CLASS)||c.includes(W.NOT_FOUND_USER_IN_CLASS)){_.push({name:"User_Class"});return}}},T=async()=>{try{U.value=!0;let a=await z.GetAllExamByLimit(g.value.toString(),m);if(a.data.success){let c=a.data.data;x.value=c.items,m.pageNumber=c.pageNumber,m.pageSize=c.pageSize,m.totalCount=c.totalCount,m.statusFilter&&(m.pageNumber>c.totalPages&&m.totalCount>0?(m.pageNumber=1,_.push({name:"User_Class_Exam",params:{id:g.value},query:{pageNumber:1,pageSize:m.pageSize,testName:m.testName,status:m.status}})):_.push({name:"User_Class_Exam",params:{id:g.value},query:{pageNumber:m.pageNumber,pageSize:m.pageSize,testName:m.testName,status:m.status}}),m.statusFilter=!m.statusFilter)}}catch(a){console.log("ERROR: GETALLEXAMBYLIMIT class exam: "+a)}finally{U.value=!1}};ue(()=>Object.keys(e.query).length,()=>{var a;m.pageNumber=e.query.pageNumber||1,m.pageSize=e.query.pageSize||10,m.testName=((a=e.query.testName)==null?void 0:a.toString())||"",m.status=e.query.status||N.value[0].value,m.statusFilter=!0,T()});const P=(a,c)=>{m.pageNumber=a,m.pageSize=c,m.statusFilter=!0,T()},F=a=>{if(a<24)return`${a} ${d(a!==1?"settings.subscription.plan.hour_plural":"settings.subscription.plan.hour_singular")} ${d("class_exam.other.ago")}`;if(a<24*7){const c=Math.floor(a/24);return`${c} ${d(c!==1?"settings.subscription.plan.day_plural":"settings.subscription.plan.day_singular")} ${d("class_exam.other.ago")}`}else if(a<24*30){const c=Math.floor(a/168);return`${c} ${d(c!==1?"settings.subscription.plan.week_plural":"settings.subscription.plan.week_singular")} ${d("class_exam.other.ago")}`}else if(a<24*365){const c=Math.floor(a/720);return`${c} ${d(c!==1?"settings.subscription.plan.month_plural":"settings.subscription.plan.month_singular")} ${d("class_exam.other.ago")}`}else{const c=Math.floor(a/8760);return`${c} ${d(c!==1?"settings.subscription.plan.year_plural":"settings.subscription.plan.year_singular")} ${d("class_exam.other.ago")}`}},n=a=>{switch(a){case I.COMPLETED:return"#3b82f6";case I.ACTIVE:return"#22C55E";case I.UPCOMING:return"#f59e0b"}},y=()=>{_.push({name:"User_Test_Create",params:{id:g.value}})},Z=a=>{_.push({name:"User_Test_Update",params:{id:a}})},$=a=>{pe.confirm({title:d("class_exam.modal.delete_title"),content:d("class_exam.modal.delete_content"),okText:d("sidebar.buttons.ok"),cancelText:d("sidebar.buttons.cancel"),onOk:async()=>{(await ve.Delete(a)).data.success&&(M.success(d("message.deleted_successfully")),T())}})},ee=a=>{_.push({name:"User_Test_Attempt",params:{id:a}})},te=a=>{_.push({name:"User_Class_Exam_Result",params:{classId:g.value,testId:a}})},ae=C({studentId:"",studentName:"",studentEmail:"",score:0,status:""}),j=C(x.value[0]||{testId:"",name:"",timeStart:"",timeLimit:0,numberOfQuestions:0,status:I.ACTIVE,relativeTime:0}),H=C(null),se=async a=>{var c;j.value=a,await ge(),(c=H.value)==null||c.openModal()},ne={name:[{required:!0,message:d("message.required"),trigger:"change"},{max:100,message:d("message.out_of_range",{max_length:100}),trigger:"change"}],topic:[{max:100,message:d("message.out_of_range",{max_length:100}),trigger:"change"}]},B=C(!1),G=C(),E=Y({name:S.value.name,topic:S.value.topic}),L=C(!1),le=async()=>{var a;L.value=!0;try{if((a=G.value)==null||a.validate(),!(await z.Update({classId:g.value,name:E.name,topic:E.topic})).data.success){M.error(d("message.updated_failed"));return}M.success(d("message.updated_successfully")),B.value=!1,window.location.reload()}catch(c){console.log(c)}finally{L.value=!1}};_e(async()=>{h("updateSidebar","class"),await w(),await k(),await T()});const Q={route:e,router:_,t:d,emit:h,classId:g,classData:S,optionKeys:A,exam_status_options:N,pageParams:m,exam_data:x,userRoleInClass:R,loading:U,getPermission:k,getClassData:w,getData:T,onPaginationChange:P,getFormattedRelativeTime:F,getTagColor:n,onRedirectToCreate:y,onRedirectToUpdate:Z,onDeleteTest:$,onRedirectToAttempt:ee,onRedirectToResult:te,chosenUser:ae,chosenExam:j,userHistoryModalRef:H,onOpenHistoryModal:se,rules:ne,modal_update_open:B,updateClassFormRef:G,updateClassFormState:E,isUpdateLoading:L,onUpdateClass:le,get CLASS_STUDENT_POSITION(){return Ce},get CLASS_EXAM_STATUS(){return I},get dayjs(){return fe},Input:he,get FileDoneOutlined(){return V},UserTestAttempts:ye};return Object.defineProperty(Q,"__isScriptSetup",{enumerable:!1,value:!0}),Q}}),Ie={class:"page-container"},Oe={class:"title-container"},Ue={class:"breadcrumb-container"},ke={class:"title-breadcrumb-item"},Ee={key:0,class:"title-breadcrumb-item"},De={class:"breadcrumb-item-topic"},Ae={key:1,class:"title-breadcrumb-item"},Re={class:"breadcrumb-item-topic"},we={class:"content"},ze={class:"content-item"},Pe={class:"content-item-title"},Fe={class:"content-item-functions"},Le={class:"content-item-navigators"},Me={class:"navigator-container"},qe={style:{width:"300px",padding:"0px"}},Ve={key:0,class:"exam-item-container"},je={class:"exam-item"},He={class:"exam-item-title"},Be={class:"exam-item-info exam-item-date"},Ge={class:"exam-item-info exam-info-detail"},Qe={class:"exam-item-questions"},Xe={class:"exam-item-time"},Ye={class:"exam-item-assigned completion"},We={key:0,class:"exam-item-assigned"},Je={key:1,class:"exam-item-assigned"},Ke={class:"exam-item-actions"},Ze=["onClick"],$e=["onClick"],et=["onClick"],tt=["onClick"],at={key:1,class:"w-100 d-flex justify-content-center"},st={class:"pagination-container"},nt={class:"modal-container"},lt={class:"modal-title-container"};function ot(o,t,v,e,_,d){const h=f("RouterLink"),g=f("a-button"),S=f("a-select-option"),A=f("a-select"),N=f("a-skeleton"),m=f("a-tag"),x=f("a-tooltip"),R=f("a-empty"),U=f("a-pagination"),k=f("a-col"),w=f("a-row"),T=f("a-form-item"),P=f("a-form"),F=f("a-modal");return u(),b(O,null,[s("div",Ie,[s("div",Oe,[s("div",Ue,[s("ul",null,[s("li",ke,[r(h,{to:{name:"User_Class"}},{default:i(()=>[s("span",null,l(o.$t("class_index.title")),1),t[8]||(t[8]=p()),t[9]||(t[9]=s("br",null,null,-1))]),_:1,__:[8,9]}),t[10]||(t[10]=s("i",{class:"bx bx-chevron-right"},null,-1))]),e.userRoleInClass===e.CLASS_STUDENT_POSITION.OWNER?(u(),b("li",Ee,[r(h,{to:{name:""},class:"breadcrumb-item-class",onClick:t[0]||(t[0]=n=>e.modal_update_open=!0)},{default:i(()=>[s("span",null,l(e.classData.name),1),s("span",De,l(e.classData.topic),1)]),_:1}),t[11]||(t[11]=s("i",{class:"bx bx-edit"},null,-1))])):(u(),b("li",Ae,[r(h,{to:{name:""},class:"breadcrumb-item-class"},{default:i(()=>[s("span",null,l(e.classData.name),1),s("span",Re,l(e.classData.topic),1)]),_:1})]))])])]),s("div",we,[s("div",ze,[s("div",Pe,[s("div",null,[s("span",null,l(o.$t("class_index.title")),1),s("span",null,l(o.$t("class_exam.sub_title")),1)]),e.userRoleInClass!==e.CLASS_STUDENT_POSITION.STUDENT?(u(),D(g,{key:0,type:"primary",class:"main-color-btn",onClick:e.onRedirectToCreate},{default:i(()=>[t[12]||(t[12]=s("i",{class:"me-2 bx bx-list-plus"},null,-1)),p(" "+l(o.$t("class_exam.buttons.assign_test")),1)]),_:1,__:[12]})):q("v-if",!0)]),s("div",Fe,[s("div",Le,[s("div",Me,[r(h,{class:"navigator-item navigator-active",to:{name:""}},{default:i(()=>[p(l(o.$t("class_index.navigators.exam")),1)]),_:1}),r(h,{class:"navigator-item",to:{name:"User_Class_Quiz"}},{default:i(()=>[p(l(o.$t("class_index.navigators.quiz")),1)]),_:1}),r(h,{class:"navigator-item",to:{name:"User_Class_Student"}},{default:i(()=>[p(l(o.$t("class_index.navigators.member")),1)]),_:1})])]),r(A,{class:"me-3",value:e.pageParams.status,"onUpdate:value":t[1]||(t[1]=n=>e.pageParams.status=n),style:{width:"200px"},onChange:e.getData},{default:i(()=>[(u(!0),b(O,null,J(e.exam_status_options,n=>(u(),D(S,{value:n.value},{default:i(()=>[p(l(n.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"]),s("div",qe,[r(e.Input,{onInput:e.getData,modelValue:e.pageParams.testName,"onUpdate:modelValue":t[2]||(t[2]=n=>e.pageParams.testName=n),placeholder:e.t("class_exam.other.search_placeholder")},{icon:i(()=>t[13]||(t[13]=[s("i",{class:"bx bx-search"},null,-1)])),_:1},8,["modelValue","placeholder"])])]),e.loading?(u(),b(O,{key:0},[r(N,{active:"",loading:e.loading},null,8,["loading"]),r(N,{active:"",loading:e.loading},null,8,["loading"]),r(N,{active:"",loading:e.loading},null,8,["loading"])],64)):(u(),b(O,{key:1},[e.exam_data.length>0?(u(),b("div",Ve,[(u(!0),b(O,null,J(e.exam_data,n=>(u(),b("div",je,[t[17]||(t[17]=s("i",{class:"bx bx-book-open exam-item-icon"},null,-1)),s("div",null,[s("div",He,[p(l(n.name)+" ",1),r(m,{color:e.getTagColor(n.status)},{default:i(()=>[p(l(o.$t(`class_exam.select_option.${n.status}`)),1)]),_:2},1032,["color"])]),s("div",Be,[s("div",null,[t[14]||(t[14]=s("i",{class:"bx bx-calendar"},null,-1)),p(" "+l(e.dayjs(n.timeStart).format("DD/MM/YYYY HH:mm A")),1)])]),s("div",Ge,[s("div",Qe,[t[15]||(t[15]=s("i",{class:"bx bx-message-square-edit bx-rotate-270"},null,-1)),p(" "+l(n.numberOfQuestions)+" "+l(o.$t("dashboards.list_items.quiz.questions")),1)]),s("div",Xe,[t[16]||(t[16]=s("i",{class:"bx bx-time-five"},null,-1)),p(" "+l(n.timeLimit)+" "+l(o.$t("class_exam.other.min")),1)]),s("span",Ye,l(n.numberOfCompletion)+" "+l(o.$t("class_exam.other.completions")),1),n.relativeTime>=0?(u(),b("span",We,l(o.$t("class_exam.other.assigned"))+" "+l(e.getFormattedRelativeTime(n.relativeTime)),1)):(u(),b("span",Je,l(o.$t("class_exam.other.start_in"))+" "+l(n.relativeTime*-1)+" "+l(n.relativeTime*-1>0?o.$t("settings.subscription.plan.hour_plural"):o.$t("settings.subscription.plan.hour_singular")),1))])]),s("div",Ke,[n.status===e.CLASS_EXAM_STATUS.ACTIVE?(u(),D(g,{key:0,type:"primary",class:"main-color-btn",onClick:y=>e.onRedirectToAttempt(n.testId)},{default:i(()=>[p(l(o.$t("class_exam.buttons.attempt")),1)]),_:2},1032,["onClick"])):q("v-if",!0),e.userRoleInClass!==e.CLASS_STUDENT_POSITION.STUDENT?(u(),b(O,{key:1},[n.status===e.CLASS_EXAM_STATUS.UPCOMING?(u(),D(x,{key:0},{title:i(()=>[p(l(o.$t("question_sets_index.buttons.edit")),1)]),default:i(()=>[s("i",{class:"bx bx-edit",onClick:y=>e.onRedirectToUpdate(n.testId)},null,8,Ze)]),_:2},1024)):q("v-if",!0),r(x,null,{title:i(()=>[p(l(o.$t("class_member.buttons.history_test")),1)]),default:i(()=>[s("i",{onClick:y=>e.onRedirectToResult(n.testId)},[r(e.FileDoneOutlined)],8,$e)]),_:2},1024),r(x,null,{title:i(()=>[p(l(o.$t("question_sets_index.buttons.delete")),1)]),default:i(()=>[s("i",{class:"text-danger bx bx-trash-alt",onClick:y=>e.onDeleteTest(n.testId)},null,8,et)]),_:2},1024)],64)):(u(),D(x,{key:2},{title:i(()=>[p(l(o.$t("class_member.buttons.history_test")),1)]),default:i(()=>[s("i",{onClick:y=>e.onOpenHistoryModal(n)},[r(e.FileDoneOutlined)],8,tt)]),_:2},1024))])]))),256))])):(u(),b("div",at,[r(R,null,{description:i(()=>[s("span",null,l(o.$t("class_index.other.no_data_matches")),1)]),_:1})]))],64)),s("div",st,[r(U,{onChange:e.onPaginationChange,current:e.pageParams.pageNumber,"onUpdate:current":t[3]||(t[3]=n=>e.pageParams.pageNumber=n),total:e.pageParams.totalCount,pageSize:e.pageParams.pageSize,"show-total":(n,y)=>`${y[0]}-${y[1]} of ${n} ${e.t("class_exam.other.items")}`,"show-size-changer":"",class:"crud-layout-pagination",locale:{items_per_page:e.t("class_index.other.pages")}},null,8,["current","total","pageSize","show-total","locale"])])])])]),r(F,{centered:"","wrap-class-name":"medium-modal",open:e.modal_update_open,onCancel:t[7]||(t[7]=n=>e.modal_update_open=!1)},{footer:i(()=>[r(g,{loading:e.isUpdateLoading,class:"main-color-btn",key:"submit",type:"primary",onClick:e.onUpdateClass},{default:i(()=>[p(l(o.$t("update_QS.buttons.update")),1)]),_:1},8,["loading"])]),default:i(()=>[s("div",nt,[s("div",lt,[r(w,{class:"w-100 d-flex align-items-center"},{default:i(()=>[r(k,{span:4},{default:i(()=>[r(h,{onClick:t[4]||(t[4]=n=>e.modal_update_open=!1),to:{name:""}},{default:i(()=>t[18]||(t[18]=[s("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[18]})]),_:1}),r(k,{class:"main-title",span:20},{default:i(()=>[s("span",null,l(e.t("class_index.modal.update_title")),1)]),_:1})]),_:1})]),r(P,{ref:"updateClassFormRef",layout:"vertical",rules:e.rules,model:e.updateClassFormState},{default:i(()=>[r(T,null,{default:i(()=>[r(e.Input,{label:e.t("class_index.modal.create_class_name_label"),name:"name",modelValue:e.updateClassFormState.name,"onUpdate:modelValue":t[5]||(t[5]=n=>e.updateClassFormState.name=n),placeholder:e.t("class_index.modal.create_class_name_placeholder"),"is-required":!0,"max-length":100},null,8,["label","modelValue","placeholder"])]),_:1}),r(T,null,{default:i(()=>[r(e.Input,{label:e.t("class_index.modal.create_class_topic_label"),name:"topic",modelValue:e.updateClassFormState.topic,"onUpdate:modelValue":t[6]||(t[6]=n=>e.updateClassFormState.topic=n),placeholder:e.t("class_index.modal.create_class_topic_placeholder"),"max-length":100},null,8,["label","modelValue","placeholder"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open"]),r(e.UserTestAttempts,{ref:"userHistoryModalRef","test-id":e.chosenExam.testId.toString(),"user-id":null,"test-name":e.chosenExam.name,"passing-score":0,"student-name":null},null,8,["test-id","test-name"])],64)}const gt=be(Ne,[["render",ot],["__scopeId","data-v-1afc52c6"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/class/exam.vue"]]);export{gt as default};

import{d as re,u as ce,i as _,C as Q,D as K,j as de,s as ue,Q as me,k as B,_ as _e,r as d,G as Y,o as u,w as n,b as t,p as S,c as o,t as i,a as h,F as A,E as R,f as k,e as H}from"./index-C2jtDg6B.js";import{A as J}from"./ApiTestTemplate-Ds5LzdWO.js";import{A as X}from"./ApiFolder-DE_T1vB3.js";import{I as he}from"./Input-0Otcuoto.js";import{V as Z}from"./visibility-PZlBDoOn.js";const z={OWNER:"Owner",EDITABLE:"Editable",VIEW_ONLY:"ViewOnly"},ve=re({__name:"ShareModal",props:{id:{type:String,required:!0},name:{type:String,required:!0},mode:{type:String,required:!0},visibility:{type:String,required:!0},options:{type:null,required:!0}},setup(r,{expose:l}){const{t:p}=ce(),e=r,P=_(!1),q=()=>{g.value=U.value[0].value,P.value=!0},V=()=>{P.value=!1};l({openModal:q});const v=Object.values(e.options),U=Q(()=>v.map(a=>({label:p(`share_modal.visibility.${a}.mode`),value:a}))),g=_(),y=_("");K(()=>g.value,async a=>{y.value=p(`share_modal.visibility.${a}.explain`),a===Z.PRIVATE&&await M()});const N=[z.EDITABLE,z.VIEW_ONLY],O=Q(()=>N.map(a=>({label:p(`share_modal.permission.${a}.mode`),value:a}))),F=_(O.value[0].value),f=_([{id:"1",name:"SEP490 - Summer 2025"},{id:"2",name:"MLN111 - Spring 2025"},{id:"3",name:"MLN121 - Spring 2025"}]),C=_([]),b=_(),w=_([]),M=async()=>{debugger;let a;switch(e.mode){case"quiz":break;case"template":{a=await J.GetSharedUser(e.id);break}case"folder":{a=await X.GetSharedUser(e.id);break}}a!=null&&a.data.success&&(C.value=a.data.data.sharingModel)},I=_(""),s=_([]),m=_([]),W=_(null);function j(a){var c;I.value&&!((c=W.value)!=null&&c.contains(a.target))?s.value=[]:s.value=[...m.value]}const $=async()=>{if(!I.value.trim()){s.value=[],m.value=[];return}const a=await me.SearchByEmail(I.value);a.data.success&&(s.value=a.data.data,m.value=[...a.data.data])},T=async({sharingModels:a=[],deleteUserIds:c=[],successMsg:L="Updated successfully",errorMsg:ie="Update failed!"})=>{b.value={id:e.id,sharingModels:a,deleteUserIds:c};let x;switch(e.mode){case"quiz":break;case"template":{x=await J.UpdateSharedUser(b.value);break}case"folder":{x=await X.UpdateSharedUser({folderId:b.value.id,...b.value});break}}x!=null&&x.data.success?(await M(),B.success(L)):B.error(ie)},ee=async a=>{await T({sharingModels:[{sharingUserId:a.id,shareMode:z.VIEW_ONLY}],successMsg:"Added successfully",errorMsg:"Add failed!"})},ae=async(a,c)=>{await T({sharingModels:[{sharingUserId:a,shareMode:c}],successMsg:"Updated successfully",errorMsg:"Update failed!"})},se=async a=>{w.value.push(a),await T({sharingModels:[],deleteUserIds:w.value,successMsg:"Removed successfully",errorMsg:"Remove failed!"})},te=a=>C.value.some(c=>c.userId===a),E=de({checkAll:!1,indeterminate:!1,checkedList:[]}),le=a=>{var c;Object.assign(E,{checkedList:a.target.checked?(c=f.value)==null?void 0:c.map(L=>L.id):[],indeterminate:!1})};K(()=>E.checkedList,a=>{var c;E.indeterminate=!!a.length&&a.length<f.value.map(L=>L.id).length,E.checkAll=a.length===((c=f.value)==null?void 0:c.length)});const ne=()=>{V()},D=()=>window.location.origin+`/user/library/${e.id}`,oe=()=>{navigator.clipboard.writeText(D()).then(()=>{B.success("Copied")}).catch(()=>{B.error("Empty")})};ue(()=>{document.addEventListener("click",j),y.value=p(`share_modal.visibility.${g.value}.explain`)});const G={t:p,props:e,visibility:P,openModal:q,closeModal:V,visibilityKeys:v,visibility_options:U,selected_visibility_option:g,selected_visibility_explain:y,permissionKeys:N,permission_options:O,selected_permission_option:F,user_class_sample:f,sharedUser:C,sharingFormState:b,deleteUserIds:w,getSharedUser:M,searchUserEmailValue:I,userFound:s,lastSearchResult:m,searchUserResultRef:W,handleMouseClickOutside:j,onSearchUser:$,updateSharedUsers:T,onShareWithResultUser:ee,onChangePeoplePermission:ae,onConfirmRemovePeopleAccess:se,isSharedUserContain:te,shareClassState:E,onCheckAll:le,onShareClass:ne,getPublicShareUrl:D,onCopyPublicShareUrl:oe,Input:he,get VISIBILITY(){return Z},get PERMISSION(){return z}};return Object.defineProperty(G,"__isScriptSetup",{enumerable:!1,value:!0}),G}}),pe={class:"title-container"},fe={class:"visibility-explain"},be={class:"form-item search-user",ref:"searchUserResultRef"},ge={key:0,class:S(["search-user-container"])},Se={class:"search-user-result"},ye={class:"search-user-item"},Ie={class:"user-item-email"},ke={class:"list-item-section"},Ue={class:"list-item-title"},Ce={class:"list-item-container"},we={class:"list-item"},Me={class:"people-access-info"},Ee={class:"people-access-permission"},Le={key:0,class:"ms-2 text-danger bx bx-trash"},xe={class:"list-item-section"},Ae={class:"list-item-title d-flex align-items-center"},Re={class:"list-item"},Pe={class:"mt-3 d-flex justify-content-end"};function Ve(r,l,p,e,P,q){const V=d("RouterLink"),v=d("a-col"),U=d("a-row"),g=d("a-select-option"),y=d("a-select"),N=d("a-form-item"),O=d("a-qrcode"),F=d("a-input"),f=d("a-button"),C=d("a-popconfirm"),b=d("a-checkbox"),w=d("a-checkbox-group"),M=d("a-form"),I=d("a-modal");return u(),Y(I,{centered:"",width:"100%","wrap-class-name":"medium-modal",open:e.visibility,onCancel:e.closeModal},{footer:n(()=>l[11]||(l[11]=[])),default:n(()=>[t("div",{class:S(["page-container",e.selected_visibility_option===e.VISIBILITY.PRIVATE?"larger":""])},[t("div",pe,[o(U,{class:"w-100 d-flex align-items-center justify-content-between"},{default:n(()=>[o(v,{span:1},{default:n(()=>[o(V,{to:{name:""},onClick:e.closeModal},{default:n(()=>l[4]||(l[4]=[t("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[4]})]),_:1}),o(v,{class:"main-title",span:22},{default:n(()=>[t("span",null,i(r.$t("share_modal.title"))+" "+i(r.$t(`share_modal.mode.${p.mode}`))+" "+i(p.name),1),l[5]||(l[5]=t("br",null,null,-1)),t("span",null,i(r.$t("share_modal.sub_title")),1)]),_:1,__:[5]})]),_:1})]),o(M,{layout:"vertical"},{default:n(()=>[o(U,{class:"p-3 d-flex justify-content-between"},{default:n(()=>[o(v,{span:24},{default:n(()=>[o(N,{label:r.$t("share_modal.component_title.visibility")},{default:n(()=>[o(y,{class:"me-3",value:e.selected_visibility_option,"onUpdate:value":l[0]||(l[0]=s=>e.selected_visibility_option=s),style:{width:"200px"}},{default:n(()=>[(u(!0),h(A,null,R(e.visibility_options,s=>(u(),Y(g,{value:s.value},{default:n(()=>[k(i(s.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"]),t("div",fe,i(e.selected_visibility_explain),1)]),_:1},8,["label"])]),_:1}),o(v,{span:24,class:S(["shareable-link-container",e.selected_visibility_option===e.VISIBILITY.PUBLIC?"":"d-none"])},{default:n(()=>[o(O,{value:e.getPublicShareUrl()},null,8,["value"]),t("div",null,[o(F,{class:"share-link",value:e.getPublicShareUrl()},null,8,["value"]),o(f,{class:"mt-2 main-color-btn",type:"primary",onClick:e.onCopyPublicShareUrl},{default:n(()=>[l[6]||(l[6]=t("i",{class:"me-3 bx bx-link-alt"},null,-1)),k(" "+i(r.$t("share_modal.buttons.copy_link")),1)]),_:1,__:[6]})])]),_:1},8,["class"]),o(v,{span:24,class:S([e.selected_visibility_option===e.VISIBILITY.PRIVATE?"":"d-none"])},{default:n(()=>[t("div",be,[t("label",null,[k(i(r.$t("share_modal.component_title.share_with_email"))+" - ",1),l[7]||(l[7]=t("span",null,"enter full email to search user",-1))]),o(e.Input,{onChange:e.onSearchUser,value:e.searchUserEmailValue,"onUpdate:value":l[1]||(l[1]=s=>e.searchUserEmailValue=s),placeholder:e.t("share_modal.other.search_email_placeholder")},{icon:n(()=>l[8]||(l[8]=[t("i",{class:"bx bx-envelope"},null,-1)])),_:1},8,["value","placeholder"]),e.userFound.length>0?(u(),h("div",ge,[t("div",Se,[(u(!0),h(A,null,R(e.userFound,s=>(u(),h("div",ye,[t("div",Ie,i(s.email),1),t("div",{class:S(["user-item-access",e.isSharedUserContain(s.id)?"d-none":""])},[o(f,{type:"primary",class:"main-color-btn",onClick:m=>e.onShareWithResultUser(s)},{default:n(()=>[...l[9]||(l[9]=[t("i",{class:"bx bxs-user-plus"},null,-1)])]),_:2,__:[9]},1032,["onClick"])],2)]))),256))])])):H("v-if",!0)],512),t("div",ke,[t("div",Ue,i(r.$t("share_modal.component_title.people_with_access",{number:e.sharedUser.length})),1),t("div",Ce,[(u(!0),h(A,null,R(e.sharedUser,s=>(u(),h("div",we,[l[10]||(l[10]=t("img",{class:"people-access-img",src:"",alt:""},null,-1)),t("div",Me,[t("span",null,i(s.fullName),1),t("span",null,i(s.email),1)]),t("div",Ee,[o(y,{disabled:s.shareMode===e.PERMISSION.OWNER,onChange:m=>e.onChangePeoplePermission(s.userId,s.shareMode),style:{width:"130px"},value:s.shareMode,"onUpdate:value":m=>s.shareMode=m},{default:n(()=>[(u(!0),h(A,null,R(e.permission_options,m=>(u(),Y(g,{value:m.value},{default:n(()=>[k(i(m.label),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["disabled","onChange","value","onUpdate:value"]),o(C,{title:r.$t("share_modal.other.delete_warning"),"ok-text":r.$t("share_modal.buttons.yes"),"cancel-text":r.$t("share_modal.buttons.no"),onConfirm:m=>e.onConfirmRemovePeopleAccess(s.userId)},{default:n(()=>[s.shareMode!==e.PERMISSION.OWNER?(u(),h("i",Le)):H("v-if",!0)]),_:2},1032,["title","ok-text","cancel-text","onConfirm"])])]))),256))])])]),_:1},8,["class"]),o(v,{span:24,class:S([e.selected_visibility_option===e.VISIBILITY.IN_CLASS?"":"d-none"])},{default:n(()=>[t("div",xe,[t("div",Ae,[t("div",{class:S(["w-25 header-item",e.shareClassState.checkAll?"check-all":""])},[o(b,{onClick:e.onCheckAll,checked:e.shareClassState.checkAll,"onUpdate:checked":l[2]||(l[2]=s=>e.shareClassState.checkAll=s),indeterminate:e.shareClassState.indeterminate},{default:n(()=>[k(i(r.$t("share_modal.buttons.check_all",{number:e.shareClassState.checkedList.length})),1)]),_:1},8,["checked","indeterminate"])],2),t("span",null,i(r.$t("share_modal.component_title.share_with_class")),1)]),t("div",null,[o(w,{class:"list-item-container",value:e.shareClassState.checkedList,"onUpdate:value":l[3]||(l[3]=s=>e.shareClassState.checkedList=s)},{default:n(()=>[(u(!0),h(A,null,R(e.user_class_sample,s=>(u(),h("div",Re,[o(b,{value:s.id},{default:n(()=>[t("span",null,i(s.name),1)]),_:2},1032,["value"])]))),256))]),_:1},8,["value"])]),t("div",Pe,[o(f,{type:"primary",class:"main-color-btn",size:"large",onClick:e.onShareClass},{default:n(()=>[k(i(r.$t("share_modal.buttons.done")),1)]),_:1})])])]),_:1},8,["class"])]),_:1})]),_:1})],2)]),_:1},8,["open"])}const qe=_e(ve,[["render",Ve],["__scopeId","data-v-a1cc234f"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/shared/modals/ShareModal.vue"]]);export{qe as S};

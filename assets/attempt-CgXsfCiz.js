import{d as Ie,S as X,u as ye,q as Te,l as Ae,i as d,z as L,a3 as Ce,s as qe,k as T,R as Se,M as Qe,D as ke,_ as De,r as M,c as h,o as u,b as i,a as m,w,f as E,t as v,C as $,F,B as G,p as f,e as Y}from"./index-CW61C-sU.js";import{A as oe}from"./ApiTest-BOKsJ6Sl.js";import{Q as A}from"./questionTypes-CS3lcRlq.js";import{T as Me,l as Ee}from"./vue-draggable-plus-CZtYoO2z.js";import{V as Oe}from"./Validator-CWeiTIFe.js";import{u as Ue}from"./utc-CDwbnwnz.js";import{H as Re}from"./HolderOutlined-B4q7j7_A.js";/* empty css                                                                 */function Le(I=[],o=[]){const s=[];for(let e=0;e<I.length;e++)s.push({leftId:I[e].id,rightId:o[e].id});return s}class He{transferToUserAnswerSubmit(o){return console.log(o),o.map(s=>{var e;return{questionId:s.questionId,userAnswerData:{type:s.type,multipleChoice:s.multipleChoices??[],matching:Le(s.matchingLeft??[],s.matchingRight??[]),ordering:((e=s.ordering)==null?void 0:e.map((x,g)=>({itemId:x.id,order:g})))??[],shortText:s.shortText??""}}})}transferFromUserAnswerSubmit(o){return o.filter(s=>s.userAnswerData!=null).map(s=>{var e,x,g;return{questionId:s.questionId,type:s.userAnswerData.type,multipleChoices:s.userAnswerData.multipleChoice??[],matchingLeft:(e=s.userAnswerData.matching)!=null&&e.length?s.userAnswerData.matching.map(c=>({id:c.leftId})):[],matchingRight:(x=s.userAnswerData.matching)!=null&&x.length?s.userAnswerData.matching.map(c=>({id:c.rightId})):[],ordering:(g=s.userAnswerData.ordering)!=null&&g.length?s.userAnswerData.ordering.map(c=>({id:c.itemId})):[],shortText:s.userAnswerData.shortText??""}})}}const ae=new He,Ve=Ie({__name:"attempt",setup(I,{expose:o}){o(),X.extend(Ue);const{t:s}=ye(),e=Te(),x=Ae(),g=d([]),c=d([]),a=d({id:"",explainText:"",questionSetId:"",questionText:"",score:0,scoreGraded:0,textFormat:"0",type:"MultipleChoice",correctMultipleChoiceCount:0,questionData:{matching:null,multipleChoice:null,ordering:null,shortText:""}}),S=d(""),Q=d(!1),O=d(!1),U=d([]),H=d([]),r=d([]),_=d([]),k=d(""),ee=d(!0),J=d(e.params.id.toString()),y=d({attemptId:"",name:"",questionCount:0,timeStart:"",timeEnd:"",timeLimit:0,timeRemaining:0,questions:[]}),K=d(!1),te=async()=>{try{if(K.value=!0,!Oe.isValidGuid(J.value)){ee.value=!1,x.push({name:"404"});return}const t=await oe.Attempt(J.value);if(y.value=t.data.data,y.value.timeRemaining<=0){T.error(s("message.time_up")),x.push({name:"User_Class"});return}g.value=[...t.data.data.questions.map(n=>({id:n.questionId,...n}))],c.value=ae.transferFromUserAnswerSubmit(t.data.data.questions.map(n=>({questionId:n.id,userAnswerData:n.userAnswerDataDto}))),a.value=g.value[0]}catch(t){Object.keys(t.response.data.errors).includes(Se.MAX_ATTEMPT_IN_THIS_TEST)&&x.back()}finally{K.value=!1}},V=(t,n)=>{t===-1?c.value.push(n):c.value[t]=n},re=()=>{const t=c.value.findIndex(n=>n.questionId===a.value.id);switch(a.value.type){case A.MULTIPLE_CHOICE:{U.value.length>0?V(t,{questionId:a.value.id,type:a.value.type,multipleChoices:[...U.value],matchingLeft:null,matchingRight:null,ordering:null,shortText:""}):t!==-1&&c.value.splice(t,1);break}case A.MATCHING:{V(t,{questionId:a.value.id,type:a.value.type,multipleChoices:null,matchingLeft:[...H.value],matchingRight:[...r.value],ordering:null,shortText:""});break}case A.ORDERING:{V(t,{questionId:a.value.id,type:a.value.type,multipleChoices:null,matchingLeft:null,matchingRight:null,ordering:[..._.value],shortText:""});break}case A.SHORT_TEXT:{k.value.trim()?V(t,{questionId:a.value.id,type:a.value.type,multipleChoices:null,matchingLeft:null,matchingRight:null,ordering:null,shortText:k.value.trim()}):t!==-1&&c.value.splice(t,1);break}}},N=async t=>{const n=ae.transferToUserAnswerSubmit(c.value);return(await oe.Submit({attemptId:y.value.attemptId,userAnswers:n,isSubmit:t})).data.success},le=()=>{Qe.confirm({title:s("attempt_test.submit_modal.title"),content:s("attempt_test.submit_modal.content"),centered:!0,okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),onOk:async()=>{if(!await N(!0)){T.error(s("message.submited_failed"));return}T.info(s("message.submited_successfully")),x.push({name:"User_Class"})}})},ue=async()=>{try{if(!await N(!1)){T.error(s("message.submited_failed"));return}T.info(s("message.saved_successfully"))}catch{T.error(s("message.saved_failed"))}},j=t=>{var R;B(),Q.value=!1,a.value=g.value[t];const n=c.value.find(l=>l.questionId===a.value.id);switch(a.value.type){case A.MULTIPLE_CHOICE:{S.value=s("learn_QS.instructions.multiple_choice",{number:a.value.correctMultipleChoiceCount}),U.value=n?n==null?void 0:n.multipleChoices:[];break}case A.ORDERING:{S.value=s("learn_QS.instructions.ordering"),_.value=n?n==null?void 0:n.ordering.map(l=>{var p,b;return{id:l.id,text:(b=(p=a.value.questionData.ordering)==null?void 0:p.find(q=>q.id===l.id))==null?void 0:b.text}}):((R=a.value.questionData.ordering)==null?void 0:R.map(l=>l))||[];break}case A.MATCHING:{S.value=s("learn_QS.instructions.matching"),H.value=n?n==null?void 0:n.matchingLeft.map(l=>{var p,b;return{id:l.id,text:(b=(p=a.value.questionData.matching)==null?void 0:p.leftItems.find(q=>q.id===l.id))==null?void 0:b.text}}):a.value.questionData.matching.leftItems.map(l=>l)||[],r.value=n?n==null?void 0:n.matchingRight.map(l=>{var p,b;return{id:l.id,text:(b=(p=a.value.questionData.matching)==null?void 0:p.rightItems.find(q=>q.id===l.id))==null?void 0:b.text}}):a.value.questionData.matching.rightItems.map(l=>l)||{};break}case A.SHORT_TEXT:{S.value=s("learn_QS.instructions.short_text"),k.value=n?n==null?void 0:n.shortText:"";break}}},ce=()=>{const t=g.value.findIndex(n=>n.id===a.value.id);t<g.value.length-1&&j(t+1)},de=()=>{const t=g.value.findIndex(n=>n.id===a.value.id);t>0&&j(t-1)},me=t=>Array.from(c.value).some(n=>n.questionId===t),ge=L(()=>{const t=g.value.findIndex(n=>n.id===a.value.id);return t!==-1&&t<g.value.length-1}),ve=L(()=>{const t=g.value.findIndex(n=>n.id===a.value.id);return t!==-1&&t>0}),he=L(()=>g.value.findIndex(t=>t.id===a.value.id)),fe={scroll:!0,scrollSensitivity:100,scrollSpeed:100,scrollTarget:document.scrollingElement};function B(){ke(()=>{requestAnimationFrame(()=>{const t=document.querySelectorAll(".matching-option-container.left .answer-option-matching"),n=document.querySelectorAll(".matching-option-container.right .answer-option-matching"),R=Math.min(t.length,n.length);for(let l=0;l<R;l++){const p=t[l],b=n[l];if(!p||!b)continue;p.style.height="auto",b.style.height="auto";const q=Math.max(p.offsetHeight,b.offsetHeight);p.style.height=`${q}px`,b.style.height=`${q}px`}})})}const _e=L(()=>{var t;return(t=a.value.questionData.multipleChoice)==null?void 0:t.some(n=>n.text.length>=100)}),W=d(X().add(y.value.timeRemaining*60,"second")),z=d(y.value.timeRemaining*60);let C=null;const pe=L(()=>{const t=Math.floor(z.value/60).toString().padStart(2,"0"),n=(z.value%60).toString().padStart(2,"0");return`${t}:${n}`}),Z=async()=>{const t=W.value.diff(X(),"second");if(z.value=t>0?t:0,t<=0&&C){if(clearInterval(C),C=null,!await N(!0)){T.error(s("message.submited_failed"));return}T.info(s("message.time_up")),x.push({name:"User_Class"})}};let P=null;const ne=async()=>{if(!await N(!1)){T.error(s("message.auto_save_failed"));return}T.info(s("message.auto_save_successfully"))},D=d(new Set),be=()=>{const t=a.value.id;D.value.delete(t)||D.value.add(t),localStorage.setItem("flagged_question",JSON.stringify({attemptId:y.value.attemptId,questions:Array.from(D.value)}))},se=()=>{const t=localStorage.getItem("flagged_question");if(!t)return;const n=JSON.parse(t);if(n.attemptId!=y.value.attemptId){localStorage.removeItem("flagged_question");return}if(!Array.isArray(n.questions)){localStorage.removeItem("flagged_question");return}D.value=new Set(n.questions)},we=t=>Array.from(D.value).some(n=>n===t),xe=L(()=>{const t=a.value.id;return Array.from(D.value).some(n=>n===t)});Ce(()=>{C&&clearInterval(C),P&&clearInterval(P)}),qe(async()=>{B(),window.addEventListener("resize",B),await te(),z.value=y.value.timeRemaining*60,W.value=X().add(y.value.timeRemaining*60,"second"),j(0),se(),Z(),C=setInterval(Z,1e3),P=setInterval(ne,3e4)});const ie={t:s,route:e,router:x,quiz:g,userAnswer:c,currentQuestion:a,currentQuestionInstruction:S,currentQuestionIsSkipped:Q,isSubmitted:O,userAnswerMultipleChoice:U,userAnswerMatchingLeft:H,userAnswerMatchingRight:r,userAnswerOrdering:_,userAnswerShortText:k,isDataValid:ee,testId:J,attemptData:y,loading:K,getAttemptData:te,updateUserAnswer:V,onUserAnswerChange:re,sendUserAnswer:N,onSubmit:le,onSave:ue,onLoadCurrentQuestion:j,onNextQuestion:ce,onPreviousQuestion:de,userAnswerContainQuestion:me,hasNextQuestion:ge,hasPreviousQuestion:ve,currentQuestionIndex:he,dragOptions:fe,syncMatchingHeights:B,isOptionExceed:_e,endTime:W,remainingTime:z,get timer(){return C},set timer(t){C=t},formattedTime:pe,updateCountdown:Z,get autoSaver(){return P},set autoSaver(t){P=t},autoSave:ne,flaggedQuestion:D,onToggleFlagQuestion:be,onLoadFlaggedQuestion:se,flagContainQuestion:we,isCurrentQuestionFlagged:xe,get QUESTION_TYPE(){return A},TextArea:Me,get VueDraggable(){return Ee},get HolderOutlined(){return Re}};return Object.defineProperty(ie,"__isScriptSetup",{enumerable:!1,value:!0}),ie}}),Ne={class:"page-container"},ze={class:"title-container title-container-header"},Pe={class:"content content-test d-flex flex-column"},Fe={class:"d-flex"},Ge={class:"content-item question-navigators"},Ye={class:"question-navigator-title d-flex justify-content-between align-items-center"},je={class:"countdown d-flex align-items-center"},Be={key:1,class:"question-navigator-container"},Xe=["onClick"],Je={class:"d-flex"},Ke={class:"content-item"},We={key:0},Ze={key:1,class:"section question-section"},$e={class:"question-info-index"},et=["innerHTML"],tt={class:"section answer-section"},nt={class:"d-flex align-items-center"},st={class:"answer-section-ins"},it={class:"answer-option-content"},ot={key:1,class:"answer-option-container matching"},at={class:"matching-option-container left"},rt={class:"d-flex align-items-center"},lt={class:f(["answer-option answer-option-matching"])},ut={class:"answer-option-order"},ct={class:"answer-option-content"},dt={class:"matching-option-container right"},mt={class:"d-flex align-items-center"},gt={class:f(["answer-option answer-option-matching"])},vt={class:"answer-option-content"},ht={class:"answer-option-order"},ft={key:2,class:"answer-option-container ordering"},_t={class:f(["answer-option answer-option-ordering"])},pt={class:"answer-option-order"},bt={class:"answer-option-content"},wt={key:3,class:"answer-option-container"},xt={class:f(["answer-short-text"])},It={class:"w-100 d-flex align-items-center"},yt={class:"learn-question-footer"},Tt={class:"d-flex"};function At(I,o,s,e,x,g){const c=M("RouterLink"),a=M("a-col"),S=M("a-row"),Q=M("a-skeleton"),O=M("a-button"),U=M("a-checkbox"),H=M("a-checkbox-group");return u(),h("div",Ne,[i("div",ze,[m(S,{class:"w-100 d-flex align-items-center"},{default:w(()=>[m(a,{span:1},{default:w(()=>[m(c,{to:{name:"User_Class"}},{default:w(()=>o[7]||(o[7]=[i("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[7]})]),_:1}),m(a,{class:"main-title",span:22},{default:w(()=>{var r,_;return[i("span",null,v((r=e.attemptData)==null?void 0:r.name),1),o[8]||(o[8]=E()),o[9]||(o[9]=i("br",null,null,-1)),i("span",null,v((_=e.attemptData)==null?void 0:_.questionCount),1)]}),_:1,__:[8,9]})]),_:1})]),i("div",Pe,[i("div",Fe,[i("div",Ge,[i("div",Ye,[i("span",null,v(e.t("practice_test.other.question_list")),1),i("span",je,[o[10]||(o[10]=i("i",{class:"bx bx-timer"},null,-1)),E(" "+v(e.formattedTime),1)])]),e.loading?(u(),$(Q,{key:0,loading:e.loading},null,8,["loading"])):(u(),h("div",Be,[(u(!0),h(F,null,G(e.quiz,(r,_)=>(u(),h("div",{class:f(["question-navigation-item-outer",e.currentQuestion.id===r.id?"current-question":"",e.flagContainQuestion(r.id)?"flagged-question":""]),onClick:k=>e.onLoadCurrentQuestion(_)},[i("div",{class:f(["question-navigator-item",e.userAnswerContainQuestion(r.id)?"completed-question":""])},[i("span",null,v(_+1),1)],2)],10,Xe))),256))])),i("div",Je,[m(O,{type:"primary",class:f(["main-color-btn",e.isSubmitted?"main-color-btn-disabled":""]),onClick:e.onSubmit},{default:w(()=>[E(v(I.$t("learn_QS.buttons.submit")),1)]),_:1},8,["class"]),m(O,{type:"primary",class:f(["ms-3 main-color-btn-ghost",e.isSubmitted?"main-color-btn-disabled":""]),onClick:e.onSave},{default:w(()=>[E(v(I.$t("admin.manage_subscription.btn.save")),1)]),_:1},8,["class"])])])]),i("div",Ke,[e.loading?(u(),h("div",We,[m(Q,{loading:e.loading},null,8,["loading"]),m(Q,{loading:e.loading},null,8,["loading"]),m(Q,{loading:e.loading},null,8,["loading"])])):(u(),h("div",Ze,[i("div",$e,v(I.$t("create_QS.question.question"))+" "+v(e.currentQuestionIndex+1),1),i("div",{class:f(["learn-question"]),innerHTML:e.currentQuestion.questionText},null,8,et),Y(` <div v-else :class="['learn-question']">
                        {{ currentQuestion.questionText }}
                    </div> `),i("div",tt,[i("div",nt,[i("div",st,v(e.currentQuestionInstruction),1)]),e.currentQuestion.type===e.QUESTION_TYPE.MULTIPLE_CHOICE?(u(),$(H,{key:0,onChange:e.onUserAnswerChange,value:e.userAnswerMultipleChoice,"onUpdate:value":o[0]||(o[0]=r=>e.userAnswerMultipleChoice=r),class:f(["answer-option-container multiplechoice",e.isOptionExceed?"column":""])},{default:w(()=>[(u(!0),h(F,null,G(e.currentQuestion.questionData.multipleChoice,(r,_)=>(u(),$(U,{value:r.id,"onUpdate:value":k=>r.id=k,class:f(["answer-option answer-option-multiplechoice"])},{default:w(()=>[i("div",it,v(r.text),1)]),_:2},1032,["value","onUpdate:value"]))),256))]),_:1},8,["value","class"])):Y("v-if",!0),e.currentQuestion.type===e.QUESTION_TYPE.MATCHING?(u(),h("div",ot,[i("div",at,[m(e.VueDraggable,{modelValue:e.userAnswerMatchingLeft,"onUpdate:modelValue":o[1]||(o[1]=r=>e.userAnswerMatchingLeft=r),options:e.dragOptions,onMove:e.syncMatchingHeights,onEnd:o[2]||(o[2]=()=>{e.syncMatchingHeights(),e.onUserAnswerChange()})},{default:w(()=>[(u(!0),h(F,null,G(e.userAnswerMatchingLeft,(r,_)=>(u(),h("div",rt,[i("div",lt,[i("div",ut,[m(e.HolderOutlined)]),i("div",ct,v(r.text),1)]),o[11]||(o[11]=i("i",{class:f(["bx bxs-label matching-icon"])},null,-1))]))),256))]),_:1},8,["modelValue"])]),i("div",dt,[m(e.VueDraggable,{modelValue:e.userAnswerMatchingRight,"onUpdate:modelValue":o[3]||(o[3]=r=>e.userAnswerMatchingRight=r),options:e.dragOptions,onMove:e.syncMatchingHeights,onEnd:o[4]||(o[4]=()=>{e.syncMatchingHeights(),e.onUserAnswerChange()})},{default:w(()=>[(u(!0),h(F,null,G(e.userAnswerMatchingRight,(r,_)=>(u(),h("div",mt,[o[12]||(o[12]=i("i",{class:f(["bx bxs-label matching-icon"])},null,-1)),i("div",gt,[i("div",vt,v(r.text),1),i("div",ht,[m(e.HolderOutlined)])])]))),256))]),_:1},8,["modelValue"])])])):Y("v-if",!0),e.currentQuestion.type===e.QUESTION_TYPE.ORDERING?(u(),h("div",ft,[m(e.VueDraggable,{modelValue:e.userAnswerOrdering,"onUpdate:modelValue":o[5]||(o[5]=r=>e.userAnswerOrdering=r),options:e.dragOptions,onEnd:e.onUserAnswerChange},{default:w(()=>[(u(!0),h(F,null,G(e.userAnswerOrdering,(r,_)=>(u(),h("div",_t,[i("div",pt,[m(e.HolderOutlined),E(" "+v(_+1),1)]),i("div",bt,v(r.text),1)]))),256))]),_:1},8,["modelValue"])])):Y("v-if",!0),e.currentQuestion.type===e.QUESTION_TYPE.SHORT_TEXT?(u(),h("div",wt,[i("div",xt,[i("div",It,[m(e.TextArea,{placeholder:"Enter your answer...",modelValue:e.userAnswerShortText,"onUpdate:modelValue":o[6]||(o[6]=r=>e.userAnswerShortText=r),onChange:e.onUserAnswerChange},null,8,["modelValue"])])])])):Y("v-if",!0)]),i("div",yt,[m(O,{class:f(["main-color-btn",e.hasPreviousQuestion?"":"main-color-btn-disabled"]),type:"primary",size:"large",onClick:e.onPreviousQuestion},{default:w(()=>[o[13]||(o[13]=i("i",{class:"bx bx-chevron-left"},null,-1)),E(" "+v(I.$t("practice_test.buttons.previous")),1)]),_:1,__:[13]},8,["class"]),i("i",{class:f(["bx bx-flag flag-button",e.isCurrentQuestionFlagged?"bxs-flag":""]),onClick:e.onToggleFlagQuestion},null,2),i("div",Tt,[m(O,{class:f(["main-color-btn",e.hasNextQuestion?"":"main-color-btn-disabled"]),type:"primary",size:"large",onClick:e.onNextQuestion},{default:w(()=>[E(v(I.$t("learn_QS.buttons.next_question"))+" ",1),o[14]||(o[14]=i("i",{class:"bx bx-chevron-right"},null,-1))]),_:1,__:[14]},8,["class"])])])]))])])])}const Ot=De(Ve,[["render",At],["__scopeId","data-v-b60278b8"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test/attempt.vue"]]);export{Ot as default};

import{a as r,I as oe,d as ie,q as re,l as ce,u as de,i as b,z as me,j as Y,E as ue,s as _e,R as J,M as pe,k as L,D as ge,S as fe,_ as ve,r as f,c as C,o as p,b as s,w as i,f as _,t as o,C as A,e as q,F as U,B as K}from"./index-CHQ5wIb3.js";import{A as R}from"./ApiClass-B3uIo_GQ.js";import{A as be}from"./ApiTest-BwaTVl2I.js";import{C as Ce}from"./classStudentPosition-B7ChrNvq.js";import{I as he}from"./Input-DIUsBtCl.js";import{V as Se}from"./Validator-CWeiTIFe.js";import{U as ye}from"./UserTestAttempts-D7cI3LvL.js";import"./lodash-D3YBHHdp.js";var xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M688 312v-48c0-4.4-3.6-8-8-8H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8zm-392 88c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm376 116c-119.3 0-216 96.7-216 216s96.7 216 216 216 216-96.7 216-216-96.7-216-216-216zm107.5 323.5C750.8 868.2 712.6 884 672 884s-78.8-15.8-107.5-44.5C535.8 810.8 520 772.6 520 732s15.8-78.8 44.5-107.5C593.2 595.8 631.4 580 672 580s78.8 15.8 107.5 44.5C808.2 653.2 824 691.4 824 732s-15.8 78.8-44.5 107.5zM761 656h-44.3c-2.6 0-5 1.2-6.5 3.3l-63.5 87.8-23.1-31.9a7.92 7.92 0 00-6.5-3.3H573c-6.5 0-10.3 7.4-6.5 12.7l73.8 102.1c3.2 4.4 9.7 4.4 12.9 0l114.2-158c3.9-5.3.1-12.7-6.4-12.7zM440 852H208V148h560v344c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h272c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"file-done",theme:"outlined"};function W(l){for(var t=1;t<arguments.length;t++){var v=arguments[t]!=null?Object(arguments[t]):{},e=Object.keys(v);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(v).filter(function(u){return Object.getOwnPropertyDescriptor(v,u).enumerable}))),e.forEach(function(u){Te(l,u,v[u])})}return l}function Te(l,t,v){return t in l?Object.defineProperty(l,t,{value:v,enumerable:!0,configurable:!0,writable:!0}):l[t]=v,l}var V=function(t,v){var e=W({},t,v.attrs);return r(oe,W({},e,{icon:xe}),null)};V.displayName="FileDoneOutlined";V.inheritAttrs=!1;const I={ALL:"All",UPCOMING:"Upcoming",ACTIVE:"Active",COMPLETED:"Completed"},Ne=ie({__name:"exam",emits:["updateSidebar"],setup(l,{expose:t,emit:v}){var X;t();const e=re(),u=ce(),{t:d}=de(),h=v,g=b(e.params.id||""),S=b({classId:"",name:"",topic:""}),D=Object.values(I),N=me(()=>D.map(a=>({label:d(`class_exam.select_option.${a}`),value:a!==I.ALL?a:""}))),m=Y({pageNumber:e.query.pageNumber||1,pageSize:e.query.pageSize||10,testName:((X=e.query.testName)==null?void 0:X.toString())||"",status:e.query.status||N.value[0].value,totalCount:0,statusFilter:!1}),x=b([]),w=b(""),O=b(!1),k=async()=>{try{const a=await R.GetUserPermission(S.value.classId);a.data.success&&(w.value=a.data.data)}catch(a){console.log(a)}},z=async()=>{try{if(!Se.isValidGuid(g.value.toString())){u.push({name:"404"});return}g.value||u.push({name:"404"});let a=await R.GetById(g.value.toString());a.data.success||u.push({name:"404"}),S.value=a.data.data,E.name=S.value.name,E.topic=S.value.topic}catch(a){const c=Object.keys(a.response.data.errors);if(c.includes(J.NOT_FOUND_STUDENT_IN_CLASS)||c.includes(J.NOT_FOUND_USER_IN_CLASS)){u.push({name:"User_Class"});return}}},T=async()=>{try{O.value=!0;let a=await R.GetAllExamByLimit(g.value.toString(),m);if(a.data.success){let c=a.data.data;x.value=c.items,m.pageNumber=c.pageNumber,m.pageSize=c.pageSize,m.totalCount=c.totalCount,m.statusFilter&&(m.pageNumber>c.totalPages&&m.totalCount>0?(m.pageNumber=1,u.push({name:"User_Class_Exam",params:{id:g.value},query:{pageNumber:1,pageSize:m.pageSize,testName:m.testName,status:m.status}})):u.push({name:"User_Class_Exam",params:{id:g.value},query:{pageNumber:m.pageNumber,pageSize:m.pageSize,testName:m.testName,status:m.status}}),m.statusFilter=!m.statusFilter)}}catch(a){console.log("ERROR: GETALLEXAMBYLIMIT class exam: "+a)}finally{O.value=!1}};ue(()=>Object.keys(e.query).length,()=>{var a;m.pageNumber=e.query.pageNumber||1,m.pageSize=e.query.pageSize||10,m.testName=((a=e.query.testName)==null?void 0:a.toString())||"",m.status=e.query.status||N.value[0].value,m.statusFilter=!0,T()});const F=(a,c)=>{m.pageNumber=a,m.pageSize=c,m.statusFilter=!0,T()},P=a=>{if(a<24)return`${a} ${d(a!==1?"settings.subscription.plan.hour_plural":"settings.subscription.plan.hour_singular")} ${d("class_exam.other.ago")}`;if(a<24*7){const c=Math.floor(a/24);return`${c} ${d(c!==1?"settings.subscription.plan.day_plural":"settings.subscription.plan.day_singular")} ${d("class_exam.other.ago")}`}else if(a<24*30){const c=Math.floor(a/168);return`${c} ${d(c!==1?"settings.subscription.plan.week_plural":"settings.subscription.plan.week_singular")} ${d("class_exam.other.ago")}`}else if(a<24*365){const c=Math.floor(a/720);return`${c} ${d(c!==1?"settings.subscription.plan.month_plural":"settings.subscription.plan.month_singular")} ${d("class_exam.other.ago")}`}else{const c=Math.floor(a/8760);return`${c} ${d(c!==1?"settings.subscription.plan.year_plural":"settings.subscription.plan.year_singular")} ${d("class_exam.other.ago")}`}},n=a=>{switch(a){case I.COMPLETED:return"#3b82f6";case I.ACTIVE:return"#22C55E";case I.UPCOMING:return"#f59e0b"}},y=()=>{u.push({name:"User_Test_Create",params:{id:g.value}})},Z=a=>{u.push({name:"User_Test_Update",params:{id:a}})},$=a=>{pe.confirm({title:d("class_exam.modal.delete_title"),content:d("class_exam.modal.delete_content"),okText:d("sidebar.buttons.ok"),cancelText:d("sidebar.buttons.cancel"),onOk:async()=>{(await be.Delete(a)).data.success&&(L.success(d("message.deleted_successfully")),T())}})},ee=a=>{u.push({name:"User_Test_Attempt",params:{id:a}})},te=a=>{u.push({name:"User_Class_Exam_Result",params:{classId:g.value,testId:a}})},ae=b({studentId:"",studentName:"",studentEmail:"",score:0,status:""}),j=b(x.value[0]||{testId:"",name:"",timeStart:"",timeLimit:0,numberOfQuestions:0,status:I.ACTIVE,relativeTime:0}),H=b(null),se=async a=>{var c;j.value=a,await ge(),(c=H.value)==null||c.openModal()},ne={name:[{required:!0,message:d("message.required"),trigger:"change"},{max:100,message:d("message.out_of_range",{max_length:100}),trigger:"change"}],topic:[{max:100,message:d("message.out_of_range",{max_length:100}),trigger:"change"}]},B=b(!1),G=b(),E=Y({name:S.value.name,topic:S.value.topic}),M=b(!1),le=async()=>{var a;M.value=!0;try{if((a=G.value)==null||a.validate(),!(await R.Update({classId:g.value,name:E.name,topic:E.topic})).data.success){L.error(d("message.updated_failed"));return}L.success(d("message.updated_successfully")),B.value=!1,window.location.reload()}catch(c){console.log(c)}finally{M.value=!1}};_e(async()=>{h("updateSidebar","class"),await z(),await k(),await T()});const Q={route:e,router:u,t:d,emit:h,classId:g,classData:S,optionKeys:D,exam_status_options:N,pageParams:m,exam_data:x,userRoleInClass:w,loading:O,getPermission:k,getClassData:z,getData:T,onPaginationChange:F,getFormattedRelativeTime:P,getTagColor:n,onRedirectToCreate:y,onRedirectToUpdate:Z,onDeleteTest:$,onRedirectToAttempt:ee,onRedirectToResult:te,chosenUser:ae,chosenExam:j,userHistoryModalRef:H,onOpenHistoryModal:se,rules:ne,modal_update_open:B,updateClassFormRef:G,updateClassFormState:E,isUpdateLoading:M,onUpdateClass:le,get CLASS_STUDENT_POSITION(){return Ce},get CLASS_EXAM_STATUS(){return I},get dayjs(){return fe},Input:he,get FileDoneOutlined(){return V},UserTestAttempts:ye};return Object.defineProperty(Q,"__isScriptSetup",{enumerable:!1,value:!0}),Q}}),Ie={class:"page-container"},Ue={class:"title-container"},Oe={class:"breadcrumb-container"},ke={class:"title-breadcrumb-item"},Ee={class:"title-breadcrumb-item"},Ae={class:"breadcrumb-item-topic"},De={class:"content"},we={class:"content-item"},ze={class:"content-item-title"},Re={class:"content-item-functions"},Fe={class:"content-item-navigators"},Pe={class:"navigator-container"},Me={style:{width:"300px",padding:"0px"}},Le={key:0,class:"exam-item-container"},qe={class:"exam-item"},Ve={class:"exam-item-title"},je={class:"exam-item-info exam-item-date"},He={class:"exam-item-info exam-info-detail"},Be={class:"exam-item-questions"},Ge={class:"exam-item-time"},Qe={class:"exam-item-assigned completion"},Xe={key:0,class:"exam-item-assigned"},Ye={key:1,class:"exam-item-assigned"},Je={class:"exam-item-actions"},Ke=["onClick"],We=["onClick"],Ze=["onClick"],$e=["onClick"],et={key:1,class:"w-100 d-flex justify-content-center"},tt={class:"pagination-container"},at={class:"modal-container"},st={class:"modal-title-container"};function nt(l,t,v,e,u,d){const h=f("RouterLink"),g=f("a-button"),S=f("a-select-option"),D=f("a-select"),N=f("a-skeleton"),m=f("a-tag"),x=f("a-tooltip"),w=f("a-empty"),O=f("a-pagination"),k=f("a-col"),z=f("a-row"),T=f("a-form-item"),F=f("a-form"),P=f("a-modal");return p(),C(U,null,[s("div",Ie,[s("div",Ue,[s("div",Oe,[s("ul",null,[s("li",ke,[r(h,{to:{name:"User_Class"}},{default:i(()=>[s("span",null,o(l.$t("class_index.title")),1),t[8]||(t[8]=_()),t[9]||(t[9]=s("br",null,null,-1))]),_:1,__:[8,9]}),t[10]||(t[10]=s("i",{class:"bx bx-chevron-right"},null,-1))]),s("li",Ee,[r(h,{to:{name:""},class:"breadcrumb-item-class",onClick:t[0]||(t[0]=n=>e.modal_update_open=!0)},{default:i(()=>[s("span",null,o(e.classData.name),1),s("span",Ae,o(e.classData.topic),1)]),_:1}),t[11]||(t[11]=s("i",{class:"bx bx-edit"},null,-1))])])])]),s("div",De,[s("div",we,[s("div",ze,[s("div",null,[s("span",null,o(l.$t("class_index.title")),1),s("span",null,o(l.$t("class_exam.sub_title")),1)]),e.userRoleInClass!==e.CLASS_STUDENT_POSITION.STUDENT?(p(),A(g,{key:0,type:"primary",class:"main-color-btn",onClick:e.onRedirectToCreate},{default:i(()=>[t[12]||(t[12]=s("i",{class:"me-2 bx bx-list-plus"},null,-1)),_(" "+o(l.$t("class_exam.buttons.assign_test")),1)]),_:1,__:[12]})):q("v-if",!0)]),s("div",Re,[s("div",Fe,[s("div",Pe,[r(h,{class:"navigator-item navigator-active",to:{name:""}},{default:i(()=>[_(o(l.$t("class_index.navigators.exam")),1)]),_:1}),r(h,{class:"navigator-item",to:{name:"User_Class_Quiz"}},{default:i(()=>[_(o(l.$t("class_index.navigators.quiz")),1)]),_:1}),r(h,{class:"navigator-item",to:{name:"User_Class_Student"}},{default:i(()=>[_(o(l.$t("class_index.navigators.member")),1)]),_:1})])]),r(D,{class:"me-3",value:e.pageParams.status,"onUpdate:value":t[1]||(t[1]=n=>e.pageParams.status=n),style:{width:"200px"},onChange:e.getData},{default:i(()=>[(p(!0),C(U,null,K(e.exam_status_options,n=>(p(),A(S,{value:n.value},{default:i(()=>[_(o(n.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"]),s("div",Me,[r(e.Input,{onInput:e.getData,modelValue:e.pageParams.testName,"onUpdate:modelValue":t[2]||(t[2]=n=>e.pageParams.testName=n),placeholder:e.t("class_exam.other.search_placeholder")},{icon:i(()=>t[13]||(t[13]=[s("i",{class:"bx bx-search"},null,-1)])),_:1},8,["modelValue","placeholder"])])]),e.loading?(p(),C(U,{key:0},[r(N,{active:"",loading:e.loading},null,8,["loading"]),r(N,{active:"",loading:e.loading},null,8,["loading"]),r(N,{active:"",loading:e.loading},null,8,["loading"])],64)):(p(),C(U,{key:1},[e.exam_data.length>0?(p(),C("div",Le,[(p(!0),C(U,null,K(e.exam_data,n=>(p(),C("div",qe,[t[17]||(t[17]=s("i",{class:"bx bx-book-open exam-item-icon"},null,-1)),s("div",null,[s("div",Ve,[_(o(n.name)+" ",1),r(m,{color:e.getTagColor(n.status)},{default:i(()=>[_(o(l.$t(`class_exam.select_option.${n.status}`)),1)]),_:2},1032,["color"])]),s("div",je,[s("div",null,[t[14]||(t[14]=s("i",{class:"bx bx-calendar"},null,-1)),_(" "+o(e.dayjs(n.timeStart).format("DD/MM/YYYY HH:mm A")),1)])]),s("div",He,[s("div",Be,[t[15]||(t[15]=s("i",{class:"bx bx-message-square-edit bx-rotate-270"},null,-1)),_(" "+o(n.numberOfQuestions)+" "+o(l.$t("dashboards.list_items.quiz.questions")),1)]),s("div",Ge,[t[16]||(t[16]=s("i",{class:"bx bx-time-five"},null,-1)),_(" "+o(n.timeLimit)+" "+o(l.$t("class_exam.other.min")),1)]),s("span",Qe,o(n.numberOfCompletion)+" "+o(l.$t("class_exam.other.completions")),1),n.relativeTime>=0?(p(),C("span",Xe,o(l.$t("class_exam.other.assigned"))+" "+o(e.getFormattedRelativeTime(n.relativeTime)),1)):(p(),C("span",Ye,o(l.$t("class_exam.other.start_in"))+" "+o(n.relativeTime*-1)+" "+o(n.relativeTime*-1>0?l.$t("settings.subscription.plan.hour_plural"):l.$t("settings.subscription.plan.hour_singular")),1))])]),s("div",Je,[n.status===e.CLASS_EXAM_STATUS.ACTIVE?(p(),A(g,{key:0,type:"primary",class:"main-color-btn",onClick:y=>e.onRedirectToAttempt(n.testId)},{default:i(()=>[_(o(l.$t("class_exam.buttons.attempt")),1)]),_:2},1032,["onClick"])):q("v-if",!0),e.userRoleInClass!==e.CLASS_STUDENT_POSITION.STUDENT?(p(),C(U,{key:1},[n.status===e.CLASS_EXAM_STATUS.UPCOMING?(p(),A(x,{key:0},{title:i(()=>[_(o(l.$t("question_sets_index.buttons.edit")),1)]),default:i(()=>[s("i",{class:"bx bx-edit",onClick:y=>e.onRedirectToUpdate(n.testId)},null,8,Ke)]),_:2},1024)):q("v-if",!0),r(x,null,{title:i(()=>[_(o(l.$t("class_member.buttons.history_test")),1)]),default:i(()=>[s("i",{onClick:y=>e.onRedirectToResult(n.testId)},[r(e.FileDoneOutlined)],8,We)]),_:2},1024),r(x,null,{title:i(()=>[_(o(l.$t("question_sets_index.buttons.delete")),1)]),default:i(()=>[s("i",{class:"text-danger bx bx-trash-alt",onClick:y=>e.onDeleteTest(n.testId)},null,8,Ze)]),_:2},1024)],64)):(p(),A(x,{key:2},{title:i(()=>[_(o(l.$t("class_member.buttons.history_test")),1)]),default:i(()=>[s("i",{onClick:y=>e.onOpenHistoryModal(n)},[r(e.FileDoneOutlined)],8,$e)]),_:2},1024))])]))),256))])):(p(),C("div",et,[r(w,null,{description:i(()=>[s("span",null,o(l.$t("class_index.other.no_data_matches")),1)]),_:1})]))],64)),s("div",tt,[r(O,{onChange:e.onPaginationChange,current:e.pageParams.pageNumber,"onUpdate:current":t[3]||(t[3]=n=>e.pageParams.pageNumber=n),total:e.pageParams.totalCount,pageSize:e.pageParams.pageSize,"show-total":(n,y)=>`${y[0]}-${y[1]} of ${n} ${e.t("class_exam.other.items")}`,"show-size-changer":"",class:"crud-layout-pagination",locale:{items_per_page:e.t("class_index.other.pages")}},null,8,["current","total","pageSize","show-total","locale"])])])])]),r(P,{centered:"","wrap-class-name":"medium-modal",open:e.modal_update_open,onCancel:t[7]||(t[7]=n=>e.modal_update_open=!1)},{footer:i(()=>[r(g,{loading:e.isUpdateLoading,class:"main-color-btn",key:"submit",type:"primary",onClick:e.onUpdateClass},{default:i(()=>[_(o(l.$t("update_QS.buttons.update")),1)]),_:1},8,["loading"])]),default:i(()=>[s("div",at,[s("div",st,[r(z,{class:"w-100 d-flex align-items-center"},{default:i(()=>[r(k,{span:4},{default:i(()=>[r(h,{onClick:t[4]||(t[4]=n=>e.modal_update_open=!1),to:{name:""}},{default:i(()=>t[18]||(t[18]=[s("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[18]})]),_:1}),r(k,{class:"main-title",span:20},{default:i(()=>[s("span",null,o(e.t("class_index.modal.update_title")),1)]),_:1})]),_:1})]),r(F,{ref:"updateClassFormRef",layout:"vertical",rules:e.rules,model:e.updateClassFormState},{default:i(()=>[r(T,null,{default:i(()=>[r(e.Input,{label:e.t("class_index.modal.create_class_name_label"),name:"name",modelValue:e.updateClassFormState.name,"onUpdate:modelValue":t[5]||(t[5]=n=>e.updateClassFormState.name=n),placeholder:e.t("class_index.modal.create_class_name_placeholder"),"is-required":!0,"max-length":100},null,8,["label","modelValue","placeholder"])]),_:1}),r(T,null,{default:i(()=>[r(e.Input,{label:e.t("class_index.modal.create_class_topic_label"),name:"topic",modelValue:e.updateClassFormState.topic,"onUpdate:modelValue":t[6]||(t[6]=n=>e.updateClassFormState.topic=n),placeholder:e.t("class_index.modal.create_class_topic_placeholder"),"max-length":100},null,8,["label","modelValue","placeholder"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open"]),r(e.UserTestAttempts,{ref:"userHistoryModalRef","test-id":e.chosenExam.testId.toString(),"user-id":null,"test-name":e.chosenExam.name,"passing-score":0,"student-name":null},null,8,["test-id","test-name"])],64)}const _t=ve(Ne,[["render",nt],["__scopeId","data-v-1afc52c6"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/class/exam.vue"]]);export{_t as default};

import{d as xe,O as z,u as be,q as we,l as Te,i as l,C as L,W as Ie,s as ye,M as Ae,k as G,X as Ce,_ as Se,r as A,a as c,o as r,b as i,c as d,w as p,f as Q,t as x,F as R,E as H,p as m,G as se,e as Y}from"./index-C2jtDg6B.js";import{A as Z}from"./ApiTest-RSE37fQt.js";import{Q as w}from"./questionTypes-CS3lcRlq.js";import{T as qe}from"./TextArea-SkV_8IH8.js";import{l as Qe}from"./vue-draggable-plus-DALPiNCD.js";import{V as ke}from"./Validator-CWeiTIFe.js";import{u as Oe}from"./utc-BGTnualw.js";import{H as Ee}from"./HolderOutlined-DGSrVOt0.js";/* empty css                                                                 */function Me(k=[],o=[]){const u=[];for(let e=0;e<k.length;e++)u.push({leftId:k[e].id,rightId:o[e].id});return u}class Ue{transferToUserAnswerSubmit(o){return o.map(u=>{var e;return{questionId:u.questionId,userAnswerData:{type:u.type,multipleChoice:u.multipleChoices??[],matching:Me(u.matchingLeft??[],u.matchingRight??[]),ordering:((e=u.ordering)==null?void 0:e.map(g=>({itemId:g.id,order:g.correctOrder})))??[],shortText:u.shortText??""}}})}transferFromUserAnswerSubmit(o){return o.filter(u=>u!=null).map(({questionId:u,userAnswerData:e})=>({questionId:u,type:e.type,multipleChoices:e.multipleChoice??[],matchingLeft:e.matching.map(g=>({id:g.leftId})),matchingRight:e.matching.map(g=>({id:g.rightId})),ordering:e.ordering.map(g=>({id:g.itemId,correctOrder:g.order}))??[],shortText:e.shortText??""}))}}const $=new Ue,Le=xe({__name:"attempt",setup(k,{expose:o}){o(),z.extend(Oe);const{t:u}=be(),e=we(),g=Te(),ee={HTML:"HTML",PLAIN_TEXT:"PlainText"},_=l([]),h=l([]),a=l({id:"",explainText:"",questionSetId:"",questionText:"",score:0,scoreGraded:0,textFormat:"0",type:"MultipleChoice",questionData:{matching:null,multipleChoice:null,ordering:null,shortText:""}}),b=l(""),C=l(!1),j=l(!1),S=l([]),s=l([]),v=l([]),q=l([]),V=l(""),X=l(!0),B=l(e.params.id.toString()),T=l({attemptId:"",name:"",questionCount:0,timeStart:"",timeEnd:"",timeLimit:0,timeRemaining:0,questions:[]}),W=l(!1),te=async()=>{try{if(W.value=!0,!ke.isValidGuid(B.value)){X.value=!1,g.push({name:"404"});return}const t=await Z.Attempt(B.value);T.value=t.data.data,_.value=[...t.data.data.questions.map(n=>({id:n.questionId,...n}))],h.value=$.transferFromUserAnswerSubmit(t.data.data.questions.map(n=>n.userAnswerDataDto)),a.value=_.value[0]}catch(t){if(!t.response.data.success){X.value=!1,g.push({name:"404"});return}console.log(t)}finally{W.value=!1}},O=(t,n)=>{t===-1?h.value.push(n):h.value[t]=n},ae=()=>{const t=h.value.findIndex(n=>n.questionId===a.value.id);switch(a.value.type){case w.MULTIPLE_CHOICE:{S.value.length>0?O(t,{questionId:a.value.id,type:a.value.type,multipleChoices:[...S.value],matchingLeft:null,matchingRight:null,ordering:null,shortText:""}):t!==-1&&h.value.splice(t,1);break}case w.MATCHING:{O(t,{questionId:a.value.id,type:a.value.type,multipleChoices:null,matchingLeft:[...s.value],matchingRight:[...v.value],ordering:null,shortText:""});break}case w.ORDERING:{O(t,{questionId:a.value.id,type:a.value.type,multipleChoices:null,matchingLeft:null,matchingRight:null,ordering:[...q.value],shortText:""});break}case w.SHORT_TEXT:{V.value.trim()?O(t,{questionId:a.value.id,type:a.value.type,multipleChoices:null,matchingLeft:null,matchingRight:null,ordering:null,shortText:V.value.trim()}):t!==-1&&h.value.splice(t,1);break}}},re=()=>{Ae.confirm({title:"Are you sure to submit your test?",content:"Please double check your answer before submitting!",centered:!0,onOk:async()=>{const t=$.transferToUserAnswerSubmit(h.value);if(!(await Z.Submit({attemptId:T.value.attemptId,userAnswers:t})).data.success){G.error("Submit failed!");return}G.info("Submit successfully!")}})},N=t=>{var P,y;D(),C.value=!1,a.value=_.value[t];const n=h.value.find(f=>f.questionId===a.value.id);switch(a.value.type){case w.MULTIPLE_CHOICE:{b.value=`Choose (${(P=a.value.questionData.multipleChoice)==null?void 0:P.filter(f=>f.isAnswer).length}) options.`,S.value=n?n==null?void 0:n.multipleChoices:[];break}case w.ORDERING:{b.value="Arrange these options to their correct order.",q.value=n?n==null?void 0:n.ordering:((y=a.value.questionData.ordering)==null?void 0:y.map(f=>f))||[];break}case w.MATCHING:{b.value="Arrange the items to align with their correct matches.",s.value=n?n==null?void 0:n.matchingLeft:a.value.questionData.matching.leftItems.map(f=>f)||[],v.value=n?n==null?void 0:n.matchingRight:a.value.questionData.matching.rightItems.map(f=>f)||{};break}case w.SHORT_TEXT:{b.value="Fill in the blank the correct answer.",V.value=n?n==null?void 0:n.shortText:"";break}}},le=()=>{const t=_.value.findIndex(n=>n.id===a.value.id);t<_.value.length-1&&N(t+1)},ue=()=>{const t=_.value.findIndex(n=>n.id===a.value.id);t>0&&N(t-1)},ce=t=>Array.from(h.value).some(n=>n.questionId===t),de=L(()=>{const t=_.value.findIndex(n=>n.id===a.value.id);return t!==-1&&t<_.value.length-1}),me=L(()=>{const t=_.value.findIndex(n=>n.id===a.value.id);return t!==-1&&t>0}),ge={scroll:!0,scrollSensitivity:100,scrollSpeed:100,scrollTarget:document.scrollingElement};function D(){Ce(()=>{requestAnimationFrame(()=>{const t=document.querySelectorAll(".matching-option-container.left .answer-option-matching"),n=document.querySelectorAll(".matching-option-container.right .answer-option-matching"),P=Math.min(t.length,n.length);for(let y=0;y<P;y++){const f=t[y],F=n[y];if(!f||!F)continue;f.style.height="auto",F.style.height="auto";const ie=Math.max(f.offsetHeight,F.offsetHeight);f.style.height=`${ie}px`,F.style.height=`${ie}px`}})})}const he=L(()=>{var t;return(t=a.value.questionData.multipleChoice)==null?void 0:t.some(n=>n.text.length>=100)}),J=l(z().add(T.value.timeRemaining*60,"second")),E=l(T.value.timeRemaining*60);let I=null;const ve=L(()=>{const t=Math.floor(E.value/60).toString().padStart(2,"0"),n=(E.value%60).toString().padStart(2,"0");return`${t}:${n}`}),K=()=>{const t=J.value.diff(z(),"second");E.value=t>0?t:0,t<=0&&I&&(clearInterval(I),I=null)};let M=null;const ne=async()=>{const t=$.transferToUserAnswerSubmit(h.value);if(!(await Z.Submit({attemptId:T.value.attemptId,userAnswers:t,isSubmit:!1})).data.success){G.error("Auto failed!");return}G.info("Auto saved")},U=l(new Set),fe=()=>{const t=a.value.id;U.value.delete(t)||U.value.add(t)},_e=t=>Array.from(U.value).some(n=>n===t),pe=L(()=>{const t=a.value.id;return Array.from(U.value).some(n=>n===t)});Ie(()=>{I&&clearInterval(I),M&&clearInterval(M)}),ye(async()=>{D(),window.addEventListener("resize",D),await te(),E.value=T.value.timeRemaining*60,J.value=z().add(T.value.timeRemaining*60,"second"),N(0),K(),I=setInterval(K,1e3),M=setInterval(ne,6e4)});const oe={t:u,route:e,router:g,QUESTION_FORMAT:ee,quiz:_,userAnswer:h,currentQuestion:a,currentQuestionInstruction:b,currentQuestionIsSkipped:C,isSubmitted:j,userAnswerMultipleChoice:S,userAnswerMatchingLeft:s,userAnswerMatchingRight:v,userAnswerOrdering:q,userAnswerShortText:V,isDataValid:X,testId:B,attemptData:T,loading:W,getAttemptData:te,updateUserAnswer:O,onUserAnswerChange:ae,onSubmit:re,onLoadCurrentQuestion:N,onNextQuestion:le,onPreviousQuestion:ue,userAnswerContainQuestion:ce,hasNextQuestion:de,hasPreviousQuestion:me,dragOptions:ge,syncMatchingHeights:D,isOptionExceed:he,endTime:J,remainingTime:E,get timer(){return I},set timer(t){I=t},formattedTime:ve,updateCountdown:K,get autoSaver(){return M},set autoSaver(t){M=t},autoSave:ne,flaggedQuestion:U,onToggleFlagQuestion:fe,flagContainQuestion:_e,isCurrentQuestionFlagged:pe,get QUESTION_TYPE(){return w},TextArea:qe,get VueDraggable(){return Qe},get HolderOutlined(){return Ee}};return Object.defineProperty(oe,"__isScriptSetup",{enumerable:!1,value:!0}),oe}}),Re={class:"page-container"},He={class:"title-container title-container-header"},Ve={class:"content content-test d-flex flex-column"},Ne={class:"d-flex"},De={class:"content-item question-navigators"},Pe={class:"question-navigator-title d-flex justify-content-between align-items-center"},Fe={class:"countdown d-flex align-items-center"},ze={class:"question-navigator-container"},Ge=["onClick"],Ye={class:"content-item"},je={key:0},Xe={key:1,class:"section question-section"},Be=["innerHTML"],We={key:1,class:m(["learn-question"])},Je={class:"section answer-section"},Ke={class:"d-flex align-items-center"},Ze={class:"answer-section-ins"},$e={class:"answer-option-content"},et={key:1,class:"answer-option-container matching"},tt={class:"matching-option-container left"},nt={class:"d-flex align-items-center"},ot={class:m(["answer-option answer-option-matching"])},it={class:"answer-option-order"},st={class:"answer-option-content"},at={class:"matching-option-container right"},rt={class:"d-flex align-items-center"},lt={class:m(["answer-option answer-option-matching"])},ut={class:"answer-option-content"},ct={class:"answer-option-order"},dt={key:2,class:"answer-option-container ordering"},mt={class:m(["answer-option answer-option-ordering"])},gt={class:"answer-option-order"},ht={class:"answer-option-content"},vt={key:3,class:"answer-option-container"},ft={class:m(["answer-short-text"])},_t={class:"w-100 d-flex align-items-center"},pt={class:"learn-question-footer"},xt={class:"d-flex"};function bt(k,o,u,e,g,ee){const _=A("RouterLink"),h=A("a-col"),a=A("a-row"),b=A("a-button"),C=A("a-skeleton"),j=A("a-checkbox"),S=A("a-checkbox-group");return r(),c("div",Re,[i("div",He,[d(a,{class:"w-100 d-flex align-items-center"},{default:p(()=>[d(h,{span:1},{default:p(()=>[d(_,{to:{name:"User_Library"}},{default:p(()=>o[7]||(o[7]=[i("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[7]})]),_:1}),d(h,{class:"main-title",span:22},{default:p(()=>{var s,v;return[i("span",null,x((s=e.attemptData)==null?void 0:s.name),1),o[8]||(o[8]=Q()),o[9]||(o[9]=i("br",null,null,-1)),i("span",null,x((v=e.attemptData)==null?void 0:v.questionCount),1)]}),_:1,__:[8,9]})]),_:1})]),i("div",Ve,[i("div",Ne,[i("div",De,[i("div",Pe,[o[11]||(o[11]=i("span",null,"Questions",-1)),i("span",Fe,[o[10]||(o[10]=i("i",{class:"bx bx-timer"},null,-1)),Q(" "+x(e.formattedTime),1)])]),i("div",ze,[(r(!0),c(R,null,H(e.quiz,(s,v)=>(r(),c("div",{class:m(["question-navigator-item",e.currentQuestion.id===s.id?"current-question":"",e.userAnswerContainQuestion(s.id)?"completed-question":"",e.flagContainQuestion(s.id)?"flagged-question":""]),onClick:q=>e.onLoadCurrentQuestion(v)},[i("span",null,x(v+1),1)],10,Ge))),256))]),d(b,{type:"primary",class:m(["main-color-btn",e.isSubmitted?"main-color-btn-disabled":""]),onClick:e.onSubmit},{default:p(()=>o[12]||(o[12]=[Q(" Submit ")])),_:1,__:[12]},8,["class"])])]),i("div",Ye,[e.loading?(r(),c("div",je,[d(C,{loading:e.loading},null,8,["loading"]),d(C,{loading:e.loading},null,8,["loading"]),d(C,{loading:e.loading},null,8,["loading"])])):(r(),c("div",Xe,[e.currentQuestion.textFormat.toString()==="0"?(r(),c("div",{key:0,class:m(["learn-question"]),innerHTML:e.currentQuestion.questionText},null,8,Be)):(r(),c("div",We,x(e.currentQuestion.questionText),1)),i("div",Je,[i("div",Ke,[i("div",Ze,x(e.currentQuestionInstruction),1)]),e.currentQuestion.type===e.QUESTION_TYPE.MULTIPLE_CHOICE?(r(),se(S,{key:0,onChange:e.onUserAnswerChange,value:e.userAnswerMultipleChoice,"onUpdate:value":o[0]||(o[0]=s=>e.userAnswerMultipleChoice=s),class:m(["answer-option-container multiplechoice",e.isOptionExceed?"column":""])},{default:p(()=>[(r(!0),c(R,null,H(e.currentQuestion.questionData.multipleChoice,(s,v)=>(r(),se(j,{value:s.id,"onUpdate:value":q=>s.id=q,class:m(["answer-option answer-option-multiplechoice"])},{default:p(()=>[i("div",$e,x(s.text),1)]),_:2},1032,["value","onUpdate:value"]))),256))]),_:1},8,["value","class"])):Y("v-if",!0),e.currentQuestion.type===e.QUESTION_TYPE.MATCHING?(r(),c("div",et,[i("div",tt,[d(e.VueDraggable,{modelValue:e.userAnswerMatchingLeft,"onUpdate:modelValue":o[1]||(o[1]=s=>e.userAnswerMatchingLeft=s),options:e.dragOptions,onMove:e.syncMatchingHeights,onEnd:o[2]||(o[2]=()=>{e.syncMatchingHeights(),e.onUserAnswerChange()})},{default:p(()=>[(r(!0),c(R,null,H(e.userAnswerMatchingLeft,(s,v)=>(r(),c("div",nt,[i("div",ot,[i("div",it,[d(e.HolderOutlined)]),i("div",st,x(s.text),1)]),o[13]||(o[13]=i("i",{class:m(["bx bxs-label matching-icon"])},null,-1))]))),256))]),_:1},8,["modelValue"])]),i("div",at,[d(e.VueDraggable,{modelValue:e.userAnswerMatchingRight,"onUpdate:modelValue":o[3]||(o[3]=s=>e.userAnswerMatchingRight=s),options:e.dragOptions,onMove:e.syncMatchingHeights,onEnd:o[4]||(o[4]=()=>{e.syncMatchingHeights(),e.onUserAnswerChange()})},{default:p(()=>[(r(!0),c(R,null,H(e.userAnswerMatchingRight,(s,v)=>(r(),c("div",rt,[o[14]||(o[14]=i("i",{class:m(["bx bxs-label matching-icon"])},null,-1)),i("div",lt,[i("div",ut,x(s.text),1),i("div",ct,[d(e.HolderOutlined)])])]))),256))]),_:1},8,["modelValue"])])])):Y("v-if",!0),e.currentQuestion.type===e.QUESTION_TYPE.ORDERING?(r(),c("div",dt,[d(e.VueDraggable,{modelValue:e.userAnswerOrdering,"onUpdate:modelValue":o[5]||(o[5]=s=>e.userAnswerOrdering=s),options:e.dragOptions,onEnd:e.onUserAnswerChange},{default:p(()=>[(r(!0),c(R,null,H(e.userAnswerOrdering,(s,v)=>(r(),c("div",mt,[i("div",gt,[d(e.HolderOutlined),Q(" "+x(v+1),1)]),i("div",ht,x(s.text),1)]))),256))]),_:1},8,["modelValue"])])):Y("v-if",!0),e.currentQuestion.type===e.QUESTION_TYPE.SHORT_TEXT?(r(),c("div",vt,[i("div",ft,[i("div",_t,[d(e.TextArea,{placeholder:"Enter your answer...",modelValue:e.userAnswerShortText,"onUpdate:modelValue":o[6]||(o[6]=s=>e.userAnswerShortText=s),onChange:e.onUserAnswerChange},null,8,["modelValue"])])])])):Y("v-if",!0)]),i("div",pt,[d(b,{class:m(["main-color-btn",e.hasPreviousQuestion?"":"main-color-btn-disabled"]),type:"primary",size:"large",onClick:e.onPreviousQuestion},{default:p(()=>o[15]||(o[15]=[i("i",{class:"bx bx-chevron-left"},null,-1),Q(" Previous question ")])),_:1,__:[15]},8,["class"]),i("i",{class:m(["bx bx-flag flag-button",e.isCurrentQuestionFlagged?"bxs-flag":""]),onClick:e.onToggleFlagQuestion},null,2),i("div",xt,[d(b,{class:m(["main-color-btn",e.hasNextQuestion?"":"main-color-btn-disabled"]),type:"primary",size:"large",onClick:e.onNextQuestion},{default:p(()=>o[16]||(o[16]=[Q(" Next question "),i("i",{class:"bx bx-chevron-right"},null,-1)])),_:1,__:[16]},8,["class"])])])]))])])])}const kt=Se(Le,[["render",bt],["__scopeId","data-v-b60278b8"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test/attempt.vue"]]);export{kt as default};

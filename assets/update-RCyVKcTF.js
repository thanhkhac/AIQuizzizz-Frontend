import{d as ee,u as te,l as ne,q as ae,i as f,j as oe,a2 as se,a3 as le,s as ie,k as S,D as q,M as D,_ as re,r as U,c as N,o as M,b as l,a as d,w as g,f as w,t as c,e as de,C as H,Q as ue,F as me}from"./index-CPgAPADT.js";import{A as O}from"./ApiTestTemplate-DVeKtGlW.js";import{Q as C}from"./questionTypes-CS3lcRlq.js";import{T as ce}from"./TransferQuestionData-BxcXdBjq.js";import{V as pe}from"./Validator-CWeiTIFe.js";import{I as fe}from"./Input-knY-wdRA.js";import{T as ge}from"./vue-draggable-plus-Bqgn4gQa.js";import{C as k,S as _e,O as he,M as ve,a as Qe,s as be,b as Ie}from"./vue-virtual-scroller.esm-BLq8Ow8g.js";import{G as Se,I as Te}from"./GenerateQSModal-BAftivaM.js";import"./lodash-CLrHEAaN.js";/* empty css                                                                 */import"./ApiQuestionSet-CZgRqYHn.js";import"./languages-DtYW231W.js";const qe=ee({__name:"update",setup(m,{expose:i}){i();const{t:s}=te(),e=ne(),x=ae(),y=f(!1),_=f(x.params.id),p=f({testTemplateId:"",name:"",questions:[]}),h=f(!0),v=async()=>{try{if(y.value=!0,!pe.isValidGuid(_.value)){h.value=!1,e.push({name:"404"});return}await L();let t=await O.GetById(_.value);if(!t.data.success){h.value=!1,e.push({name:"404"});return}p.value=t.data.data,p.value.questions=t.data.data.questions.map(a=>({id:a.questionId,...a})),n.name=p.value.name,n.createUpdateQuestions=p.value.questions.map(a=>ce.transformResponseToRequest(a)),n.testTemplateId=p.value.testTemplateId,window.addEventListener("beforeunload",V)}catch(t){console.log(t)}finally{y.value=!1}},R=f(),n=oe({testTemplateId:"",name:"",description:"",createUpdateQuestions:[],deleteQuestionIds:[]}),A={title:[{required:"true",message:s("message.required"),trigger:"change"},{length:100,message:s("message.out_of_range",{max_length:100}),trigger:"change"}],description:[{length:200,message:s("message.out_of_range",{max_length:200}),trigger:"change"}],questions:[{validator:(t,a)=>a&&a.length>500?Promise.reject(s("message.maximum_tag.limit_question",{number:500})):Promise.resolve(),trigger:"change"}]},T={MultipleChoice:Qe,Matching:ve,Ordering:he,ShortText:_e},E=()=>({id:"new_"+Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:k.defaultMultipleChoices(),matchingPairs:k.defaultMatchingPairs(),orderingItems:k.defaultOrderingItems(),shortAnswer:""}),j=t=>{k.onChangeQuestionType(t)},W=()=>{if(n.createUpdateQuestions.length>=500){S.warning(s("message.limit_question",{number:500}));return}n.createUpdateQuestions=[...n.createUpdateQuestions,E()],q(()=>{var t,a;(a=(t=b.value)==null?void 0:t.forceUpdate)==null||a.call(t),q(()=>{const u=n.createUpdateQuestions.length;requestAnimationFrame(()=>{var Q;(Q=b.value)==null||Q.scrollToItem(u)})})})},X=t=>{if(n.createUpdateQuestions.length<=1){S.warning(s("message.minimum_question",{number:1}));return}const a=n.createUpdateQuestions[t].id;!a.startsWith("new_")&&a&&n.deleteQuestionIds.push(a),n.createUpdateQuestions=[...n.createUpdateQuestions.slice(0,t),...n.createUpdateQuestions.slice(t+1)]},Y=()=>{let t=!1,a=s("message.invalid_question"),u=new Set;if(n.name.trim().length>100||n.name.trim().length===0){t=!0,a=s("message.invalid_title"),S.error(a);return}if(n.description.trim().length>250){t=!0,a=s("message.invalid_description"),S.error(a);return}[n.createUpdateQuestions.filter(o=>{const r=o.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return r.length===0||r.length>=5e3}),n.createUpdateQuestions.filter(o=>(o.explainText?o.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=5e3),n.createUpdateQuestions.filter(o=>o.type===C.MULTIPLE_CHOICE&&(o.multipleChoices.some(r=>r.text.trim().length===0||r.text.trim().length>1e3)||o.multipleChoices.filter(r=>r.isAnswer).length===0||o.multipleChoices.length<2)),n.createUpdateQuestions.filter(o=>o.type===C.MATCHING&&(o.matchingPairs.some(r=>r.leftItem.trim().length===0||r.leftItem.trim().length>1e3)||o.matchingPairs.some(r=>r.rightItem.trim().length===0||r.rightItem.trim().length>1e3)||o.matchingPairs.length<2)),n.createUpdateQuestions.filter(o=>o.type===C.ORDERING&&(o.orderingItems.some(r=>r.text.trim().length===0||r.text.trim().length>1e3)||o.orderingItems.length<2)),n.createUpdateQuestions.filter(o=>o.type===C.SHORT_TEXT&&(o.shortAnswer.trim().length===0||o.shortAnswer.trim().length>1e3))].forEach(o=>{o.length>0&&(t=!0,o.forEach(r=>u.add(r)))});let I=Array.from(u).map(o=>n.createUpdateQuestions.indexOf(o)+1);t?D.error({title:s("create_QS.modal.invalid.title"),content:s("create_QS.modal.invalid.content")+I.sort().join(", "),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel")}):P()},P=()=>{D.confirm({title:s("create_template.modal.valid.title"),content:s("create_QS.modal.valid.content"),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{let t=await O.Update(p.value.testTemplateId,{...n,createUpdateQuestions:n.createUpdateQuestions.map(a=>({questionId:a.id.startsWith("new_")?null:a.id,...a}))});t.data.success&&(S.success(s("message.updated_successfully")),h.value=!1,e.push({name:"User_TestTemplate_Detail",params:{id:t.data.data}}))}})},G=f(null),J=()=>{var t;(t=G.value)==null||t.openImportModal()},F=f(null),K=()=>{var t;(t=F.value)==null||t.openGenerateAIModal()},Z=t=>{n.createUpdateQuestions.push(...t.map((a,u)=>{var Q;return{...a,id:`new_${n.createUpdateQuestions.length+u}`,questionId:null,orderingItems:(Q=a.orderingItems)==null?void 0:Q.map((I,o)=>({...I,correctOrder:o}))}})),q(()=>{var a,u;(u=(a=b.value)==null?void 0:a.forceUpdate)==null||u.call(a),q(()=>{const Q=n.createUpdateQuestions.length;requestAnimationFrame(()=>{var I;(I=b.value)==null||I.scrollToItem(Q)})})}),S.success(`${s("message.imported_question",{number:t.length})}`)};function V(t){t.preventDefault(),t.returnValue=""}se((t,a,u)=>{if(!h.value){u();return}D.confirm({title:s("create_QS.modal.leave.title"),content:s("create_QS.modal.leave.content"),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),onOk:()=>{u()},onCancel:()=>u(!1)})}),le(()=>{window.removeEventListener("beforeunload",V)});const z=f({canEdit:!1,canDelete:!1}),L=async()=>{const t=await O.GetPermissions(_.value);t.data.success&&(z.value=t.data.data,z.value.canEdit||(h.value=!1,e.push({name:"404"})))},b=f(null),$=()=>{q(()=>{var t,a;(a=(t=b.value)==null?void 0:t.forceUpdate)==null||a.call(t)})};ie(async()=>{await v()});const B={t:s,router:e,route:x,loading:y,testTemplateId:_,testTemplate:p,isDataValid:h,getTestTemplate:v,formRef:R,formState:n,rules:A,componentMap:T,createQuestionTemplate:E,onHandleChangeQuestionType:j,onAddQuestion:W,onRemoveQuestion:X,onFinish:Y,showModalConfirmation:P,importModalRef:G,onOpenImportModal:J,generateModalRef:F,openGenerateAIModal:K,onModalImport:Z,handleBeforeUnload:V,permission:z,getPermission:L,scrollerRef:b,handleScroll:$,Input:fe,TextArea:ge,ImportQSModal:Te,GenerateQSModal:Se,get DynamicScroller(){return Ie},get DynamicScrollerItem(){return be}};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),Ue={class:"page-container"},ye={class:"title-container"},Me={class:"content"},we={class:"content-item"},Ce={class:"content-item-title"},ke={class:"d-flex"},xe={class:"content-item"},Re={class:"content-item-title"},Ae={class:"content-item-buttons"},Ve={class:"import-button"},ze={key:0};function De(m,i,s,e,x,y){const _=U("RouterLink"),p=U("a-col"),h=U("a-row"),v=U("a-skeleton"),R=U("a-form");return M(),N(me,null,[l("div",Ue,[l("div",ye,[d(h,{class:"w-100 d-flex align-items-center"},{default:g(()=>[d(p,{span:1},{default:g(()=>[d(_,{to:{name:"User_Folder"}},{default:g(()=>i[3]||(i[3]=[l("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[3]})]),_:1}),d(p,{class:"main-title",span:23},{default:g(()=>[l("span",null,c(m.$t("update_template.title",{name:e.formState.name})),1),i[4]||(i[4]=w()),i[5]||(i[5]=l("br",null,null,-1)),l("span",null,c(m.$t("create_QS.sub_title")),1)]),_:1,__:[4,5]})]),_:1})]),l("div",Me,[d(R,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":i[2]||(i[2]=n=>e.formState=n),rules:e.rules,ref:"formRef"},{default:g(()=>[l("div",we,[l("div",Ce,[l("div",null,[l("span",null,c(m.$t("create_QS.quiz.question_detail_title")),1),l("span",null,c(m.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":i[0]||(i[0]=n=>e.formState.name=n),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),l("div",ke,[d(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":i[1]||(i[1]=n=>e.formState.description=n),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"])])]),l("div",xe,[l("div",Re,[l("div",null,[l("span",null,c(m.$t("create_QS.quiz.question_question_title")),1),l("span",null,c(m.$t("create_QS.quiz.question_question_sub_title")),1)]),l("div",Ae,[d(_,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:g(()=>[w(c(m.$t("create_QS.buttons.import"))+" ",1),i[6]||(i[6]=l("i",{class:"bx bx-download"},null,-1))]),_:1,__:[6]}),d(_,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:g(()=>[w(c(m.$t("create_QS.buttons.generated_by_ai"))+" ",1),i[7]||(i[7]=l("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[7]}),l("div",{class:"import-button",onClick:e.onFinish},c(m.$t("update_QS.buttons.update")),1),l("div",Ve,c(m.$t("create_QS.quiz.total",{number:e.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1)])]),e.loading?(M(),N("div",ze,[d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"])])):de("v-if",!0),d(e.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.createUpdateQuestions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:g(({item:n,index:A})=>[(M(),H(e.DynamicScrollerItem,{item:n,key:n.id},{default:g(()=>[(M(),H(ue(e.componentMap[n.type]),{question:n,index:e.formState.createUpdateQuestions.findIndex(T=>T.id===n.id)+1,displayScore:!1,onDeleteQuestion:T=>e.onRemoveQuestion(A),onChangeQuestionType:T=>e.onHandleChangeQuestionType(n)},null,40,["question","index","onDeleteQuestion","onChangeQuestionType"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),l("div",{class:"add-question-btn",onClick:e.onAddQuestion},[i[8]||(i[8]=l("i",{class:"bx bx-plus"},null,-1)),w(" "+c(m.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),d(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,"number-of-question":e.formState.createUpdateQuestions.length,onImport:e.onModalImport},null,8,["title","number-of-question"]),d(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport,"number-of-question":e.formState.createUpdateQuestions.length},null,8,["title","number-of-question"])],64)}const Je=re(qe,[["render",De],["__scopeId","data-v-48787c2a"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test_template/update.vue"]]);export{Je as default};

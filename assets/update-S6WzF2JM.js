import{d as me,u as fe,q as pe,l as Te,i as u,j as ge,Q as he,R as ve,s as _e,S as _,k as M,M as P,_ as Me,r as T,a as Z,o as S,b as r,c as l,w as m,G as L,f as N,t as $,N as Se,F as we}from"./index-CNC2148x.js";import{A as ee}from"./ApiTest-etmH5VkP.js";import{Q as k}from"./questionTypes-CS3lcRlq.js";import{T as qe,a as Ie,C as Re,b as Ce,c as ye,d as ke,S as Ae}from"./ChooseQuestionModal-DAuf2Iyp.js";import{S as Fe,O as be,M as De,a as xe,s as Oe,b as Ee}from"./vue-virtual-scroller.esm-DlV9LOwx.js";import{T as te}from"./TransferQuestionData-Bl0XXg5D.js";import{V as Qe}from"./Validator-CWeiTIFe.js";import"./Input-B6AzPJuz.js";import"./ApiFolder-Bv-Wx8C2.js";import"./folderShareMode-BudLQ2R2.js";import"./ApiTestTemplate-C8M07FBO.js";import"./TextArea-Cfsh6sg3.js";import"./vue-draggable-plus-BepsPqA6.js";const Be=me({__name:"update",setup(A,{expose:i}){var W;i();const G={MultipleChoice:xe,Matching:De,Ordering:be,ShortText:Fe},{t}=fe(),F=pe(),w=Te(),g=u(),o=ge({testId:((W=F.params.id)==null?void 0:W.toString())||"",name:"",classId:"",timeLimit:60,startTime:"",endTime:"",gradeAttemptMethod:Ie.HIGHEST_SCORE,gradeQuestionMethod:qe.PARTIAL,isShowCorrectAnswerInReview:!0,isAllowReviewAfterSubmit:!0,shuffle:2,maxAttempt:2,passingScore:50,questions:[]}),b={questions:[{validator:(e,a)=>a&&a.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},h=u(!1),c=u(!0),q=async()=>{if(h.value=!0,!Qe.isValidGuid(o.testId)){c.value=!1,w.push({name:"404"});return}const e=await ee.GetById(o.testId);if(!e.data.success){c.value=!1,w.push({name:"404"});return}Object.assign(o,e.data.data),o.startTime=e.data.data.timeStart,o.endTime=e.data.data.timeEnd,o.questions=e.data.data.questions.map(a=>te.transformResponseToRequest(a)),h.value=!1},f=()=>({id:Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),I=()=>{if(o.questions.length>=10){M.warning("Each question set could have at most 100 questions");return}o.questions.push(f())},H=e=>{if(o.questions.length<=1){M.warning("Each question set must have at least 1 questions");return}o.questions.splice(e,1)},oe=async()=>{var v;await((v=g.value)==null?void 0:v.validate());let e=!1,a="Invalid question.",d=new Set;if(o.name.trim().length>100||o.name.trim().length===0){e=!0,a="Invalid title.",M.error(a),D();return}[o.questions.filter(n=>{const s=n.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return s.length===0||s.length>=500}),o.questions.filter(n=>(n.explainText?n.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),o.questions.filter(n=>n.type===k.MULTIPLE_CHOICE&&(n.multipleChoices.some(s=>s.text.trim().length===0||s.text.trim().length>500)||n.multipleChoices.filter(s=>s.isAnswer).length===0)),o.questions.filter(n=>n.type===k.MATCHING&&(n.matchingPairs.some(s=>s.leftItem.trim().length===0||s.leftItem.trim().length>500)||n.matchingPairs.some(s=>s.rightItem.trim().length===0||s.rightItem.trim().length>500))),o.questions.filter(n=>n.type===k.ORDERING&&n.orderingItems.some(s=>s.text.trim().length===0||s.text.trim().length>500)),o.questions.filter(n=>n.type===k.SHORT_TEXT&&(n.shortAnswer.trim().length===0||n.shortAnswer.trim().length>500))].forEach(n=>{n.length>0&&(e=!0,n.forEach(s=>d.add(s)))});let z=Array.from(d).map(n=>o.questions.indexOf(n)+1);e?P.error({title:"Cannot create new question set!",content:"There are errors at questions: "+z.sort().join(", ")}):U()},U=()=>{P.confirm({title:"Create new quiz!",content:"Make sure to review your contents before proceeding.",centered:!0,onOk:async()=>{(await ee.Create(o)).data.success&&(c.value=!1,M.success("Updated successfully!"))}})},V=u(null),D=()=>{var e;(e=V.value)==null||e.openTestSettingModal()},R=u(null),x=()=>{var e;(e=R.value)==null||e.openModal()},ne=()=>{var e;p.value=null,(e=R.value)==null||e.closeModal(),E()},ae=e=>{var a;p.value=e,(a=R.value)==null||a.closeModal(),O()},p=u(null),j=u(""),Y=u(null),O=()=>{var e;(e=Y.value)==null||e.openModal()},se=()=>{p.value=null,x()},C=u(null),E=()=>{var e;(e=C.value)==null||e.openModal()},le=()=>{var e;p.value=null,(e=C.value)==null||e.closeModal(),x()},re=async e=>{var a;j.value=e,(a=C.value)==null||a.closeModal(),await _(),J()},X=u(null),J=()=>{var e;(e=X.value)==null||e.openModal()},ie=e=>{p.value=e,O()},de=()=>{E()},ce=e=>{M.success(`Imported ${e.length} questions`);const a=e.map(d=>te.transformResponseToRequest(d));o.questions=[...o.questions,...a],_(()=>{var d,B;(B=(d=y.value)==null?void 0:d.forceUpdate)==null||B.call(d),_(()=>{const z=o.questions.length;requestAnimationFrame(()=>{var v;(v=y.value)==null||v.scrollToItem(z)})})})};he((e,a,d)=>{if(!c.value){d();return}P.confirm({title:"Leave already?",content:"You have unsaved changes.",onOk:()=>{d()},onCancel:()=>d(!1)})});function Q(e){e.preventDefault(),e.returnValue=""}ve(()=>{window.removeEventListener("beforeunload",Q)});const y=u(null),ue=()=>{_(()=>{var e,a;(a=(e=y.value)==null?void 0:e.forceUpdate)==null||a.call(e)})};_e(async()=>{await q(),window.addEventListener("beforeunload",Q),await _(),D()});const K={componentMap:G,t,route:F,router:w,formRef:g,formState:o,rules:b,loading:h,isDataValid:c,getData:q,createQuestionTemplate:f,onAddQuestion:I,onRemoveQuestion:H,onFinish:oe,showModalConfirmation:U,settingModalRef:V,openSettingModal:D,folderModalRef:R,openFolderModal:x,onSwitchToTestTemplate:ne,onOpenFolder:ae,chosenFolder:p,chosenTestTemplateId:j,folderTestTemplateModalRef:Y,openFolderTestTemplateModal:O,onBackToFolderModal:se,testTemplateModalRef:C,openTestTemplateModal:E,onSwitchToFolder:le,onOpenTestTemplate:re,questionModalRef:X,openQuestionModal:J,onBackToFolderTestTemplate:ie,onBackToTestTemplate:de,onModalImport:ce,handleBeforeUnload:Q,scrollerRef:y,handleScroll:ue,SettingTestModal:Ae,ChooseFolderModal:ke,ChooseFolderTestTemplateModal:ye,ChooseTestTemplateModal:Ce,ChooseQuestionModal:Re,get DynamicScroller(){return Ee},get DynamicScrollerItem(){return Oe}};return Object.defineProperty(K,"__isScriptSetup",{enumerable:!1,value:!0}),K}}),ze={class:"page-container"},Pe={class:"title-container"},Le={class:"content"},Ne={class:"content-item"},Ge={class:"content-item-title"},He={class:"content-item-buttons"},Ue={class:"import-button"},Ve={key:0};function je(A,i,G,t,F,w){const g=T("RouterLink"),o=T("a-col"),b=T("a-row"),h=T("a-button"),c=T("a-skeleton"),q=T("a-form");return S(),Z(we,null,[r("div",ze,[r("div",Pe,[l(b,{class:"w-100 d-flex align-items-center"},{default:m(()=>[l(o,{span:1},{default:m(()=>[l(g,{to:{name:""},onClick:t.openSettingModal},{default:m(()=>i[0]||(i[0]=[r("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[0]})]),_:1}),l(o,{class:"main-title",span:23},{default:m(()=>i[1]||(i[1]=[r("span",null,"Assign new test for class SEP490",-1),r("br",null,null,-1),r("span",null,"Add questions, set answers and configure test settings",-1)])),_:1,__:[1]})]),_:1})]),r("div",Le,[l(q,{layout:"vertical",model:t.formState,rules:t.rules,ref:"formRef"},{default:m(()=>[r("div",Ne,[r("div",Ge,[i[4]||(i[4]=r("div",null,[r("span",null,"Test questions"),r("span",null,"Create and manage your test questions")],-1)),r("div",He,[l(g,{class:"import-button",to:{name:""},onClick:t.openFolderModal},{default:m(()=>i[2]||(i[2]=[N(" Choose from folder test ")])),_:1,__:[2]}),r("div",Ue,$(A.$t("create_QS.quiz.total",{number:t.formState.questions.length.toString().padStart(3,"0")})),1),l(h,{type:"primary",class:"main-color-btn",size:"large",onClick:t.onFinish},{default:m(()=>i[3]||(i[3]=[N(" Next ")])),_:1,__:[3]})])]),t.loading?(S(),Z("div",Ve,[l(c,{loading:t.loading,active:""},null,8,["loading"]),l(c,{loading:t.loading,active:""},null,8,["loading"]),l(c,{loading:t.loading,active:""},null,8,["loading"]),l(c,{loading:t.loading,active:""},null,8,["loading"]),l(c,{loading:t.loading,active:""},null,8,["loading"])])):(S(),L(t.DynamicScroller,{key:1,ref:"scrollerRef",class:"scroller","key-field":"id",items:t.formState.questions,"min-item-size":650,buffer:800,prerender:10,onScroll:t.handleScroll},{default:m(({item:f,index:I})=>[(S(),L(t.DynamicScrollerItem,{item:f,key:f.id},{default:m(()=>[(S(),L(Se(t.componentMap[f.type]),{question:f,index:I+1,displayScore:!1,onDeleteQuestion:H=>t.onRemoveQuestion(I)},null,40,["question","index","onDeleteQuestion"]))]),_:2},1032,["item"]))]),_:1},8,["items"])),r("div",{class:"add-question-btn",onClick:t.onAddQuestion},[i[5]||(i[5]=r("i",{class:"bx bx-plus"},null,-1)),N(" "+$(A.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["model"])])]),l(t.SettingTestModal,{ref:"settingModalRef","form-ref":t.formRef,"class-name":"SEP490","form-state":t.formState},null,8,["form-ref","form-state"]),l(t.ChooseFolderModal,{ref:"folderModalRef",onSwitchToTestTemplate:t.onSwitchToTestTemplate,onOpenFolder:t.onOpenFolder},null,512),l(t.ChooseFolderTestTemplateModal,{ref:"folderTestTemplateModalRef",folder:t.chosenFolder,onBackToFolderModal:t.onBackToFolderModal,onOpenTestTemplate:t.onOpenTestTemplate},null,8,["folder"]),l(t.ChooseTestTemplateModal,{ref:"testTemplateModalRef",onSwitchToFolder:t.onSwitchToFolder,onOpenTestTemplate:t.onOpenTestTemplate},null,512),l(t.ChooseQuestionModal,{ref:"questionModalRef","test-template-id":t.chosenTestTemplateId,folder:t.chosenFolder,onBackToFolderTestTemplateModal:t.onBackToFolderTestTemplate,onBackToTestTemplateModal:t.onBackToTestTemplate,onImport:t.onModalImport},null,8,["test-template-id","folder"])],64)}const lt=Me(Be,[["render",je],["__scopeId","data-v-c9dbf500"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test/update.vue"]]);export{lt as default};

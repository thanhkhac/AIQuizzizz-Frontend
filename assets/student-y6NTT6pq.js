import{d as te,q as ae,l as ne,u as se,B as H,i as k,j as K,C as oe,s as le,k as p,M as V,v as ie,_ as re,r as u,a as f,o as _,b as t,e as D,c as l,w as s,f as v,t as d,E as U,F as T,D as W}from"./index-LsQ9jhpY.js";import{u as de}from"./user-zaK1_Zi8.js";import{A as I}from"./ApiClass-BWhA5EE9.js";import{I as ce}from"./Input-Dsf9BKpt.js";import{C as me}from"./classStudentPosition-B7ChrNvq.js";import{V as ue}from"./Validator-CWeiTIFe.js";const _e={FULL_NAME:"FullName",EMAIL:"Email"},ge=te({__name:"student",emits:["updateSidebar"],setup(c,{expose:n,emit:B}){var Y;n();const e=ae(),C=ne(),{t:i}=se(),y=B,x=Object.values(_e),z=H(()=>x.map(a=>({label:i(`class_member.select_option.${a}`),value:a}))),g=k(e.params.id||""),N=k({classId:"",name:"",topic:""}),w=k(!1),R=[{title:"No",key:"no",customRender:a=>a.index+1},{title:i("class_member.column.fullName"),dataIndex:"fullName",key:"fullName",sorter:(a,m)=>a.fullName.localeCompare(m.fullName)},{title:i("class_member.column.email"),dataIndex:"email",key:"email",sorter:(a,m)=>a.email.localeCompare(m.email)},{title:i("class_member.column.position"),dataIndex:"position",key:"position"},{key:"action"}],O=[1,3,5,7,30],P=H(()=>O.map(a=>({label:a+i(a===1?"class_member.other.day_singular":"class_member.other.day_plural"),value:a}))),L=async()=>{try{if(!ue.isValidGuid(g.value.toString())){C.push({name:"404"});return}g.value||C.push({name:"404"});let a=await I.GetById(g.value.toString());a.data.success||C.push({name:"404"}),N.value=a.data.data}catch(a){console.log("ERROR: GETBYID class: "+a)}},E=k(""),A=async()=>{try{const a=await I.GetUserPermission(N.value.classId);a.data.success&&(E.value=a.data.data)}catch(a){console.log(a)}},r=K({pageNumber:e.query.pageNumber||1,pageSize:e.query.pageSize||10,keyword:((Y=e.query.keyword)==null?void 0:Y.toString())||"",fieldName:e.query.fieldName||z.value[0].value,totalCount:0,statusFilter:!1}),h=k([]),S=async()=>{try{w.value=!0;let a=await I.GetAllStudentByLimit(g.value.toString(),r);if(a.data.success){let m=a.data.data;h.value=m.items,r.pageNumber=m.pageNumber,r.pageSize=m.pageSize,r.totalCount=m.totalCount,r.statusFilter&&(r.pageNumber>m.totalPages&&r.totalCount>0?(r.pageNumber=1,C.push({name:"User_Class_Student",params:{id:g.value},query:{pageNumber:1,pageSize:r.pageSize,keyword:r.keyword,fieldName:r.fieldName}})):C.push({name:"User_Class_Student",params:{id:g.value},query:{pageNumber:r.pageNumber,pageSize:r.pageSize,keyword:r.keyword,fieldName:r.fieldName}}),r.statusFilter=!r.statusFilter)}}catch(a){console.log("ERROR: GETALLEXAMBYLIMIT class exam: "+a)}finally{w.value=!1}};oe(()=>Object.keys(e.query).length,()=>{var a;r.pageNumber=e.query.pageNumber||1,r.pageSize=e.query.pageSize||10,r.keyword=((a=e.query.keyword)==null?void 0:a.toString())||"",r.fieldName=e.query.fieldName||z.value[0].value,r.statusFilter=!0,S()});const M=(a,m)=>{r.pageNumber=a,r.pageSize=m,r.statusFilter=!0,S()},q=k(!1),o=K({classId:g.value,code:"",expiredTime:P.value[0].value}),b=k(""),F=k(!1),j=async()=>{await G(),q.value=!0},G=async()=>{const a=await I.GetInivationCode(g.value.toString());a.data.data&&(o.code=a.data.data,b.value=window.location.origin+`/user/class/invitation/${o.code}`)},X=async()=>{(await I.CreateNewInvitation(o)).data.success?(p.success(i("message.created_new_invitation")),j()):p.error(i("message.created_failed"))},J=a=>{if(!o.code)return;let m=o.code;a==="link"&&(m=b.value),navigator.clipboard.writeText(m).then(()=>{p.success(i("message.copied"))}).catch(()=>{p.error(i("message.copied_failed"))})},Z=a=>{V.confirm({title:i("class_member.modal.delete_member_title"),content:i("class_member.modal.delete_member_content"),centered:!0,okText:i("sidebar.buttons.ok"),cancelText:i("sidebar.buttons.cancel"),onOk:async()=>{if(!(await I.DeleteClassMember(g.value.toString(),a.toString())).data.success){p.error(i("message.removed_failed"));return}p.success(i("message.removed_successfully")),await S()}})},$=(a,m)=>{V.confirm({title:i("class_member.modal.update_member_title"),content:i("class_member.modal.update_member_content"),centered:!0,okText:i("sidebar.buttons.ok"),cancelText:i("sidebar.buttons.cancel"),onOk:async()=>{if(!(await I.UpdateClassMemberPosition(g.value.toString(),a.toString(),m)).data.success){p.error(i("message.updated_failed"));return}p.success(i("message.updated_successfully")),await S()}})},ee=()=>{V.confirm({title:i("class_member.danger_zone.warning"),content:ie("div",{style:"color: red"},i("class_member.danger_zone.warning_explain")),centered:!0,okText:i("sidebar.buttons.ok"),cancelText:i("sidebar.buttons.cancel"),onOk:async()=>{if(!(await I.Delete(g.value.toString())).data.success){p.error(i("message.deleted_failed"));return}p.success(i("message.deleted_successfully")),C.push({name:"User_Class"})}})};le(async()=>{y("updateSidebar","class"),await L(),await A(),await S()});const Q={route:e,router:C,t:i,emit:y,optionKeys:x,class_position_options:z,classId:g,classData:N,loading:w,columns:R,optionDays:O,code_limit_time:P,getClassData:L,userRoleInClass:E,getPermission:A,pageParams:r,student_data:h,getData:S,onPaginationChange:M,modal_invitation_open:q,invitationFormState:o,inivitationLink:b,isInvitaionLoading:F,onOpenInvitationModal:j,getInvitationCode:G,onResetInvitation:X,onCopyInvitationCode:J,onConfirmDeleteMember:Z,onConfirmUpdateMemberPosition:$,onOpenConfirmDeleteClass:ee,get user_image(){return de},Input:ce,get CLASS_STUDENT_POSITION(){return me}};return Object.defineProperty(Q,"__isScriptSetup",{enumerable:!1,value:!0}),Q}}),ve={class:"page-container"},be={class:"title-container"},pe={class:"breadcrumb-container"},fe={class:"title-breadcrumb-item"},ye={class:"title-breadcrumb-item"},Se={class:"breadcrumb-item-topic"},Ce={class:"content"},ke={class:"content-item"},Ie={class:"content-item-title"},Ne={class:"content-item-functions"},we={class:"content-item-navigators"},he={class:"navigator-container"},Te={style:{width:"300px",padding:"0px"}},xe={key:0,class:"student-name-container"},ze=["src"],De={class:"student-name"},Ue={key:0,class:"student-action"},Ee=["onClick"],Oe=["onClick"],Pe=["onClick"],Le={key:1,class:"w-100 d-flex justify-content-center"},Ae={class:"pagination-container"},qe={class:"mt-4 content-item"},Fe={class:"content-item-title"},Re={class:"text-danger"},Me={class:"danger-zone mt-3 p-4"},Ve={class:"text-danger fs-6 fw-bold"},Be={class:"text-secondary"},je={class:"modal-container"},Ge={class:"modal-title-container"},Qe={class:"modal-invitation-body"},Ye={class:"invitation-code-container"},He={class:"invitation-code-container"};function Ke(c,n,B,e,C,i){const y=u("RouterLink"),x=u("a-button"),z=u("a-select-option"),g=u("a-select"),N=u("a-skeleton"),w=u("a-tooltip"),R=u("a-table"),O=u("a-config-provider"),P=u("a-empty"),L=u("a-pagination"),E=u("a-col"),A=u("a-row"),r=u("a-qrcode"),h=u("a-form-item"),S=u("a-form"),M=u("a-divider"),q=u("a-modal");return _(),f(T,null,[t("div",ve,[t("div",be,[t("div",pe,[t("ul",null,[t("li",fe,[l(y,{to:{name:"User_Class"}},{default:s(()=>[t("span",null,d(c.$t("class_index.title")),1),n[10]||(n[10]=v()),n[11]||(n[11]=t("br",null,null,-1))]),_:1,__:[10,11]}),n[12]||(n[12]=t("i",{class:"bx bx-chevron-right"},null,-1))]),t("li",ye,[l(y,{to:{name:""},class:"breadcrumb-item-class"},{default:s(()=>[t("span",null,d(e.classData.name),1),t("span",Se,d(e.classData.topic),1)]),_:1})])])])]),t("div",Ce,[t("div",ke,[t("div",Ie,[t("div",null,[t("span",null,d(c.$t("class_member.title")),1),t("span",null,d(c.$t("class_member.sub_title")),1)]),e.userRoleInClass!==e.CLASS_STUDENT_POSITION.STUDENT?(_(),U(x,{key:0,class:"main-color-btn",type:"primary",size:"large",onClick:e.onOpenInvitationModal},{default:s(()=>[n[13]||(n[13]=t("i",{class:"me-2 bx bx-user-plus"},null,-1)),v(" "+d(c.$t("class_member.buttons.invite_member")),1)]),_:1,__:[13]})):D("v-if",!0)]),t("div",Ne,[t("div",we,[t("div",he,[l(y,{class:"navigator-item",to:{name:"User_Class_Exam"}},{default:s(()=>[v(d(c.$t("class_index.navigators.exam")),1)]),_:1}),l(y,{class:"navigator-item",to:{name:"User_Class_Quiz"}},{default:s(()=>[v(d(c.$t("class_index.navigators.quiz")),1)]),_:1}),l(y,{class:"navigator-item navigator-active",to:{name:""}},{default:s(()=>[v(d(c.$t("class_index.navigators.member")),1)]),_:1})])]),l(g,{class:"me-3",value:e.pageParams.fieldName,"onUpdate:value":n[0]||(n[0]=o=>e.pageParams.fieldName=o),style:{width:"200px"},onChange:e.getData},{default:s(()=>[(_(!0),f(T,null,W(e.class_position_options,o=>(_(),U(z,{value:o.value},{default:s(()=>[v(d(o.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"]),t("div",Te,[l(e.Input,{onInput:e.getData,modelValue:e.pageParams.keyword,"onUpdate:modelValue":n[1]||(n[1]=o=>e.pageParams.keyword=o),placeholder:e.t("class_member.other.search_placeholder")},{icon:s(()=>n[14]||(n[14]=[t("i",{class:"bx bx-search"},null,-1)])),_:1},8,["modelValue","placeholder"])])]),e.loading?(_(),f(T,{key:0},[l(N,{active:"",loading:e.loading},null,8,["loading"]),l(N,{active:"",loading:e.loading},null,8,["loading"]),l(N,{active:"",loading:e.loading},null,8,["loading"])],64)):(_(),f(T,{key:1},[e.student_data.length>0?(_(),U(O,{key:0,locale:{Table:{cancelSort:"",triggerAsc:"",triggerDesc:""}}},{default:s(()=>[l(R,{columns:e.columns,"data-source":e.student_data,"row-key":"studentId",pagination:!1},{bodyCell:s(({column:o,record:b})=>[o.key==="fullName"?(_(),f("div",xe,[t("img",{class:"user-image",src:e.user_image,alt:""},null,8,ze),t("div",De,d(b.fullName),1)])):D("v-if",!0),o.key==="position"?(_(),f(T,{key:1},[v(d(c.$t(`class_member.position.${b.position}`)),1)],64)):D("v-if",!0),o.key==="action"?(_(),f(T,{key:2},[e.userRoleInClass===e.CLASS_STUDENT_POSITION.OWNER?(_(),f("div",Ue,[b.position===e.CLASS_STUDENT_POSITION.STUDENT?(_(),U(w,{key:0},{title:s(()=>[v(d(c.$t("class_member.buttons.assign_lecturer")),1)]),default:s(()=>[t("i",{style:{cursor:"pointer"},class:"bx bxs-id-card",onClick:F=>e.onConfirmUpdateMemberPosition(b.studentId,e.CLASS_STUDENT_POSITION.TEACHER)},null,8,Ee)]),_:2},1024)):(_(),U(w,{key:1},{title:s(()=>[v(d(c.$t("class_member.buttons.remove_lecturer")),1)]),default:s(()=>[t("i",{class:"text-danger bx bxs-id-card",onClick:F=>e.onConfirmUpdateMemberPosition(b.studentId,e.CLASS_STUDENT_POSITION.STUDENT)},null,8,Oe)]),_:2},1024)),l(w,null,{title:s(()=>[v(d(c.$t("question_sets_index.buttons.delete")),1)]),default:s(()=>[t("i",{class:"text-danger bx bx-trash-alt",onClick:F=>e.onConfirmDeleteMember(b.studentId)},null,8,Pe)]),_:2},1024)])):D("v-if",!0)],64)):D("v-if",!0)]),_:1},8,["data-source"])]),_:1})):(_(),f("div",Le,[l(P,null,{description:s(()=>[t("span",null,d(c.$t("class_index.other.no_data_matches")),1)]),_:1})]))],64)),t("div",Ae,[l(L,{onChange:e.onPaginationChange,current:e.pageParams.pageNumber,"onUpdate:current":n[2]||(n[2]=o=>e.pageParams.pageNumber=o),total:e.pageParams.totalCount,pageSize:e.pageParams.pageSize,"show-total":(o,b)=>`${b[0]}-${b[1]} of ${o} ${e.t("class_member.other.items")}`,"show-size-changer":"","show-quick-jumper":"",class:"crud-layout-pagination",locale:{items_per_page:e.t("class_index.other.pages")}},null,8,["current","total","pageSize","show-total","locale"])])]),t("div",qe,[t("div",Fe,[t("div",null,[t("span",Re,d(c.$t("class_member.danger_zone.title")),1),t("span",null,d(c.$t("class_member.danger_zone.sub_title")),1)])]),t("div",Me,[t("div",Ve,d(c.$t("class_member.danger_zone.warning")),1),t("div",Be,d(c.$t("class_member.danger_zone.warning_explain")),1),l(x,{class:"mt-3",type:"primary",danger:"",size:"large",onClick:e.onOpenConfirmDeleteClass},{default:s(()=>[v(d(c.$t("class_member.buttons.delete_class")),1)]),_:1})])])])]),D(" invitation modal "),l(q,{width:"750px",centered:"","wrap-class-name":"medium-modal",open:e.modal_invitation_open,onCancel:n[9]||(n[9]=o=>e.modal_invitation_open=!1)},{footer:s(()=>[l(S,{layout:"vertical",class:"w-100 d-flex align-items-end justify-content-between"},{default:s(()=>[l(h,{label:e.t("class_member.modal.time_limit_label")},{default:s(()=>[l(g,{value:e.invitationFormState.expiredTime,"onUpdate:value":n[8]||(n[8]=o=>e.invitationFormState.expiredTime=o),style:{width:"200px"},onChange:e.getData},{default:s(()=>[(_(!0),f(T,null,W(e.code_limit_time,o=>(_(),U(z,{value:o.value},{default:s(()=>[v(d(o.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},8,["label"]),l(h,null,{default:s(()=>[l(x,{loading:e.isInvitaionLoading,class:"main-color-btn",key:"submit",type:"primary",onClick:e.onResetInvitation},{default:s(()=>[v(d(c.$t("class_member.buttons.reset_code")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),default:s(()=>[t("div",je,[t("div",Ge,[l(A,{class:"w-100 d-flex align-items-center"},{default:s(()=>[l(E,{span:2},{default:s(()=>[l(y,{onClick:n[3]||(n[3]=o=>e.modal_invitation_open=!1),to:{name:""}},{default:s(()=>n[15]||(n[15]=[t("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[15]})]),_:1}),l(E,{class:"main-title",span:22},{default:s(()=>[t("span",null,d(c.$t("class_member.modal.title")),1),n[16]||(n[16]=v()),n[17]||(n[17]=t("br",null,null,-1)),t("span",null,d(c.$t("class_member.modal.sub_title")),1)]),_:1,__:[16,17]})]),_:1})]),t("div",Qe,[l(r,{value:e.invitationFormState.code,class:"invitation-body-qrcode"},null,8,["value"]),l(S,{layout:"vertical",class:"invitation-body-link"},{default:s(()=>[l(h,{label:e.t("class_member.modal.class_code_label")},{default:s(()=>[t("div",Ye,[l(e.Input,{modelValue:e.invitationFormState.code,"onUpdate:modelValue":n[4]||(n[4]=o=>e.invitationFormState.code=o),"is-required":!0,"max-length":100,readonly:!0},null,8,["modelValue"]),t("i",{class:"bx bx-copy",onClick:n[5]||(n[5]=o=>e.onCopyInvitationCode("code"))})])]),_:1},8,["label"]),l(h,{label:e.t("class_member.modal.invitation_link")},{default:s(()=>[t("div",He,[l(e.Input,{modelValue:e.inivitationLink,"onUpdate:modelValue":n[6]||(n[6]=o=>e.inivitationLink=o),"is-required":!0,"max-length":100,readonly:!0},null,8,["modelValue"]),t("i",{class:"bx bx-copy",onClick:n[7]||(n[7]=o=>e.onCopyInvitationCode("link"))})])]),_:1},8,["label"])]),_:1})]),l(M,null,{default:s(()=>[v(d(c.$t("class_member.modal.or")),1)]),_:1})])]),_:1},8,["open"])],64)}const at=re(ge,[["render",Ke],["__scopeId","data-v-6a35c450"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/class/student.vue"]]);export{at as default};

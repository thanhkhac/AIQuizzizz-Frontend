import{d as te,u as ne,l as ae,q as oe,i as f,j as ie,X as le,Y as se,s as re,k as S,R,M as V,_ as de,r as w,a as k,o as Q,b as a,c as d,w as _,f as q,t as p,F,D as ue,E as z,N as ce}from"./index-BCUxjaAq.js";import{A as O}from"./ApiQuestionSet-KXdPi0X5.js";import{Q as y}from"./questionTypes-CS3lcRlq.js";import{T as me}from"./TransferQuestionData-BxcXdBjq.js";import{V as pe}from"./Validator-CWeiTIFe.js";import{I as ge}from"./Input-DiOVXk72.js";import{T as fe}from"./TextArea-B3IciHWP.js";import{S as _e,O as ve,M as he,a as Se,s as Qe,b as be}from"./vue-virtual-scroller.esm-BCgYN7K7.js";import{G as Ie,I as we}from"./GenerateQSModal-DMTLu139.js";/* empty css                                                                 */import"./vue-draggable-plus-DDQDMlok.js";import"./ApiTestTemplate-m_Y76s3J.js";import"./languages-DtYW231W.js";const qe=te({__name:"update",setup(m,{expose:i}){i();const{t:s}=ne(),e=ae(),M=oe(),T=f(!1),v=f(M.params.id),h=f({id:"",name:"",description:"",tags:[]}),b=f([]),g=f(!0),x=async()=>{if(T.value=!0,!pe.isValidGuid(v.value)){g.value=!1,e.push({name:"404"});return}let t=await O.GetDetailById(v.value),o=await O.GetQuestionById(v.value);if(!t.data.success||!o.data.success){g.value=!1,e.push({name:"404"});return}h.value=t.data.data,b.value=o.data.data,n.name=h.value.name,n.description=h.value.description,n.createUpdateQuestions=b.value.map(c=>me.transformResponseToRequest(c)),n.tags=h.value.tags.map(c=>c.name),T.value=!1,window.addEventListener("beforeunload",C)},u=f(),n=ie({name:"",description:"",createUpdateQuestions:[],deleteQuestionIds:[],tags:[]}),D={title:[{required:"true",message:"This field is required",trigger:"change"},{length:100,message:"Limit 100",trigger:"change"}],description:[{length:200,message:"Limit 200",trigger:"change"}],tags:[{validator:(t,o)=>o&&o.length>5?Promise.reject("You can only add up to 5 tags."):Promise.resolve(),trigger:"change"}],questions:[{validator:(t,o)=>o&&o.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},N={MultipleChoice:Se,Matching:he,Ordering:ve,ShortText:_e},L=()=>({id:`new_${Date.now().toString()}`,type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),j=()=>{if(n.createUpdateQuestions.length>=500){S.warning(s("maximum_tag.limit_question",{number:500}));return}n.createUpdateQuestions=[...n.createUpdateQuestions,L()],R(()=>{var t,o;(o=(t=U.value)==null?void 0:t.forceUpdate)==null||o.call(t),R(()=>{const c=n.createUpdateQuestions.length;requestAnimationFrame(()=>{var A;(A=U.value)==null||A.scrollToItem(c)})})})},H=t=>{if(n.createUpdateQuestions.length<=1){S.warning(s("maximum_tag.minimum_question",{number:1}));return}const o=n.createUpdateQuestions[t].id;!o.startsWith("new_")&&o&&n.deleteQuestionIds.push(o),n.createUpdateQuestions=[...n.createUpdateQuestions.slice(0,t),...n.createUpdateQuestions.slice(t+1)]},Y=()=>{let t=!1,o=s("message.invalid_question"),c=new Set;if(n.name.trim().length>100||n.name.trim().length===0){t=!0,o=s("message.invalid_title"),S.error(o);return}if(n.description.trim().length>250){t=!0,o=s("message.invalid_description"),S.error(o);return}[n.createUpdateQuestions.filter(l=>{const r=l.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return r.length===0||r.length>=500}),n.createUpdateQuestions.filter(l=>(l.explainText?l.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),n.createUpdateQuestions.filter(l=>l.type===y.MULTIPLE_CHOICE&&(l.multipleChoices.some(r=>r.text.trim().length===0||r.text.trim().length>500)||l.multipleChoices.filter(r=>r.isAnswer).length===0)),n.createUpdateQuestions.filter(l=>l.type===y.MATCHING&&(l.matchingPairs.some(r=>r.leftItem.trim().length===0||r.leftItem.trim().length>500)||l.matchingPairs.some(r=>r.rightItem.trim().length===0||r.rightItem.trim().length>500))),n.createUpdateQuestions.filter(l=>l.type===y.ORDERING&&l.orderingItems.some(r=>r.text.trim().length===0||r.text.trim().length>500)),n.createUpdateQuestions.filter(l=>l.type===y.SHORT_TEXT&&(l.shortAnswer.trim().length===0||l.shortAnswer.trim().length>500))].forEach(l=>{l.length>0&&(t=!0,l.forEach(r=>c.add(r)))});let ee=Array.from(c).map(l=>n.createUpdateQuestions.indexOf(l)+1);t?V.error({title:s("create_QS.modal.invalid.title"),content:s("create_QS.modal.invalid.content")+ee.sort().join(", "),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel")}):E()},E=()=>{V.confirm({title:s("update_QS.modal.valid.title"),content:s("create_QS.modal.valid.content"),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{n.createUpdateQuestions=n.createUpdateQuestions.map(o=>o.id.startsWith("new_")?{...o,id:""}:o);let t=await O.Update(v.value,n);t.data.success&&S.success(t.data.data)}})},I=f(""),W=()=>{if(n.tags.length>=5){S.warning("Limit : 5 tags");return}I.value&&I.value.trim().length<=50?(n.tags.push(I.value),I.value=""):S.warning("Invalid tag content")},X=t=>{n.tags.splice(t,1)},G=f(null),J=()=>{var t;(t=G.value)==null||t.openImportModal()},P=f(null),K=()=>{var t;(t=P.value)==null||t.openGenerateAIModal()},Z=t=>{n.createUpdateQuestions.push(...t.map((o,c)=>({...o,id:`new_${n.createUpdateQuestions.length+c}`}))),S.success(`Imported ${t.length} questions`)};function C(t){t.preventDefault(),t.returnValue=""}le((t,o,c)=>{if(!g.value){c();return}V.confirm({title:s("create_QS.modal.leave.title"),content:s("create_QS.modal.leave.content"),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),onOk:()=>{c()},onCancel:()=>c(!1)})}),se(()=>{window.removeEventListener("beforeunload",C)});const U=f(null),$=()=>{R(()=>{var t,o;(o=(t=U.value)==null?void 0:t.forceUpdate)==null||o.call(t)})};re(async()=>{await x()});const B={t:s,router:e,route:M,loading:T,questionSetId:v,questionSetDetail:h,questionSetQuestions:b,isDataValid:g,getTestTemplate:x,formRef:u,formState:n,rules:D,componentMap:N,createQuestionTemplate:L,onAddQuestion:j,onRemoveQuestion:H,onFinish:Y,showModalConfirmation:E,tagContent:I,addTag:W,removeTag:X,importModalRef:G,onOpenImportModal:J,generateModalRef:P,openGenerateAIModal:K,onModalImport:Z,handleBeforeUnload:C,scrollerRef:U,handleScroll:$,Input:ge,TextArea:fe,ImportQSModal:we,GenerateQSModal:Ie,get DynamicScroller(){return be},get DynamicScrollerItem(){return Qe}};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),Te={class:"page-container"},xe={class:"title-container"},Ue={class:"content"},ke={class:"content-item"},ye={class:"content-item-title"},Me={class:"d-flex"},De={class:"form-item"},Ce={class:"tag-container"},Ae=["onClick"],Re={class:"tag-inputter"},Ve={class:"content-item"},ze={class:"content-item-title"},Oe={class:"content-item-buttons"},Le={class:"import-button"},Ee={key:0};function Ge(m,i,s,e,M,T){const v=w("RouterLink"),h=w("a-col"),b=w("a-row"),g=w("a-skeleton"),x=w("a-form");return Q(),k(F,null,[a("div",Te,[a("div",xe,[d(b,{class:"w-100 d-flex align-items-center"},{default:_(()=>[d(h,{span:1},{default:_(()=>[d(v,{to:{name:"User_Library"}},{default:_(()=>i[4]||(i[4]=[a("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[4]})]),_:1}),d(h,{class:"main-title",span:23},{default:_(()=>[a("span",null,p(m.$t("create_QS.title")),1),i[5]||(i[5]=q()),i[6]||(i[6]=a("br",null,null,-1)),a("span",null,p(m.$t("create_QS.sub_title")),1)]),_:1,__:[5,6]})]),_:1})]),a("div",Ue,[d(x,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":i[3]||(i[3]=u=>e.formState=u),rules:e.rules,ref:"formRef"},{default:_(()=>[a("div",ke,[a("div",ye,[a("div",null,[a("span",null,p(m.$t("create_QS.quiz.question_detail_title")),1),a("span",null,p(m.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":i[0]||(i[0]=u=>e.formState.name=u),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),a("div",Me,[d(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":i[1]||(i[1]=u=>e.formState.description=u),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"]),a("div",De,[a("label",null,p(m.$t("create_QS.quiz.tag")),1),a("div",Ce,[(Q(!0),k(F,null,ue(e.formState.tags,(u,n)=>(Q(),k("div",{class:"tag-item",key:n},[q(p(u)+" ",1),a("i",{class:"bx bx-x",onClick:D=>e.removeTag(n)},null,8,Ae)]))),128))]),a("div",Re,[d(e.Input,{modelValue:e.tagContent,"onUpdate:modelValue":i[2]||(i[2]=u=>e.tagContent=u),placeholder:e.t("question_sets_index.search_placeholder"),"max-length":50},{icon:_(()=>i[7]||(i[7]=[a("i",{class:"bx bx-purchase-tag-alt"},null,-1)])),_:1},8,["modelValue","placeholder"]),a("i",{class:"bx bx-plus tag-inputter-button",onClick:e.addTag})])])])]),a("div",Ve,[a("div",ze,[a("div",null,[a("span",null,p(m.$t("create_QS.quiz.question_question_title")),1),a("span",null,p(m.$t("create_QS.quiz.question_question_sub_title")),1)]),a("div",Oe,[d(v,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:_(()=>[q(p(m.$t("create_QS.buttons.import"))+" ",1),i[8]||(i[8]=a("i",{class:"bx bx-download"},null,-1))]),_:1,__:[8]}),d(v,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:_(()=>[q(p(m.$t("create_QS.buttons.generated_by_ai"))+" ",1),i[9]||(i[9]=a("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[9]}),a("div",{class:"import-button",onClick:e.onFinish},p(m.$t("update_QS.buttons.update")),1),a("div",Le,p(m.$t("create_QS.quiz.total",{number:e.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1)])]),e.loading?(Q(),k("div",Ee,[d(g,{loading:e.loading,active:""},null,8,["loading"]),d(g,{loading:e.loading,active:""},null,8,["loading"]),d(g,{loading:e.loading,active:""},null,8,["loading"]),d(g,{loading:e.loading,active:""},null,8,["loading"]),d(g,{loading:e.loading,active:""},null,8,["loading"])])):(Q(),z(e.DynamicScroller,{key:1,ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.createUpdateQuestions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:_(({item:u,index:n})=>[(Q(),z(e.DynamicScrollerItem,{item:u,key:u.id},{default:_(()=>[(Q(),z(ce(e.componentMap[u.type]),{question:u,index:n+1,displayScore:!1,onDeleteQuestion:D=>e.onRemoveQuestion(n)},null,40,["question","index","onDeleteQuestion"]))]),_:2},1032,["item"]))]),_:1},8,["items"])),a("div",{class:"add-question-btn",onClick:e.onAddQuestion},[i[10]||(i[10]=a("i",{class:"bx bx-plus"},null,-1)),q(" "+p(m.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),d(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,onImport:e.onModalImport},null,8,["title"]),d(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport},null,8,["title"])],64)}const et=de(qe,[["render",Ge],["__scopeId","data-v-ef9cef6a"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/question_sets/update.vue"]]);export{et as default};

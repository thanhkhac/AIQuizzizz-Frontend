import{d as re,u as ie,q as ce,l as de,i as d,j as ue,Q as me,R as fe,s as pe,k as S,S as h,M as B,_ as Te,r as w,a as ge,o as P,b as l,c,w as u,f as L,t as J,G as K,N as he,F as ve}from"./index-CNC2148x.js";import{A as _e}from"./ApiClass-BckaWWMn.js";import{A as Me}from"./ApiTest-etmH5VkP.js";import{Q as A}from"./questionTypes-CS3lcRlq.js";import{T as Se,a as we,C as qe,b as Ie,c as Ce,d as Re,S as Ae}from"./ChooseQuestionModal-DAuf2Iyp.js";import{S as ye,O as Fe,M as xe,a as De,s as ke,b as be}from"./vue-virtual-scroller.esm-DlV9LOwx.js";import{T as Ee}from"./TransferQuestionData-Bl0XXg5D.js";import{V as Oe}from"./Validator-CWeiTIFe.js";import"./Input-B6AzPJuz.js";import"./ApiFolder-Bv-Wx8C2.js";import"./folderShareMode-BudLQ2R2.js";import"./ApiTestTemplate-C8M07FBO.js";import"./TextArea-Cfsh6sg3.js";import"./vue-draggable-plus-BepsPqA6.js";const Qe=re({__name:"create",setup(y,{expose:i}){i();const z={MultipleChoice:De,Matching:xe,Ordering:Fe,ShortText:ye},{t}=ie(),F=ce(),v=de(),m=d(!0),_=async()=>{if(!Oe.isValidGuid(o.classId)){m.value=!1,v.push({name:"404"});return}(await _e.GetById(o.classId)).data.success||(m.value=!1,v.push({name:"404"}))},q=d(),o=ue({name:"",classId:F.params.id.toString()||"",timeLimit:60,startTime:"",endTime:"",gradeAttemptMethod:we.HIGHEST_SCORE,gradeQuestionMethod:Se.PARTIAL,isShowCorrectAnswerInReview:!0,isAllowReviewAfterSubmit:!0,shuffle:2,maxAttempt:2,passingScore:50,questions:[]}),x={title:[{required:"true",message:"This field is required",trigger:"change"},{length:100,message:"Limit 100",trigger:"change"}],description:[{length:200,message:"Limit 200",trigger:"change"}],tags:[{validator:(e,s)=>s&&s.length>5?Promise.reject("You can only add up to 5 tags."):Promise.resolve(),trigger:"change"}],questions:[{validator:(e,s)=>s&&s.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},f=()=>({id:Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),I=()=>{if(o.questions.length>=10){S.warning("Each question set could have at most 100 questions");return}o.questions=[...o.questions,f()],h(()=>{var e,s;(s=(e=T.value)==null?void 0:e.forceUpdate)==null||s.call(e),h(()=>{const r=o.questions.length;requestAnimationFrame(()=>{var g;(g=T.value)==null||g.scrollToItem(r)})})})},N=e=>{if(o.questions.length<=1){S.warning("Each question set must have at least 1 questions");return}o.questions=[...o.questions.slice(0,e),...o.questions.slice(e+1)]},W=async()=>{var M;await((M=q.value)==null?void 0:M.validate());let e=!1,s="Invalid question.",r=new Set;if(o.name.trim().length>100||o.name.trim().length===0){e=!0,s="Invalid title.",S.error(s),D();return}[o.questions.filter(n=>{const a=n.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return a.length===0||a.length>=500}),o.questions.filter(n=>(n.explainText?n.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),o.questions.filter(n=>n.type===A.MULTIPLE_CHOICE&&(n.multipleChoices.some(a=>a.text.trim().length===0||a.text.trim().length>500)||n.multipleChoices.filter(a=>a.isAnswer).length===0)),o.questions.filter(n=>n.type===A.MATCHING&&(n.matchingPairs.some(a=>a.leftItem.trim().length===0||a.leftItem.trim().length>500)||n.matchingPairs.some(a=>a.rightItem.trim().length===0||a.rightItem.trim().length>500))),o.questions.filter(n=>n.type===A.ORDERING&&n.orderingItems.some(a=>a.text.trim().length===0||a.text.trim().length>500)),o.questions.filter(n=>n.type===A.SHORT_TEXT&&(n.shortAnswer.trim().length===0||n.shortAnswer.trim().length>500))].forEach(n=>{n.length>0&&(e=!0,n.forEach(a=>r.add(a)))});let Q=Array.from(r).map(n=>o.questions.indexOf(n)+1);e?B.error({title:"Cannot create new question set!",content:"There are errors at questions: "+Q.sort().join(", ")}):U()},U=()=>{B.confirm({title:"Create new quiz!",content:"Make sure to review your contents before proceeding.",centered:!0,onOk:async()=>{(await Me.Create(o)).data.success&&(m.value=!1,S.success("Created successfully!"),v.push({name:"User_Class_Exam",params:{id:o.classId}}))}})},G=d(null),D=()=>{var e;(e=G.value)==null||e.openTestSettingModal()},C=d(null),k=()=>{var e;(e=C.value)==null||e.openModal()},Z=()=>{var e;p.value=null,(e=C.value)==null||e.closeModal(),E()},$=e=>{var s;p.value=e,(s=C.value)==null||s.closeModal(),b()},p=d(null),H=d(""),V=d(null),b=()=>{var e;(e=V.value)==null||e.openModal()},ee=()=>{p.value=null,k()},R=d(null),E=()=>{var e;(e=R.value)==null||e.openModal()},te=()=>{var e;p.value=null,(e=R.value)==null||e.closeModal(),k()},oe=async e=>{var s;H.value=e,(s=R.value)==null||s.closeModal(),await h(),Y()},j=d(null),Y=()=>{var e;(e=j.value)==null||e.openModal()},ne=e=>{p.value=e,b()},se=()=>{E()},ae=e=>{S.success(`Imported ${e.length} questions`);const s=e.map(r=>Ee.transformResponseToRequest(r));o.questions=[...o.questions,...s],h(()=>{var r,g;(g=(r=T.value)==null?void 0:r.forceUpdate)==null||g.call(r),h(()=>{const Q=o.questions.length;requestAnimationFrame(()=>{var M;(M=T.value)==null||M.scrollToItem(Q)})})})};me((e,s,r)=>{if(!m.value){r();return}B.confirm({title:"Leave already?",content:"You have unsaved changes.",onOk:()=>{r()},onCancel:()=>r(!1)})});function O(e){e.preventDefault(),e.returnValue=""}fe(()=>{window.removeEventListener("beforeunload",O)});const T=d(null),le=()=>{h(()=>{var e,s;(s=(e=T.value)==null?void 0:e.forceUpdate)==null||s.call(e)})};pe(()=>{_(),o.questions.push(f()),window.addEventListener("beforeunload",O),D()});const X={componentMap:z,t,route:F,router:v,isDataValid:m,getClassData:_,formRef:q,formState:o,rules:x,createQuestionTemplate:f,onAddQuestion:I,onRemoveQuestion:N,onFinish:W,showModalConfirmation:U,settingModalRef:G,openSettingModal:D,folderModalRef:C,openFolderModal:k,onSwitchToTestTemplate:Z,onOpenFolder:$,chosenFolder:p,chosenTestTemplateId:H,folderTestTemplateModalRef:V,openFolderTestTemplateModal:b,onBackToFolderModal:ee,testTemplateModalRef:R,openTestTemplateModal:E,onSwitchToFolder:te,onOpenTestTemplate:oe,questionModalRef:j,openQuestionModal:Y,onBackToFolderTestTemplate:ne,onBackToTestTemplate:se,onModalImport:ae,handleBeforeUnload:O,scrollerRef:T,handleScroll:le,SettingTestModal:Ae,ChooseFolderModal:Re,ChooseFolderTestTemplateModal:Ce,ChooseTestTemplateModal:Ie,ChooseQuestionModal:qe,get DynamicScroller(){return be},get DynamicScrollerItem(){return ke}};return Object.defineProperty(X,"__isScriptSetup",{enumerable:!1,value:!0}),X}}),Be={class:"page-container"},Pe={class:"title-container"},Le={class:"content"},ze={class:"content-item"},Ne={class:"content-item-title"},Ue={class:"content-item-buttons"},Ge={class:"import-button"};function He(y,i,z,t,F,v){const m=w("RouterLink"),_=w("a-col"),q=w("a-row"),o=w("a-button"),x=w("a-form");return P(),ge(ve,null,[l("div",Be,[l("div",Pe,[c(q,{class:"w-100 d-flex align-items-center"},{default:u(()=>[c(_,{span:1},{default:u(()=>[c(m,{to:{name:""},onClick:t.openSettingModal},{default:u(()=>i[0]||(i[0]=[l("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[0]})]),_:1}),c(_,{class:"main-title",span:23},{default:u(()=>i[1]||(i[1]=[l("span",null,"Assign new test for class SEP490",-1),l("br",null,null,-1),l("span",null,"Add questions, set answers and configure test settings",-1)])),_:1,__:[1]})]),_:1})]),l("div",Le,[c(x,{layout:"vertical",model:t.formState,rules:t.rules,ref:"formRef"},{default:u(()=>[l("div",ze,[l("div",Ne,[i[4]||(i[4]=l("div",null,[l("span",null,"Test questions"),l("span",null,"Create and manage your test questions")],-1)),l("div",Ue,[c(m,{class:"import-button",to:{name:""},onClick:t.openFolderModal},{default:u(()=>i[2]||(i[2]=[L(" Choose from folder test ")])),_:1,__:[2]}),l("div",Ge,J(y.$t("create_QS.quiz.total",{number:t.formState.questions.length.toString().padStart(3,"0")})),1),c(o,{type:"primary",class:"main-color-btn",size:"large",onClick:t.onFinish},{default:u(()=>i[3]||(i[3]=[L(" Next ")])),_:1,__:[3]})])]),c(t.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:t.formState.questions,"min-item-size":650,buffer:800,prerender:10,onScroll:t.handleScroll},{default:u(({item:f,index:I})=>[(P(),K(t.DynamicScrollerItem,{item:f,key:f.id},{default:u(()=>[(P(),K(he(t.componentMap[f.type]),{question:f,index:I+1,displayScore:!1,onDeleteQuestion:N=>t.onRemoveQuestion(I)},null,40,["question","index","onDeleteQuestion"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),l("div",{class:"add-question-btn",onClick:t.onAddQuestion},[i[5]||(i[5]=l("i",{class:"bx bx-plus"},null,-1)),L(" "+J(y.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["model"])])]),c(t.SettingTestModal,{ref:"settingModalRef","form-ref":t.formRef,"class-name":"SEP490","form-state":t.formState},null,8,["form-ref","form-state"]),c(t.ChooseFolderModal,{ref:"folderModalRef",onSwitchToTestTemplate:t.onSwitchToTestTemplate,onOpenFolder:t.onOpenFolder},null,512),c(t.ChooseFolderTestTemplateModal,{ref:"folderTestTemplateModalRef",folder:t.chosenFolder,onBackToFolderModal:t.onBackToFolderModal,onOpenTestTemplate:t.onOpenTestTemplate},null,8,["folder"]),c(t.ChooseTestTemplateModal,{ref:"testTemplateModalRef",onSwitchToFolder:t.onSwitchToFolder,onOpenTestTemplate:t.onOpenTestTemplate},null,512),c(t.ChooseQuestionModal,{ref:"questionModalRef","test-template-id":t.chosenTestTemplateId,folder:t.chosenFolder,onBackToFolderTestTemplateModal:t.onBackToFolderTestTemplate,onBackToTestTemplateModal:t.onBackToTestTemplate,onImport:t.onModalImport},null,8,["test-template-id","folder"])],64)}const at=Te(Qe,[["render",He],["__scopeId","data-v-501cc219"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test/create.vue"]]);export{at as default};

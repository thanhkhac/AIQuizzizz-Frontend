import{d as ee,u as te,l as ae,q as ne,i as f,j as oe,a2 as se,a3 as ie,s as le,k as Q,G as V,M as z,_ as re,r as S,a as B,o as q,b as s,c as d,w as g,f as U,t as m,e as de,E as N,R as ue,F as me}from"./index-odI1__hS.js";import{A as D}from"./ApiTestTemplate-DcqlEdwS.js";import{Q as y}from"./questionTypes-CS3lcRlq.js";import{T as ce}from"./TransferQuestionData-BxcXdBjq.js";import{V as pe}from"./Validator-CWeiTIFe.js";import{I as fe}from"./Input-DyxqJnjy.js";import{T as ge}from"./vue-draggable-plus-nfkw9o27.js";import{C as M,S as _e,O as he,M as ve,a as Qe,s as be,b as Se}from"./vue-virtual-scroller.esm-pEPKGCif.js";import{G as Te,I as Ie}from"./GenerateQSModal-Dp-QSjQ8.js";import"./lodash-DXFFMOBY.js";/* empty css                                                                 */import"./ApiQuestionSet-DBReJRHg.js";import"./languages-DtYW231W.js";const qe=ee({__name:"update",setup(u,{expose:l}){l();const{t:o}=te(),e=ae(),w=ne(),T=f(!1),_=f(w.params.id),c=f({testTemplateId:"",name:"",questions:[]}),h=f(!0),v=async()=>{try{if(T.value=!0,!pe.isValidGuid(_.value)){h.value=!1,e.push({name:"404"});return}await F();let t=await D.GetById(_.value);if(!t.data.success){h.value=!1,e.push({name:"404"});return}c.value=t.data.data,c.value.questions=t.data.data.questions.map(n=>({id:n.questionId,...n})),a.name=c.value.name,a.createUpdateQuestions=c.value.questions.map(n=>ce.transformResponseToRequest(n)),a.testTemplateId=c.value.testTemplateId,window.addEventListener("beforeunload",x)}catch(t){console.log(t)}finally{T.value=!1}},C=f(),a=oe({testTemplateId:"",name:"",description:"",createUpdateQuestions:[],deleteQuestionIds:[]}),k={title:[{required:"true",message:o("message.required"),trigger:"change"},{length:100,message:o("message.out_of_range",{max_length:100}),trigger:"change"}],description:[{length:200,message:o("message.out_of_range",{max_length:200}),trigger:"change"}],questions:[{validator:(t,n)=>n&&n.length>500?Promise.reject(o("message.maximum_tag.limit_question",{number:500})):Promise.resolve(),trigger:"change"}]},b={MultipleChoice:Qe,Matching:ve,Ordering:he,ShortText:_e},E=()=>({id:"new_"+Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:M.defaultMultipleChoices(),matchingPairs:M.defaultMatchingPairs(),orderingItems:M.defaultOrderingItems(),shortAnswer:""}),H=t=>{M.onChangeQuestionType(t)},j=()=>{if(a.createUpdateQuestions.length>=500){Q.warning(o("message.limit_question",{number:500}));return}a.createUpdateQuestions=[...a.createUpdateQuestions,E()],V(()=>{var t,n;(n=(t=I.value)==null?void 0:t.forceUpdate)==null||n.call(t),V(()=>{const p=a.createUpdateQuestions.length;requestAnimationFrame(()=>{var A;(A=I.value)==null||A.scrollToItem(p)})})})},W=t=>{if(a.createUpdateQuestions.length<=1){Q.warning(o("message.minimum_question",{number:1}));return}const n=a.createUpdateQuestions[t].id;!n.startsWith("new_")&&n&&a.deleteQuestionIds.push(n),a.createUpdateQuestions=[...a.createUpdateQuestions.slice(0,t),...a.createUpdateQuestions.slice(t+1)]},X=()=>{let t=!1,n=o("message.invalid_question"),p=new Set;if(a.name.trim().length>100||a.name.trim().length===0){t=!0,n=o("message.invalid_title"),Q.error(n);return}if(a.description.trim().length>250){t=!0,n=o("message.invalid_description"),Q.error(n);return}[a.createUpdateQuestions.filter(i=>{const r=i.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return r.length===0||r.length>=500}),a.createUpdateQuestions.filter(i=>(i.explainText?i.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),a.createUpdateQuestions.filter(i=>i.type===y.MULTIPLE_CHOICE&&(i.multipleChoices.some(r=>r.text.trim().length===0||r.text.trim().length>500)||i.multipleChoices.filter(r=>r.isAnswer).length===0)),a.createUpdateQuestions.filter(i=>i.type===y.MATCHING&&(i.matchingPairs.some(r=>r.leftItem.trim().length===0||r.leftItem.trim().length>500)||i.matchingPairs.some(r=>r.rightItem.trim().length===0||r.rightItem.trim().length>500))),a.createUpdateQuestions.filter(i=>i.type===y.ORDERING&&i.orderingItems.some(r=>r.text.trim().length===0||r.text.trim().length>500)),a.createUpdateQuestions.filter(i=>i.type===y.SHORT_TEXT&&(i.shortAnswer.trim().length===0||i.shortAnswer.trim().length>500))].forEach(i=>{i.length>0&&(t=!0,i.forEach(r=>p.add(r)))});let $=Array.from(p).map(i=>a.createUpdateQuestions.indexOf(i)+1);t?z.error({title:o("create_QS.modal.invalid.title"),content:o("create_QS.modal.invalid.content")+$.sort().join(", "),okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel")}):O()},O=()=>{z.confirm({title:o("create_template.modal.valid.title"),content:o("create_QS.modal.valid.content"),okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{let t=await D.Update(c.value.testTemplateId,{...a,createUpdateQuestions:a.createUpdateQuestions.map(n=>({questionId:n.id.startsWith("new_")?null:n.id,...n}))});t.data.success&&(Q.success(o("message.updated_successfully")),h.value=!1,e.push({name:"User_TestTemplate_Detail",params:{id:t.data.data}}))}})},G=f(null),Y=()=>{var t;(t=G.value)==null||t.openImportModal()},P=f(null),J=()=>{var t;(t=P.value)==null||t.openGenerateAIModal()},K=t=>{a.createUpdateQuestions.push(...t.map((n,p)=>({...n,id:`new_${a.createUpdateQuestions.length+p}`}))),Q.success(`${o("message.imported_question",{number:t.length})}`)};function x(t){t.preventDefault(),t.returnValue=""}se((t,n,p)=>{if(!h.value){p();return}z.confirm({title:o("create_QS.modal.leave.title"),content:o("create_QS.modal.leave.content"),okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),onOk:()=>{p()},onCancel:()=>p(!1)})}),ie(()=>{window.removeEventListener("beforeunload",x)});const R=f({canEdit:!1,canDelete:!1}),F=async()=>{const t=await D.GetPermissions(_.value);t.data.success&&(R.value=t.data.data,R.value.canEdit||(h.value=!1,e.push({name:"404"})))},I=f(null),Z=()=>{V(()=>{var t,n;(n=(t=I.value)==null?void 0:t.forceUpdate)==null||n.call(t)})};le(async()=>{await v()});const L={t:o,router:e,route:w,loading:T,testTemplateId:_,testTemplate:c,isDataValid:h,getTestTemplate:v,formRef:C,formState:a,rules:k,componentMap:b,createQuestionTemplate:E,onHandleChangeQuestionType:H,onAddQuestion:j,onRemoveQuestion:W,onFinish:X,showModalConfirmation:O,importModalRef:G,onOpenImportModal:Y,generateModalRef:P,openGenerateAIModal:J,onModalImport:K,handleBeforeUnload:x,permission:R,getPermission:F,scrollerRef:I,handleScroll:Z,Input:fe,TextArea:ge,ImportQSModal:Ie,GenerateQSModal:Te,get DynamicScroller(){return Se},get DynamicScrollerItem(){return be}};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}}),Ue={class:"page-container"},ye={class:"title-container"},Me={class:"content"},we={class:"content-item"},Ce={class:"content-item-title"},ke={class:"d-flex"},xe={class:"content-item"},Re={class:"content-item-title"},Ae={class:"content-item-buttons"},Ve={class:"import-button"},ze={key:0};function De(u,l,o,e,w,T){const _=S("RouterLink"),c=S("a-col"),h=S("a-row"),v=S("a-skeleton"),C=S("a-form");return q(),B(me,null,[s("div",Ue,[s("div",ye,[d(h,{class:"w-100 d-flex align-items-center"},{default:g(()=>[d(c,{span:1},{default:g(()=>[d(_,{to:{name:"User_Folder"}},{default:g(()=>l[3]||(l[3]=[s("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[3]})]),_:1}),d(c,{class:"main-title",span:23},{default:g(()=>[s("span",null,m(u.$t("update_template.title",{name:e.formState.name})),1),l[4]||(l[4]=U()),l[5]||(l[5]=s("br",null,null,-1)),s("span",null,m(u.$t("create_QS.sub_title")),1)]),_:1,__:[4,5]})]),_:1})]),s("div",Me,[d(C,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":l[2]||(l[2]=a=>e.formState=a),rules:e.rules,ref:"formRef"},{default:g(()=>[s("div",we,[s("div",Ce,[s("div",null,[s("span",null,m(u.$t("create_QS.quiz.question_detail_title")),1),s("span",null,m(u.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":l[0]||(l[0]=a=>e.formState.name=a),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),s("div",ke,[d(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":l[1]||(l[1]=a=>e.formState.description=a),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"])])]),s("div",xe,[s("div",Re,[s("div",null,[s("span",null,m(u.$t("create_QS.quiz.question_question_title")),1),s("span",null,m(u.$t("create_QS.quiz.question_question_sub_title")),1)]),s("div",Ae,[d(_,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:g(()=>[U(m(u.$t("create_QS.buttons.import"))+" ",1),l[6]||(l[6]=s("i",{class:"bx bx-download"},null,-1))]),_:1,__:[6]}),d(_,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:g(()=>[U(m(u.$t("create_QS.buttons.generated_by_ai"))+" ",1),l[7]||(l[7]=s("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[7]}),s("div",{class:"import-button",onClick:e.onFinish},m(u.$t("update_QS.buttons.update")),1),s("div",Ve,m(u.$t("create_QS.quiz.total",{number:e.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1)])]),e.loading?(q(),B("div",ze,[d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"])])):de("v-if",!0),d(e.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.createUpdateQuestions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:g(({item:a,index:k})=>[(q(),N(e.DynamicScrollerItem,{item:a,key:a.id},{default:g(()=>[(q(),N(ue(e.componentMap[a.type]),{question:a,index:e.formState.createUpdateQuestions.findIndex(b=>b.id===a.id)+1,displayScore:!1,onDeleteQuestion:b=>e.onRemoveQuestion(k),onChangeQuestionType:b=>e.onHandleChangeQuestionType(a)},null,40,["question","index","onDeleteQuestion","onChangeQuestionType"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),s("div",{class:"add-question-btn",onClick:e.onAddQuestion},[l[8]||(l[8]=s("i",{class:"bx bx-plus"},null,-1)),U(" "+m(u.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),d(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,"number-of-question":e.formState.createUpdateQuestions.length,onImport:e.onModalImport},null,8,["title","number-of-question"]),d(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport,"number-of-question":e.formState.createUpdateQuestions.length},null,8,["title","number-of-question"])],64)}const Je=re(qe,[["render",De],["__scopeId","data-v-48787c2a"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test_template/update.vue"]]);export{Je as default};

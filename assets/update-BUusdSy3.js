import{d as Z,u as $,l as ee,q as te,i as f,j as ne,X as ae,Y as oe,s as se,k as S,Q as A,M as R,_ as ie,r as Q,a as L,o as T,b as s,c as d,w as g,f as q,t as m,e as le,E as N,N as re,F as de}from"./index-BhCEM7Qr.js";import{A as C}from"./ApiTestTemplate-GdvjRZpe.js";import{Q as U}from"./questionTypes-CS3lcRlq.js";import{T as ce}from"./TransferQuestionData-BxcXdBjq.js";import{V as me}from"./Validator-CWeiTIFe.js";import{I as ue}from"./Input-pAeduOdR.js";import{T as pe}from"./TextArea-WM5cwCwM.js";import{S as fe,O as ge,M as _e,a as ve,s as he,b as Se}from"./vue-virtual-scroller.esm-7uu7mpKW.js";import{G as Qe,I as be}from"./GenerateQSModal-DsgyAhI_.js";/* empty css                                                                 */import"./vue-draggable-plus-CRg8kvXS.js";import"./languages-DtYW231W.js";const Ie=Z({__name:"update",setup(c,{expose:l}){l();const{t:o}=$(),e=ee(),x=te(),b=f(!1),_=f(x.params.id),p=f({testTemplateId:"",name:"",questions:[]}),h=f(!0),v=async()=>{try{if(b.value=!0,!me.isValidGuid(_.value)){h.value=!1,e.push({name:"404"});return}await P();let t=await C.GetById(_.value);if(!t.data.success){h.value=!1,e.push({name:"404"});return}p.value=t.data.data,n.name=p.value.name,n.createUpdateQuestions=p.value.questions.map(a=>ce.transformResponseToRequest(a)),n.testTemplateId=p.value.testTemplateId,window.addEventListener("beforeunload",y)}catch(t){console.log(t)}finally{b.value=!1}},M=f(),n=ne({testTemplateId:"",name:"",description:"",createUpdateQuestions:[],deleteQuestionIds:[]}),I={title:[{required:"true",message:o("message.required"),trigger:"change"},{length:100,message:o("message.out_of_range",{max_length:100}),trigger:"change"}],description:[{length:200,message:o("message.out_of_range",{max_length:200}),trigger:"change"}],questions:[{validator:(t,a)=>a&&a.length>500?Promise.reject(o("message.maximum_tag.limit_question",{number:500})):Promise.resolve(),trigger:"change"}]},V={MultipleChoice:ve,Matching:_e,Ordering:ge,ShortText:fe},z=()=>({id:`new_${Date.now().toString()}`,type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),B=()=>{if(n.createUpdateQuestions.length>=500){S.warning(o("message.limit_question",{number:500}));return}n.createUpdateQuestions=[...n.createUpdateQuestions,z()],A(()=>{var t,a;(a=(t=w.value)==null?void 0:t.forceUpdate)==null||a.call(t),A(()=>{const u=n.createUpdateQuestions.length;requestAnimationFrame(()=>{var D;(D=w.value)==null||D.scrollToItem(u)})})})},j=t=>{if(n.createUpdateQuestions.length<=1){S.warning(o("message.minimum_question",{number:1}));return}const a=n.createUpdateQuestions[t].id;!a.startsWith("new_")&&a&&n.deleteQuestionIds.push(a),n.createUpdateQuestions=[...n.createUpdateQuestions.slice(0,t),...n.createUpdateQuestions.slice(t+1)]},H=()=>{let t=!1,a=o("message.invalid_question"),u=new Set;if(n.name.trim().length>100||n.name.trim().length===0){t=!0,a=o("message.invalid_title"),S.error(a);return}if(n.description.trim().length>250){t=!0,a=o("message.invalid_description"),S.error(a);return}[n.createUpdateQuestions.filter(i=>{const r=i.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return r.length===0||r.length>=500}),n.createUpdateQuestions.filter(i=>(i.explainText?i.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),n.createUpdateQuestions.filter(i=>i.type===U.MULTIPLE_CHOICE&&(i.multipleChoices.some(r=>r.text.trim().length===0||r.text.trim().length>500)||i.multipleChoices.filter(r=>r.isAnswer).length===0)),n.createUpdateQuestions.filter(i=>i.type===U.MATCHING&&(i.matchingPairs.some(r=>r.leftItem.trim().length===0||r.leftItem.trim().length>500)||i.matchingPairs.some(r=>r.rightItem.trim().length===0||r.rightItem.trim().length>500))),n.createUpdateQuestions.filter(i=>i.type===U.ORDERING&&i.orderingItems.some(r=>r.text.trim().length===0||r.text.trim().length>500)),n.createUpdateQuestions.filter(i=>i.type===U.SHORT_TEXT&&(i.shortAnswer.trim().length===0||i.shortAnswer.trim().length>500))].forEach(i=>{i.length>0&&(t=!0,i.forEach(r=>u.add(r)))});let K=Array.from(u).map(i=>n.createUpdateQuestions.indexOf(i)+1);t?R.error({title:o("create_QS.modal.invalid.title"),content:o("create_QS.modal.invalid.content")+K.sort().join(", "),okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel")}):O()},O=()=>{R.confirm({title:o("create_template.modal.valid.title"),content:o("create_QS.modal.valid.content"),okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{n.createUpdateQuestions=n.createUpdateQuestions.map(a=>a.id.startsWith("new_")?{...a,id:""}:a),(await C.Update(p.value.testTemplateId,n)).data.success&&S.success(o("message.created_successfully"))}})},E=f(null),W=()=>{var t;(t=E.value)==null||t.openImportModal()},G=f(null),X=()=>{var t;(t=G.value)==null||t.openGenerateAIModal()},Y=t=>{n.createUpdateQuestions.push(...t.map((a,u)=>({...a,id:`new_${n.createUpdateQuestions.length+u}`}))),S.success(`${o("message.imported_question",{number:t.length})}`)};function y(t){t.preventDefault(),t.returnValue=""}ae((t,a,u)=>{if(!h.value){u();return}R.confirm({title:o("create_QS.modal.leave.title"),content:o("create_QS.modal.leave.content"),okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),onOk:()=>{u()},onCancel:()=>u(!1)})}),oe(()=>{window.removeEventListener("beforeunload",y)});const k=f({canEdit:!1,canDelete:!1}),P=async()=>{const t=await C.GetPermissions(_.value);t.data.success&&(k.value=t.data.data,k.value.canEdit||(h.value=!1,e.push({name:"404"})))},w=f(null),J=()=>{A(()=>{var t,a;(a=(t=w.value)==null?void 0:t.forceUpdate)==null||a.call(t)})};se(async()=>{await v()});const F={t:o,router:e,route:x,loading:b,testTemplateId:_,testTemplate:p,isDataValid:h,getTestTemplate:v,formRef:M,formState:n,rules:I,componentMap:V,createQuestionTemplate:z,onAddQuestion:B,onRemoveQuestion:j,onFinish:H,showModalConfirmation:O,importModalRef:E,onOpenImportModal:W,generateModalRef:G,openGenerateAIModal:X,onModalImport:Y,handleBeforeUnload:y,permission:k,getPermission:P,scrollerRef:w,handleScroll:J,Input:ue,TextArea:pe,ImportQSModal:be,GenerateQSModal:Qe,get DynamicScroller(){return Se},get DynamicScrollerItem(){return he}};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}}),we={class:"page-container"},Te={class:"title-container"},qe={class:"content"},Ue={class:"content-item"},xe={class:"content-item-title"},Me={class:"d-flex"},ye={class:"content-item"},ke={class:"content-item-title"},De={class:"content-item-buttons"},Ae={class:"import-button"},Re={key:0};function Ce(c,l,o,e,x,b){const _=Q("RouterLink"),p=Q("a-col"),h=Q("a-row"),v=Q("a-skeleton"),M=Q("a-form");return T(),L(de,null,[s("div",we,[s("div",Te,[d(h,{class:"w-100 d-flex align-items-center"},{default:g(()=>[d(p,{span:1},{default:g(()=>[d(_,{to:{name:"User_Folder"}},{default:g(()=>l[3]||(l[3]=[s("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[3]})]),_:1}),d(p,{class:"main-title",span:23},{default:g(()=>[s("span",null,m(c.$t("update_template.title",{name:e.formState.name})),1),l[4]||(l[4]=q()),l[5]||(l[5]=s("br",null,null,-1)),s("span",null,m(c.$t("create_QS.sub_title")),1)]),_:1,__:[4,5]})]),_:1})]),s("div",qe,[d(M,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":l[2]||(l[2]=n=>e.formState=n),rules:e.rules,ref:"formRef"},{default:g(()=>[s("div",Ue,[s("div",xe,[s("div",null,[s("span",null,m(c.$t("create_QS.quiz.question_detail_title")),1),s("span",null,m(c.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":l[0]||(l[0]=n=>e.formState.name=n),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),s("div",Me,[d(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":l[1]||(l[1]=n=>e.formState.description=n),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"])])]),s("div",ye,[s("div",ke,[s("div",null,[s("span",null,m(c.$t("create_QS.quiz.question_question_title")),1),s("span",null,m(c.$t("create_QS.quiz.question_question_sub_title")),1)]),s("div",De,[d(_,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:g(()=>[q(m(c.$t("create_QS.buttons.import"))+" ",1),l[6]||(l[6]=s("i",{class:"bx bx-download"},null,-1))]),_:1,__:[6]}),d(_,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:g(()=>[q(m(c.$t("create_QS.buttons.generated_by_ai"))+" ",1),l[7]||(l[7]=s("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[7]}),s("div",{class:"import-button",onClick:e.onFinish},m(c.$t("create_QS.buttons.create")),1),s("div",Ae,m(c.$t("create_QS.quiz.total",{number:e.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1)])]),e.loading?(T(),L("div",Re,[d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"]),d(v,{loading:e.loading,active:""},null,8,["loading"])])):le("v-if",!0),d(e.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.createUpdateQuestions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:g(({item:n,index:I})=>[(T(),N(e.DynamicScrollerItem,{item:n,key:n.id},{default:g(()=>[(T(),N(re(e.componentMap[n.type]),{question:n,index:I+1,displayScore:!1,onDeleteQuestion:V=>e.onRemoveQuestion(I)},null,40,["question","index","onDeleteQuestion"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),s("div",{class:"add-question-btn",onClick:e.onAddQuestion},[l[8]||(l[8]=s("i",{class:"bx bx-plus"},null,-1)),q(" "+m(c.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),d(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,onImport:e.onModalImport},null,8,["title"]),d(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport},null,8,["title"])],64)}const We=ie(Ie,[["render",Ce],["__scopeId","data-v-48787c2a"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test_template/update.vue"]]);export{We as default};

import{d as X,u as Y,l as J,i as q,j as K,X as W,s as Z,Y as $,k as p,R as x,M as D,_ as ee,r as M,a as O,o as I,b as n,c as d,w as f,f as Q,t as c,F as L,D as te,E as P,N as ne}from"./index-DhrrK0Mu.js";import{A as oe}from"./ApiQuestionSet-CCKPOHyK.js";import{I as ae}from"./Input-BvI-y3AG.js";import{T as ie}from"./TextArea-CfE5AIa4.js";import{S as re,O as se,M as le,a as me,s as ue,b as de}from"./vue-virtual-scroller.esm-CYTKZvaH.js";import{G as ce,I as ge}from"./GenerateQSModal-v77-P2ko.js";import{Q as k}from"./questionTypes-CS3lcRlq.js";/* empty css                                                                 */import"./vue-draggable-plus-CN4f4UR9.js";import"./ApiTestTemplate-C2cUjulG.js";import"./languages-DtYW231W.js";const fe=X({__name:"create",setup(u,{expose:i}){i();const{t:o}=Y(),e=J(),R=q(),a=K({name:"",description:"",tags:[],questions:[]}),S={title:[{required:"true",message:o("message.required"),trigger:"change"},{length:100,message:o("message.out_of_range",{max_length:100}),trigger:"change"}],description:[{length:200,message:o("message.out_of_range",{max_length:200}),trigger:"change"}],tags:[{validator:(t,r)=>r&&r.length>5?Promise.reject(o("message.maximum_tag.out_of_range",{tag:5})):Promise.resolve(),trigger:"change"}],questions:[{validator:(t,r)=>r&&r.length>500?Promise.reject(o("message.maximum_tag.limit_question",{number:500})):Promise.resolve(),trigger:"change"}]},w={MultipleChoice:me,Matching:le,Ordering:se,ShortText:re},h=q(""),C=()=>{if(a.tags.length>=5){p.warning(o("maximum_tag.out_of_range",{tag:5}));return}h.value&&h.value.trim().length<=50?(a.tags.push(h.value),h.value=""):p.warning(o("maximum_tag.invalid_tag_content"))},m=t=>{a.tags.splice(t,1)},_=()=>({id:Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),y=async()=>{if(a.questions.length>=500){p.warning(o("message.limit_question",{number:500}));return}a.questions=[...a.questions,_()],x(()=>{var t,r;(r=(t=b.value)==null?void 0:t.forceUpdate)==null||r.call(t),x(()=>{const g=a.questions.length;requestAnimationFrame(()=>{var v;(v=b.value)==null||v.scrollToItem(g)})})})},F=t=>{if(a.questions.length<=1){p.warning(o("message.minimum_question",{number:1}));return}a.questions=[...a.questions.slice(0,t),...a.questions.slice(t+1)]},G=()=>{let t=!1,r=o("message.invalid_question"),g=new Set;if(a.name.trim().length>100||a.name.trim().length===0){t=!0,r=o("message.invalid_title"),p.error(r);return}if(a.description.trim().length>250){t=!0,r=o("message.invalid_description"),p.error(r);return}[a.questions.filter(s=>{const l=s.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return l.length===0||l.length>=500}),a.questions.filter(s=>(s.explainText?s.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),a.questions.filter(s=>s.type===k.MULTIPLE_CHOICE&&(s.multipleChoices.some(l=>l.text.trim().length===0||l.text.trim().length>500)||s.multipleChoices.filter(l=>l.isAnswer).length===0)),a.questions.filter(s=>s.type===k.MATCHING&&(s.matchingPairs.some(l=>l.leftItem.trim().length===0||l.leftItem.trim().length>500)||s.matchingPairs.some(l=>l.rightItem.trim().length===0||l.rightItem.trim().length>500))),a.questions.filter(s=>s.type===k.ORDERING&&s.orderingItems.some(l=>l.text.trim().length===0||l.text.trim().length>500)),a.questions.filter(s=>s.type===k.SHORT_TEXT&&(s.shortAnswer.trim().length===0||s.shortAnswer.trim().length>500))].forEach(s=>{s.length>0&&(t=!0,s.forEach(l=>g.add(l)))});let T=Array.from(g).map(s=>a.questions.indexOf(s)+1);t?D.error({title:o("create_QS.modal.invalid.title"),content:o("create_QS.modal.invalid.content")+T.sort().join(", "),okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel")}):z()},z=()=>{D.confirm({title:o("create_QS.Modal.confirmvalid.title"),content:o("create_QS.modal.valid.content"),centered:!0,okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),onOk:async()=>{let t=await oe.Create(a);t.data.success&&(p.success(o("message.created_successfully")),e.push({name:"User_QuestionSet_Detail",params:{id:t.data.data}}))}})},V=q(null),N=()=>{var t;(t=V.value)==null||t.openImportModal()},U=q(null),B=()=>{var t;(t=U.value)==null||t.openGenerateAIModal()},j=t=>{t.length!==0&&(a.questions.push(...t.map((r,g)=>({...r,id:`new_${a.questions.length+g}`}))),x(()=>{var r,g;(g=(r=b.value)==null?void 0:r.forceUpdate)==null||g.call(r),x(()=>{const v=a.questions.length;requestAnimationFrame(()=>{var T;(T=b.value)==null||T.scrollToItem(v)})})}),p.success(`${o("message.imported_question",{number:t.length})}`))};W((t,r,g)=>{D.confirm({title:o("create_QS.modal.leave.title"),content:o("create_QS.modal.leave.content"),okText:o("sidebar.buttons.ok"),cancelText:o("sidebar.buttons.cancel"),onOk:()=>{g()},onCancel:()=>g(!1)})});function A(t){t.preventDefault(),t.returnValue=""}const b=q(null),H=()=>{x(()=>{var t,r;(r=(t=b.value)==null?void 0:t.forceUpdate)==null||r.call(t)})};Z(()=>{a.questions.push(_()),window.addEventListener("beforeunload",A)}),$(()=>{window.removeEventListener("beforeunload",A)});const E={t:o,router:e,formRef:R,formState:a,rules:S,componentMap:w,tagContent:h,addTag:C,removeTag:m,createQuestionTemplate:_,onAddQuestion:y,onRemoveQuestion:F,onFinish:G,showModalConfirmation:z,importModalRef:V,onOpenImportModal:N,generateModalRef:U,openGenerateAIModal:B,onModalImport:j,handleBeforeUnload:A,scrollerRef:b,handleScroll:H,Input:ae,TextArea:ie,ImportQSModal:ge,GenerateQSModal:ce,get DynamicScroller(){return de},get DynamicScrollerItem(){return ue}};return Object.defineProperty(E,"__isScriptSetup",{enumerable:!1,value:!0}),E}}),_e={class:"page-container"},pe={class:"title-container"},he={class:"content"},be={class:"content-item"},Se={class:"content-item-title"},ve={class:"d-flex"},qe={class:"form-item"},xe={class:"tag-container"},Ie=["onClick"],Qe={class:"tag-inputter"},we={class:"content-item"},Te={class:"content-item-title"},Me={class:"content-item-buttons"},ke={class:"import-button"};function Ce(u,i,o,e,R,a){const S=M("RouterLink"),w=M("a-col"),h=M("a-row"),C=M("a-form");return I(),O(L,null,[n("div",_e,[n("div",pe,[d(h,{class:"w-100 d-flex align-items-center"},{default:f(()=>[d(w,{span:1},{default:f(()=>[d(S,{to:{name:"User_Library"}},{default:f(()=>i[4]||(i[4]=[n("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[4]})]),_:1}),d(w,{class:"main-title",span:23},{default:f(()=>[n("span",null,c(u.$t("create_QS.title")),1),i[5]||(i[5]=Q()),i[6]||(i[6]=n("br",null,null,-1)),n("span",null,c(u.$t("create_QS.sub_title")),1)]),_:1,__:[5,6]})]),_:1})]),n("div",he,[d(C,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":i[3]||(i[3]=m=>e.formState=m),rules:e.rules,ref:"formRef"},{default:f(()=>[n("div",be,[n("div",Se,[n("div",null,[n("span",null,c(u.$t("create_QS.quiz.question_detail_title")),1),n("span",null,c(u.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":i[0]||(i[0]=m=>e.formState.name=m),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),n("div",ve,[d(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":i[1]||(i[1]=m=>e.formState.description=m),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"]),n("div",qe,[n("label",null,c(u.$t("create_QS.quiz.tag")),1),n("div",xe,[(I(!0),O(L,null,te(e.formState.tags,(m,_)=>(I(),O("div",{class:"tag-item",key:_},[Q(c(m)+" ",1),n("i",{class:"bx bx-x",onClick:y=>e.removeTag(_)},null,8,Ie)]))),128))]),n("div",Qe,[d(e.Input,{modelValue:e.tagContent,"onUpdate:modelValue":i[2]||(i[2]=m=>e.tagContent=m),placeholder:e.t("question_sets_index.search_placeholder"),"max-length":50},{icon:f(()=>i[7]||(i[7]=[n("i",{class:"bx bx-purchase-tag-alt"},null,-1)])),_:1},8,["modelValue","placeholder"]),n("i",{class:"bx bx-plus tag-inputter-button",onClick:e.addTag})])])])]),n("div",we,[n("div",Te,[n("div",null,[n("span",null,c(u.$t("create_QS.quiz.question_question_title")),1),n("span",null,c(u.$t("create_QS.quiz.question_question_sub_title")),1)]),n("div",Me,[d(S,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:f(()=>[Q(c(u.$t("create_QS.buttons.import"))+" ",1),i[8]||(i[8]=n("i",{class:"bx bx-download"},null,-1))]),_:1,__:[8]}),d(S,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:f(()=>[Q(c(u.$t("create_QS.buttons.generated_by_ai"))+" ",1),i[9]||(i[9]=n("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[9]}),n("div",{class:"import-button",onClick:e.onFinish},c(u.$t("create_QS.buttons.create")),1),n("div",ke,c(u.$t("create_QS.quiz.total",{number:e.formState.questions.length.toString().padStart(3,"0")})),1)])]),d(e.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.questions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:f(({item:m,index:_})=>[(I(),P(e.DynamicScrollerItem,{item:m,key:m.id},{default:f(()=>[(I(),P(ne(e.componentMap[m.type]),{question:m,index:_+1,displayScore:!1,onDeleteQuestion:y=>e.onRemoveQuestion(_)},null,40,["question","index","onDeleteQuestion"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),n("div",{class:"add-question-btn",onClick:e.onAddQuestion},[i[10]||(i[10]=n("i",{class:"bx bx-plus"},null,-1)),Q(" "+c(u.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),d(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,numberOfQuestion:e.formState.questions.length,onImport:e.onModalImport},null,8,["title","numberOfQuestion"]),d(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport,numberOfQuestion:e.formState.questions.length},null,8,["title","numberOfQuestion"])],64)}const Fe=ee(fe,[["render",Ce],["__scopeId","data-v-b7d6bbaa"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/question_sets/create.vue"]]);export{Fe as default};

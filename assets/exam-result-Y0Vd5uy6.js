import{d as V,q as Y,l as Q,u as K,i as h,z as X,j as J,E as W,s as Z,D as $,S as ee,_ as te,r as _,c as S,o as b,b as t,a as o,w as i,f as k,t as s,F as C,B as ae,C as j,e as H}from"./index-DQ5VBJ-w.js";import{A as se}from"./ApiClass-Dvf--i2d.js";import{T,A as B}from"./ApiTest-BBWDOBeZ.js";import{T as ne,a as le}from"./testGradeQuestionMethod-B_BacNS6.js";import{I as oe}from"./Input-Cgk3a5K5.js";import{V as F}from"./Validator-CWeiTIFe.js";import{U as ie}from"./UserTestAttempts-rsb9lsiv.js";import"./lodash-E-28zDij.js";const re=V({__name:"exam-result",emits:["updateSidebar"],setup(l,{expose:d,emit:z}){var U,L;d();const e=Y(),p=Q(),{t:y}=K(),w=z,m=h(!1),c=h(e.params.classId||""),x=h({classId:"",name:"",topic:""}),g=h(e.params.testId||""),v=h({name:"",classId:e.params.classId.toString()||"",timeLimit:0,startTime:"",endTime:"",questionCount:0,gradeAttemptMethod:le.HIGHEST_SCORE,gradeQuestionMethod:ne.PARTIAL,isShowCorrectAnswerInReview:!0,isAllowReviewAfterSubmit:!0,numberOfShuffles:0,maxAttempt:0,passingScore:0,totalScore:0}),N=h([]),E=[{title:"No",key:"no",customRender:a=>a.index+1},{title:y("class_member.column.fullName"),dataIndex:"studentName",key:"studentName",sorter:(a,u)=>a.studentName.localeCompare(u.studentName)},{title:y("class_member.column.email"),dataIndex:"studentEmail",key:"email",sorter:(a,u)=>a.studentEmail.localeCompare(u.studentEmail)},{title:y("user_attempts_modal.columns.final_score"),dataIndex:"score",key:"score",sorter:(a,u)=>a.score-u.score},{title:y("user_attempts_modal.columns.result"),dataIndex:"status",key:"status"}],A=Object.values(T),R=X(()=>A.map(a=>({label:y(`exam_result.test_status.${a}`),value:a!==T.ALL?a:""}))),n=J({pageNumber:e.query.pageNumber||1,pageSize:e.query.pageSize||10,studentName:((U=e.query.studentName)==null?void 0:U.toString())||"",isPassed:((L=e.query.isPassed)==null?void 0:L.toString())||null,totalCount:0,statusFilter:!1}),D=async()=>{try{if(!F.isValidGuid(c.value.toString())){p.push({name:"404"});return}c.value||p.push({name:"404"});let a=await se.GetById(c.value.toString());a.data.success||p.push({name:"404"}),x.value=a.data.data}catch(a){console.log("ERROR: GETBYID class: "+a)}},I=async()=>{try{if(!F.isValidGuid(g.value.toString())){p.push({name:"404"});return}g.value||p.push({name:"404"});let a=await B.GetById(g.value.toString(),!1);a.data.success||p.push({name:"404"}),v.value=a.data.data}catch(a){console.log("ERROR: GETBYID test: "+a)}},r=async()=>{try{m.value=!0;let a=await B.GetAllExamResultByLimit(g.value.toString(),n);if(a.data.success){let u=a.data.data;N.value=a.data.data.items,n.pageNumber=u.pageNumber,n.pageSize=u.pageSize,n.totalCount=u.totalCount,n.statusFilter&&(n.pageNumber>u.totalPages&&n.totalCount>0?(n.pageNumber=1,p.push({name:"User_Class_Exam_Result",params:{classId:c.value,testId:g.value},query:{pageNumber:1,pageSize:n.pageSize,studentName:n.studentName,isPassed:n.isPassed}})):p.push({name:"User_Class_Exam_Result",params:{classId:c.value,testId:g.value},query:{pageNumber:n.pageNumber,pageSize:n.pageSize,studentName:n.studentName,isPassed:n.isPassed}}),n.statusFilter=!n.statusFilter)}}catch(a){console.log("ERROR: GETALLEXAMBYLIMIT class exam result: "+a)}finally{m.value=!1}};W(()=>Object.keys(e.query).length,()=>{var a,u;n.pageNumber=e.query.pageNumber||1,n.pageSize=e.query.pageSize||11,n.studentName=((a=e.query.studentName)==null?void 0:a.toString())||"",n.isPassed=((u=e.query.isPassed)==null?void 0:u.toString())||null,n.statusFilter=!0,r()});const f=(a,u)=>{n.pageNumber=a,n.pageSize=u,n.statusFilter=!0,r()},P=h({studentId:"",studentName:"",studentEmail:"",score:0,status:""}),q=h(null),G=async a=>{var u;P.value=a,await $(),(u=q.value)==null||u.openModal()},O=a=>{switch(a){case T.PASSED:return"#22C55E";case T.FAILED:return"#cd201f"}};Z(async()=>{w("updateSidebar","class"),await D(),await I(),await r()});const M={route:e,router:p,t:y,emit:w,loading:m,classId:c,classData:x,testId:g,testData:v,testResultData:N,columns:E,optionKeys:A,test_status_options:R,pageParams:n,getClassData:D,getTestDetail:I,getData:r,onPaginationChange:f,chosenUser:P,userHistoryModalRef:q,openUserHistoryModal:G,getTagColor:O,Input:oe,get dayjs(){return ee},UserTestAttempts:ie};return Object.defineProperty(M,"__isScriptSetup",{enumerable:!1,value:!0}),M}}),ue={class:"page-container"},de={class:"title-container"},me={class:"breadcrumb-container"},ce={class:"title-breadcrumb-item"},_e={class:"title-breadcrumb-item"},pe={class:"breadcrumb-item-topic"},ge={class:"content"},fe={class:"content-item"},be={class:"content-item-title"},he={class:"test-info-container"},ye={class:"d-flex justify-content-between"},ve={class:"d-flex justify-content-between"},Se={class:"d-flex justify-content-between"},we={class:"d-flex justify-content-between"},De={class:"content-item-functions"},Ie={style:{width:"300px",padding:"0px"}},xe=["onClick"],Ne={key:1,class:"w-110 d-flex justify-content-center"},Ae={class:"pagination-container"};function Ce(l,d,z,e,p,y){var D,I;const w=_("RouterLink"),m=_("a-col"),c=_("a-row"),x=_("a-select-option"),g=_("a-select"),v=_("a-skeleton"),N=_("a-tag"),E=_("a-table"),A=_("a-config-provider"),R=_("a-empty"),n=_("a-pagination");return b(),S(C,null,[t("div",ue,[t("div",de,[t("div",me,[t("ul",null,[t("li",ce,[o(w,{to:{name:"User_Class"}},{default:i(()=>[t("span",null,s(l.$t("class_index.title")),1),d[3]||(d[3]=k()),d[4]||(d[4]=t("br",null,null,-1))]),_:1,__:[3,4]}),d[5]||(d[5]=t("i",{class:"bx bx-chevron-right"},null,-1))]),t("li",_e,[o(w,{to:{name:"User_Class_Exam",params:{id:e.classId}},class:"breadcrumb-item-class"},{default:i(()=>[t("span",null,s(e.classData.name),1),t("span",pe,s(e.classData.topic),1)]),_:1},8,["to"])])])])]),t("div",ge,[t("div",fe,[t("div",be,[t("div",null,[t("span",null,s(l.$t("exam_result.test_name",{name:e.testData.name})),1),t("span",null,s(l.$t("class_index.title"))+": "+s(e.classData.name),1)])]),t("div",he,[o(c,{class:"mb-2 d-flex align-items-center justify-content-between"},{default:i(()=>[o(m,{span:11,class:"test-info-item"},{default:i(()=>[t("div",ye,[t("span",null,s(l.$t("exam_result.start_time")),1),t("span",null,s(e.dayjs(e.testData.startTime).format("DD/MM/YYYY HH:mm A")),1)]),t("div",ve,[t("span",null,s(l.$t("exam_result.end_time")),1),t("span",null,s(e.dayjs(e.testData.endTime).format("DD/MM/YYYY HH:mm A")),1)])]),_:1}),o(m,{span:11,class:"test-info-item"},{default:i(()=>[t("div",Se,[t("span",null,s(l.$t("exam_result.time_limit")),1),t("span",null,s(e.testData.timeLimit)+" "+s(e.testData.timeLimit>1?l.$t("practice_test.other.minute_plural"):l.$t("practice_test.other.minute")),1)]),t("div",we,[t("span",null,s(l.$t("exam_result.question_count")),1),t("span",null,s(e.testData.questionCount)+" "+s(e.testData.questionCount>1?l.$t("exam_result.other.question_plural"):l.$t("exam_result.other.question")),1)])]),_:1})]),_:1}),o(c,{class:"mb-2 d-flex align-items-center justify-content-between"},{default:i(()=>[o(m,{span:11,class:"d-flex justify-content-between test-info-item"},{default:i(()=>[t("span",null,s(l.$t("exam_result.grade_attempt_method")),1),t("span",null,s(l.$t(`setting_test_modal.final_score_options.${e.testData.gradeAttemptMethod}`)),1)]),_:1}),o(m,{span:11,class:"d-flex justify-content-between test-info-item"},{default:i(()=>[t("span",null,s(l.$t("exam_result.max_attempt")),1),t("span",null,s(e.testData.maxAttempt)+" "+s(e.testData.questionCount>1?l.$t("exam_result.other.time_plural"):l.$t("exam_result.other.time")),1)]),_:1})]),_:1}),o(c,{class:"mb-2 d-flex align-items-center justify-content-between"},{default:i(()=>[o(m,{span:11,class:"d-flex justify-content-between test-info-item"},{default:i(()=>[t("span",null,s(l.$t("exam_result.grade_question_method")),1),t("span",null,s(l.$t(`setting_test_modal.partial_grade_method.${e.testData.gradeQuestionMethod}`)),1)]),_:1}),o(m,{span:11,class:"d-flex justify-content-between test-info-item"},{default:i(()=>[t("span",null,s(l.$t("exam_result.passing_score")),1),t("span",null,s(e.testData.totalScore*(e.testData.passingScore/100))+" ("+s(e.testData.passingScore)+"%) ",1)]),_:1})]),_:1}),o(c,{class:"mb-2 d-flex align-items-center justify-content-between"},{default:i(()=>[o(m,{span:11,class:"d-flex justify-content-between test-info-item"},{default:i(()=>[t("span",null,s(l.$t("exam_result.show_correct_answer")),1),t("span",null,s(e.testData.isShowCorrectAnswerInReview?l.$t("share_modal.buttons.yes"):l.$t("share_modal.buttons.no")),1)]),_:1}),o(m,{span:11,class:"d-flex justify-content-between test-info-item"},{default:i(()=>[t("span",null,s(l.$t("exam_result.allow_review")),1),t("span",null,s(e.testData.isAllowReviewAfterSubmit?l.$t("share_modal.buttons.yes"):l.$t("share_modal.buttons.no")),1)]),_:1})]),_:1})]),t("div",De,[o(g,{value:e.pageParams.isPassed,"onUpdate:value":d[0]||(d[0]=r=>e.pageParams.isPassed=r),style:{width:"230px","margin-right":"10px"},onChange:e.getData},{default:i(()=>[(b(!0),S(C,null,ae(e.test_status_options,r=>(b(),j(x,{value:r.value},{default:i(()=>[k(s(r.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"]),t("div",Ie,[o(e.Input,{onInput:e.getData,modelValue:e.pageParams.studentName,"onUpdate:modelValue":d[1]||(d[1]=r=>e.pageParams.studentName=r),placeholder:e.t("class_member.other.search_placeholder")},{icon:i(()=>d[6]||(d[6]=[t("i",{class:"bx bx-search"},null,-1)])),_:1},8,["modelValue","placeholder"])])]),e.loading?(b(),S(C,{key:0},[o(v,{loading:e.loading},null,8,["loading"]),o(v,{loading:e.loading},null,8,["loading"]),o(v,{loading:e.loading},null,8,["loading"])],64)):(b(),S(C,{key:1},[e.testResultData.length>0?(b(),j(A,{key:0,locale:{Table:{cancelSort:"",triggerAsc:"",triggerDesc:""}}},{default:i(()=>[o(E,{columns:e.columns,"data-source":e.testResultData,"row-key":"studentId",pagination:!1},{bodyCell:i(({column:r,record:f})=>[r.key==="studentName"?(b(),S("div",{key:0,class:"student-name",onClick:P=>e.openUserHistoryModal(f)},s(f.studentName),9,xe)):H("v-if",!0),r.key==="status"?(b(),j(N,{key:1,color:e.getTagColor(f.status)},{default:i(()=>[k(s(f.status),1)]),_:2},1032,["color"])):H("v-if",!0)]),_:1},8,["data-source"])]),_:1})):(b(),S("div",Ne,[o(R,null,{description:i(()=>[t("span",null,s(l.$t("class_index.other.no_data_matches")),1)]),_:1})]))],64)),t("div",Ae,[o(n,{onChange:e.onPaginationChange,current:e.pageParams.pageNumber,"onUpdate:current":d[2]||(d[2]=r=>e.pageParams.pageNumber=r),total:e.pageParams.totalCount,pageSize:e.pageParams.pageSize,"show-total":(r,f)=>`${f[0]}-${f[1]} of ${r} ${e.t("class_member.other.items")}`,"show-size-changer":"","show-quick-jumper":"",class:"crud-layout-pagination",locale:{items_per_page:e.t("class_index.other.pages")}},null,8,["current","total","pageSize","show-total","locale"])])])])]),o(e.UserTestAttempts,{ref:"userHistoryModalRef","test-id":e.testId.toString(),"user-id":(D=e.chosenUser)==null?void 0:D.studentId,"test-name":e.testData.name,"passing-score":e.testData.passingScore,"student-name":(I=e.chosenUser)==null?void 0:I.studentEmail},null,8,["test-id","user-id","test-name","passing-score","student-name"])],64)}const Me=te(re,[["render",Ce],["__scopeId","data-v-09bf35d5"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/class/exam-result.vue"]]);export{Me as default};

import{d as te,u as ne,l as ae,q as oe,i as f,j as ie,X as se,Y as le,s as re,k as S,R,M as V,_ as de,r as q,a as k,o as Q,b as o,c as d,w as _,f as w,t as p,F,D as ue,E as z,N as ce}from"./index-DhrrK0Mu.js";import{A as O}from"./ApiQuestionSet-CCKPOHyK.js";import{Q as y}from"./questionTypes-CS3lcRlq.js";import{T as me}from"./TransferQuestionData-BxcXdBjq.js";import{V as pe}from"./Validator-CWeiTIFe.js";import{I as ge}from"./Input-BvI-y3AG.js";import{T as fe}from"./TextArea-CfE5AIa4.js";import{S as _e,O as ve,M as he,a as Se,s as Qe,b as be}from"./vue-virtual-scroller.esm-CYTKZvaH.js";import{G as Ie,I as qe}from"./GenerateQSModal-v77-P2ko.js";/* empty css                                                                 */import"./vue-draggable-plus-CN4f4UR9.js";import"./ApiTestTemplate-C2cUjulG.js";import"./languages-DtYW231W.js";const we=te({__name:"update",setup(m,{expose:i}){i();const{t:l}=ne(),e=ae(),M=oe(),T=f(!1),v=f(M.params.id),h=f({id:"",name:"",description:"",tags:[]}),b=f([]),g=f(!0),U=async()=>{if(T.value=!0,!pe.isValidGuid(v.value)){g.value=!1,e.push({name:"404"});return}let t=await O.GetDetailById(v.value),a=await O.GetQuestionById(v.value);if(!t.data.success||!a.data.success){g.value=!1,e.push({name:"404"});return}h.value=t.data.data,b.value=a.data.data,n.name=h.value.name,n.description=h.value.description,n.createUpdateQuestions=b.value.map(c=>me.transformResponseToRequest(c)),n.tags=h.value.tags.map(c=>c.name),T.value=!1,window.addEventListener("beforeunload",C)},u=f(),n=ie({name:"",description:"",createUpdateQuestions:[],deleteQuestionIds:[],tags:[]}),D={title:[{required:"true",message:"This field is required",trigger:"change"},{length:100,message:"Limit 100",trigger:"change"}],description:[{length:200,message:"Limit 200",trigger:"change"}],tags:[{validator:(t,a)=>a&&a.length>5?Promise.reject("You can only add up to 5 tags."):Promise.resolve(),trigger:"change"}],questions:[{validator:(t,a)=>a&&a.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},N={MultipleChoice:Se,Matching:he,Ordering:ve,ShortText:_e},L=()=>({id:`new_${Date.now().toString()}`,type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),j=()=>{if(n.createUpdateQuestions.length>=500){S.warning(l("maximum_tag.limit_question",{number:500}));return}n.createUpdateQuestions=[...n.createUpdateQuestions,L()],R(()=>{var t,a;(a=(t=x.value)==null?void 0:t.forceUpdate)==null||a.call(t),R(()=>{const c=n.createUpdateQuestions.length;requestAnimationFrame(()=>{var A;(A=x.value)==null||A.scrollToItem(c)})})})},H=t=>{if(n.createUpdateQuestions.length<=1){S.warning(l("maximum_tag.minimum_question",{number:1}));return}const a=n.createUpdateQuestions[t].id;!a.startsWith("new_")&&a&&n.deleteQuestionIds.push(a),n.createUpdateQuestions=[...n.createUpdateQuestions.slice(0,t),...n.createUpdateQuestions.slice(t+1)]},Y=()=>{let t=!1,a=l("message.invalid_question"),c=new Set;if(n.name.trim().length>100||n.name.trim().length===0){t=!0,a=l("message.invalid_title"),S.error(a);return}if(n.description.trim().length>250){t=!0,a=l("message.invalid_description"),S.error(a);return}[n.createUpdateQuestions.filter(s=>{const r=s.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return r.length===0||r.length>=500}),n.createUpdateQuestions.filter(s=>(s.explainText?s.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),n.createUpdateQuestions.filter(s=>s.type===y.MULTIPLE_CHOICE&&(s.multipleChoices.some(r=>r.text.trim().length===0||r.text.trim().length>500)||s.multipleChoices.filter(r=>r.isAnswer).length===0)),n.createUpdateQuestions.filter(s=>s.type===y.MATCHING&&(s.matchingPairs.some(r=>r.leftItem.trim().length===0||r.leftItem.trim().length>500)||s.matchingPairs.some(r=>r.rightItem.trim().length===0||r.rightItem.trim().length>500))),n.createUpdateQuestions.filter(s=>s.type===y.ORDERING&&s.orderingItems.some(r=>r.text.trim().length===0||r.text.trim().length>500)),n.createUpdateQuestions.filter(s=>s.type===y.SHORT_TEXT&&(s.shortAnswer.trim().length===0||s.shortAnswer.trim().length>500))].forEach(s=>{s.length>0&&(t=!0,s.forEach(r=>c.add(r)))});let ee=Array.from(c).map(s=>n.createUpdateQuestions.indexOf(s)+1);t?V.error({title:l("create_QS.modal.invalid.title"),content:l("create_QS.modal.invalid.content")+ee.sort().join(", "),okText:l("sidebar.buttons.ok"),cancelText:l("sidebar.buttons.cancel")}):E()},E=()=>{V.confirm({title:l("update_QS.modal.valid.title"),content:l("create_QS.modal.valid.content"),okText:l("sidebar.buttons.ok"),cancelText:l("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{let t=await O.Update(v.value,{...n,createUpdateQuestions:n.createUpdateQuestions.map(a=>({...a,questionId:a.id.startsWith("new_")?null:a.id,id:a.id.startsWith("new_")?null:a.id}))});t.data.success&&(S.success(l("message.updated_successfully")),e.push({name:"User_QuestionSet_Detail",params:{id:t.data.data}}))}})},I=f(""),W=()=>{if(n.tags.length>=5){S.warning("Limit : 5 tags");return}I.value&&I.value.trim().length<=50?(n.tags.push(I.value),I.value=""):S.warning("Invalid tag content")},X=t=>{n.tags.splice(t,1)},G=f(null),J=()=>{var t;(t=G.value)==null||t.openImportModal()},P=f(null),K=()=>{var t;(t=P.value)==null||t.openGenerateAIModal()},Z=t=>{n.createUpdateQuestions.push(...t.map((a,c)=>({...a,id:`new_${n.createUpdateQuestions.length+c}`}))),S.success(`Imported ${t.length} questions`)};function C(t){t.preventDefault(),t.returnValue=""}se((t,a,c)=>{if(!g.value){c();return}V.confirm({title:l("create_QS.modal.leave.title"),content:l("create_QS.modal.leave.content"),okText:l("sidebar.buttons.ok"),cancelText:l("sidebar.buttons.cancel"),onOk:()=>{c()},onCancel:()=>c(!1)})}),le(()=>{window.removeEventListener("beforeunload",C)});const x=f(null),$=()=>{R(()=>{var t,a;(a=(t=x.value)==null?void 0:t.forceUpdate)==null||a.call(t)})};re(async()=>{await U()});const B={t:l,router:e,route:M,loading:T,questionSetId:v,questionSetDetail:h,questionSetQuestions:b,isDataValid:g,getTestTemplate:U,formRef:u,formState:n,rules:D,componentMap:N,createQuestionTemplate:L,onAddQuestion:j,onRemoveQuestion:H,onFinish:Y,showModalConfirmation:E,tagContent:I,addTag:W,removeTag:X,importModalRef:G,onOpenImportModal:J,generateModalRef:P,openGenerateAIModal:K,onModalImport:Z,handleBeforeUnload:C,scrollerRef:x,handleScroll:$,Input:ge,TextArea:fe,ImportQSModal:qe,GenerateQSModal:Ie,get DynamicScroller(){return be},get DynamicScrollerItem(){return Qe}};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),Te={class:"page-container"},Ue={class:"title-container"},xe={class:"content"},ke={class:"content-item"},ye={class:"content-item-title"},Me={class:"d-flex"},De={class:"form-item"},Ce={class:"tag-container"},Ae=["onClick"],Re={class:"tag-inputter"},Ve={class:"content-item"},ze={class:"content-item-title"},Oe={class:"content-item-buttons"},Le={class:"import-button"},Ee={key:0};function Ge(m,i,l,e,M,T){const v=q("RouterLink"),h=q("a-col"),b=q("a-row"),g=q("a-skeleton"),U=q("a-form");return Q(),k(F,null,[o("div",Te,[o("div",Ue,[d(b,{class:"w-100 d-flex align-items-center"},{default:_(()=>[d(h,{span:1},{default:_(()=>[d(v,{to:{name:"User_Library"}},{default:_(()=>i[4]||(i[4]=[o("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[4]})]),_:1}),d(h,{class:"main-title",span:23},{default:_(()=>[o("span",null,p(m.$t("create_QS.title")),1),i[5]||(i[5]=w()),i[6]||(i[6]=o("br",null,null,-1)),o("span",null,p(m.$t("create_QS.sub_title")),1)]),_:1,__:[5,6]})]),_:1})]),o("div",xe,[d(U,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":i[3]||(i[3]=u=>e.formState=u),rules:e.rules,ref:"formRef"},{default:_(()=>[o("div",ke,[o("div",ye,[o("div",null,[o("span",null,p(m.$t("create_QS.quiz.question_detail_title")),1),o("span",null,p(m.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":i[0]||(i[0]=u=>e.formState.name=u),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),o("div",Me,[d(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":i[1]||(i[1]=u=>e.formState.description=u),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"]),o("div",De,[o("label",null,p(m.$t("create_QS.quiz.tag")),1),o("div",Ce,[(Q(!0),k(F,null,ue(e.formState.tags,(u,n)=>(Q(),k("div",{class:"tag-item",key:n},[w(p(u)+" ",1),o("i",{class:"bx bx-x",onClick:D=>e.removeTag(n)},null,8,Ae)]))),128))]),o("div",Re,[d(e.Input,{modelValue:e.tagContent,"onUpdate:modelValue":i[2]||(i[2]=u=>e.tagContent=u),placeholder:e.t("question_sets_index.search_placeholder"),"max-length":50},{icon:_(()=>i[7]||(i[7]=[o("i",{class:"bx bx-purchase-tag-alt"},null,-1)])),_:1},8,["modelValue","placeholder"]),o("i",{class:"bx bx-plus tag-inputter-button",onClick:e.addTag})])])])]),o("div",Ve,[o("div",ze,[o("div",null,[o("span",null,p(m.$t("create_QS.quiz.question_question_title")),1),o("span",null,p(m.$t("create_QS.quiz.question_question_sub_title")),1)]),o("div",Oe,[d(v,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:_(()=>[w(p(m.$t("create_QS.buttons.import"))+" ",1),i[8]||(i[8]=o("i",{class:"bx bx-download"},null,-1))]),_:1,__:[8]}),d(v,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:_(()=>[w(p(m.$t("create_QS.buttons.generated_by_ai"))+" ",1),i[9]||(i[9]=o("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[9]}),o("div",{class:"import-button",onClick:e.onFinish},p(m.$t("update_QS.buttons.update")),1),o("div",Le,p(m.$t("create_QS.quiz.total",{number:e.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1)])]),e.loading?(Q(),k("div",Ee,[d(g,{loading:e.loading,active:""},null,8,["loading"]),d(g,{loading:e.loading,active:""},null,8,["loading"]),d(g,{loading:e.loading,active:""},null,8,["loading"]),d(g,{loading:e.loading,active:""},null,8,["loading"]),d(g,{loading:e.loading,active:""},null,8,["loading"])])):(Q(),z(e.DynamicScroller,{key:1,ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.createUpdateQuestions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:_(({item:u,index:n})=>[(Q(),z(e.DynamicScrollerItem,{item:u,key:u.id},{default:_(()=>[(Q(),z(ce(e.componentMap[u.type]),{question:u,index:n+1,displayScore:!1,onDeleteQuestion:D=>e.onRemoveQuestion(n)},null,40,["question","index","onDeleteQuestion"]))]),_:2},1032,["item"]))]),_:1},8,["items"])),o("div",{class:"add-question-btn",onClick:e.onAddQuestion},[i[10]||(i[10]=o("i",{class:"bx bx-plus"},null,-1)),w(" "+p(m.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),d(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,"number-of-question":e.formState.createUpdateQuestions.length,onImport:e.onModalImport},null,8,["title","number-of-question"]),d(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport,"number-of-question":e.formState.createUpdateQuestions.length},null,8,["title","number-of-question"])],64)}const et=de(we,[["render",Ge],["__scopeId","data-v-ef9cef6a"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/question_sets/update.vue"]]);export{et as default};

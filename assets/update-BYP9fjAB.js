import{d as te,u as ne,l as ae,q as oe,i as g,j as ie,V as se,W as re,s as le,k as v,X as A,M as R,_ as de,r as q,a as y,o as S,b as a,c as l,w as f,f as w,t as m,F,E as ue,G as V,N as ce}from"./index-C2jtDg6B.js";import{A as z}from"./ApiQuestionSet-C75xoSuo.js";import{Q as M}from"./questionTypes-CS3lcRlq.js";import{T as me}from"./TransferQuestionData-Bl0XXg5D.js";import{V as pe}from"./Validator-CWeiTIFe.js";import{I as ge}from"./Input-0Otcuoto.js";import{T as fe}from"./TextArea-SkV_8IH8.js";import{S as _e,O as he,M as ve,a as Se,s as Qe,b as Ie}from"./vue-virtual-scroller.esm-D8MvBVCq.js";import{G as qe,I as we}from"./GenerateQSModal-Cbah8nW_.js";/* empty css                                                                 */import"./vue-draggable-plus-DALPiNCD.js";import"./ApiTestTemplate-Ds5LzdWO.js";const be=te({__name:"update",setup(c,{expose:i}){i();const{t:O}=ne(),e=ae(),x=oe(),b=g(!1),_=g(x.params.id),h=g({id:"",name:"",description:"",tags:[]}),Q=g([]),p=g(!0),U=async()=>{if(b.value=!0,!pe.isValidGuid(_.value)){p.value=!1,e.push({name:"404"});return}let t=await z.GetDetailById(_.value),o=await z.GetQuestionById(_.value);if(!t.data.success||!o.data.success){p.value=!1,e.push({name:"404"});return}h.value=t.data.data,Q.value=o.data.data,n.name=h.value.name,n.description=h.value.description,n.createUpdateQuestions=Q.value.map(u=>me.transformResponseToRequest(u)),n.tags=h.value.tags.map(u=>u.name),b.value=!1,window.addEventListener("beforeunload",C)},d=g(),n=ie({name:"",description:"",createUpdateQuestions:[],deleteQuestionIds:[],tags:[]}),k={title:[{required:"true",message:"This field is required",trigger:"change"},{length:100,message:"Limit 100",trigger:"change"}],description:[{length:200,message:"Limit 200",trigger:"change"}],tags:[{validator:(t,o)=>o&&o.length>5?Promise.reject("You can only add up to 5 tags."):Promise.resolve(),trigger:"change"}],questions:[{validator:(t,o)=>o&&o.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},N={MultipleChoice:Se,Matching:ve,Ordering:he,ShortText:_e},E=()=>({id:`new_${Date.now().toString()}`,type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),j=()=>{if(n.createUpdateQuestions.length>=100){v.warning("Each question set could have at most 100 questions");return}n.createUpdateQuestions=[...n.createUpdateQuestions,E()],A(()=>{var t,o;(o=(t=T.value)==null?void 0:t.forceUpdate)==null||o.call(t),A(()=>{const u=n.createUpdateQuestions.length;requestAnimationFrame(()=>{var D;(D=T.value)==null||D.scrollToItem(u)})})})},H=t=>{if(n.createUpdateQuestions.length<=1){v.warning("Each question set must have at least 1 questions");return}const o=n.createUpdateQuestions[t].id;!o.startsWith("new_")&&o&&n.deleteQuestionIds.push(o),n.createUpdateQuestions=[...n.createUpdateQuestions.slice(0,t),...n.createUpdateQuestions.slice(t+1)]},Y=()=>{let t=!1,o="Invalid question.",u=new Set;if(n.name.trim().length>100||n.name.trim().length===0){t=!0,o="Invalid title.",v.error(o);return}if(n.description.trim().length>250){t=!0,o="Invalid description.",v.error(o);return}[n.createUpdateQuestions.filter(s=>{const r=s.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return r.length===0||r.length>=500}),n.createUpdateQuestions.filter(s=>(s.explainText?s.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),n.createUpdateQuestions.filter(s=>s.type===M.MULTIPLE_CHOICE&&(s.multipleChoices.some(r=>r.text.trim().length===0||r.text.trim().length>500)||s.multipleChoices.filter(r=>r.isAnswer).length===0)),n.createUpdateQuestions.filter(s=>s.type===M.MATCHING&&(s.matchingPairs.some(r=>r.leftItem.trim().length===0||r.leftItem.trim().length>500)||s.matchingPairs.some(r=>r.rightItem.trim().length===0||r.rightItem.trim().length>500))),n.createUpdateQuestions.filter(s=>s.type===M.ORDERING&&s.orderingItems.some(r=>r.text.trim().length===0||r.text.trim().length>500)),n.createUpdateQuestions.filter(s=>s.type===M.SHORT_TEXT&&(s.shortAnswer.trim().length===0||s.shortAnswer.trim().length>500))].forEach(s=>{s.length>0&&(t=!0,s.forEach(r=>u.add(r)))});let ee=Array.from(u).map(s=>n.createUpdateQuestions.indexOf(s)+1);t?R.error({title:"Cannot create new question set!",content:"There are errors at questions: "+ee.sort().join(", ")}):L()},L=()=>{R.confirm({title:"Create new quiz!",content:"Make sure to review your contents before proceeding.",centered:!0,onOk:async()=>{n.createUpdateQuestions=n.createUpdateQuestions.map(o=>o.id.startsWith("new_")?{...o,id:""}:o);let t=await z.Update(_.value,n);t.data.success&&v.success(t.data.data)}})},I=g(""),W=()=>{if(n.tags.length>=5){v.warning("Limit : 5 tags");return}I.value&&I.value.trim().length<=50?(n.tags.push(I.value),I.value=""):v.warning("Invalid tag content")},X=t=>{n.tags.splice(t,1)},G=g(null),J=()=>{var t;(t=G.value)==null||t.openImportModal()},P=g(null),K=()=>{var t;(t=P.value)==null||t.openGenerateAIModal()},Z=t=>{n.createUpdateQuestions.push(...t.map((o,u)=>({...o,id:`new_${n.createUpdateQuestions.length+u}`}))),v.success(`Imported ${t.length} questions`)};function C(t){t.preventDefault(),t.returnValue=""}se((t,o,u)=>{if(!p.value){u();return}R.confirm({title:"Leave already?",content:"You have unsaved changes.",onOk:()=>{u()},onCancel:()=>u(!1)})}),re(()=>{window.removeEventListener("beforeunload",C)});const T=g(null),$=()=>{A(()=>{var t,o;(o=(t=T.value)==null?void 0:t.forceUpdate)==null||o.call(t)})};le(async()=>{await U()});const B={t:O,router:e,route:x,loading:b,questionSetId:_,questionSetDetail:h,questionSetQuestions:Q,isDataValid:p,getTestTemplate:U,formRef:d,formState:n,rules:k,componentMap:N,createQuestionTemplate:E,onAddQuestion:j,onRemoveQuestion:H,onFinish:Y,showModalConfirmation:L,tagContent:I,addTag:W,removeTag:X,importModalRef:G,onOpenImportModal:J,generateModalRef:P,openGenerateAIModal:K,onModalImport:Z,handleBeforeUnload:C,scrollerRef:T,handleScroll:$,Input:ge,TextArea:fe,ImportQSModal:we,GenerateQSModal:qe,get DynamicScroller(){return Ie},get DynamicScrollerItem(){return Qe}};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),Ue={class:"page-container"},Te={class:"title-container"},ye={class:"content"},Me={class:"content-item"},xe={class:"content-item-title"},ke={class:"d-flex"},Ce={class:"form-item"},De={class:"tag-container"},Ae=["onClick"],Re={class:"tag-inputter"},Ve={class:"content-item"},ze={class:"content-item-title"},Oe={class:"content-item-buttons"},Ee={class:"import-button"},Le={key:0};function Ge(c,i,O,e,x,b){const _=q("RouterLink"),h=q("a-col"),Q=q("a-row"),p=q("a-skeleton"),U=q("a-form");return S(),y(F,null,[a("div",Ue,[a("div",Te,[l(Q,{class:"w-100 d-flex align-items-center"},{default:f(()=>[l(h,{span:1},{default:f(()=>[l(_,{to:{name:"User_Library"}},{default:f(()=>i[4]||(i[4]=[a("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[4]})]),_:1}),l(h,{class:"main-title",span:23},{default:f(()=>[a("span",null,m(c.$t("create_QS.title")),1),i[5]||(i[5]=w()),i[6]||(i[6]=a("br",null,null,-1)),a("span",null,m(c.$t("create_QS.sub_title")),1)]),_:1,__:[5,6]})]),_:1})]),a("div",ye,[l(U,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":i[3]||(i[3]=d=>e.formState=d),rules:e.rules,ref:"formRef"},{default:f(()=>[a("div",Me,[a("div",xe,[a("div",null,[a("span",null,m(c.$t("create_QS.quiz.question_detail_title")),1),a("span",null,m(c.$t("create_QS.quiz.question_detail_sub_title")),1)])]),l(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":i[0]||(i[0]=d=>e.formState.name=d),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),a("div",ke,[l(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":i[1]||(i[1]=d=>e.formState.description=d),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"]),a("div",Ce,[a("label",null,m(c.$t("create_QS.quiz.tag")),1),a("div",De,[(S(!0),y(F,null,ue(e.formState.tags,(d,n)=>(S(),y("div",{class:"tag-item",key:n},[w(m(d)+" ",1),a("i",{class:"bx bx-x",onClick:k=>e.removeTag(n)},null,8,Ae)]))),128))]),a("div",Re,[l(e.Input,{modelValue:e.tagContent,"onUpdate:modelValue":i[2]||(i[2]=d=>e.tagContent=d),placeholder:e.t("question_sets_index.search_placeholder"),"max-length":50},{icon:f(()=>i[7]||(i[7]=[a("i",{class:"bx bx-purchase-tag-alt"},null,-1)])),_:1},8,["modelValue","placeholder"]),a("i",{class:"bx bx-plus tag-inputter-button",onClick:e.addTag})])])])]),a("div",Ve,[a("div",ze,[a("div",null,[a("span",null,m(c.$t("create_QS.quiz.question_question_title")),1),a("span",null,m(c.$t("create_QS.quiz.question_question_sub_title")),1)]),a("div",Oe,[l(_,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:f(()=>[w(m(c.$t("create_QS.buttons.import"))+" ",1),i[8]||(i[8]=a("i",{class:"bx bx-download"},null,-1))]),_:1,__:[8]}),l(_,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:f(()=>[w(m(c.$t("create_QS.buttons.generated_by_ai"))+" ",1),i[9]||(i[9]=a("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[9]}),a("div",{class:"import-button",onClick:e.onFinish},m(c.$t("create_QS.buttons.create")),1),a("div",Ee,m(c.$t("create_QS.quiz.total",{number:e.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1)])]),e.loading?(S(),y("div",Le,[l(p,{loading:e.loading,active:""},null,8,["loading"]),l(p,{loading:e.loading,active:""},null,8,["loading"]),l(p,{loading:e.loading,active:""},null,8,["loading"]),l(p,{loading:e.loading,active:""},null,8,["loading"]),l(p,{loading:e.loading,active:""},null,8,["loading"])])):(S(),V(e.DynamicScroller,{key:1,ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.createUpdateQuestions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:f(({item:d,index:n})=>[(S(),V(e.DynamicScrollerItem,{item:d,key:d.id},{default:f(()=>[(S(),V(ce(e.componentMap[d.type]),{question:d,index:n+1,displayScore:!1,onDeleteQuestion:k=>e.onRemoveQuestion(n)},null,40,["question","index","onDeleteQuestion"]))]),_:2},1032,["item"]))]),_:1},8,["items"])),a("div",{class:"add-question-btn",onClick:e.onAddQuestion},[i[10]||(i[10]=a("i",{class:"bx bx-plus"},null,-1)),w(" "+m(c.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),l(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,onImport:e.onModalImport},null,8,["title"]),l(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport},null,8,["title"])],64)}const $e=de(be,[["render",Ge],["__scopeId","data-v-ef9cef6a"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/question_sets/update.vue"]]);export{$e as default};

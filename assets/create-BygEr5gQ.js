import{d as ie,u as ce,q as de,l as me,i as d,j as ue,X as fe,Y as pe,s as Te,k as q,R as h,M as z,_ as ge,r as b,a as _e,o as L,b as l,c as i,w as f,t as g,f as U,E as W,N as he,F as ve}from"./index-BCUxjaAq.js";import{A as Se}from"./ApiClass-CUxIB31K.js";import{A as Me}from"./ApiTest-CpKx_L9J.js";import{Q as x}from"./questionTypes-CS3lcRlq.js";import{T as we,a as qe,C as be,b as Ie,c as Re,d as Ce,S as ke}from"./ChooseQuestionModal-CvyxCMdy.js";import{S as De,O as Ae,M as Fe,a as xe,s as ye,b as Qe}from"./vue-virtual-scroller.esm-BCgYN7K7.js";import{T as Oe}from"./TransferQuestionData-BxcXdBjq.js";import{V as Ee}from"./Validator-CWeiTIFe.js";import"./Input-DiOVXk72.js";import"./utc-DCpXwuO2.js";import"./ApiFolder-CXuDzAPP.js";import"./folderShareMode-BudLQ2R2.js";import"./ApiTestTemplate-m_Y76s3J.js";import"./TextArea-B3IciHWP.js";/* empty css                                                                 */import"./vue-draggable-plus-DDQDMlok.js";const Be=ie({__name:"create",setup(u,{expose:p}){p();const H={MultipleChoice:xe,Matching:Fe,Ordering:Ae,ShortText:De},{t:e}=ce(),y=de(),S=me(),T=d(!0),M=d(),I=async()=>{if(!Ee.isValidGuid(o.classId)){T.value=!1,S.push({name:"404"});return}const t=await Se.GetById(o.classId);if(!t.data.success){T.value=!1,S.push({name:"404"});return}M.value=t.data.data},R=d(),o=ue({name:"",classId:y.params.id.toString()||"",timeLimit:60,startTime:"",endTime:"",gradeAttemptMethod:qe.HIGHEST_SCORE,gradeQuestionMethod:we.PARTIAL,isShowCorrectAnswerInReview:!0,isAllowReviewAfterSubmit:!0,shuffle:2,maxAttempt:2,passingScore:50,questions:[]}),C={title:[{required:"true",message:e("message.required"),trigger:"change"},{length:100,message:e("message.limit",{limit:100}),trigger:"change"}],description:[{length:200,message:e("message.limit",{limit:200}),trigger:"change"}],tags:[{validator:(t,s)=>s&&s.length>5?Promise.reject(e("message.maximum_tag.out_of_range",{tag:5})):Promise.resolve(),trigger:"change"}],questions:[{validator:(t,s)=>s&&s.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},c=()=>({id:Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),k=()=>{if(o.questions.length>=100){q.warning(e("message.limit_question",{number:100}));return}o.questions=[...o.questions,c()],h(()=>{var t,s;(s=(t=v.value)==null?void 0:t.forceUpdate)==null||s.call(t),h(()=>{const r=o.questions.length;requestAnimationFrame(()=>{var m;(m=v.value)==null||m.scrollToItem(r)})})})},N=t=>{if(o.questions.length<=1){q.warning(e("message.minimum_question",{number:1}));return}o.questions=[...o.questions.slice(0,t),...o.questions.slice(t+1)]},Z=async()=>{var F;await((F=R.value)==null?void 0:F.validate());let t=!1,s=e("message.invalid_question"),r=new Set;if(o.name.trim().length>100||o.name.trim().length===0){t=!0,s=e("message.invalid_title"),q.error(s),Q();return}[o.questions.filter(n=>{const a=n.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return a.length===0||a.length>=500}),o.questions.filter(n=>(n.explainText?n.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),o.questions.filter(n=>n.type===x.MULTIPLE_CHOICE&&(n.multipleChoices.some(a=>a.text.trim().length===0||a.text.trim().length>500)||n.multipleChoices.filter(a=>a.isAnswer).length===0)),o.questions.filter(n=>n.type===x.MATCHING&&(n.matchingPairs.some(a=>a.leftItem.trim().length===0||a.leftItem.trim().length>500)||n.matchingPairs.some(a=>a.rightItem.trim().length===0||a.rightItem.trim().length>500))),o.questions.filter(n=>n.type===x.ORDERING&&n.orderingItems.some(a=>a.text.trim().length===0||a.text.trim().length>500)),o.questions.filter(n=>n.type===x.SHORT_TEXT&&(n.shortAnswer.trim().length===0||n.shortAnswer.trim().length>500))].forEach(n=>{n.length>0&&(t=!0,n.forEach(a=>r.add(a)))});let A=Array.from(r).map(n=>o.questions.indexOf(n)+1);t?z.error({title:e("create_QS.modal.invalid.title"),content:e("create_QS.modal.invalid.content")+A.sort().join(", "),okText:e("sidebar.buttons.ok"),cancelText:e("sidebar.buttons.cancel")}):V()},V=()=>{z.confirm({title:e("create_QS.modal.valid.title"),content:e("create_QS.modal.valid.content"),okText:e("sidebar.buttons.ok"),cancelText:e("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{(await Me.Create(o)).data.success&&(T.value=!1,q.success(e("message.created_successfully")),S.push({name:"User_Class_Exam",params:{id:o.classId}}))}})},G=d(null),Q=()=>{var t;(t=G.value)==null||t.openTestSettingModal()},w=d(null),O=()=>{var t;(t=w.value)==null||t.openModal()},$=()=>{var t;_.value=null,(t=w.value)==null||t.closeModal(),B()},ee=t=>{var s;_.value=t,(s=w.value)==null||s.closeModal(),E()},_=d(null),j=d(""),Y=d(null),E=()=>{var t;(t=Y.value)==null||t.openModal()},te=()=>{_.value=null,O()},D=d(null),B=()=>{var t;(t=D.value)==null||t.openModal()},oe=()=>{var t;_.value=null,(t=D.value)==null||t.closeModal(),O()},ne=async(t,s)=>{var r;j.value=t,(r=D.value)==null||r.closeModal(),_.value=s,await h(),J()},X=d(null),J=()=>{var t;(t=X.value)==null||t.openModal()},se=async t=>{_.value=t,await h(),E()},ae=()=>{B()},le=t=>{var r;const s=t.map(m=>Oe.transformResponseToRequest(m));(r=w.value)==null||r.closeModal(),o.questions=[...o.questions,...s],h(()=>{var m,A;(A=(m=v.value)==null?void 0:m.forceUpdate)==null||A.call(m),h(()=>{const F=o.questions.length;requestAnimationFrame(()=>{var n;(n=v.value)==null||n.scrollToItem(F)})})}),q.success(`${e("message.imported_question",{number:t.length})}`)};fe((t,s,r)=>{if(!T.value){r();return}z.confirm({title:e("create_QS.modal.leave.title"),content:e("create_QS.modal.leave.content"),okText:e("sidebar.buttons.ok"),cancelText:e("sidebar.buttons.cancel"),onOk:()=>{r()},onCancel:()=>r(!1)})});function P(t){t.preventDefault(),t.returnValue=""}pe(()=>{window.removeEventListener("beforeunload",P)});const v=d(null),re=()=>{h(()=>{var t,s;(s=(t=v.value)==null?void 0:t.forceUpdate)==null||s.call(t)})};Te(()=>{I(),o.questions.push(c()),window.addEventListener("beforeunload",P),Q()});const K={componentMap:H,t:e,route:y,router:S,isDataValid:T,classData:M,getClassData:I,formRef:R,formState:o,rules:C,createQuestionTemplate:c,onAddQuestion:k,onRemoveQuestion:N,onFinish:Z,showModalConfirmation:V,settingModalRef:G,openSettingModal:Q,folderModalRef:w,openFolderModal:O,onSwitchToTestTemplate:$,onOpenFolder:ee,chosenFolder:_,chosenTestTemplateId:j,folderTestTemplateModalRef:Y,openFolderTestTemplateModal:E,onBackToFolderModal:te,testTemplateModalRef:D,openTestTemplateModal:B,onSwitchToFolder:oe,onOpenTestTemplate:ne,questionModalRef:X,openQuestionModal:J,onBackToFolderTestTemplate:se,onBackToTestTemplate:ae,onModalImport:le,handleBeforeUnload:P,scrollerRef:v,handleScroll:re,SettingTestModal:ke,ChooseFolderModal:Ce,ChooseFolderTestTemplateModal:Re,ChooseTestTemplateModal:Ie,ChooseQuestionModal:be,get DynamicScroller(){return Qe},get DynamicScrollerItem(){return ye}};return Object.defineProperty(K,"__isScriptSetup",{enumerable:!1,value:!0}),K}}),Pe={class:"page-container"},ze={class:"title-container"},Le={class:"content"},Ue={class:"content-item"},He={class:"content-item-title"},Ne={class:"content-item-buttons"},Ve={class:"import-button"};function Ge(u,p,H,e,y,S){var C;const T=b("RouterLink"),M=b("a-col"),I=b("a-row"),R=b("a-button"),o=b("a-form");return L(),_e(ve,null,[l("div",Pe,[l("div",ze,[i(I,{class:"w-100 d-flex align-items-center"},{default:f(()=>[i(M,{span:1},{default:f(()=>[i(T,{to:{name:""},onClick:e.openSettingModal},{default:f(()=>p[0]||(p[0]=[l("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[0]})]),_:1}),i(M,{class:"main-title",span:23},{default:f(()=>{var c;return[l("span",null,g(u.$t("assign_test.title",{class_name:(c=e.classData)==null?void 0:c.name})),1),p[1]||(p[1]=l("br",null,null,-1)),l("span",null,g(u.$t("assign_test.sub_title")),1)]}),_:1,__:[1]})]),_:1})]),l("div",Le,[i(o,{layout:"vertical",model:e.formState,rules:e.rules,ref:"formRef"},{default:f(()=>[l("div",Ue,[l("div",He,[l("div",null,[l("span",null,g(u.$t("assign_test.test_question.title")),1),l("span",null,g(u.$t("assign_test.test_question.sub_title")),1)]),l("div",Ne,[i(T,{class:"import-button",to:{name:""},onClick:e.openFolderModal},{default:f(()=>[U(g(u.$t("assign_test.buttons.choose_from_folder")),1)]),_:1}),l("div",Ve,g(u.$t("create_QS.quiz.total",{number:e.formState.questions.length.toString().padStart(3,"0")})),1),i(R,{type:"primary",class:"main-color-btn",size:"large",onClick:e.onFinish},{default:f(()=>[U(g(u.$t("assign_test.buttons.next")),1)]),_:1})])]),i(e.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.questions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:f(({item:c,index:k})=>[(L(),W(e.DynamicScrollerItem,{item:c,key:c.id},{default:f(()=>[(L(),W(he(e.componentMap[c.type]),{question:c,index:k+1,displayScore:!1,onDeleteQuestion:N=>e.onRemoveQuestion(k)},null,40,["question","index","onDeleteQuestion"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),l("div",{class:"add-question-btn",onClick:e.onAddQuestion},[p[2]||(p[2]=l("i",{class:"bx bx-plus"},null,-1)),U(" "+g(u.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["model"])])]),i(e.SettingTestModal,{ref:"settingModalRef","form-ref":e.formRef,"class-name":(C=e.classData)==null?void 0:C.name,"form-state":e.formState},null,8,["form-ref","class-name","form-state"]),i(e.ChooseFolderModal,{ref:"folderModalRef",onSwitchToTestTemplate:e.onSwitchToTestTemplate,onOpenFolder:e.onOpenFolder},null,512),i(e.ChooseFolderTestTemplateModal,{ref:"folderTestTemplateModalRef",folder:e.chosenFolder,onBackToFolderModal:e.onBackToFolderModal,onOpenTestTemplate:e.onOpenTestTemplate},null,8,["folder"]),i(e.ChooseTestTemplateModal,{ref:"testTemplateModalRef",onSwitchToFolder:e.onSwitchToFolder,onOpenTestTemplate:e.onOpenTestTemplate},null,512),i(e.ChooseQuestionModal,{ref:"questionModalRef","test-template-id":e.chosenTestTemplateId,folder:e.chosenFolder,onBackToFolderTestTemplateModal:e.onBackToFolderTestTemplate,onBackToTestTemplateModal:e.onBackToTestTemplate,onImport:e.onModalImport},null,8,["test-template-id","folder"])],64)}const it=ge(Be,[["render",Ge],["__scopeId","data-v-501cc219"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test/create.vue"]]);export{it as default};

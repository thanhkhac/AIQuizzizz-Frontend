import{d as j,u as J,i as S,j as X,X as Y,s as K,Y as Z,k as f,R as w,M as O,_ as $,r as y,a as D,o as I,b as n,c as m,w as p,f as T,t as u,F as E,D as ee,E as H,N as te}from"./index-BCUxjaAq.js";import{A as ne}from"./ApiQuestionSet-KXdPi0X5.js";import{I as oe}from"./Input-DiOVXk72.js";import{T as ie}from"./TextArea-B3IciHWP.js";import{S as re,O as ae,M as se,a as le,s as ce,b as de}from"./vue-virtual-scroller.esm-BCgYN7K7.js";import{G as me,I as ue}from"./GenerateQSModal-DMTLu139.js";import{Q}from"./questionTypes-CS3lcRlq.js";/* empty css                                                                 */import"./vue-draggable-plus-DDQDMlok.js";import"./ApiTestTemplate-m_Y76s3J.js";import"./languages-DtYW231W.js";const ge=j({__name:"create",setup(d,{expose:r}){r();const{t:i}=J(),e=S(),o=X({name:"",description:"",tags:[],questions:[]}),P={title:[{required:"true",message:i("message.required"),trigger:"change"},{length:100,message:i("message.out_of_range",{max_length:100}),trigger:"change"}],description:[{length:200,message:i("message.out_of_range",{max_length:200}),trigger:"change"}],tags:[{validator:(t,a)=>a&&a.length>5?Promise.reject(i("message.maximum_tag.out_of_range",{tag:5})):Promise.resolve(),trigger:"change"}],questions:[{validator:(t,a)=>a&&a.length>500?Promise.reject(i("message.maximum_tag.limit_question",{number:500})):Promise.resolve(),trigger:"change"}]},x={MultipleChoice:le,Matching:se,Ordering:ae,ShortText:re},b=[{id:"q1",type:"MultipleChoice",questionText:"What is the capital of France ?",questionHTML:"<p><strong>What</strong> is <br/> the <em>capital</em> of <u>France</u>? <code>// geography</code></p>",explainText:"Paris is the capital city of France.",score:10,multipleChoices:[{id:"1",text:"Paris",isAnswer:!0},{id:"2",text:"London",isAnswer:!1},{id:"3",text:"Berlin",isAnswer:!1}],matchingPairs:[],orderingItems:[],shortAnswer:""},{id:"q2",type:"Matching",questionText:"Match the countries to their capitals.",questionHTML:"<p><u>Match</u> the <strong>countries</strong> to their <em>capitals</em>. <code>// matching task</code></p>",explainText:"Each country must be paired with its capital.",score:10,multipleChoices:[],matchingPairs:[{id:"1",leftItem:"Japan",rightItem:"Tokyo"},{id:"2",leftItem:"Italy",rightItem:"Rome"},{id:"3",leftItem:"Vietnam",rightItem:"Hanoi"}],orderingItems:[],shortAnswer:""},{id:"q3",type:"Ordering",questionText:"Arrange the steps of the water cycle in the correct order.",questionHTML:"<p><strong>Arrange</strong> the steps of the <u>water cycle</u> in the <em>correct order</em>. <code>// science</code></p>",explainText:"The correct order is: Evaporation → Condensation → Precipitation → Collection.",score:10,multipleChoices:[],matchingPairs:[],orderingItems:[{id:"1",text:"Evaporation",correctOrder:0},{id:"2",text:"Condensation",correctOrder:1},{id:"3",text:"Precipitation",correctOrder:2},{id:"4",text:"Collection",correctOrder:3}],shortAnswer:""},{id:"q4",type:"ShortText",questionText:"What is the chemical symbol for water?",questionHTML:"<p><em>What</em> is the chemical <strong>symbol</strong> for <u>water</u>? <code>H2O</code></p>",explainText:"H2O is the formula for water.",score:10,multipleChoices:[],matchingPairs:[],orderingItems:[],shortAnswer:"H2O"},{id:"q5",type:"MultipleChoice",questionText:"Which planet is known as the Red Planet?",questionHTML:"<p>Which <strong>planet</strong> is known as the <em>Red Planet</em>? <u>Mars</u> <pre><code>// astronomy</code></pre></p>",explainText:"Mars is often called the Red Planet due to its reddish appearance.",score:10,multipleChoices:[{id:"1",text:"Mars",isAnswer:!0},{id:"2",text:"Venus",isAnswer:!1},{id:"3",text:"Jupiter",isAnswer:!1}],matchingPairs:[],orderingItems:[],shortAnswer:""}],_=S(""),A=()=>{if(o.tags.length>=5){f.warning(i("maximum_tag.out_of_range",{tag:5}));return}_.value&&_.value.trim().length<=50?(o.tags.push(_.value),_.value=""):f.warning(i("maximum_tag.invalid_tag_content"))},c=t=>{o.tags.splice(t,1)},h=()=>({id:Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),C=async()=>{if(o.questions.length>=500){f.warning(i("message.limit_question",{number:500}));return}o.questions=[...o.questions,h()],w(()=>{var t,a;(a=(t=q.value)==null?void 0:t.forceUpdate)==null||a.call(t),w(()=>{const g=o.questions.length;requestAnimationFrame(()=>{var v;(v=q.value)==null||v.scrollToItem(g)})})})},U=t=>{if(o.questions.length<=1){f.warning(i("message.minimum_question",{number:1}));return}o.questions=[...o.questions.slice(0,t),...o.questions.slice(t+1)]},F=()=>{let t=!1,a=i("message.invalid_question"),g=new Set;if(o.name.trim().length>100||o.name.trim().length===0){t=!0,a=i("message.invalid_title"),f.error(a);return}if(o.description.trim().length>250){t=!0,a=i("message.invalid_description"),f.error(a);return}[o.questions.filter(s=>{const l=s.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return l.length===0||l.length>=500}),o.questions.filter(s=>(s.explainText?s.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),o.questions.filter(s=>s.type===Q.MULTIPLE_CHOICE&&(s.multipleChoices.some(l=>l.text.trim().length===0||l.text.trim().length>500)||s.multipleChoices.filter(l=>l.isAnswer).length===0)),o.questions.filter(s=>s.type===Q.MATCHING&&(s.matchingPairs.some(l=>l.leftItem.trim().length===0||l.leftItem.trim().length>500)||s.matchingPairs.some(l=>l.rightItem.trim().length===0||l.rightItem.trim().length>500))),o.questions.filter(s=>s.type===Q.ORDERING&&s.orderingItems.some(l=>l.text.trim().length===0||l.text.trim().length>500)),o.questions.filter(s=>s.type===Q.SHORT_TEXT&&(s.shortAnswer.trim().length===0||s.shortAnswer.trim().length>500))].forEach(s=>{s.length>0&&(t=!0,s.forEach(l=>g.add(l)))});let M=Array.from(g).map(s=>o.questions.indexOf(s)+1);t?O.error({title:i("create_QS.modal.invalid.title"),content:i("create_QS.modal.invalid.content")+M.sort().join(", "),okText:i("sidebar.buttons.ok"),cancelText:i("sidebar.buttons.cancel")}):R()},R=()=>{O.confirm({title:i("create_QS.Modal.confirmvalid.title"),content:i("create_QS.modal.valid.content"),centered:!0,okText:i("sidebar.buttons.ok"),cancelText:i("sidebar.buttons.cancel"),onOk:async()=>{let t=await ne.Create(o);t.data.success&&f.success(t.data.data)}})},V=S(null),G=()=>{var t;(t=V.value)==null||t.openImportModal()},z=S(null),B=()=>{var t;(t=z.value)==null||t.openGenerateAIModal()},N=t=>{t.length!==0&&(o.questions.push(...t.map((a,g)=>({...a,id:`new_${o.questions.length+g}`}))),w(()=>{var a,g;(g=(a=q.value)==null?void 0:a.forceUpdate)==null||g.call(a),w(()=>{const v=o.questions.length;requestAnimationFrame(()=>{var M;(M=q.value)==null||M.scrollToItem(v)})})}),f.success(`${i("message.imported_question",{number:t.length})}`))};Y((t,a,g)=>{O.confirm({title:i("create_QS.modal.leave.title"),content:i("create_QS.modal.leave.content"),okText:i("sidebar.buttons.ok"),cancelText:i("sidebar.buttons.cancel"),onOk:()=>{g()},onCancel:()=>g(!1)})});function k(t){t.preventDefault(),t.returnValue=""}const q=S(null),W=()=>{w(()=>{var t,a;(a=(t=q.value)==null?void 0:t.forceUpdate)==null||a.call(t)})};K(()=>{o.questions.push(...b),window.addEventListener("beforeunload",k)}),Z(()=>{window.removeEventListener("beforeunload",k)});const L={t:i,formRef:e,formState:o,rules:P,componentMap:x,question_data_raw:b,tagContent:_,addTag:A,removeTag:c,createQuestionTemplate:h,onAddQuestion:C,onRemoveQuestion:U,onFinish:F,showModalConfirmation:R,importModalRef:V,onOpenImportModal:G,generateModalRef:z,openGenerateAIModal:B,onModalImport:N,handleBeforeUnload:k,scrollerRef:q,handleScroll:W,Input:oe,TextArea:ie,ImportQSModal:ue,GenerateQSModal:me,get DynamicScroller(){return de},get DynamicScrollerItem(){return ce}};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}}),pe={class:"page-container"},he={class:"title-container"},fe={class:"content"},_e={class:"content-item"},qe={class:"content-item-title"},xe={class:"d-flex"},be={class:"form-item"},ve={class:"tag-container"},Se=["onClick"],we={class:"tag-inputter"},Ie={class:"content-item"},Te={class:"content-item-title"},Me={class:"content-item-buttons"},ye={class:"import-button"};function Qe(d,r,i,e,o,P){const x=y("RouterLink"),b=y("a-col"),_=y("a-row"),A=y("a-form");return I(),D(E,null,[n("div",pe,[n("div",he,[m(_,{class:"w-100 d-flex align-items-center"},{default:p(()=>[m(b,{span:1},{default:p(()=>[m(x,{to:{name:"User_Library"}},{default:p(()=>r[4]||(r[4]=[n("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[4]})]),_:1}),m(b,{class:"main-title",span:23},{default:p(()=>[n("span",null,u(d.$t("create_QS.title")),1),r[5]||(r[5]=T()),r[6]||(r[6]=n("br",null,null,-1)),n("span",null,u(d.$t("create_QS.sub_title")),1)]),_:1,__:[5,6]})]),_:1})]),n("div",fe,[m(A,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":r[3]||(r[3]=c=>e.formState=c),rules:e.rules,ref:"formRef"},{default:p(()=>[n("div",_e,[n("div",qe,[n("div",null,[n("span",null,u(d.$t("create_QS.quiz.question_detail_title")),1),n("span",null,u(d.$t("create_QS.quiz.question_detail_sub_title")),1)])]),m(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":r[0]||(r[0]=c=>e.formState.name=c),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),n("div",xe,[m(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":r[1]||(r[1]=c=>e.formState.description=c),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"]),n("div",be,[n("label",null,u(d.$t("create_QS.quiz.tag")),1),n("div",ve,[(I(!0),D(E,null,ee(e.formState.tags,(c,h)=>(I(),D("div",{class:"tag-item",key:h},[T(u(c)+" ",1),n("i",{class:"bx bx-x",onClick:C=>e.removeTag(h)},null,8,Se)]))),128))]),n("div",we,[m(e.Input,{modelValue:e.tagContent,"onUpdate:modelValue":r[2]||(r[2]=c=>e.tagContent=c),placeholder:e.t("question_sets_index.search_placeholder"),"max-length":50},{icon:p(()=>r[7]||(r[7]=[n("i",{class:"bx bx-purchase-tag-alt"},null,-1)])),_:1},8,["modelValue","placeholder"]),n("i",{class:"bx bx-plus tag-inputter-button",onClick:e.addTag})])])])]),n("div",Ie,[n("div",Te,[n("div",null,[n("span",null,u(d.$t("create_QS.quiz.question_question_title")),1),n("span",null,u(d.$t("create_QS.quiz.question_question_sub_title")),1)]),n("div",Me,[m(x,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:p(()=>[T(u(d.$t("create_QS.buttons.import"))+" ",1),r[8]||(r[8]=n("i",{class:"bx bx-download"},null,-1))]),_:1,__:[8]}),m(x,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:p(()=>[T(u(d.$t("create_QS.buttons.generated_by_ai"))+" ",1),r[9]||(r[9]=n("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[9]}),n("div",{class:"import-button",onClick:e.onFinish},u(d.$t("create_QS.buttons.create")),1),n("div",ye,u(d.$t("create_QS.quiz.total",{number:e.formState.questions.length.toString().padStart(3,"0")})),1)])]),m(e.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.questions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:p(({item:c,index:h})=>[(I(),H(e.DynamicScrollerItem,{item:c,key:c.id},{default:p(()=>[(I(),H(te(e.componentMap[c.type]),{question:c,index:h+1,displayScore:!1,onDeleteQuestion:C=>e.onRemoveQuestion(h)},null,40,["question","index","onDeleteQuestion"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),n("div",{class:"add-question-btn",onClick:e.onAddQuestion},[r[10]||(r[10]=n("i",{class:"bx bx-plus"},null,-1)),T(" "+u(d.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),m(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,onImport:e.onModalImport},null,8,["title"]),m(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport},null,8,["title"])],64)}const He=$(ge,[["render",Qe],["__scopeId","data-v-b7d6bbaa"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/question_sets/create.vue"]]);export{He as default};

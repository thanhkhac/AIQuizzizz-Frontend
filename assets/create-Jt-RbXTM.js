import{d as N,u as j,l as W,i as v,j as X,a2 as Y,a3 as J,s as K,k as g,G as S,M as R,_ as Z,r as M,c as $,o as z,b as i,a as d,w as p,f as C,t as f,E as P,R as ee,F as te}from"./index-DUeSh8Hp.js";import{A as ne}from"./ApiTestTemplate-DTKfadsb.js";import{I as oe}from"./Input-BDHjI2aK.js";import{T as se}from"./vue-draggable-plus-BQ8mQqOI.js";import{C as y,S as ae,O as ie,M as le,a as re,s as ue,b as me}from"./vue-virtual-scroller.esm-DTQk1Rwo.js";import{G as ce,I as de}from"./GenerateQSModal-BXEEsVoc.js";import{Q as w}from"./questionTypes-CS3lcRlq.js";/* empty css                                                              *//* empty css                                                                 */import"./ApiQuestionSet-B86nMJAB.js";import"./languages-DtYW231W.js";const fe=N({__name:"create",setup(m,{expose:r}){r();const{t:s}=j(),t=W(),I=v(!0),D=v(),n=X({name:"",description:"",questions:[]}),T={title:[{required:"true",message:s("message.required"),trigger:"change"},{length:100,message:s("message.out_of_range",{max_length:100}),trigger:"change"}],description:[{length:200,message:s("message.out_of_range",{max_length:100}),trigger:"change"}],questions:[{validator:(e,a)=>a&&a.length>500?Promise.reject(s("message.maximum_tag.limit_question",{number:500})):Promise.resolve(),trigger:"change"}]},x={MultipleChoice:re,Matching:le,Ordering:ie,ShortText:ae},h=()=>({id:"new_"+Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:y.defaultMultipleChoices(),matchingPairs:y.defaultMatchingPairs(),orderingItems:y.defaultOrderingItems(),shortAnswer:""}),c=e=>{y.onChangeQuestionType(e)},k=()=>{if(n.questions.length>=500){g.warning(s("message.limit_question",{number:500}));return}n.questions=[...n.questions,h()],S(()=>{var e,a;(a=(e=_.value)==null?void 0:e.forceUpdate)==null||a.call(e),S(()=>{const u=n.questions.length;requestAnimationFrame(()=>{var b;(b=_.value)==null||b.scrollToItem(u)})})})},q=e=>{if(n.questions.length<=1){g.warning(s("message.minimum_question",{number:1}));return}n.questions=[...n.questions.slice(0,e),...n.questions.slice(e+1)]},G=()=>{let e=!1,a=s("message.invalid_question"),u=new Set;if(n.name.trim().length>100||n.name.trim().length===0){e=!0,a=s("message.invalid_title"),g.error(a);return}if(n.description.trim().length>250){e=!0,a=s("message.invalid_description"),g.error(a);return}[n.questions.filter(o=>{const l=o.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return l.length===0||l.length>=5e3}),n.questions.filter(o=>(o.explainText?o.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=5e3),n.questions.filter(o=>o.type===w.MULTIPLE_CHOICE&&(o.multipleChoices.some(l=>l.text.trim().length===0||l.text.trim().length>1e3)||o.multipleChoices.filter(l=>l.isAnswer).length===0||o.multipleChoices.length<2)),n.questions.filter(o=>o.type===w.MATCHING&&(o.matchingPairs.some(l=>l.leftItem.trim().length===0||l.leftItem.trim().length>1e3)||o.matchingPairs.some(l=>l.rightItem.trim().length===0||l.rightItem.trim().length>1e3)||o.matchingPairs.length<2)),n.questions.filter(o=>o.type===w.ORDERING&&(o.orderingItems.some(l=>l.text.trim().length===0||l.text.trim().length>1e3)||o.orderingItems.length<2)),n.questions.filter(o=>o.type===w.SHORT_TEXT&&(o.shortAnswer.trim().length===0||o.shortAnswer.trim().length>1e3))].forEach(o=>{o.length>0&&(e=!0,o.forEach(l=>u.add(l)))});let Q=Array.from(u).map(o=>n.questions.indexOf(o)+1);e?R.error({title:s("create_QS.modal.invalid.title"),content:s("create_QS.modal.invalid.content")+Q.sort().join(", "),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel")}):O()},O=()=>{R.confirm({title:s("create_template.modal.valid.title"),content:s("create_QS.modal.valid.content"),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),centered:!0,onOk:async()=>{n.questions=n.questions.map(a=>a.id.startsWith("new_")?{...a,questionId:null}:a);let e=await ne.Create(n);e.data.success&&(g.success(s("message.created_successfully")),I.value=!1,t.push({name:"User_TestTemplate_Detail",params:{id:e.data.data}}))}})},E=v(null),F=()=>{var e;(e=E.value)==null||e.openImportModal()},U=v(null),L=()=>{var e;(e=U.value)==null||e.openGenerateAIModal()},B=e=>{n.questions.unshift(...e.map((a,u)=>({...a,id:`new_${n.questions.length+u}`}))),S(()=>{var a,u;(u=(a=_.value)==null?void 0:a.forceUpdate)==null||u.call(a),S(()=>{const b=n.questions.length;requestAnimationFrame(()=>{var Q;(Q=_.value)==null||Q.scrollToItem(b)})})}),g.success(`${s("message.imported_question",{number:e.length})}`)};Y((e,a,u)=>{if(!I.value){u();return}R.confirm({title:s("create_QS.modal.leave.title"),content:s("create_QS.modal.leave.content"),okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),onOk:()=>{u()},onCancel:()=>u(!1)})});function A(e){e.preventDefault(),e.returnValue=""}J(()=>{window.removeEventListener("beforeunload",A)});const _=v(null),H=()=>{S(()=>{var e,a;(a=(e=_.value)==null?void 0:e.forceUpdate)==null||a.call(e)})};K(()=>{n.questions.push(h()),window.addEventListener("beforeunload",A)});const V={t:s,router:t,isDataValid:I,formRef:D,formState:n,rules:T,componentMap:x,createQuestionTemplate:h,onHandleChangeQuestionType:c,onAddQuestion:k,onRemoveQuestion:q,onFinish:G,showModalConfirmation:O,importModalRef:E,onOpenImportModal:F,generateModalRef:U,openGenerateAIModal:L,onModalImport:B,handleBeforeUnload:A,scrollerRef:_,handleScroll:H,Input:oe,TextArea:se,ImportQSModal:de,GenerateQSModal:ce,get DynamicScroller(){return me},get DynamicScrollerItem(){return ue}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),pe={class:"page-container"},_e={class:"title-container"},ge={class:"content"},he={class:"content-item"},qe={class:"content-item-title"},be={class:"d-flex"},ve={class:"content-item"},Se={class:"content-item-title"},Ie={class:"content-item-buttons"},Te={class:"import-button"};function Qe(m,r,s,t,I,D){const n=M("RouterLink"),T=M("a-col"),x=M("a-row"),h=M("a-form");return z(),$(te,null,[i("div",pe,[i("div",_e,[d(x,{class:"w-100 d-flex align-items-center"},{default:p(()=>[d(T,{span:1},{default:p(()=>[d(n,{to:{name:"User_TestTemplate"}},{default:p(()=>r[2]||(r[2]=[i("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[2]})]),_:1}),d(T,{class:"main-title",span:23},{default:p(()=>[i("span",null,f(m.$t("create_template.title")),1),r[3]||(r[3]=C()),r[4]||(r[4]=i("br",null,null,-1)),i("span",null,f(m.$t("create_QS.sub_title")),1)]),_:1,__:[3,4]})]),_:1})]),i("div",ge,[d(h,{layout:"vertical",model:t.formState,rules:t.rules,ref:"formRef"},{default:p(()=>[i("div",he,[i("div",qe,[i("div",null,[i("span",null,f(m.$t("create_QS.quiz.question_detail_title")),1),i("span",null,f(m.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(t.Input,{class:"question-input-item",modelValue:t.formState.name,"onUpdate:modelValue":r[0]||(r[0]=c=>t.formState.name=c),isRequired:!0,placeholder:t.t("question_sets_index.search_placeholder"),label:t.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),i("div",be,[d(t.TextArea,{class:"question-input-item",modelValue:t.formState.description,"onUpdate:modelValue":r[1]||(r[1]=c=>t.formState.description=c),placeholder:"textarea with clear icon","max-length":250,label:t.t("create_QS.quiz.description")},null,8,["modelValue","label"])])]),i("div",ve,[i("div",Se,[i("div",null,[i("span",null,f(m.$t("create_QS.quiz.question_question_title")),1),i("span",null,f(m.$t("create_QS.quiz.question_question_sub_title")),1)]),i("div",Ie,[d(n,{onClick:t.onOpenImportModal,class:"import-button",to:{name:""}},{default:p(()=>[C(f(m.$t("create_QS.buttons.import"))+" ",1),r[5]||(r[5]=i("i",{class:"bx bx-download"},null,-1))]),_:1,__:[5]}),d(n,{onClick:t.openGenerateAIModal,class:"import-button",to:{name:""}},{default:p(()=>[C(f(m.$t("create_QS.buttons.generated_by_ai"))+" ",1),r[6]||(r[6]=i("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[6]}),i("div",{class:"import-button",onClick:t.onFinish},f(m.$t("create_QS.buttons.create")),1),i("div",Te,f(m.$t("create_QS.quiz.total",{number:t.formState.questions.length.toString().padStart(3,"0")})),1)])]),d(t.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:t.formState.questions,"min-item-size":650,buffer:800,prerender:10,onScroll:t.handleScroll},{default:p(({item:c,index:k})=>[(z(),P(t.DynamicScrollerItem,{item:c,key:c.id},{default:p(()=>[(z(),P(ee(t.componentMap[c.type]),{question:c,index:t.formState.questions.findIndex(q=>q.id===c.id)+1,displayScore:!1,onDeleteQuestion:q=>t.onRemoveQuestion(k),onChangeQuestionType:q=>t.onHandleChangeQuestionType(c)},null,40,["question","index","onDeleteQuestion","onChangeQuestionType"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),i("div",{class:"add-question-btn",onClick:t.onAddQuestion},[r[7]||(r[7]=i("i",{class:"bx bx-plus"},null,-1)),C(" "+f(m.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["model"])])]),d(t.ImportQSModal,{ref:"importModalRef",title:t.formState.name,"number-of-question":t.formState.questions.length,onImport:t.onModalImport},null,8,["title","number-of-question"]),d(t.GenerateQSModal,{ref:"generateModalRef",title:t.formState.name,onImport:t.onModalImport,"number-of-question":t.formState.questions.length},null,8,["title","number-of-question"])],64)}const Ee=Z(fe,[["render",Qe],["__scopeId","data-v-6115bf3d"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test_template/create.vue"]]);export{Ee as default};

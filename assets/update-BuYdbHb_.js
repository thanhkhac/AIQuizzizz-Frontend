import{d as J,u as K,l as Z,q as $,i as g,j as ee,Q as te,R as ne,s as oe,k as v,S as A,M as D,_ as ae,r as Q,a as L,o as w,b as a,c as l,w as p,f as T,t as u,e as re,G,N as ie,F as se}from"./index-CNC2148x.js";import{A as P}from"./ApiTestTemplate-C8M07FBO.js";import{Q as b}from"./questionTypes-CS3lcRlq.js";import{T as le}from"./TransferQuestionData-Bl0XXg5D.js";import{V as de}from"./Validator-CWeiTIFe.js";import{I as ue}from"./Input-B6AzPJuz.js";import{T as ce}from"./TextArea-Cfsh6sg3.js";import{S as me,O as pe,M as fe,a as ge,s as _e,b as he}from"./vue-virtual-scroller.esm-DlV9LOwx.js";import{G as ve,I as Qe}from"./GenerateQSModal-aBOoBjEx.js";import"./vue-draggable-plus-BepsPqA6.js";const Se=J({__name:"update",setup(d,{expose:i}){i();const{t:R}=K(),t=Z(),U=$(),S=g(!1),_=g(U.params.id),m=g({testTemplateId:"",name:"",questions:[]}),h=g(!0),f=async()=>{if(S.value=!0,!de.isValidGuid(_.value)){h.value=!1,t.push({name:"404"});return}let n=await P.GetById(_.value);if(!n.data.success){h.value=!1,t.push({name:"404"});return}m.value=n.data.data,e.name=m.value.name,e.createUpdateQuestions=m.value.questions.map(o=>le.transformResponseToRequest(o)),e.testTemplateId=m.value.testTemplateId,window.addEventListener("beforeunload",y),S.value=!1},M=g(),e=ee({testTemplateId:"",name:"",description:"",createUpdateQuestions:[],deleteQuestionIds:[]}),I={title:[{required:"true",message:"This field is required",trigger:"change"},{length:100,message:"Limit 100",trigger:"change"}],description:[{length:200,message:"Limit 200",trigger:"change"}],tags:[{validator:(n,o)=>o&&o.length>5?Promise.reject("You can only add up to 5 tags."):Promise.resolve(),trigger:"change"}],questions:[{validator:(n,o)=>o&&o.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},k={MultipleChoice:ge,Matching:fe,Ordering:pe,ShortText:me},C=()=>({id:"",type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),N=()=>{if(e.createUpdateQuestions.length>=100){v.warning("Each question set could have at most 100 questions");return}e.createUpdateQuestions=[...e.createUpdateQuestions,C()],A(()=>{var n,o;(o=(n=q.value)==null?void 0:n.forceUpdate)==null||o.call(n),A(()=>{const c=e.createUpdateQuestions.length;requestAnimationFrame(()=>{var x;(x=q.value)==null||x.scrollToItem(c)})})})},B=n=>{if(e.createUpdateQuestions.length<=1){v.warning("Each question set must have at least 1 questions");return}const o=e.createUpdateQuestions[n].id;o&&e.deleteQuestionIds.push(o),e.createUpdateQuestions=[...e.createUpdateQuestions.slice(0,n),...e.createUpdateQuestions.slice(n+1)]},F=()=>{let n=!1,o="Invalid question.",c=new Set;if(e.name.trim().length>100||e.name.trim().length===0){n=!0,o="Invalid title.",v.error(o);return}if(e.description.trim().length>250){n=!0,o="Invalid description.",v.error(o);return}[e.createUpdateQuestions.filter(r=>{const s=r.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return s.length===0||s.length>=500}),e.createUpdateQuestions.filter(r=>(r.explainText?r.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),e.createUpdateQuestions.filter(r=>r.type===b.MULTIPLE_CHOICE&&(r.multipleChoices.some(s=>s.text.trim().length===0||s.text.trim().length>500)||r.multipleChoices.filter(s=>s.isAnswer).length===0)),e.createUpdateQuestions.filter(r=>r.type===b.MATCHING&&(r.matchingPairs.some(s=>s.leftItem.trim().length===0||s.leftItem.trim().length>500)||r.matchingPairs.some(s=>s.rightItem.trim().length===0||s.rightItem.trim().length>500))),e.createUpdateQuestions.filter(r=>r.type===b.ORDERING&&r.orderingItems.some(s=>s.text.trim().length===0||s.text.trim().length>500)),e.createUpdateQuestions.filter(r=>r.type===b.SHORT_TEXT&&(r.shortAnswer.trim().length===0||r.shortAnswer.trim().length>500))].forEach(r=>{r.length>0&&(n=!0,r.forEach(s=>c.add(s)))});let X=Array.from(c).map(r=>e.createUpdateQuestions.indexOf(r)+1);n?D.error({title:"Cannot create new question set!",content:"There are errors at questions: "+X.sort().join(", ")}):V()},V=()=>{D.confirm({title:"Create new quiz!",content:"Make sure to review your contents before proceeding.",centered:!0,onOk:async()=>{e.createUpdateQuestions=e.createUpdateQuestions.map(o=>o.id.startsWith("new_")?{...o,id:""}:o);let n=await P.Update(m.value.testTemplateId,e);n.data.success&&v.success(n.data.data)}})},z=g(null),j=()=>{var n;(n=z.value)==null||n.openImportModal()},O=g(null),H=()=>{var n;(n=O.value)==null||n.openGenerateAIModal()},Y=n=>{e.createUpdateQuestions.push(...n.map((o,c)=>({...o,id:`new_${e.createUpdateQuestions.length+c}`}))),v.success(`Imported ${n.length} questions`)};function y(n){n.preventDefault(),n.returnValue=""}te((n,o,c)=>{if(!h.value){c();return}D.confirm({title:"Leave already?",content:"You have unsaved changes.",onOk:()=>{c()},onCancel:()=>c(!1)})}),ne(()=>{window.removeEventListener("beforeunload",y)});const q=g(null),W=()=>{A(()=>{var n,o;(o=(n=q.value)==null?void 0:n.forceUpdate)==null||o.call(n)})};oe(async()=>{await f()});const E={t:R,router:t,route:U,loading:S,testTemplateId:_,testTemplate:m,isDataValid:h,getTestTemplate:f,formRef:M,formState:e,rules:I,componentMap:k,createQuestionTemplate:C,onAddQuestion:N,onRemoveQuestion:B,onFinish:F,showModalConfirmation:V,importModalRef:z,onOpenImportModal:j,generateModalRef:O,openGenerateAIModal:H,onModalImport:Y,handleBeforeUnload:y,scrollerRef:q,handleScroll:W,Input:ue,TextArea:ce,ImportQSModal:Qe,GenerateQSModal:ve,get DynamicScroller(){return he},get DynamicScrollerItem(){return _e}};return Object.defineProperty(E,"__isScriptSetup",{enumerable:!1,value:!0}),E}}),Ie={class:"page-container"},qe={class:"title-container"},we={class:"content"},Te={class:"content-item"},be={class:"content-item-title"},Ue={class:"d-flex"},Me={class:"content-item"},ye={class:"content-item-title"},xe={class:"content-item-buttons"},Ae={class:"import-button"},De={key:0};function Re(d,i,R,t,U,S){const _=Q("RouterLink"),m=Q("a-col"),h=Q("a-row"),f=Q("a-skeleton"),M=Q("a-form");return w(),L(se,null,[a("div",Ie,[a("div",qe,[l(h,{class:"w-100 d-flex align-items-center"},{default:p(()=>[l(m,{span:1},{default:p(()=>[l(_,{to:{name:"User_Library"}},{default:p(()=>i[3]||(i[3]=[a("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[3]})]),_:1}),l(m,{class:"main-title",span:23},{default:p(()=>[a("span",null,u(d.$t("create_QS.title")),1),i[4]||(i[4]=T()),i[5]||(i[5]=a("br",null,null,-1)),a("span",null,u(d.$t("create_QS.sub_title")),1)]),_:1,__:[4,5]})]),_:1})]),a("div",we,[l(M,{layout:"vertical",modelValue:t.formState,"onUpdate:modelValue":i[2]||(i[2]=e=>t.formState=e),rules:t.rules,ref:"formRef"},{default:p(()=>[a("div",Te,[a("div",be,[a("div",null,[a("span",null,u(d.$t("create_QS.quiz.question_detail_title")),1),a("span",null,u(d.$t("create_QS.quiz.question_detail_sub_title")),1)])]),l(t.Input,{class:"question-input-item",modelValue:t.formState.name,"onUpdate:modelValue":i[0]||(i[0]=e=>t.formState.name=e),isRequired:!0,placeholder:t.t("question_sets_index.search_placeholder"),label:t.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),a("div",Ue,[l(t.TextArea,{class:"question-input-item",modelValue:t.formState.description,"onUpdate:modelValue":i[1]||(i[1]=e=>t.formState.description=e),placeholder:"textarea with clear icon","max-length":250,label:t.t("create_QS.quiz.description")},null,8,["modelValue","label"])])]),a("div",Me,[a("div",ye,[a("div",null,[a("span",null,u(d.$t("create_QS.quiz.question_question_title")),1),a("span",null,u(d.$t("create_QS.quiz.question_question_sub_title")),1)]),a("div",xe,[l(_,{onClick:t.onOpenImportModal,class:"import-button",to:{name:""}},{default:p(()=>[T(u(d.$t("create_QS.buttons.import"))+" ",1),i[6]||(i[6]=a("i",{class:"bx bx-download"},null,-1))]),_:1,__:[6]}),l(_,{onClick:t.openGenerateAIModal,class:"import-button",to:{name:""}},{default:p(()=>[T(u(d.$t("create_QS.buttons.generated_by_ai"))+" ",1),i[7]||(i[7]=a("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[7]}),a("div",{class:"import-button",onClick:t.onFinish},u(d.$t("create_QS.buttons.create")),1),a("div",Ae,u(d.$t("create_QS.quiz.total",{number:t.formState.createUpdateQuestions.length.toString().padStart(3,"0")})),1)])]),t.loading?(w(),L("div",De,[l(f,{loading:t.loading,active:""},null,8,["loading"]),l(f,{loading:t.loading,active:""},null,8,["loading"]),l(f,{loading:t.loading,active:""},null,8,["loading"]),l(f,{loading:t.loading,active:""},null,8,["loading"]),l(f,{loading:t.loading,active:""},null,8,["loading"])])):re("v-if",!0),l(t.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:t.formState.createUpdateQuestions,"min-item-size":650,buffer:800,prerender:10,onScroll:t.handleScroll},{default:p(({item:e,index:I})=>[(w(),G(t.DynamicScrollerItem,{item:e,key:e.id},{default:p(()=>[(w(),G(ie(t.componentMap[e.type]),{question:e,index:I+1,displayScore:!1,onDeleteQuestion:k=>t.onRemoveQuestion(I)},null,40,["question","index","onDeleteQuestion"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),a("div",{class:"add-question-btn",onClick:t.onAddQuestion},[i[8]||(i[8]=a("i",{class:"bx bx-plus"},null,-1)),T(" "+u(d.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),l(t.ImportQSModal,{ref:"importModalRef",title:t.formState.name,onImport:t.onModalImport},null,8,["title"]),l(t.GenerateQSModal,{ref:"generateModalRef",title:t.formState.name,onImport:t.onModalImport},null,8,["title"])],64)}const Be=ae(Se,[["render",Re],["__scopeId","data-v-48787c2a"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test_template/update.vue"]]);export{Be as default};

import{d as xe,T as B,u as be,q as Te,l as ye,i as d,B as U,a3 as Ae,s as qe,k as O,S as Ce,M as Se,G as Qe,_ as ke,r as M,a as m,o as u,b as i,c as h,w as x,f as R,t as v,E as $,F as P,D as z,p as _,e as X}from"./index-DpsX2GFI.js";import{A as ie}from"./ApiTest-DjFXgMvd.js";import{Q as y}from"./questionTypes-CS3lcRlq.js";import{H as Oe,Q as Me}from"./questionTextFormat-C4xBDw4R.js";import{T as Ee,l as De}from"./vue-draggable-plus-VN-_ajwE.js";import{V as Ue}from"./Validator-CWeiTIFe.js";import{u as Re}from"./utc-tFrh5C7_.js";/* empty css                                                                 */function Le(T=[],o=[]){const s=[];for(let e=0;e<T.length;e++)s.push({leftId:T[e].id,rightId:o[e].id});return s}class He{transferToUserAnswerSubmit(o){return console.log(o),o.map(s=>{var e;return{questionId:s.questionId,userAnswerData:{type:s.type,multipleChoice:s.multipleChoices??[],matching:Le(s.matchingLeft??[],s.matchingRight??[]),ordering:((e=s.ordering)==null?void 0:e.map((I,g)=>({itemId:I.id,order:g})))??[],shortText:s.shortText??""}}})}transferFromUserAnswerSubmit(o){return o.filter(s=>s.userAnswerData!=null).map(s=>{var e,I,g;return{questionId:s.questionId,type:s.userAnswerData.type,multipleChoices:s.userAnswerData.multipleChoice??[],matchingLeft:(e=s.userAnswerData.matching)!=null&&e.length?s.userAnswerData.matching.map(c=>({id:c.leftId})):[],matchingRight:(I=s.userAnswerData.matching)!=null&&I.length?s.userAnswerData.matching.map(c=>({id:c.rightId})):[],ordering:(g=s.userAnswerData.ordering)!=null&&g.length?s.userAnswerData.ordering.map(c=>({id:c.itemId})):[],shortText:s.userAnswerData.shortText??""}})}}const ae=new He,Ne=xe({__name:"attempt",setup(T,{expose:o}){o(),B.extend(Re);const{t:s}=be(),e=Te(),I=ye(),g=d([]),c=d([]),a=d({id:"",explainText:"",questionSetId:"",questionText:"",score:0,scoreGraded:0,textFormat:"0",type:"MultipleChoice",correctMultipleChoiceCount:0,questionData:{matching:null,multipleChoice:null,ordering:null,shortText:""}}),C=d(""),S=d(!1),L=d(!1),E=d([]),H=d([]),r=d([]),f=d([]),Q=d(""),ee=d(!0),J=d(e.params.id.toString()),b=d({attemptId:"",name:"",questionCount:0,timeStart:"",timeEnd:"",timeLimit:0,timeRemaining:0,questions:[]}),K=d(!1),te=async()=>{try{if(K.value=!0,!Ue.isValidGuid(J.value)){ee.value=!1,I.push({name:"404"});return}const t=await ie.Attempt(J.value);if(b.value=t.data.data,b.value.timeRemaining<=0){O.error(s("message.time_up")),I.push({name:"User_Class"});return}g.value=[...t.data.data.questions.map(n=>({id:n.questionId,...n}))],c.value=ae.transferFromUserAnswerSubmit(t.data.data.questions.map(n=>({questionId:n.id,userAnswerData:n.userAnswerDataDto}))),a.value=g.value[0]}catch(t){Object.keys(t.response.data.errors).includes(Ce.MAX_ATTEMPT_IN_THIS_TEST)&&I.back()}finally{K.value=!1}},N=(t,n)=>{t===-1?c.value.push(n):c.value[t]=n},re=()=>{const t=c.value.findIndex(n=>n.questionId===a.value.id);switch(a.value.type){case y.MULTIPLE_CHOICE:{E.value.length>0?N(t,{questionId:a.value.id,type:a.value.type,multipleChoices:[...E.value],matchingLeft:null,matchingRight:null,ordering:null,shortText:""}):t!==-1&&c.value.splice(t,1);break}case y.MATCHING:{N(t,{questionId:a.value.id,type:a.value.type,multipleChoices:null,matchingLeft:[...H.value],matchingRight:[...r.value],ordering:null,shortText:""});break}case y.ORDERING:{N(t,{questionId:a.value.id,type:a.value.type,multipleChoices:null,matchingLeft:null,matchingRight:null,ordering:[...f.value],shortText:""});break}case y.SHORT_TEXT:{Q.value.trim()?N(t,{questionId:a.value.id,type:a.value.type,multipleChoices:null,matchingLeft:null,matchingRight:null,ordering:null,shortText:Q.value.trim()}):t!==-1&&c.value.splice(t,1);break}}},G=async t=>{const n=ae.transferToUserAnswerSubmit(c.value);return(await ie.Submit({attemptId:b.value.attemptId,userAnswers:n,isSubmit:t})).data.success},le=()=>{Se.confirm({title:s("attempt_test.submit_modal.title"),content:s("attempt_test.submit_modal.content"),centered:!0,okText:s("sidebar.buttons.ok"),cancelText:s("sidebar.buttons.cancel"),onOk:async()=>{if(!await G(!0)){O.error(s("message.submited_failed"));return}O.info(s("message.submited_successfully")),I.push({name:"User_Class"})}})},Y=t=>{var D;j(),S.value=!1,a.value=g.value[t];const n=c.value.find(l=>l.questionId===a.value.id);switch(a.value.type){case y.MULTIPLE_CHOICE:{C.value=s("learn_QS.instructions.multiple_choice",{number:a.value.correctMultipleChoiceCount}),E.value=n?n==null?void 0:n.multipleChoices:[];break}case y.ORDERING:{C.value=s("learn_QS.instructions.ordering"),f.value=n?n==null?void 0:n.ordering.map(l=>{var p,w;return{id:l.id,text:(w=(p=a.value.questionData.ordering)==null?void 0:p.find(q=>q.id===l.id))==null?void 0:w.text}}):((D=a.value.questionData.ordering)==null?void 0:D.map(l=>l))||[];break}case y.MATCHING:{C.value=s("learn_QS.instructions.matching"),H.value=n?n==null?void 0:n.matchingLeft.map(l=>{var p,w;return{id:l.id,text:(w=(p=a.value.questionData.matching)==null?void 0:p.leftItems.find(q=>q.id===l.id))==null?void 0:w.text}}):a.value.questionData.matching.leftItems.map(l=>l)||[],r.value=n?n==null?void 0:n.matchingRight.map(l=>{var p,w;return{id:l.id,text:(w=(p=a.value.questionData.matching)==null?void 0:p.rightItems.find(q=>q.id===l.id))==null?void 0:w.text}}):a.value.questionData.matching.rightItems.map(l=>l)||{};break}case y.SHORT_TEXT:{C.value=s("learn_QS.instructions.short_text"),Q.value=n?n==null?void 0:n.shortText:"";break}}},ue=()=>{const t=g.value.findIndex(n=>n.id===a.value.id);t<g.value.length-1&&Y(t+1)},ce=()=>{const t=g.value.findIndex(n=>n.id===a.value.id);t>0&&Y(t-1)},de=t=>Array.from(c.value).some(n=>n.questionId===t),me=U(()=>{const t=g.value.findIndex(n=>n.id===a.value.id);return t!==-1&&t<g.value.length-1}),ge=U(()=>{const t=g.value.findIndex(n=>n.id===a.value.id);return t!==-1&&t>0}),he=U(()=>g.value.findIndex(t=>t.id===a.value.id)),ve={scroll:!0,scrollSensitivity:100,scrollSpeed:100,scrollTarget:document.scrollingElement};function j(){Qe(()=>{requestAnimationFrame(()=>{const t=document.querySelectorAll(".matching-option-container.left .answer-option-matching"),n=document.querySelectorAll(".matching-option-container.right .answer-option-matching"),D=Math.min(t.length,n.length);for(let l=0;l<D;l++){const p=t[l],w=n[l];if(!p||!w)continue;p.style.height="auto",w.style.height="auto";const q=Math.max(p.offsetHeight,w.offsetHeight);p.style.height=`${q}px`,w.style.height=`${q}px`}})})}const _e=U(()=>{var t;return(t=a.value.questionData.multipleChoice)==null?void 0:t.some(n=>n.text.length>=100)}),W=d(B().add(b.value.timeRemaining*60,"second")),V=d(b.value.timeRemaining*60);let A=null;const fe=U(()=>{const t=Math.floor(V.value/60).toString().padStart(2,"0"),n=(V.value%60).toString().padStart(2,"0");return`${t}:${n}`}),Z=async()=>{const t=W.value.diff(B(),"second");if(V.value=t>0?t:0,t<=0&&A){if(clearInterval(A),A=null,!await G(!0)){O.error(s("message.submited_failed"));return}O.info(s("message.time_up")),I.push({name:"User_Class"})}};let F=null;const ne=async()=>{if(!await G(!1)){O.error(s("message.auto_save_failed"));return}O.info(s("message.auto_save_successfully"))},k=d(new Set),pe=()=>{const t=a.value.id;k.value.delete(t)||k.value.add(t),localStorage.setItem("flagged_question",JSON.stringify({attemptId:b.value.attemptId,questions:Array.from(k.value)}))},se=()=>{const t=localStorage.getItem("flagged_question");if(!t)return;const n=JSON.parse(t);if(n.attemptId!=b.value.attemptId){localStorage.removeItem("flagged_question");return}if(!Array.isArray(n.questions)){localStorage.removeItem("flagged_question");return}k.value=new Set(n.questions)},we=t=>Array.from(k.value).some(n=>n===t),Ie=U(()=>{const t=a.value.id;return Array.from(k.value).some(n=>n===t)});Ae(()=>{A&&clearInterval(A),F&&clearInterval(F)}),qe(async()=>{j(),window.addEventListener("resize",j),await te(),V.value=b.value.timeRemaining*60,W.value=B().add(b.value.timeRemaining*60,"second"),Y(0),se(),Z(),A=setInterval(Z,1e3),F=setInterval(ne,3e4)});const oe={t:s,route:e,router:I,quiz:g,userAnswer:c,currentQuestion:a,currentQuestionInstruction:C,currentQuestionIsSkipped:S,isSubmitted:L,userAnswerMultipleChoice:E,userAnswerMatchingLeft:H,userAnswerMatchingRight:r,userAnswerOrdering:f,userAnswerShortText:Q,isDataValid:ee,testId:J,attemptData:b,loading:K,getAttemptData:te,updateUserAnswer:N,onUserAnswerChange:re,sendUserAnswer:G,onSubmit:le,onLoadCurrentQuestion:Y,onNextQuestion:ue,onPreviousQuestion:ce,userAnswerContainQuestion:de,hasNextQuestion:me,hasPreviousQuestion:ge,currentQuestionIndex:he,dragOptions:ve,syncMatchingHeights:j,isOptionExceed:_e,endTime:W,remainingTime:V,get timer(){return A},set timer(t){A=t},formattedTime:fe,updateCountdown:Z,get autoSaver(){return F},set autoSaver(t){F=t},autoSave:ne,flaggedQuestion:k,onToggleFlagQuestion:pe,onLoadFlaggedQuestion:se,flagContainQuestion:we,isCurrentQuestionFlagged:Ie,get QUESTION_TYPE(){return y},get QUESTION_FORMAT(){return Me},TextArea:Ee,get VueDraggable(){return De},get HolderOutlined(){return Oe}};return Object.defineProperty(oe,"__isScriptSetup",{enumerable:!1,value:!0}),oe}}),Ve={class:"page-container"},Fe={class:"title-container title-container-header"},Pe={class:"content content-test d-flex flex-column"},ze={class:"d-flex"},Ge={class:"content-item question-navigators"},Ye={class:"question-navigator-title d-flex justify-content-between align-items-center"},je={class:"countdown d-flex align-items-center"},Be={key:1,class:"question-navigator-container"},Xe=["onClick"],Je={class:"content-item"},Ke={key:0},We={key:1,class:"section question-section"},Ze={class:"question-info-index"},$e=["innerHTML"],et={key:1,class:_(["learn-question"])},tt={class:"section answer-section"},nt={class:"d-flex align-items-center"},st={class:"answer-section-ins"},ot={class:"answer-option-content"},it={key:1,class:"answer-option-container matching"},at={class:"matching-option-container left"},rt={class:"d-flex align-items-center"},lt={class:_(["answer-option answer-option-matching"])},ut={class:"answer-option-order"},ct={class:"answer-option-content"},dt={class:"matching-option-container right"},mt={class:"d-flex align-items-center"},gt={class:_(["answer-option answer-option-matching"])},ht={class:"answer-option-content"},vt={class:"answer-option-order"},_t={key:2,class:"answer-option-container ordering"},ft={class:_(["answer-option answer-option-ordering"])},pt={class:"answer-option-order"},wt={class:"answer-option-content"},It={key:3,class:"answer-option-container"},xt={class:_(["answer-short-text"])},bt={class:"w-100 d-flex align-items-center"},Tt={class:"learn-question-footer"},yt={class:"d-flex"};function At(T,o,s,e,I,g){const c=M("RouterLink"),a=M("a-col"),C=M("a-row"),S=M("a-skeleton"),L=M("a-button"),E=M("a-checkbox"),H=M("a-checkbox-group");return u(),m("div",Ve,[i("div",Fe,[h(C,{class:"w-100 d-flex align-items-center"},{default:x(()=>[h(a,{span:1},{default:x(()=>[h(c,{to:{name:"User_Class"}},{default:x(()=>o[7]||(o[7]=[i("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[7]})]),_:1}),h(a,{class:"main-title",span:22},{default:x(()=>{var r,f;return[i("span",null,v((r=e.attemptData)==null?void 0:r.name),1),o[8]||(o[8]=R()),o[9]||(o[9]=i("br",null,null,-1)),i("span",null,v((f=e.attemptData)==null?void 0:f.questionCount),1)]}),_:1,__:[8,9]})]),_:1})]),i("div",Pe,[i("div",ze,[i("div",Ge,[i("div",Ye,[i("span",null,v(e.t("practice_test.other.question_list")),1),i("span",je,[o[10]||(o[10]=i("i",{class:"bx bx-timer"},null,-1)),R(" "+v(e.formattedTime),1)])]),e.loading?(u(),$(S,{key:0,loading:e.loading},null,8,["loading"])):(u(),m("div",Be,[(u(!0),m(P,null,z(e.quiz,(r,f)=>(u(),m("div",{class:_(["question-navigation-item-outer",e.currentQuestion.id===r.id?"current-question":"",e.flagContainQuestion(r.id)?"flagged-question":""]),onClick:Q=>e.onLoadCurrentQuestion(f)},[i("div",{class:_(["question-navigator-item",e.userAnswerContainQuestion(r.id)?"completed-question":""])},[i("span",null,v(f+1),1)],2)],10,Xe))),256))])),h(L,{type:"primary",class:_(["main-color-btn",e.isSubmitted?"main-color-btn-disabled":""]),onClick:e.onSubmit},{default:x(()=>[R(v(T.$t("learn_QS.buttons.submit")),1)]),_:1},8,["class"])])]),i("div",Je,[e.loading?(u(),m("div",Ke,[h(S,{loading:e.loading},null,8,["loading"]),h(S,{loading:e.loading},null,8,["loading"]),h(S,{loading:e.loading},null,8,["loading"])])):(u(),m("div",We,[i("div",Ze,v(T.$t("create_QS.question.question"))+" "+v(e.currentQuestionIndex+1),1),e.currentQuestion.textFormat===e.QUESTION_FORMAT.HTML?(u(),m("div",{key:0,class:_(["learn-question"]),innerHTML:e.currentQuestion.questionText},null,8,$e)):(u(),m("div",et,v(e.currentQuestion.questionText),1)),i("div",tt,[i("div",nt,[i("div",st,v(e.currentQuestionInstruction),1)]),e.currentQuestion.type===e.QUESTION_TYPE.MULTIPLE_CHOICE?(u(),$(H,{key:0,onChange:e.onUserAnswerChange,value:e.userAnswerMultipleChoice,"onUpdate:value":o[0]||(o[0]=r=>e.userAnswerMultipleChoice=r),class:_(["answer-option-container multiplechoice",e.isOptionExceed?"column":""])},{default:x(()=>[(u(!0),m(P,null,z(e.currentQuestion.questionData.multipleChoice,(r,f)=>(u(),$(E,{value:r.id,"onUpdate:value":Q=>r.id=Q,class:_(["answer-option answer-option-multiplechoice"])},{default:x(()=>[i("div",ot,v(r.text),1)]),_:2},1032,["value","onUpdate:value"]))),256))]),_:1},8,["value","class"])):X("v-if",!0),e.currentQuestion.type===e.QUESTION_TYPE.MATCHING?(u(),m("div",it,[i("div",at,[h(e.VueDraggable,{modelValue:e.userAnswerMatchingLeft,"onUpdate:modelValue":o[1]||(o[1]=r=>e.userAnswerMatchingLeft=r),options:e.dragOptions,onMove:e.syncMatchingHeights,onEnd:o[2]||(o[2]=()=>{e.syncMatchingHeights(),e.onUserAnswerChange()})},{default:x(()=>[(u(!0),m(P,null,z(e.userAnswerMatchingLeft,(r,f)=>(u(),m("div",rt,[i("div",lt,[i("div",ut,[h(e.HolderOutlined)]),i("div",ct,v(r.text),1)]),o[11]||(o[11]=i("i",{class:_(["bx bxs-label matching-icon"])},null,-1))]))),256))]),_:1},8,["modelValue"])]),i("div",dt,[h(e.VueDraggable,{modelValue:e.userAnswerMatchingRight,"onUpdate:modelValue":o[3]||(o[3]=r=>e.userAnswerMatchingRight=r),options:e.dragOptions,onMove:e.syncMatchingHeights,onEnd:o[4]||(o[4]=()=>{e.syncMatchingHeights(),e.onUserAnswerChange()})},{default:x(()=>[(u(!0),m(P,null,z(e.userAnswerMatchingRight,(r,f)=>(u(),m("div",mt,[o[12]||(o[12]=i("i",{class:_(["bx bxs-label matching-icon"])},null,-1)),i("div",gt,[i("div",ht,v(r.text),1),i("div",vt,[h(e.HolderOutlined)])])]))),256))]),_:1},8,["modelValue"])])])):X("v-if",!0),e.currentQuestion.type===e.QUESTION_TYPE.ORDERING?(u(),m("div",_t,[h(e.VueDraggable,{modelValue:e.userAnswerOrdering,"onUpdate:modelValue":o[5]||(o[5]=r=>e.userAnswerOrdering=r),options:e.dragOptions,onEnd:e.onUserAnswerChange},{default:x(()=>[(u(!0),m(P,null,z(e.userAnswerOrdering,(r,f)=>(u(),m("div",ft,[i("div",pt,[h(e.HolderOutlined),R(" "+v(f+1),1)]),i("div",wt,v(r.text),1)]))),256))]),_:1},8,["modelValue"])])):X("v-if",!0),e.currentQuestion.type===e.QUESTION_TYPE.SHORT_TEXT?(u(),m("div",It,[i("div",xt,[i("div",bt,[h(e.TextArea,{placeholder:"Enter your answer...",modelValue:e.userAnswerShortText,"onUpdate:modelValue":o[6]||(o[6]=r=>e.userAnswerShortText=r),onChange:e.onUserAnswerChange},null,8,["modelValue"])])])])):X("v-if",!0)]),i("div",Tt,[h(L,{class:_(["main-color-btn",e.hasPreviousQuestion?"":"main-color-btn-disabled"]),type:"primary",size:"large",onClick:e.onPreviousQuestion},{default:x(()=>[o[13]||(o[13]=i("i",{class:"bx bx-chevron-left"},null,-1)),R(" "+v(T.$t("practice_test.buttons.previous")),1)]),_:1,__:[13]},8,["class"]),i("i",{class:_(["bx bx-flag flag-button",e.isCurrentQuestionFlagged?"bxs-flag":""]),onClick:e.onToggleFlagQuestion},null,2),i("div",yt,[h(L,{class:_(["main-color-btn",e.hasNextQuestion?"":"main-color-btn-disabled"]),type:"primary",size:"large",onClick:e.onNextQuestion},{default:x(()=>[R(v(T.$t("learn_QS.buttons.next_question"))+" ",1),o[14]||(o[14]=i("i",{class:"bx bx-chevron-right"},null,-1))]),_:1,__:[14]},8,["class"])])])]))])])])}const Dt=ke(Ne,[["render",At],["__scopeId","data-v-b60278b8"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/test/attempt.vue"]]);export{Dt as default};

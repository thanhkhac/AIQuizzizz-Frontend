import{d as j,u as Y,i as v,j as J,V as X,s as K,W as Z,k as h,X as A,M as Q,_ as $,r as I,a as k,o as w,b as n,c as d,w as m,f as S,t as u,F as z,E as ee,G as E,N as te}from"./index-C2jtDg6B.js";import{A as ne}from"./ApiQuestionSet-C75xoSuo.js";import{I as oe}from"./Input-0Otcuoto.js";import{T as ie}from"./TextArea-SkV_8IH8.js";import{S as re,O as se,M as ae,a as le,s as ce,b as de}from"./vue-virtual-scroller.esm-D8MvBVCq.js";import{G as ue,I as me}from"./GenerateQSModal-Cbah8nW_.js";import{Q as b}from"./questionTypes-CS3lcRlq.js";/* empty css                                                                 */import"./vue-draggable-plus-DALPiNCD.js";import"./ApiTestTemplate-Ds5LzdWO.js";const pe=j({__name:"create",setup(c,{expose:i}){i();const{t:O}=Y(),e=v(),o=J({name:"",description:"",tags:[],questions:[]}),P={title:[{required:"true",message:"This field is required",trigger:"change"},{length:100,message:"Limit 100",trigger:"change"}],description:[{length:200,message:"Limit 200",trigger:"change"}],tags:[{validator:(t,s)=>s&&s.length>5?Promise.reject("You can only add up to 5 tags."):Promise.resolve(),trigger:"change"}],questions:[{validator:(t,s)=>s&&s.length>500?Promise.reject("You can only add up to 5 questions."):Promise.resolve(),trigger:"change"}]},_={MultipleChoice:le,Matching:ae,Ordering:se,ShortText:re},q=[{id:"q1",type:"MultipleChoice",questionText:"What is the capital of France ?",questionHTML:"<p><strong>What</strong> is <br/> the <em>capital</em> of <u>France</u>? <code>// geography</code></p>",explainText:"Paris is the capital city of France.",score:10,multipleChoices:[{id:"1",text:"Paris",isAnswer:!0},{id:"2",text:"London",isAnswer:!1},{id:"3",text:"Berlin",isAnswer:!1}],matchingPairs:[],orderingItems:[],shortAnswer:""},{id:"q2",type:"Matching",questionText:"Match the countries to their capitals.",questionHTML:"<p><u>Match</u> the <strong>countries</strong> to their <em>capitals</em>. <code>// matching task</code></p>",explainText:"Each country must be paired with its capital.",score:10,multipleChoices:[],matchingPairs:[{id:"1",leftItem:"Japan",rightItem:"Tokyo"},{id:"2",leftItem:"Italy",rightItem:"Rome"},{id:"3",leftItem:"Vietnam",rightItem:"Hanoi"}],orderingItems:[],shortAnswer:""},{id:"q3",type:"Ordering",questionText:"Arrange the steps of the water cycle in the correct order.",questionHTML:"<p><strong>Arrange</strong> the steps of the <u>water cycle</u> in the <em>correct order</em>. <code>// science</code></p>",explainText:"The correct order is: Evaporation → Condensation → Precipitation → Collection.",score:10,multipleChoices:[],matchingPairs:[],orderingItems:[{id:"1",text:"Evaporation",correctOrder:0},{id:"2",text:"Condensation",correctOrder:1},{id:"3",text:"Precipitation",correctOrder:2},{id:"4",text:"Collection",correctOrder:3}],shortAnswer:""},{id:"q4",type:"ShortText",questionText:"What is the chemical symbol for water?",questionHTML:"<p><em>What</em> is the chemical <strong>symbol</strong> for <u>water</u>? <code>H2O</code></p>",explainText:"H2O is the formula for water.",score:10,multipleChoices:[],matchingPairs:[],orderingItems:[],shortAnswer:"H2O"},{id:"q5",type:"MultipleChoice",questionText:"Which planet is known as the Red Planet?",questionHTML:"<p>Which <strong>planet</strong> is known as the <em>Red Planet</em>? <u>Mars</u> <pre><code>// astronomy</code></pre></p>",explainText:"Mars is often called the Red Planet due to its reddish appearance.",score:10,multipleChoices:[{id:"1",text:"Mars",isAnswer:!0},{id:"2",text:"Venus",isAnswer:!1},{id:"3",text:"Jupiter",isAnswer:!1}],matchingPairs:[],orderingItems:[],shortAnswer:""}],f=v(""),T=()=>{if(o.tags.length>=5){h.warning("Limit : 5 tags");return}f.value&&f.value.trim().length<=50?(o.tags.push(f.value),f.value=""):h.warning("Invalid tag content")},l=t=>{o.tags.splice(t,1)},g=()=>({id:Date.now().toString(),type:"MultipleChoice",questionText:"",questionHTML:"",explainText:"",score:10,multipleChoices:[{id:(Date.now()+1).toString(),text:"",isAnswer:!0},{id:(Date.now()+2).toString(),text:"",isAnswer:!1},{id:(Date.now()+3).toString(),text:"",isAnswer:!1},{id:(Date.now()+4).toString(),text:"",isAnswer:!1}],matchingPairs:[{id:(Date.now()+1).toString(),leftItem:"",rightItem:""},{id:(Date.now()+2).toString(),leftItem:"",rightItem:""}],orderingItems:[{id:(Date.now()+1).toString(),text:"",correctOrder:0},{id:(Date.now()+2).toString(),text:"",correctOrder:1},{id:(Date.now()+3).toString(),text:"",correctOrder:2},{id:(Date.now()+4).toString(),text:"",correctOrder:3}],shortAnswer:""}),M=async()=>{if(o.questions.length>=10){h.warning("Each question set could have at most 100 questions");return}o.questions=[...o.questions,g()],A(()=>{var t,s;(s=(t=x.value)==null?void 0:t.forceUpdate)==null||s.call(t),A(()=>{const p=o.questions.length;requestAnimationFrame(()=>{var C;(C=x.value)==null||C.scrollToItem(p)})})})},H=t=>{if(o.questions.length<=1){h.warning("Each question set must have at least 1 questions");return}o.questions=[...o.questions.slice(0,t),...o.questions.slice(t+1)]},U=()=>{let t=!1,s="Invalid question.",p=new Set;if(o.name.trim().length>100||o.name.trim().length===0){t=!0,s="Invalid title.",h.error(s);return}if(o.description.trim().length>250){t=!0,s="Invalid description.",h.error(s);return}[o.questions.filter(r=>{const a=r.questionText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim();return a.length===0||a.length>=500}),o.questions.filter(r=>(r.explainText?r.explainText.replace(/^<p>/,"").replace(/<\/p>$/,"").trim():"").length>=500),o.questions.filter(r=>r.type===b.MULTIPLE_CHOICE&&(r.multipleChoices.some(a=>a.text.trim().length===0||a.text.trim().length>500)||r.multipleChoices.filter(a=>a.isAnswer).length===0)),o.questions.filter(r=>r.type===b.MATCHING&&(r.matchingPairs.some(a=>a.leftItem.trim().length===0||a.leftItem.trim().length>500)||r.matchingPairs.some(a=>a.rightItem.trim().length===0||a.rightItem.trim().length>500))),o.questions.filter(r=>r.type===b.ORDERING&&r.orderingItems.some(a=>a.text.trim().length===0||a.text.trim().length>500)),o.questions.filter(r=>r.type===b.SHORT_TEXT&&(r.shortAnswer.trim().length===0||r.shortAnswer.trim().length>500))].forEach(r=>{r.length>0&&(t=!0,r.forEach(a=>p.add(a)))});let W=Array.from(p).map(r=>o.questions.indexOf(r)+1);t?Q.error({title:"Cannot create new question set!",content:"There are errors at questions: "+W.sort().join(", ")}):D()},D=()=>{Q.confirm({title:"Create new quiz!",content:"Make sure to review your contents before proceeding.",centered:!0,onOk:async()=>{let t=await ne.Create(o);t.data.success&&h.success(t.data.data)}})},R=v(null),F=()=>{var t;(t=R.value)==null||t.openImportModal()},L=v(null),G=()=>{var t;(t=L.value)==null||t.openGenerateAIModal()},B=t=>{o.questions.push(...t.map((s,p)=>({...s,id:`new_${o.questions.length+p}`}))),h.success(`Imported ${t.length} questions.`)};X((t,s,p)=>{Q.confirm({title:"Leave already?",content:"You have unsaved changes.",onOk:()=>{p()},onCancel:()=>p(!1)})});function y(t){t.preventDefault(),t.returnValue=""}const x=v(null),N=()=>{A(()=>{var t,s;(s=(t=x.value)==null?void 0:t.forceUpdate)==null||s.call(t)})};K(()=>{o.questions.push(...q),window.addEventListener("beforeunload",y)}),Z(()=>{window.removeEventListener("beforeunload",y)});const V={t:O,formRef:e,formState:o,rules:P,componentMap:_,question_data_raw:q,tagContent:f,addTag:T,removeTag:l,createQuestionTemplate:g,onAddQuestion:M,onRemoveQuestion:H,onFinish:U,showModalConfirmation:D,importModalRef:R,onOpenImportModal:F,generateModalRef:L,openGenerateAIModal:G,onModalImport:B,handleBeforeUnload:y,scrollerRef:x,handleScroll:N,Input:oe,TextArea:ie,ImportQSModal:me,GenerateQSModal:ue,get DynamicScroller(){return de},get DynamicScrollerItem(){return ce}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),ge={class:"page-container"},he={class:"title-container"},fe={class:"content"},_e={class:"content-item"},qe={class:"content-item-title"},ve={class:"d-flex"},we={class:"form-item"},Se={class:"tag-container"},xe=["onClick"],Ie={class:"tag-inputter"},be={class:"content-item"},Te={class:"content-item-title"},Me={class:"content-item-buttons"},ye={class:"import-button"};function Ce(c,i,O,e,o,P){const _=I("RouterLink"),q=I("a-col"),f=I("a-row"),T=I("a-form");return w(),k(z,null,[n("div",ge,[n("div",he,[d(f,{class:"w-100 d-flex align-items-center"},{default:m(()=>[d(q,{span:1},{default:m(()=>[d(_,{to:{name:"User_Library"}},{default:m(()=>i[4]||(i[4]=[n("i",{class:"bx bx-chevron-left navigator-back-button"},null,-1)])),_:1,__:[4]})]),_:1}),d(q,{class:"main-title",span:23},{default:m(()=>[n("span",null,u(c.$t("create_QS.title")),1),i[5]||(i[5]=S()),i[6]||(i[6]=n("br",null,null,-1)),n("span",null,u(c.$t("create_QS.sub_title")),1)]),_:1,__:[5,6]})]),_:1})]),n("div",fe,[d(T,{layout:"vertical",modelValue:e.formState,"onUpdate:modelValue":i[3]||(i[3]=l=>e.formState=l),rules:e.rules,ref:"formRef"},{default:m(()=>[n("div",_e,[n("div",qe,[n("div",null,[n("span",null,u(c.$t("create_QS.quiz.question_detail_title")),1),n("span",null,u(c.$t("create_QS.quiz.question_detail_sub_title")),1)])]),d(e.Input,{class:"question-input-item",modelValue:e.formState.name,"onUpdate:modelValue":i[0]||(i[0]=l=>e.formState.name=l),isRequired:!0,placeholder:e.t("question_sets_index.search_placeholder"),label:e.t("create_QS.quiz.title"),"max-length":100},null,8,["modelValue","placeholder","label"]),n("div",ve,[d(e.TextArea,{class:"question-input-item",modelValue:e.formState.description,"onUpdate:modelValue":i[1]||(i[1]=l=>e.formState.description=l),placeholder:"textarea with clear icon","max-length":250,label:e.t("create_QS.quiz.description")},null,8,["modelValue","label"]),n("div",we,[n("label",null,u(c.$t("create_QS.quiz.tag")),1),n("div",Se,[(w(!0),k(z,null,ee(e.formState.tags,(l,g)=>(w(),k("div",{class:"tag-item",key:g},[S(u(l)+" ",1),n("i",{class:"bx bx-x",onClick:M=>e.removeTag(g)},null,8,xe)]))),128))]),n("div",Ie,[d(e.Input,{modelValue:e.tagContent,"onUpdate:modelValue":i[2]||(i[2]=l=>e.tagContent=l),placeholder:e.t("question_sets_index.search_placeholder"),"max-length":50},{icon:m(()=>i[7]||(i[7]=[n("i",{class:"bx bx-purchase-tag-alt"},null,-1)])),_:1},8,["modelValue","placeholder"]),n("i",{class:"bx bx-plus tag-inputter-button",onClick:e.addTag})])])])]),n("div",be,[n("div",Te,[n("div",null,[n("span",null,u(c.$t("create_QS.quiz.question_question_title")),1),n("span",null,u(c.$t("create_QS.quiz.question_question_sub_title")),1)]),n("div",Me,[d(_,{onClick:e.onOpenImportModal,class:"import-button",to:{name:""}},{default:m(()=>[S(u(c.$t("create_QS.buttons.import"))+" ",1),i[8]||(i[8]=n("i",{class:"bx bx-download"},null,-1))]),_:1,__:[8]}),d(_,{onClick:e.openGenerateAIModal,class:"import-button",to:{name:""}},{default:m(()=>[S(u(c.$t("create_QS.buttons.generated_by_ai"))+" ",1),i[9]||(i[9]=n("i",{class:"bx bx-upload"},null,-1))]),_:1,__:[9]}),n("div",{class:"import-button",onClick:e.onFinish},u(c.$t("create_QS.buttons.create")),1),n("div",ye,u(c.$t("create_QS.quiz.total",{number:e.formState.questions.length.toString().padStart(3,"0")})),1)])]),d(e.DynamicScroller,{ref:"scrollerRef",class:"scroller","key-field":"id",items:e.formState.questions,"min-item-size":650,buffer:800,prerender:10,onScroll:e.handleScroll},{default:m(({item:l,index:g})=>[(w(),E(e.DynamicScrollerItem,{item:l,key:l.id},{default:m(()=>[(w(),E(te(e.componentMap[l.type]),{question:l,index:g+1,displayScore:!1,onDeleteQuestion:M=>e.onRemoveQuestion(g)},null,40,["question","index","onDeleteQuestion"]))]),_:2},1032,["item"]))]),_:1},8,["items"]),n("div",{class:"add-question-btn",onClick:e.onAddQuestion},[i[10]||(i[10]=n("i",{class:"bx bx-plus"},null,-1)),S(" "+u(c.$t("create_QS.buttons.add_question")),1)])])]),_:1},8,["modelValue"])])]),d(e.ImportQSModal,{ref:"importModalRef",title:e.formState.name,onImport:e.onModalImport},null,8,["title"]),d(e.GenerateQSModal,{ref:"generateModalRef",title:e.formState.name,onImport:e.onModalImport},null,8,["title"])],64)}const Ee=$(pe,[["render",Ce],["__scopeId","data-v-b7d6bbaa"],["__file","/home/runner/work/AIQuizzizz-Frontend/AIQuizzizz-Frontend/src/views/user/question_sets/create.vue"]]);export{Ee as default};
